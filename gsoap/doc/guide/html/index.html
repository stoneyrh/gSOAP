<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta http-equiv="cache-control" content="no-cache">
<title>Genivia - gSOAP user guide</title>
<link href="genivia_tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="genivia_content.css" rel="stylesheet" type="text/css">
</head>
<body>
<div id="top">
 <div id="titlearea">
  <table height="72px" width="100%" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td width="10%">&nbsp;</td>
     <td width="175px"><a href="https://www.genivia.com"><img alt="Genivia" src="GeniviaLogo2_trans_noslogan.png"/></a></td>
     <td class="tab_home"><a href="https://www.genivia.com">Home</a></td>
     <td class="tab_home"><a href="https://www.genivia.com/docs.html">Documentation</a></td>
     <td>
      <div style="float: right; font-size: 18px; font-weight: bold;">gSOAP user guide</div>
      <br>
      <div style="float: right; font-size: 10px;">updated Wed Apr 8 2020 by Robert van Engelen</div>
     </td>
     <td width="10%">&nbsp;</td>
    </tr>
   </tbody>
  </table>
 </div>
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">gSOAP user guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#intro">Introduction</a></li>
<li class="level1"><a href="#conventions">Notational conventions</a></li>
<li class="level1"><a href="#features">Tooling characteristics</a></li>
<li class="level1"><a href="#start-modules">API documentation modules</a></li>
<li class="level1"><a href="#start">Getting started</a><ul><li class="level2"><a href="#start-examples">Where to find examples</a></li>
<li class="level2"><a href="#start-client">Creating a SOAP/XML client application</a></li>
<li class="level2"><a href="#start-service">Creating a SOAP/XML service application</a></li>
</ul>
</li>
<li class="level1"><a href="#databindings">Introduction to XML data bindings</a></li>
<li class="level1"><a href="#guide">A quick user guide</a><ul><li class="level2"><a href="#client">How to build Web API clients</a><ul><li class="level3"><a href="#example1">Example</a></li>
<li class="level3"><a href="#namespace">XML namespace considerations</a></li>
<li class="level3"><a href="#example2">Example</a></li>
<li class="level3"><a href="#proxy">How to generate C++ client proxy classes</a></li>
<li class="level3"><a href="#encoding">XSD type serialization</a></li>
<li class="level3"><a href="#example3">Example</a></li>
<li class="level3"><a href="#response">How to change the response element name</a></li>
<li class="level3"><a href="#example4">Example</a></li>
<li class="level3"><a href="#multiple">How to specify multiple output parameters</a></li>
<li class="level3"><a href="#example5">Example</a></li>
<li class="level3"><a href="#compound">How to specify output parameters with compound data types</a></li>
<li class="level3"><a href="#example6">Example</a></li>
<li class="level3"><a href="#anonymous">How to specify anonymous parameter names</a></li>
<li class="level3"><a href="#noinparam">How to specify a service operation with no input parameters</a></li>
<li class="level3"><a href="#nooutparam">How to specify a service operation with no output parameters</a></li>
<li class="level3"><a href="#restclient">How to switch to REST from SOAP</a></li>
</ul>
</li>
<li class="level2"><a href="#services">How to build Web services APIs</a><ul><li class="level3"><a href="#example7">Example</a></li>
<li class="level3"><a href="#msvc">MSVC++ builds</a></li>
<li class="level3"><a href="#stand-alone">How to create a stand-alone server</a></li>
<li class="level3"><a href="#mt">How to create a multi-threaded stand-alone service</a></li>
<li class="level3"><a href="#user">How to pass application state info to service operations</a></li>
<li class="level3"><a href="#object">How to generate C++ server classes</a></li>
<li class="level3"><a href="#chaining">How to chain C++ server classes to accept messages on the same port</a></li>
<li class="level3"><a href="#wsdl">How to generate WSDL service descriptions</a></li>
<li class="level3"><a href="#example8">Example</a></li>
<li class="level3"><a href="#clientinservice">How to make client-side calls within a service operation</a></li>
<li class="level3"><a href="#restservice">How to switch to REST from SOAP</a></li>
</ul>
</li>
<li class="level2"><a href="#oneway1">Asynchronous one-way message passing</a></li>
<li class="level2"><a href="#bindings">How to use XML serializers to save and load application data</a><ul><li class="level3"><a href="#wsdl2h">Converting WSDL, WADL, and XML schema to C/C++ with wsdl2h</a></li>
<li class="level3"><a href="#soapcpp2mapping">Mapping C/C++ to XML schema with soapcpp2</a></li>
<li class="level3"><a href="#serialize">Serializing C/C++ data to XML</a></li>
<li class="level3"><a href="#example9">Example</a></li>
<li class="level3"><a href="#default">Default values for omitted XML elements and attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#wsdlin">The wsdl2h tool</a><ul><li class="level2"><a href="#wsdl2hoptions">wsdl2h options</a><ul><li class="level3"><a href="#wsdl2h-a">wsdl2h -a</a></li>
<li class="level3"><a href="#wsdl2h-b">wsdl2h -b</a></li>
<li class="level3"><a href="#wsdl2h-c">wsdl2h -c -c++ -c++11</a></li>
<li class="level3"><a href="#wsdl2h-D">wsdl2h -D</a></li>
<li class="level3"><a href="#wsdl2h-d">wsdl2h -d</a></li>
<li class="level3"><a href="#wsdl2h-e">wsdl2h -e</a></li>
<li class="level3"><a href="#wsdl2h-F">wsdl2h -F</a></li>
<li class="level3"><a href="#wsdl2h-f">wsdl2h -f</a></li>
<li class="level3"><a href="#wsdl2h-g">wsdl2h -g</a></li>
<li class="level3"><a href="#wsdl2h-h">wsdl2h -h</a></li>
<li class="level3"><a href="#wsdl2h-I">wsdl2h -I</a></li>
<li class="level3"><a href="#wsdl2h-i">wsdl2h -i</a></li>
<li class="level3"><a href="#wsdl2h-j">wsdl2h -j</a></li>
<li class="level3"><a href="#wsdl2h-k">wsdl2h -k</a></li>
<li class="level3"><a href="#wsdl2h-L">wsdl2h -L</a></li>
<li class="level3"><a href="#wsdl2h-l">wsdl2h -l</a></li>
<li class="level3"><a href="#wsdl2h-M">wsdl2h -M</a></li>
<li class="level3"><a href="#wsdl2h-m">wsdl2h -m</a></li>
<li class="level3"><a href="#wsdl2h-N">wsdl2h -N</a></li>
<li class="level3"><a href="#wsdl2h-n">wsdl2h -n</a></li>
<li class="level3"><a href="#wsdl2h-O">wsdl2h -O</a></li>
<li class="level3"><a href="#wsdl2h-o">wsdl2h -o</a></li>
<li class="level3"><a href="#wsdl2h-P">wsdl2h -P</a></li>
<li class="level3"><a href="#wsdl2h-p">wsdl2h -p</a></li>
<li class="level3"><a href="#wsdl2h-Q">wsdl2h -Q</a></li>
<li class="level3"><a href="#wsdl2h-q">wsdl2h -q</a></li>
<li class="level3"><a href="#wsdl2h-R">wsdl2h -R</a></li>
<li class="level3"><a href="#wsdl2h-r">wsdl2h -r</a></li>
<li class="level3"><a href="#wsdl2h-S">wsdl2h -S</a></li>
<li class="level3"><a href="#wsdl2h-s">wsdl2h -s</a></li>
<li class="level3"><a href="#wsdl2h-t">wsdl2h -t</a></li>
<li class="level3"><a href="#wsdl2h-U">wsdl2h -U</a></li>
<li class="level3"><a href="#wsdl2h-u">wsdl2h -u</a></li>
<li class="level3"><a href="#wsdl2h-V">wsdl2h -V</a></li>
<li class="level3"><a href="#wsdl2h-v">wsdl2h -v</a></li>
<li class="level3"><a href="#wsdl2h-W">wsdl2h -W</a></li>
<li class="level3"><a href="#wsdl2h-w">wsdl2h -w</a></li>
<li class="level3"><a href="#wsdl2h-X">wsdl2h -X</a></li>
<li class="level3"><a href="#wsdl2h-x">wsdl2h -x</a></li>
<li class="level3"><a href="#wsdl2h-y">wsdl2h -y</a></li>
<li class="level3"><a href="#wsdl2h-z">wsdl2h -z</a></li>
<li class="level3"><a href="#wsdl2h-_">wsdl2h -_</a></li>
</ul>
</li>
<li class="level2"><a href="#typemap">Customizing XML data bindings with the typemap.dat file</a></li>
</ul>
</li>
<li class="level1"><a href="#soapcpp2">The soapcpp2 tool</a><ul><li class="level2"><a href="#soapcpp2options">soapcpp2 options</a><ul><li class="level3"><a href="#soapcpp2-0">soapcpp2 -0</a></li>
<li class="level3"><a href="#soapcpp2-1">soapcpp2 -1</a></li>
<li class="level3"><a href="#soapcpp2-2">soapcpp2 -2</a></li>
<li class="level3"><a href="#soapcpp2-A">soapcpp2 -A</a></li>
<li class="level3"><a href="#soapcpp2-a">soapcpp2 -a</a></li>
<li class="level3"><a href="#soapcpp2-b">soapcpp2 -b</a></li>
<li class="level3"><a href="#soapcpp2-C">soapcpp2 -C</a></li>
<li class="level3"><a href="#soapcpp2-c">soapcpp2 -c -c++ -c++11</a></li>
<li class="level3"><a href="#soapcpp2-d">soapcpp2 -d</a></li>
<li class="level3"><a href="#soapcpp2-E">soapcpp2 -Ec -Ed -Et</a></li>
<li class="level3"><a href="#soapcpp2-e">soapcpp2 -e</a></li>
<li class="level3"><a href="#soapcpp2-f">soapcpp2 -f</a></li>
<li class="level3"><a href="#soapcpp2-g">soapcpp2 -g</a></li>
<li class="level3"><a href="#soapcpp2-h">soapcpp2 -h</a></li>
<li class="level3"><a href="#soapcpp2-I">soapcpp2 -I</a></li>
<li class="level3"><a href="#soapcpp2-i">soapcpp2 -i</a></li>
<li class="level3"><a href="#soapcpp2-j">soapcpp2 -j</a></li>
<li class="level3"><a href="#soapcpp2-L">soapcpp2 -L</a></li>
<li class="level3"><a href="#soapcpp2-l">soapcpp2 -l</a></li>
<li class="level3"><a href="#soapcpp2-m">soapcpp2 -m</a></li>
<li class="level3"><a href="#soapcpp2-n">soapcpp2 -n</a></li>
<li class="level3"><a href="#soapcpp2-p">soapcpp2 -p</a></li>
<li class="level3"><a href="#soapcpp2-Q">soapcpp2 -Q</a></li>
<li class="level3"><a href="#soapcpp2-q">soapcpp2 -q</a></li>
<li class="level3"><a href="#soapcpp2-r">soapcpp2 -r</a></li>
<li class="level3"><a href="#soapcpp2-S">soapcpp2 -S</a></li>
<li class="level3"><a href="#soapcpp2-s">soapcpp2 -s</a></li>
<li class="level3"><a href="#soapcpp2-T">soapcpp2 -T</a></li>
<li class="level3"><a href="#soapcpp2-t">soapcpp2 -t</a></li>
<li class="level3"><a href="#soapcpp2-u">soapcpp2 -u</a></li>
<li class="level3"><a href="#soapcpp2-V">soapcpp2 -V</a></li>
<li class="level3"><a href="#soapcpp2-v">soapcpp2 -v</a></li>
<li class="level3"><a href="#soapcpp2-w">soapcpp2 -w</a></li>
<li class="level3"><a href="#soapcpp2-x">soapcpp2 -x</a></li>
<li class="level3"><a href="#soapcpp2-y">soapcpp2 -y</a></li>
<li class="level3"><a href="#soapcpp2-z">soapcpp2 -z</a></li>
</ul>
</li>
<li class="level2"><a href="#import">The #import directive</a></li>
<li class="level2"><a href="#pragmas">The #include and #define directives</a></li>
<li class="level2"><a href="#specformat">Service operation specification format</a><ul><li class="level3"><a href="#param">Service operation parameter passing</a></li>
</ul>
</li>
<li class="level2"><a href="#idtrans">C/C++ identifier name to XML tag name translation</a></li>
<li class="level2"><a href="#compilingclient">Generating a SOAP/XML client application with soapcpp2</a></li>
<li class="level2"><a href="#compilingservice">Generating a SOAP/XML Web service application with soapcpp2</a></li>
<li class="level2"><a href="#autotest">Generating an auto test server for client testing</a></li>
<li class="level2"><a href="#deep">Generating deep copy and deletion functions</a></li>
</ul>
</li>
<li class="level1"><a href="#rules">Serialization and deserialization rules</a><ul><li class="level2"><a href="#rpcversusdoclit">SOAP RPC encoding versus document/literal style messaging</a></li>
<li class="level2"><a href="#switching">SOAP 1.1 versus SOAP 1.2 and dynamic switching</a></li>
<li class="level2"><a href="#primtype">Primitive type serialization</a><ul><li class="level3"><a href="#multiprim">How to use multiple C/C++ types for a single primitive XSD type</a></li>
<li class="level3"><a href="#primclass">How to use C++ wrapper classes to specify polymorphic primitive types</a></li>
<li class="level3"><a href="#multirefstrings">Multi-reference strings</a></li>
<li class="level3"><a href="#smart">Smart string mixed-content deserialization</a></li>
<li class="level3"><a href="#precision">Changing the precision of float and double types</a></li>
<li class="level3"><a href="#floatinfnan">INF, -INF, and NaN values of float and double types</a></li>
</ul>
</li>
<li class="level2"><a href="#enum">Enumeration serialization</a><ul><li class="level3"><a href="#enumserialization">Serialization of symbolic enumeration constants</a></li>
<li class="level3"><a href="#enumreuse">How to reuse symbolic enumeration constants</a></li>
<li class="level3"><a href="#boolean">Boolean enumeration serialization for C</a></li>
<li class="level3"><a href="#bitmask">Bitmask enumeration serialization</a></li>
</ul>
</li>
<li class="level2"><a href="#struct">Struct and class serialization</a><ul><li class="level3"><a href="#example10">Example</a></li>
<li class="level3"><a href="#methods">Class methods</a></li>
<li class="level3"><a href="#gettersetter">Get and set methods</a></li>
<li class="level3"><a href="#streaming">Updating and checking instances with get and set methods</a></li>
<li class="level3"><a href="#polymorph">Polymorphism, derived types, and dynamic binding in C++</a></li>
<li class="level3"><a href="#polymorphC">Polymorphism, derived types, and dynamic binding in C</a></li>
<li class="level3"><a href="#attributes">How to declare XML attributes</a></li>
<li class="level3"><a href="#qname">How to use QName attributes and elements</a></li>
</ul>
</li>
<li class="level2"><a href="#union">Union serialization</a></li>
<li class="level2"><a href="#pointer">Pointer type serialization</a><ul><li class="level3"><a href="#multiref">Multi-referenced data serialization</a></li>
<li class="level3"><a href="#null">NULL pointers and nil elements</a></li>
</ul>
</li>
<li class="level2"><a href="#void">Void pointer serialization</a></li>
<li class="level2"><a href="#fixedarrays">Fixed-size array serialization</a></li>
<li class="level2"><a href="#dynarray">Dynamic array serialization</a><ul><li class="level3"><a href="#arraybounds">SOAP-encoded array bounds</a></li>
<li class="level3"><a href="#oned">One-dimensional dynamic SOAP-encoded arrays</a></li>
<li class="level3"><a href="#onedoffset">One-dimensional dynamic SOAP-encoded arrays with non-zero offsets</a></li>
<li class="level3"><a href="#nested">Nested one-dimensional dynamic SOAP-encoded arrays</a></li>
<li class="level3"><a href="#multid">Multi-dimensional dynamic SOAP-encoded arrays</a></li>
<li class="level3"><a href="#list">Non-SOAP dynamic arrays</a></li>
<li class="level3"><a href="#templates">STL containers</a></li>
<li class="level3"><a href="#polymorphicarrays">Polymorphic dynamic arrays and lists</a></li>
<li class="level3"><a href="#arrayitems">How to change the tag names of array item elements</a></li>
</ul>
</li>
<li class="level2"><a href="#base64binary">base64Binary serialization</a></li>
<li class="level2"><a href="#hexbinary">hexBinary serialization</a></li>
<li class="level2"><a href="#literal">SOAP RPC encoded versus document/literal style</a><ul><li class="level3"><a href="#literal2">Serializing mixed content with literal XML strings</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#validation">XML validation</a><ul><li class="level2"><a href="#defaultvalues">Default values</a></li>
<li class="level2"><a href="#occurrence">Occurrence constraints</a><ul><li class="level3"><a href="#occurs">Elements with minOccurs and maxOccurs restrictions</a></li>
<li class="level3"><a href="#requiredandprohibited">Required and prohibited attributes</a></li>
</ul>
</li>
<li class="level2"><a href="#valueconstraints">Value constraints</a><ul><li class="level3"><a href="#lengthconstraints">Data length restrictions</a></li>
<li class="level3"><a href="#valuerangeconstraints">Value range restrictions</a></li>
<li class="level3"><a href="#patternconstraints">Pattern restrictions</a></li>
</ul>
</li>
<li class="level2"><a href="#qualified">Element and attribute qualified/unqualified forms</a></li>
</ul>
</li>
<li class="level1"><a href="#nstable">XML namespaces and the namespace mapping table</a></li>
<li class="level1"><a href="#header">SOAP Header processing</a></li>
<li class="level1"><a href="#fault">SOAP Fault processing</a></li>
<li class="level1"><a href="#MIME">MIME attachments</a><ul><li class="level2"><a href="#SWAsending">Sending a collection of MIME attachments (SwA)</a></li>
<li class="level2"><a href="#SWAreceiving">Retrieving a collection of MIME/MTOM attachments (SwA)</a></li>
</ul>
</li>
<li class="level1"><a href="#DIME">DIME attachments</a><ul><li class="level2"><a href="#DIMEsending">Sending a collection of DIME attachments</a></li>
<li class="level2"><a href="#DIMEreceiving">Retrieving a collection of DIME attachments</a></li>
<li class="level2"><a href="#DIMEbinary">Serializing binary data with DIME attachments</a></li>
<li class="level2"><a href="#DIMEstreaming">Streaming DIME</a></li>
<li class="level2"><a href="#dimechunking">Streaming chunked DIME</a></li>
<li class="level2"><a href="#DIMEWSDL">WSDL bindings for DIME attachments</a></li>
</ul>
</li>
<li class="level1"><a href="#MTOM">MTOM attachments</a><ul><li class="level2"><a href="#MIMEWSDL">Generating MultipartRelated MIME attachment bindings in WSDL</a></li>
<li class="level2"><a href="#MTOMsendingreceiving">Sending and receiving MTOM attachments</a></li>
<li class="level2"><a href="#MTOMstreaming">Streaming MIME/MTOM</a></li>
<li class="level2"><a href="#MTOMpoststreaming">Redirecting inbound MIME/MTOM streams based on SOAP body content</a></li>
<li class="level2"><a href="#mimechunking">Streaming chunked MIME/MTOM</a></li>
</ul>
</li>
<li class="level1"><a href="#UDP">SOAP/XML over UDP</a><ul><li class="level2"><a href="#wsaudp">Using WS-Addressing with SOAP-over-UDP</a><ul><li class="level3"><a href="#unicast">Client-side one-way UDP unicast</a></li>
<li class="level3"><a href="#multicast">Client-side one-way UDP multicast</a></li>
<li class="level3"><a href="#requestresponseunicast">Client-side request-response UDP unicast</a></li>
<li class="level3"><a href="#requestresponsemulticast">Client-side request-response multicast</a></li>
</ul>
</li>
<li class="level2"><a href="#soapoverudp">SOAP-over-UDP server</a><ul><li class="level3"><a href="#soapoverudpmulticast">SOAP-over-UDP multicast receiving server</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#compilerflags">Compile-time flags</a><ul><li class="level2"><a href="#soapdefs">Using the soapdefs.h header file</a></li>
</ul>
</li>
<li class="level1"><a href="#flags">Run-time flags</a></li>
<li class="level1"><a href="#errcodes">Run-time error codes</a></li>
<li class="level1"><a href="#memory">Memory management</a></li>
<li class="level1"><a href="#classmemory">Intra-class memory management</a></li>
<li class="level1"><a href="#debugging">Debugging</a></li>
<li class="level1"><a href="#limitations">Limitations</a></li>
<li class="level1"><a href="#advanced">Advanced features</a><ul><li class="level2"><a href="#internationalization">Internationalization</a></li>
<li class="level2"><a href="#directives">Directives</a><ul><li class="level3"><a href="#directives-1">Service directives</a></li>
<li class="level3"><a href="#directives-2">Service method directives</a></li>
<li class="level3"><a href="#directives-3">Schema directives</a></li>
<li class="level3"><a href="#directives-4">Schema type directives</a></li>
<li class="level3"><a href="#example12">Example</a></li>
</ul>
</li>
<li class="level2"><a href="#transient">Transient data types</a></li>
<li class="level2"><a href="#volatile">Serialization &quot;as is&quot; of volatile data types</a></li>
<li class="level2"><a href="#extern">How to declare custom serializers and deserializers</a></li>
<li class="level2"><a href="#callback">Function callbacks for customized I/O and HTTP handling</a></li>
<li class="level2"><a href="#http307">How to handle HTTP 307 temporary redirect</a></li>
<li class="level2"><a href="#get">How to implement HTTP GET, PUT, and PATCH services</a></li>
<li class="level2"><a href="#keepalive">TCP and HTTP keep-alive</a></li>
<li class="level2"><a href="#chunked">HTTP chunked transfer encoding</a></li>
<li class="level2"><a href="#buffered">HTTP buffered sends</a></li>
<li class="level2"><a href="#authentication">HTTP authentication</a><ul><li class="level3"><a href="#bearerauthentication">HTTP bearer authentication</a></li>
<li class="level3"><a href="#basicauthentication">HTTP basic authentication</a></li>
<li class="level3"><a href="#NTLMauthentication">HTTP NTLM authentication</a></li>
<li class="level3"><a href="#NTLMproxyauthentication">HTTP proxy NTLM authentication</a></li>
<li class="level3"><a href="#proxyauthentication">HTTP proxy basic authentication</a></li>
</ul>
</li>
<li class="level2"><a href="#tips">Performance improvement tips</a></li>
<li class="level2"><a href="#safety">Safety guards</a></li>
<li class="level2"><a href="#timeout">Timeout management for non-blocking operations</a></li>
<li class="level2"><a href="#forceclose">Closing connections by force</a></li>
<li class="level2"><a href="#socketopt">Socket options and flags</a></li>
<li class="level2"><a href="#hostportconnect">Overriding the host and port to connect</a></li>
<li class="level2"><a href="#serveropenssl">Secure Web services with HTTPS</a></li>
<li class="level2"><a href="#clientopenssl">Secure clients with HTTPS</a></li>
<li class="level2"><a href="#sslauthenticationcallbacks">SSL authentication callbacks</a></li>
<li class="level2"><a href="#ssl">SSL certificates and key files</a></li>
<li class="level2"><a href="#sslhw">SSL hardware acceleration</a></li>
<li class="level2"><a href="#sslwin">SSL on Windows</a></li>
<li class="level2"><a href="#compression">Zlib compression</a></li>
<li class="level2"><a href="#clientcookie">Client-side cookie support</a></li>
<li class="level2"><a href="#servercookie">Server-side cookie support</a></li>
<li class="level2"><a href="#proxyservers">Connecting clients through proxy servers</a></li>
<li class="level2"><a href="#bindbeforeconnect">Bind before connect and setting the client interface address</a></li>
<li class="level2"><a href="#fastcgi">FastCGI</a></li>
<li class="level2"><a href="#lean">How to minimize application memory footprint</a></li>
<li class="level2"><a href="#noio">How to remove the BSD socket library requirement</a></li>
<li class="level2"><a href="#combine">How to combine multiple client and server implementations into one executable</a></li>
<li class="level2"><a href="#codenamespace">How to build a client or server in a C++ code namespace</a></li>
<li class="level2"><a href="#dylibs">How to create client/server libraries</a><ul><li class="level3"><a href="#example13">C++ examples</a></li>
<li class="level3"><a href="#example14">C examples</a></li>
<li class="level3"><a href="#example15">How to chain C services to accept messages on the same port</a></li>
</ul>
</li>
<li class="level2"><a href="#dll">How to create DLLs</a><ul><li class="level3"><a href="#basedll">Creating the base stdsoap2.dll</a></li>
<li class="level3"><a href="#clientserverdll">Creating client and server DLLs</a></li>
</ul>
</li>
<li class="level2"><a href="#module">How to build modules and libraries with the #module directive</a></li>
<li class="level2"><a href="#plugins">Plugins, modules, and extensions</a><ul><li class="level3"><a href="#dom">DOM API overview</a></li>
<li class="level3"><a href="#loggingplugin">The message logging plugin</a></li>
<li class="level3"><a href="#RESTfulserverGET">RESTful server-side API with the HTTP GET plugin</a></li>
<li class="level3"><a href="#RESTfulservicePOST">RESTful server-side API with the HTTP POST plugin</a></li>
<li class="level3"><a href="#httpdaplugin">The HTTP digest authentication plugin</a></li>
<li class="level3"><a href="#sessionsplugin">The HTTP sessions plugin</a></li>
<li class="level3"><a href="#apacheplugin">The Apache module plugin</a></li>
<li class="level3"><a href="#isapiplugin">The ISAPI extension plugin</a></li>
<li class="level3"><a href="#curlplugin">The CURL plugin</a></li>
<li class="level3"><a href="#wininetplugin">The WinInet plugin</a></li>
<li class="level3"><a href="#wsaplugin">The WS-Addressing plugin</a></li>
<li class="level3"><a href="#wsrmplugin">The WS-ReliableMessaging plugin</a></li>
<li class="level3"><a href="#wsseplugin">The WS-Security plugin</a></li>
<li class="level3"><a href="#wsddplugin">The WS-Discovery plugin</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#copyright">Copyright                                                           </a></li>
</ul>
</div>
<div class="textblock"><h1>User guide</h1>
<div align="right"><em>Copyright (c) 2000-2020, Genivia Inc.<br />
All rights reserved.</em></div><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>The gSOAP toolkit offers C/C++ tools and libraries to implement efficient and secure SOAP, XML, JSON and REST client and service Web API applications. The tools also offer XML data bindings for C and C++ to generate XML serializers to efficiently read and write C/C++ data to and from files and streams.</p>
<p>The gSOAP wsdl2h tool consumes WSDL and XSD schema files to converts them to C/C++ source code to implement XML messaging infrastructures. This frees the developer to focus on application functionality rather than on infrastructure.</p>
<p>More specifically, the wsdl2h tool consumes WSDLs to generate a C or C++ interface header file, which uses a developer-friendly C/C++ header file syntax. This allows developers to inspect Web services and XML schemas from a functionality point of view, rather than getting bogged down into the underlying SOAP-based infrastructure details of WSDLs and XSDs.</p>
<p>The soapcpp2 tool generates all the Web service binding source code with XML serializers necessary to quickly develop server-side and client-side Web service APIs.</p>
<p>The soapcpp2 tool can also be used to produce, rather than consume, WSDL and XSD files to deploy XML Web services or to develop XML applications. This approach allows the deployment of legacy C/C++ applications as services. Simply describe the Web API in a C or C++ interface header file for the soapcpp2 tool to generate the C/C++ source code that glues everything together.</p>
<p>Besides SOAP-based services, also non-SOAP XML and JSON REST services can be implemented with the gSOAP tools. Either described by WSDLs or by XML schemas converted to C/C++ source code by wsdl2h, or by using the JSON libraries included with gSOAP to develop JSON applications.</p>
<p>Furthermore, the gSOAP tools can be just as easily used to develop C/C++ applications that efficiently consume and produce XML by leveraging XML data bindings for C/C++ based on XML schemas. Basically, an XML schema has an equivalent set of C/C++ data types for the components described by the schema. So XML schema strings are just C/C++ strings, XML schema enumerations are C/C++ enums, XML schema complex types are just structs and classes in C/C++, and so on. This enhances the reliability and safety of XML applications, because type-safe serializable C/C++ data types are serialized and validated in XML automatically.</p>
<p>This XML data binding means that your XML data is simply represented as C/C++ data. Reading and writing XML is a lot easier than using a DOM or SAX library for XML. This is not more expensive or more complex than it sounds. In fact, the generated XML serializers are very efficient to parse and validate XML and may run more than 30 times faster than validating XML parsers such as Apache Xerces C++.</p>
<p>In summary, gSOAP offers a type-safe and transparent approach to develop XML applications that has proven to be quicker to develop (by auto-coding), safer (by XML validation and type-safety), more reliable (by auto-generation of XML test messages and warnings), and higher performing (by efficient serializers and XML parsers generated in C/C++), compared to DOM and SAX libraries.</p>
<p>This user guide explains the gSOAP tools and libraries. This user guide and additional documentation for the growing number of gSOAP plugins can be found at <a href="https://www.genivia.com/doc">https://www.genivia.com/doc</a>. A getting-started guide for developers is available at <a href="https://www.genivia.com/dev.html">https://www.genivia.com/dev.html</a> with a tutorial on common topics at <a href="https://www.genivia.com/tutorials.html">https://www.genivia.com/tutorials.html</a>. Various examples ranging from simple calculator service APIs to very large protocols spanning dozens of WSDLs can be found at <a href="https://www.genivia.com/examples.html">https://www.genivia.com/examples.html</a>. For frequently asked questions see <a href="https://www.genivia.com/resources.html">https://www.genivia.com/resources.html</a> for help.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="conventions"></a>
Notational conventions</h1>
<p>The typographical conventions used by this document are:</p>
<ul>
<li><code>Courier</code> denotes C and C++ source code.</li>
<li><em><code>Courier</code></em> denotes XML content, JSON content, file and path names, and URIs.</li>
<li><b><code>Courier</code></b> denotes HTTP content, text file content, and shell commands with command line options and arguments.</li>
</ul>
<p>The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC-2119.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="features"></a>
Tooling characteristics</h1>
<ul>
<li><b>Safety</b>: the tools generate type-safe XML serialization functions for native and user-defined C and C++ data structures.</li>
<li><b>Protocols</b>: WSDL 1.1, WSDL 2.0, REST, SOAP 1.1, SOAP 1.2, SOAP RPC encoding style, SOAP document/literal style, SOAP-over-UDP, WS-Security, WS-Addressing, WS-ReliableMessaging, WS-Discovery, WS-Trust, WS-Policy, JSON REST/RPC, XML-RPC, Atom and RSS. JSON is supported as a library bundled with the XML-RPC library to switch between XML-RPC and JSON protocols (since these are similar, speaking data wise). For more details, see the <em><code>gsoap/samples/xml-rpc-json</code></em> folder in the gSOAP package and the <a href="../../xml-rpc-json/html/index.html">XML-RPC and JSON</a> documentation.</li>
<li><b>SOAP</b>: implements the full range of SOAP 1.1/1.2 specifications, including RPC encoding and document/literal messaging styles.</li>
<li><b>XSD</b>: supports all XML schema 1.0 and 1.1 schema type constructs and has been tested against the W3C XML Schema Patterns for Databinding Interoperability working group.</li>
<li><b>XML</b>: implements a fast schema-specific XML pull parser that does not require intermediate storage of XML in a DOM to deserialize data.</li>
<li><b>HTTP</b>: HTTP 1.0/1.1 (HTTP 2.0 will be available soon), IPv4 and IPv6, HTTPS (requires OpenSSL or GNUTLS), cookies, authentication, Zlib deflate and gzip compression, and connecting through HTTP proxies.</li>
<li><b>Attachments</b>: MIME (SwA), DIME, and MTOM attachments are supported. Streaming capabilities to direct the data stream to/from resources using user-defined callbacks. gSOAP is the only toolkit that supports streaming MIME, DIME, and MTOM attachment transfers, which allows you to exchange binary data of practically unlimited size in the fastest possible way by streaming, while ensuring the usefulness of XML interoperability.</li>
<li><b>Debugging</b>: compilation of client and service applications in <code><a class="el" href="group__group__debug.html#gad72dbcf6d0153db1b8d8a58001feed83" title="User-definable macro to enable debugging and logging. ">DEBUG</a></code> mode traces their engine activity for debugging, verifies memory usage (leak detection), and saves message logs for inspection.</li>
<li><b>Testing</b>: <b><code>soapcpp2 -T</code></b> generates server source code that automatically implements echo message services for testing. The <b><code>testmsgr</code></b> tool generates XML messages from message templates for server-side and client-side black-box testing, see <a href="../../testmsgr/html/index.html">Test Messenger</a> documentation. In addition, the soapcpp2 tool generates sample SOAP/XML input and output messages for verification and testing.</li>
<li><b>Speed</b>: the soapcpp2-generated high-performance XML serializers are ideal for building efficient Web services that are compute-intensive and are therefore best written in C or C++.</li>
<li><b>Portability</b>: source code is portable and compiles on Windows, Unix, Linux, Mac OS X, Symbian, VXWorks, and embedded systems that run WinCE, Symbian, embedded Linux, and so on. The memory footprint of gSOAP client and service applications is small.</li>
<li><b>Footprint</b>: input and output buffering is used to increase efficiency and reduce memory usage. Input and output messages are not fully buffered or stored in a DOM unless required or specified. As a result, large messages can be transmitted by low-memory devices.</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="start-modules"></a>
API documentation modules</h1>
<p>The API documentation is broken down into the following functional documentation <a href="modules.html">modules</a> that drill down into the lower-level API of macros, functions, context and context variables, plugins and more:</p>
<table  class="directory">
<tr id="row_0_" class="even">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__debug.html" class="el" target="_self">Debugging and logging</a></td><td class="desc">This module defines compile-time flags and functions for run-time debugging and logging  </td></tr>
<tr id="row_1_">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__with.html" class="el" target="_self">WITH_MACRO compile-time flags</a></td><td class="desc">This module defines the <code>WITH_MACRO</code> compile-time flags to configure the engine build  </td></tr>
<tr id="row_2_" class="even">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__soap.html" class="el" target="_self">SOAP_MACRO compile-time values</a></td><td class="desc">This module defines the <code>SOAP_MACRO</code> compile-time values to configure the engine build  </td></tr>
<tr id="row_3_">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__flags.html" class="el" target="_self">SOAP_MACRO run-time flags</a></td><td class="desc">This module defines the <code>SOAP_MACRO</code> run-time <code><a href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb" class="el" title="The soap_mode flags to initialize the soap context, flags can be combined with | (bit-wise or) ...">soap_mode</a></code> flags to set the engine mode  </td></tr>
<tr id="row_4_" class="even">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__errors.html" class="el" target="_self">SOAP_MACRO run-time error codes</a></td><td class="desc">This module defines the <code>SOAP_MACRO</code> run-time <code><a href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" class="el" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error codes returned by functions and stored in <code><a href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" class="el" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code>  </td></tr>
<tr id="row_5_">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__context.html" class="el" target="_self">Context with engine state</a></td><td class="desc">This module defines the <code><a href="structsoap.html" class="el" title="Context with the engine state. ">soap</a></code> context structure with the engine state and functions to allocate, initialize, copy and delete contexts  </td></tr>
<tr id="row_6_" class="even">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__callbacks.html" class="el" target="_self">Callback functions</a></td><td class="desc">This module defines the callback functions of the <code><a href="structsoap.html" class="el" title="Context with the engine state. ">soap</a></code> context to modify its behavior, as is done by plugins  </td></tr>
<tr id="row_7_">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__ssl.html" class="el" target="_self">SSL/TLS context and functions</a></td><td class="desc">This module defines functions to set the SSL/TLS context for HTTPS and WS-Security  </td></tr>
<tr id="row_8_" class="even">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__io.html" class="el" target="_self">HTTP and IO functions</a></td><td class="desc">This module defines functions for HTTP operations and functions for receiving and sending data  </td></tr>
<tr id="row_9_">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__cookies.html" class="el" target="_self">HTTP cookie functions</a></td><td class="desc">This module defines functions to set and get HTTP cookies at the server side  </td></tr>
<tr id="row_10_" class="even">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__s2s.html" class="el" target="_self">Conversion functions</a></td><td class="desc">This module defines conversion functions of values of various types to and from strings  </td></tr>
<tr id="row_11_">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__namespace.html" class="el" target="_self">XML namespace tables</a></td><td class="desc">This module defines the <code><a href="struct_namespace.html" class="el" title="Structure of each row in a namespace table. ">Namespace</a></code> XML namespace structure and function to activate a table  </td></tr>
<tr id="row_12_" class="even">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__header.html" class="el" target="_self">Header structure and functions</a></td><td class="desc">This module defines the <code><a href="struct_s_o_a_p___e_n_v_____header.html" class="el" title="SOAP Header structure generated by wsdl2h and soapcpp2. ">SOAP_ENV__Header</a></code> structure and <code><a href="group__group__header.html#ga08d35d1900a1982fdde6f78e43fc9635" class="el" title="If soap::header is NULL then allocate SOAP_ENV__Header header and set soap::header to point to it...">soap_header</a></code> function to allocate the header  </td></tr>
<tr id="row_13_">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__fault.html" class="el" target="_self">Fault structure and functions</a></td><td class="desc">This module defines the <code><a href="struct_s_o_a_p___e_n_v_____fault.html" class="el" title="SOAP Fault structure generated by soapcpp2. ">SOAP_ENV__Fault</a></code> structure and functions to set and get fault information  </td></tr>
<tr id="row_14_" class="even">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__dime.html" class="el" target="_self">DIME attachment functions</a></td><td class="desc">This module defines functions to set and get DIME attachments  </td></tr>
<tr id="row_15_">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__mime.html" class="el" target="_self">MIME attachment functions</a></td><td class="desc">This module defines functions to set and get MIME/MTOM attachments  </td></tr>
<tr id="row_16_" class="even">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__plugin.html" class="el" target="_self">Plugins and plugin registry functions</a></td><td class="desc">This module defines plugin registry functions to register plugins  </td></tr>
<tr id="row_17_">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__threads.html" class="el" target="_self">Thread and mutex functions</a></td><td class="desc">This module defines portable thread and mutex functions  </td></tr>
<tr id="row_18_" class="even">
<td class="entry"><span style="width:16px;display:inline-block;"></span><a href="group__group__misc.html" class="el" target="_self">Miscellaneous functions</a></td><td class="desc">This module defines other useful functions  </td></tr>
</table>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="start"></a>
Getting started</h1>
<p>To start using gSOAP, you will need:</p>
<ul>
<li>The gSOAP software from <a href="https://www.genivia.com/Products/downloads.html">https://www.genivia.com/Products/downloads.html</a>. Select the gSOAP toolkit commercial edition to download (a download key is provided with the commercial-use license), or download the GPLv2 open source version from SourceForge <a href="https://sourceforge.net/projects/gsoap2">https://sourceforge.net/projects/gsoap2</a>.</li>
<li>A C or C++ compiler.</li>
<li>OpenSSL (or GNUTLS) and the Zlib libraries to enable SSL (HTTPS) and compression. These libraries are available for most platforms and are often already installed.</li>
<li>Flex <a href="http://flex.sourceforge.net">http://flex.sourceforge.net</a> and Bison <a href="http://www.gnu.org/software/bison">http://www.gnu.org/software/bison</a> to build the soapcpp2 tool. You can also build soapcpp2 without Bison and Flex installed, see <a href="https://www.genivia.com/downloads.html">https://www.genivia.com/downloads.html</a> for details.</li>
</ul>
<p>The gSOAP source code package includes:</p>
<ul>
<li>The <b><code>wsdl2h</code></b> data binding tool that converts WSDLs and XSDs to generate interface header files for soapcpp2. The source code of the wsdl2h tool is located in <em><code>gsoap/wsdl</code></em>.</li>
<li>The <b><code>soapcpp2</code></b> code generation tool that takes an interface header file and generates the C/C++ Web service binding implementation source code. The source code of the soapcpp2 tool is located in <em><code>gsoap/src</code></em>.</li>
<li>The run-time engine <em><code>gsoap/stdsoap2.h</code></em> and source code <em><code>gsoap/stdsoap2.c</code></em> for C and <em><code>gsoap/stdsoap2.cpp</code></em> for C++. These are compiled into the C libraries <em><code>gsoap/libgsoap.a</code></em> (without OpenSSL/GNUTLS for SSL/TLS), <em><code>gsoap/libgsoapssl.a</code></em> (with OpenSSL/GNUTLS for SSL/TLS and with <em><code>gsoap/dom.c</code></em> for DOM API), and the C++ libraries <em><code>gsoap/libgsoap++.a</code></em> (without OpenSSL/GNUTLS for SSL/TLS), <em><code>gsoap/libgsoapssl++.a</code></em> (with OpenSSL/GNUTLS for SSL/TLS and with <em><code>gsoap/dom.cpp</code></em> for DOM API). There are two more versions of these libraries with HTTP cookies enabled.</li>
<li>Several examples of gSOAP applications and other development tools that are build with wsdl2h and soapcpp2 are located in <em><code>gsoap/samples</code></em>.</li>
<li>XML DOM API and the domcpp code generation tool located in <em><code>gsoap/samples/dom</code></em>, see also the <a href="../../dom/html/index.html">XML DOM API and domcpp</a> documentation.</li>
<li>JSON and XML-RPC libraries and the jsoncpp code generation tool located in <em><code>gsoap/samples/xml-rpc-json</code></em>, see also the <a href="../../xml-rpc-json/html/index.html">XML-RPC and JSON</a> documentation.</li>
<li>An XML Web API testing tool located in <em><code>gsoap/samples/testmsgr</code></em>, see also the <a href="../../testmsgr/html/index.html">Test Messenger</a> documentation.</li>
<li>Plugins to enhance the capabilities of the engine and to support WS protocols such as WS-Security, WS-Addressing, WS-ReliableMessaging, and WS-Discovery. The plugins are located in <em><code>gsoap/plugin</code></em> and <em><code>gsoap/mod_gsoap</code></em>. Most but not all plugins are imported into interface header files for soapcpp2 with the <code>#import</code> directive. See also API documentation Module <a class="el" href="group__group__plugin.html">Plugins and plugin registry functions</a>.</li>
<li>Custom serializers for several C and C++ types to enhance the capabilities of XML serialization, located in <em><code>gsoap/custom</code></em>. Custom serializers are imported into interface header files for soapcpp2 with the <code>#import</code> directive. This is usually done via a <em><code>typemap.dat</code></em> file for wsdl2h that specifies bindings for XML schema types to C/C++ types, including custom serializers when desired.</li>
</ul>
<p>The wsdl2h and soapcpp2 tools and the gSOAP libraries are build with <b><code>./configure</code></b> and <b><code>make</code></b>, see the download and installation page <a href="https://www.genivia.com/downloads.html">https://www.genivia.com/downloads.html</a> for the most recent versions of gSOAP and gSOAP software installation details. The examples and other tools are build with <b><code>./configure --enable-samples</code></b> and <b><code>make</code></b>.</p>
<p>Non-SSL-enabled (that is, not HTTPS capable) versions of the binaries of the wsdl2h and soapcpp2 tools are also included in the gSOAP package in <em><code>gsoap/bin</code></em> for Windows and Mac OS platforms. The SSL-enabled and HTTPS-capable wsdl2h tool is only available for download from <a href="https://www.genivia.com/downloads.html">https://www.genivia.com/downloads.html</a> with a commercial-use license and download key.</p>
<p>Although gSOAP tools are available in binary format for several platforms, the code generated by these tools is equivalent. This means that the generated source code files can be transferred between platforms and locally compiled.</p>
<p>The examples given in this document do not require the libraries of the engine to be build, but rather show the use of the source code: <em><code>gsoap/stdsoap2.c</code></em> and <em><code>gsoap/dom.c</code></em> (or <em><code>gsoap/stdsoap2.cpp</code></em> and <em><code>gsoap/dom.cpp</code></em> for C++). Using the source code instead of the libraries gives more control when we use the <b><code>-DWITH_MACRO</code></b> and <b><code>-DSOAP_MACRO</code></b> compile-time options, see also Modules <a class="el" href="group__group__with.html">WITH_MACRO compile-time flags</a> and <a class="el" href="group__group__soap.html">SOAP_MACRO compile-time values</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="start-examples"></a>
Where to find examples</h2>
<p>Introductory examples can be found online at <a href="https://www.genivia.com/dev.html">https://www.genivia.com/dev.html</a>. Additional examples can be found online at <a href="https://www.genivia.com/examples.html">https://www.genivia.com/examples.html</a>.</p>
<p>The gSOAP package also contains numerous examples in the <em><code>gsoap/samples</code></em> directory. Run <b><code>make</code></b> inside these directories to build the example applications. The examples are meant to demonstrate basic to advanced features of gSOAP. Some examples are actually development tools and libraries, such as Test Messenger located in <em><code>gsoap/samples/testmsgr</code></em> to test XML Web APIs, the XML DOM API and domcpp located in <em><code>gsoap/samples/dom</code></em> to generate XML DOM API source code from XML files, the JSON API and jsoncpp located in <em><code>gsoap/samples/xml-rpc-json</code></em> to generate JSON API source code from JSON files.</p>
<p>Advanced examples include a streaming MTOM attachment server and client application demonstrate high-performance file exchanges, located in <em><code>gsoap/samples/mtom-stream</code></em>. An SSL-secure Web server application demonstrates the generation of dynamic content for Web browsing and Web services functionality at the same time, located in <em><code>gsoap/samples/webservice</code></em>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="start-client"></a>
Creating a SOAP/XML client application</h2>
<p>This section explains the basics to develop a SOAP/XML client application in C and C++. We refer to <a href="https://www.genivia.com/dev.html">https://www.genivia.com/dev.html</a> for additional introductory examples of SOAP/XML, XML REST and JSON applications in C and C++.</p>
<p>The wsdl2h tool imports one or more WSDLs and XML schemas and generates a gSOAP interface file for soapcpp2 with familiar C/C++ header file syntax to define the Web service operations and the C/C++ data types. The soapcpp2 tool then takes this header file and generates XML serializers for the data types (<em><code>soapStub.h</code></em>, <em><code>soapH.h</code></em>, and <em><code>soapC.cpp</code></em>), the client-side stub functions (<em><code>soapClient.cpp</code></em>), and server-side skeleton functions (<em><code>soapServer.cpp</code></em>).</p>
<p>The soapcpp2 tool can also generate WSDL definitions to implement a service from scratch, i.e. without defining a WSDL first. This "closes the loop" in that it enables Web services development from WSDL or directly from a set of C/C++ operations declared as functions in an interface header file for soapcpp2 without the need for users to be experts in WSDL and XSD.</p>
<p>You only need to follow a few steps to execute the tools from the command line or using a Makefile (see also MSVC++ project examples in the <em><code>gsoap/samples</code></em> directory with tool integration in the MSVC++ IDE). For example, to generate code for the calculator Web service, we run the wsdl2h tool from the command line on the URL of the WSDL and use <a href="#wsdl2h-o"><b><code>wsdl2h -o calc.h</code></b> option <b><code>-o calc.h</code></b></a> to specify the <em><code>calc.h</code></em> interface file to output: </p><pre class="fragment"> wsdl2h -o calc.h http://www.genivia.com/calc.wsdl
</pre><p>This generates the <em><code>calc.h</code></em> service definition interface file with service operation definitions and types to pass with the operation parameters. This interface file is then input to the soapcpp2 tool to generate the stub and skeleton source code and XML serialization functions. The <em><code>calc.h</code></em> file includes documentation extracted form the WSDL and introductions to process the file with soapcpp2. You can use Doxygen (<a href="http://www.doxygen.org">http://www.doxygen.org</a>) to automatically generate the documentation pages for your development from the generated <em><code>calc.h</code></em> interface file. To generate a markdown report for your client, use <b><code>soapcpp2 -r</code></b> option <b><code>-r</code></b> which has more details than the <em><code>calc.h</code></em> file.</p>
<p>In this example we will develop a C++ API for the calculator service. By default, the wsdl2h tool assumes C++ with STL. To build without STL, use <a href="#wsdl2h-s"><b><code>wsdl2h -s</code></b> option <b><code>-s</code></b></a>: </p><pre class="fragment"> wsdl2h -s -o calc.h http://www.genivia.com/calc.wsdl
</pre><dl class="section note"><dt>Note</dt><dd>Visual Studio IDE users should make sure to compile all gSOAP source code files in C++ compilation mode. If you migrate to a project file <code>.vcproj</code>, please set <code>CompileAs="2"</code> in your <code>.vcproj</code> file.</dd></dl>
<p>We have not yet generated the stub functions and serializers for our C++ client application to invoke remote service operations. To do so, we run the soapcpp2 tool as follows: </p><pre class="fragment"> soapcpp2 -j -C -Iimport calc.h
</pre><p>Option <b><code>-j</code></b> (and alternatively option <b><code>-i</code></b>) indicates that we want C++ proxy and server objects that include the client (and server) code, option <b><code>-C</code></b> indicates client-side only files are generated (soapcpp2 generates both client stub functions and server skeleton functions by default). Option <b><code>-I</code></b> is needed to import the <em><code>stlvector.h</code></em> file from the <em><code>gsoap/import</code></em> directory located in the gSOAP source code package to support serialization of STL vectors, when applicable.</p>
<p>We use the generated <code>soapcalcProxy</code> class declared and defined in <em><code>soapcalcProxy.h</code></em> and <em><code>soapcalcProxy.cpp</code></em>, and <em><code>calc.nsmap</code></em> XML namespace mapping table to access the Web service. The <em><code>soapcalcProxy.h</code></em> file includes documentation on the proxy class. The <code>soapcalcProxy</code> class is a proxy to invoke the remote service:</p>
<div class="fragment"><div class="line"><span class="comment">// File: calclient.cpp</span></div><div class="line"><span class="preprocessor">#include &quot;soapcalcProxy.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;calc.nsmap&quot;</span> </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  calcProxy service; </div><div class="line">  <span class="keywordtype">double</span> result; </div><div class="line">  <span class="keywordflow">if</span> (service.add(1.0, 2.0, result) == <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>) </div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;The sum of 1.0 and 2.0 is &quot;</span> &lt;&lt; result &lt;&lt; std::endl; </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">    service.soap_stream_fault(std::cerr); </div><div class="line">  service.destroy(); <span class="comment">// delete data and release memory </span></div><div class="line">}</div></div><!-- fragment --><p>To complete the build, compile the code above and compile this with the generated <em><code>soapC.cpp</code></em> and <em><code>soapcalcProxy.cpp</code></em> files, and link the engine with <b><code>-lgsoap++</code></b>: </p><pre class="fragment">c++ -o calcclient calcclient.cpp soapcalcProxy.cpp soapC.cpp -lgsoap++
</pre><p>Alternatively, compile <em><code>gsoap/stdsoap2.cpp</code></em>: </p><pre class="fragment">c++ -o calcclient calcclient.cpp soapcalcProxy.cpp soapC.cpp stdsoap2.cpp
</pre><p>In both cases it is assumed that <em><code><a class="el" href="stdsoap2_8h.html" title="This file defines the common macros, types and functions of the gSOAP API grouped by modules ...">stdsoap2.h</a></code></em> and the soapcpp2-generated <em><code>soapcalcProxy.h</code></em>, <em><code>soapStub.h</code></em>, <em><code>soapH.h</code></em>, and <em><code>calc.nsmap</code></em> files are located in the current directory.</p>
<p>Then run the example: </p><pre class="fragment">./calcclient
The sum of 1.0 and 2.0 is 3
</pre><p>To build a pure C application, use <a href="#wsdl2h-c"><b><code>wsdl2h -c</code></b> option <b><code>-c</code></b></a> and run <b><code>soapcpp2 -C</code></b> to generate the client stub functions and serializers: </p><pre class="fragment"> wsdl2h -c -o calc.h http://www.genivia.com/calc.wsdl
 soapcpp2 -C -Iimport calc.h
</pre><p>In this case our code uses a simple C function call to invoke the service and we also need to explicitly delete data and the context with <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> and <code><a class="el" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a" title="Finalize and free the given soap context from unmanaged heap memory. ">soap_free</a></code>:</p>
<div class="fragment"><div class="line"><span class="comment">// File: calclient.c</span></div><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span>    <span class="comment">// include the generated declarations</span></div><div class="line"><span class="preprocessor">#include &quot;calc.nsmap&quot;</span> <span class="comment">// include the generated namespace table</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">  <span class="keywordtype">double</span> result; </div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns__add(soap, 1.0, 2.0, &amp;result) == <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>) </div><div class="line">    printf(<span class="stringliteral">&quot;The sum of 1.0 and 2.0 is %lg\n&quot;</span>, result); </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); <span class="comment">// delete managed objects</span></div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);    <span class="comment">// finalize and delete the context</span></div><div class="line">}</div></div><!-- fragment --><p>To complete the build, compile the code above and compile this with the generated <em><code>soapC.c</code></em> and <em><code>soapClient.c</code></em> files, and link the engine with <b><code>-lgsoap</code></b>: </p><pre class="fragment">cc -o calcclient calclient.c soapClient.c soapC.c -lgsoap
</pre><p>Alternatively, compile <em><code>gsoap/stdsoap2.c</code></em>: </p><pre class="fragment">cc -o calcclient calclient.c soapClient.c soapC.c stdsoap2.c
</pre><p>In both cases it is assumed that <em><code><a class="el" href="stdsoap2_8h.html" title="This file defines the common macros, types and functions of the gSOAP API grouped by modules ...">stdsoap2.h</a></code></em> and the soapcpp2-generated <em><code>soapStub.h</code></em>, <em><code>soapH.h</code></em>, and <em><code>calc.nsmap</code></em> files are located in the current directory.</p>
<p>Then run the example: </p><pre class="fragment">./calcclient
The sum of 1.0 and 2.0 is 3
</pre><p>The calculator example is fairly simple and used here to illustrate the development steps from code generation to running the application. The development steps for large-scale XML applications is similar.</p>
<p>See <a href="https://www.genivia.com/dev.html">https://www.genivia.com/dev.html</a> for additional introductory examples of SOAP/XML, XML REST and JSON applications in C and C++. See <a href="https://www.genivia.com/examples">https://www.genivia.com/examples</a> and the examples located in the gSOAP source code package in the <em><code>gsoap/samples</code></em> directory.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="start-service"></a>
Creating a SOAP/XML service application</h2>
<p>This section explains the basics to develop a SOAP/XML service application in C and C++. We refer to <a href="https://www.genivia.com/dev.html">https://www.genivia.com/dev.html</a> for additional introductory examples of SOAP/XML, XML REST and JSON applications in C and C++.</p>
<p>Developing a service application is easy. In this example we will demonstrate a service deployed with the Common Gateway Interface (CGI) because it is a simple mechanism. This is not the preferred deployment mechanism. Because CGI is slow and stateless. FastCGI improves the speed of CGI applications, but is still stateless. Faster services can be developed as a stand-alone gSOAP HTTP/HTTPS servers as explained in this section further below.</p>
<p>To deploy services in a public and possibly hostile environment, we recommend the use of Apache module or IIS ISAPI extension to manage and protect services. An Apache module plugin and ISAPI extension plugin is included in the gSOAP package under <em><code>gsoap/mod_gsoap</code></em>. For details, see:</p>
<ul>
<li><a href="../../apache/html/index.html">gSOAP Apache module</a> documentation</li>
<li><a href="../../isapi/html/index.html">gSOAP ISAPI extension</a> documentation</li>
</ul>
<p>To deploy gSOAP stand-alone services in a public environment make sure to protect your service application as explained in Sections <a class="el" href="index.html#safety">Safety guards</a> and <a class="el" href="index.html#timeout">Timeout management for non-blocking operations</a>. See also our tutorials <a href="https://www.genivia.com/tutorials.html">https://www.genivia.com/tutorials.html</a> with instructions to protect your online gSOAP Web APIs.</p>
<p>Let's get started. Suppose we want to implement a simple CGI-based service that returns the time in GMT. For this example we start with an interface header file for soapcpp2, <em><code>currentTime.h</code></em> which contains the service definitions. Such a file can be obtained from a WSDL using wsdl2h when a WSDL is available. When a WSDL is not available, you can define the service in C/C++ definitions in a newly created interface header file and let the soapcpp2 tool generate the source code and WSDL for you.</p>
<p>The <code>currenTime</code> service operation of our Web service has only one output parameter, which is the current time defined in our <em><code>currentTime.h</code></em> service specification:</p>
<div class="fragment"><div class="line"><span class="comment">// File: currentTime.h </span></div><div class="line"><span class="comment">//gsoap ns service name: currentTime </span></div><div class="line"><span class="comment">//gsoap ns service namespace: urn:currentTime </span></div><div class="line"><span class="comment">//gsoap ns service location: http://www.yourdomain.com/currentTime.cgi </span></div><div class="line"><span class="keywordtype">int</span> ns__currentTime(time_t&amp; response);</div></div><!-- fragment --><p>Note that we associate an XML namespace prefix <code>ns</code> and namespace name <code>urn:currentTime</code> with the service WSDL and SOAP/XML messages. The gSOAP tools use a special convention for identifier names that are part of a namespace: a namespace prefix (<code>ns</code> in this case) followed by a double underscore <code>__</code>. This convention is used to resolve namespaces and to avoid name clashes. The <code>ns</code> namespace prefix is bound to the <em><code>urn:currentTime</code></em> namespace name with the <code>//gsoap</code> directive. The <code>//gsoap</code> directives are used to set the properties of the service, in this case the name, namespace, and location endpoint.</p>
<p>The service implementation for CGI simply requires a <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> call on a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context created with <code><a class="el" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c" title="Allocate and initialize a new soap context. ">soap_new</a></code>. The service operations are implemented as functions, which are called by the service skeleton functions via the service request dispatcher <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code>:</p>
<div class="fragment"><div class="line"><span class="comment">// File: currentTime.cpp </span></div><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span>           <span class="comment">// include the generated declarations </span></div><div class="line"><span class="preprocessor">#include &quot;currentTime.nsmap&quot;</span> <span class="comment">// include the generated namespace table</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="comment">// create soap context and serve one CGI-based request: </span></div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69">SOAP_XML_INDENT</a>);</div><div class="line">  <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); <span class="comment">// delete managed class instances </span></div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);    <span class="comment">// finalize and free the context</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__currentTime(<span class="keyword">struct</span> soap *soap, time_t&amp; response) </div><div class="line">{</div><div class="line">  response = time(0); </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>Note that we pass the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context with the engine context information to the service operation function as the first argument. The <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context comes in handy to determine properties of the connection and to dynamically allocate data with <code><a class="el" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c" title="Allocate a block of heap memory managed by the specified soap context. ">soap_malloc</a></code> or with the generated <code>soap_new_T</code> functions for serializable types <code>T</code> that will be automatically deleted by calling <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code> and <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> when the service operation is done and the service loop rolls over.</p>
<p>We run the soapcpp2 tool on the header file to generate the server-side code: </p><pre class="fragment"> soapcpp2 -S currentTime.h
</pre><p>and then compile the CGI binary: </p><pre class="fragment"> c++ -o currentTime.cgi currentTime.cpp soapServer.cpp soapC.cpp stdsoap2.cpp
</pre><p>To activate the service, copy the <em><code>currentTime.cgi</code></em> binary to your <em><code>bin-cgi</code></em> directory and set the proper file permissions.</p>
<p>The soapcpp2 tool generated the WSDL definitions <em><code>currentTime.wsdl</code></em>. You can use the WSDL to advertise your service. You don't need to use this WSDL to develop a gSOAP client. You can use the <em><code>currentTime.h</code></em> file with <b><code>soapcpp2 -C</code></b> option <b><code>-C</code></b> to generate client-side code.</p>
<p>Since CGI is very simple, a convenient aspect of CGI is that it exchanges messages over standard input and output. Therefore, you can run the CGI binary on the auto-generated example request XML file <em><code>currentTime.currentTime.req.xml</code></em> to test your server: </p><pre class="fragment"> ./currentTime.cgi &lt; currentTime.currentTime.req.xml
</pre><p>and this displays the HTTP server response: </p><pre class="fragment">Status: 200 OK
Server: gSOAP/2.8
X-Frame-Options: SAMEORIGIN
Content-Type: text/xml; charset=utf-8
Content-Length: 460
Connection: close
</pre> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;urn:currentTime&quot;</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;                &lt;<span class="keywordtype">ns:currentTimeResponse</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;                        &lt;<span class="keywordtype">response</span>&gt;2018-10-25<span class="keyword">T17:17:03Z</span>&lt;/<span class="keywordtype">response</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;                &lt;/<span class="keywordtype">ns:currentTimeResponse</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --><p>The above approach works also for C. Just use <b><code>soapcpp2 -c -S</code></b> option <b><code>-c</code></b> in addition to the <b><code>-S</code></b> option to generate C code. Of course, in C we use pointers instead of references and the <em><code>currentTime.h</code></em> file should be adjusted to use C syntax and types.</p>
<p>Run <b><code>soapcpp2 -r -c -S</code></b> option <b><code>-r</code></b> to generate a <em><code>soapReadme.md</code></em> report. This report includes many details about the service operations and serializable C/C++ data types declared in the interface header file. This markdown file can be converted to HTML or other document formats with tools such as <a href="www.doxygen.org">Doxygen</a>.</p>
<p>A more elegant server implementation in C++ can be obtained by using <b><code>soapcpp2 -j -S</code></b> option <b><code>-j</code></b> (or option <b><code>-i</code></b>) to generate C++ client-side proxy and server-side service objects as classes that you can use to build clients and services in C++. The option removes the generation of <em><code>soapClient.cpp</code></em> and <em><code>soapServer.cpp</code></em>, since these are no longer needed when we have classes that implement the client and server logic: </p><pre class="fragment"> soapcpp2 -j -S currentTime.h
</pre><p>This generates <em><code>soapcurrentTimeService.h</code></em> and <em><code>soapcurrentTimeService.cpp</code></em> files, as well as auxiliary files <em><code>soapStub.h</code></em>, <em><code>soapH.h</code></em>, and <em><code>soapC.cpp</code></em> and <em><code>currentTime.nsmap</code></em>. The <em><code>soapcurrentTimeService.h</code></em> file includes documentation on the service class.</p>
<p>Now using the <code>currentTimeService</code> class we can improve the CGI service application:</p>
<div class="fragment"><div class="line"><span class="comment">// File: currentTime.cpp </span></div><div class="line"><span class="preprocessor">#include &quot;soapcurrentTimeService.h&quot;</span> <span class="comment">// include the proxy declarations </span></div><div class="line"><span class="preprocessor">#include &quot;currentTime.nsmap&quot;</span>        <span class="comment">// include the generated namespace table</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="comment">// create server and serve one CGI-based request: </span></div><div class="line">  currentTimeService server(<a class="code" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69">SOAP_XML_INDENT</a>); </div><div class="line">  server.serve(); </div><div class="line">  server.destroy(); </div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> currentTimeService::currentTime(time_t&amp; response) </div><div class="line">{</div><div class="line">  response = time(0); </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>We compile this with: </p><pre class="fragment"> c++ -o currentTime.cgi currentTime.cpp soapcurrentTimeService.cpp soapC.cpp stdsoap2.cpp
</pre><p>and install the binary as a CGI application.</p>
<p>To run the server as a stand-alone iterative (i.e. non-multi-hreaded) server on port 8080 until a the accept times out or an error occurs:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (server.run(8080) != <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>) </div><div class="line">  server.soap_stream_fault(std::cerr); </div></div><!-- fragment --><p>To run the server as a stand-alone iterative server on port 8080 while ignoring common errors until a TCP occurs:</p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (server.run(8080) != <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (server.soap-&gt;error == <a class="code" href="group__group__errors.html#ga5087817634de39f79e74246b1eb4da54">SOAP_TCP_ERROR</a>)</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">  server.soap_stream_fault(std::cerr); </div><div class="line">}</div></div><!-- fragment --><p>To implement stand-alone and multi-threaded services, see Sections <a class="el" href="index.html#stand-alone">How to create a stand-alone server</a> and <a class="el" href="index.html#mt">How to create a multi-threaded stand-alone service</a>. These stand-alone Web Services handle multiple SOAP requests by spawning a thread for each request. Thread pooling is also an option. The use of Apache modules and ISAPI extensions to deploy gSOAP services is recommended to ensure load balancing, access control, tracing, and so on.</p>
<p>For more information on server-side service classes, see Section <a class="el" href="index.html#object">How to generate C++ server classes</a> . For more information on client-side proxy classes, see Section <a class="el" href="index.html#proxy">How to generate C++ client proxy classes</a> .</p>
<p>See <a href="https://www.genivia.com/dev.html">https://www.genivia.com/dev.html</a> for additional introductory examples of SOAP/XML, XML REST and JSON applications in C and C++. See <a href="https://www.genivia.com/examples">https://www.genivia.com/examples</a> and the gSOAP source code package <em><code>gsoap/samples</code></em> for more examples.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="databindings"></a>
Introduction to XML data bindings</h1>
<p>This section is a basic introduction to XML data bindings in C/C++. Because gSOAP offers many options to implement XML data bindings, we wrote a separate <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> document on this topic that contains an in-depth discussion of XML schema mappings to C/C++ types, using wsdl2h with <em><code>typemap.dat</code></em> to customize these bindings, memory management to allocate and release serializable types, and how to use <a href="#soapcpp2options">soapcpp2 options</a> to generate deep data structure copy and delete functions for serializable types.</p>
<p>Basically, the C/C++ XML data binding in gSOAP provides and automated mechanism to serialize any C and C++ data structure in XML and to deserialize XML back into C/C++ data structures. To facilitate XML data bindings, a WSDL or an XML schema (XSD file) can converted with wsdl2h into a set of serializable C or C++ data type declarations. These C/C++ type declarations can be readily incorporated into your application to manipulate XML directly as C/C++ data structures with much more ease than DOM or SAX. For example, XML schema strings are just C/C++ strings, XML schema enumerations are C/C++ enums, XML schema complex types are just structs or classes in C/C++, and so on. In this way, an automatic mapping between XML elements of the XML schema and members of a class is created. No DOM traversals and SAX events are needed.</p>
<p>More importantly, the XML C/C++ data binding makes XML manipulation type safe. That is, the type safety of C/C++ ensures that only valid XML documents can be parsed and generated.</p>
<p>The wsdl2h tool performs the mapping of WSDL and XML schemas to C and/or C++ automatically. The output of wsdl2h is a "data binding interface file" which is simply an annotated C/C++ header file with the serializable C/C++ data types that represent XML schema components. This file also includes comments and documentation of the serializable data types. For WSDLs, also functions are declared in this interface file that represent XML Web services operations.</p>
<p>Let's illustrate XML data bindings with an example. Suppose we have an XML document with a book record:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">book</span> <span class="keyword">isbn</span>=<span class="stringliteral">&quot;1234567890&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">title</span>&gt;<span class="keyword">Farewell</span> <span class="keyword">John</span> <span class="keyword">Doe</span>&lt;/<span class="keywordtype">title</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">publisher</span>&gt;<span class="keyword">ABC</span>&#39;<span class="keyword">s</span> <span class="keyword">is</span> <span class="keyword">our</span> <span class="keyword">Name</span>&lt;/<span class="keywordtype">publisher</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;/<span class="keywordtype">book</span>&gt;</div></div><!-- fragment --> </div><p>An example XML schema (XSD file) that defines the book element and type could be:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">schema</span> ...&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;book&quot;</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">complexType</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">sequence</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;title&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;string&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;publisher&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;string&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &lt;/<span class="keywordtype">sequence</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &lt;<span class="keywordtype">attribute</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;isbn&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;unsignedLong&quot;</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;required&quot;</span>/&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;/<span class="keywordtype">complexType</span>&gt; </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &lt;/<span class="keywordtype">element</span>&gt; </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&lt;/<span class="keywordtype">schema</span>&gt;</div></div><!-- fragment --> </div><p>Now, using wsdl2h we translate this XML schema that defines the book type and root element into a C++ class definition:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>book </div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">  @ <a class="code" href="group__group__soap.html#ga7c6e38d209f60a18e362172dca1a3b6e">ULONG64</a> isbn; </div><div class="line">    std::string title; </div><div class="line">    std::string publisher; </div><div class="line">};</div></div><!-- fragment --><p>Note that annotations such as <code>@</code> are used to distinguish attributes from elements. These annotations are gSOAP-specific and are handled by the soapcpp2 tool that reads this generated interface file and generates the XML data binding implementation with serializers for the data types declared in the interface file.</p>
<p>That is, the soapcpp2 tool generates all the necessary code to parse and generate XML for <code>book</code> objects. Validation constraints such as <em><code>minOccurs="1"</code></em> and <em><code>use="required"</code></em> are included in the generated code as checks that are enforced with the <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> flag.</p>
<p>To write the XML representation of a book object instantiated in our C++ application, we first create a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> engine context and use it with <code>soap_write_book</code> (a function generated by soapcpp2) to write the object in XML to standard output:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69">SOAP_XML_INDENT</a>); <span class="comment">// new context</span></div><div class="line">book bk; </div><div class="line">bk.isbn = 1234567890; </div><div class="line">bk.title = <span class="stringliteral">&quot;Farewell John Doe&quot;</span>; </div><div class="line">bk.publisher = <span class="stringliteral">&quot;ABC&#39;s is our Name&quot;</span>; </div><div class="line"><span class="keywordflow">if</span> (soap_write_book(soap, &amp;bk) != <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>) </div><div class="line">  ... <span class="comment">// error</span></div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); <span class="comment">// delete managed class instances </span></div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);    <span class="comment">// finalize and free the context</span></div></div><!-- fragment --><p>The <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context holds the engine state and run-time flags, such as <code><a class="el" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69" title="soap_mode XML output flag value to enable XML (and JSON) message indentation in messages sent ...">SOAP_XML_INDENT</a></code>, serialization options, and other I/O settings. This means that we can simply set the output file descriptor <code>int <a class="el" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9" title="The file descriptor to write data to when no socket communications are set (soap::socket == SOAP_INVA...">soap::sendfd</a></code> or output stream <code>std::ostream* <a class="el" href="structsoap.html#a27b166e404c7c98cfa45d6d7a5da90c0" title="The sink to write data to when non-NULL, which in C++ is a std::ostream object and in C is a pointer ...">soap::os</a></code> of the context to redirect the content to a file or string. Also, when serializing a graph with <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> rather than an XML tree, the XML output contains id-ref attributes to reference nodes in the XML graph, similar to the way SOAP encoding with multi-reference id-ref/href works, see Section <a class="el" href="index.html#bindings">How to use XML serializers to save and load application data</a> for details.</p>
<p>To read the XML representation from standard input into a book class instance:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d">SOAP_XML_STRICT</a>); <span class="comment">// new context</span></div><div class="line">book bk; </div><div class="line"><span class="keywordflow">if</span> (soap_read_book(soap, &amp;bk) != <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>)</div><div class="line">  ... <span class="comment">// error</span></div><div class="line"><span class="keywordflow">else</span> </div><div class="line">  cout &lt;&lt; bk.isbn &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; bk.title &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; bk.publisher &lt;&lt; endl; </div><div class="line">... <span class="comment">// further use of bk</span></div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); <span class="comment">// delete managed class instances </span></div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);    <span class="comment">// finalize and free the context</span></div></div><!-- fragment --><p>Automatic built-in strict XML validation is enabled with <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code>, which ensures that data members are present so we can safely print them in this example, thus ensuring consistency of data with the XML schema.</p>
<p>We can set the <code>int <a class="el" href="structsoap.html#a192c25cc206668600212fd34f6541f34" title="The file descriptor to read data from when no socket communications are set (soap::socket == SOAP_INV...">soap::recvfd</a></code> file descriptor or the <code>std::istream* <a class="el" href="structsoap.html#a285e8a3584ffb1cea07a700c951e436d" title="The source to read data from when non-NULL, which in C++ is a std::istream object and in C is a 0-ter...">soap::is</a></code> input stream to read from a file or string stream instead of stdin.</p>
<p>The <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code> and <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> calls deallocate the deserialized data, so use these with care. Memory management is automatic in gSOAP to avoid leaks.</p>
<p>The above example uses a very simple example schema. The gSOAP toolkit handles all XML schema constructs defined by the XML schema standard. The toolkit is also able to serialize pointer-based C/C++ data structures, including cyclic graphs, structs/classes, unions, enums, STL containers, and even special data types such as <code>struct tm</code>. Therefore, the toolkit works in two directions: from WSDL/schema to C/C++ and from C/C++ to WSDL/schema.</p>
<p>The gSOAP toolkit also handles multiple schemas defined in multiple namespaces. Normally the namespace prefixes of XML namespaces are added to the C/C++ type definitions to ensure type uniqueness. For example, if we would combine two schemas in the same application where both schemas define a <code>book</code> object, we need to resolve this conflict. In gSOAP this is done using namespace prefixes, rather than C++ namespaces (research has pointed out that XML namespaces are not equivalent to C++ namespaces). Thus, the <code>book</code> class might actually be bound to an XML namespace and the class would be named <code>ns__book</code>, where <code>ns</code> is bound to the corresponding namespace.</p>
<p>For example, the following run-time flags are available to control serialization as an XML tree or graph:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line"><a class="code" href="group__group__context.html#ga84f52a67a41009b260ff2c036df7f6ab">soap_set_mode</a>(soap, <a class="code" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493">SOAP_XML_TREE</a>);  <span class="comment">// use this for XML without id-ref (no cycles!)</span></div><div class="line"><a class="code" href="group__group__context.html#ga84f52a67a41009b260ff2c036df7f6ab">soap_set_mode</a>(soap, <a class="code" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645">SOAP_XML_GRAPH</a>); <span class="comment">// or use this for XML with id-ref (including cycles)</span></div></div><!-- fragment --><p>Other flags can be used to format XML, see Section <a class="el" href="index.html#flags">Run-time flags</a> .</p>
<p>For more details on XML databinding support for C and C++, see Section <a class="el" href="index.html#bindings">How to use XML serializers to save and load application data</a> and the <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> document.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="guide"></a>
A quick user guide</h1>
<p>This section of the user guide presents a quick overview to get started with gSOAP. In principle, XML SOAP and REST clients and services can be developed in C and C++ with the soapcpp2 tool without a detailed understanding of XML, XML schema, WSDL, and the XML SOAP protocol.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="client"></a>
How to build Web API clients</h2>
<p>The implementation of a client application that invokes remote service operations by serializing application data in XML for the remote operation request, also called XML marshalling in remote procedure calling. This requires a "stub function", also called "service proxy", for each service operation that the client invokes. The primary stub's responsibility is to serialize the parameter data in XML, send the request with the parameters to the designated SOAP service over the wire, to wait for the response, and to deserialize the parameter data of the response when it arrives. With the stub function in place, the client application invokes a remote service operation as if it would invoke a local function. To write a client stub function in C or C++ by hand is a tedious task, especially if the input and output parameters of a service operation contain elaborate data structures that must meet XML validation constraints. Fortunately, the wsdl2h tool and soapcpp2 tool automate the development of SOAP/XML Web service client and server applications.</p>
<p>The soapcpp2 tool generates the necessary gluing code (the client stub functions and server skeleton functions) to build web service clients and services. The input to the soapcpp2 tool consists of an interface file with familiar C/C++ header file syntax. This interface header file can be automatically generated from a WSDL (Web Service Description Language) documentation of a service with the gSOAP wsdl2h tool.</p>
<p>The following command: </p><pre class="fragment"> wsdl2h -o calc.h http://www.genivia.com/calc.wsdl
</pre><p>generates the <em><code>calc.h</code></em> interface header file for soapcpp2. The WSDL specification may consist of multiple imported WSDL files and XSD schema files. The WSDLs and XSDs are then translated to C or C++, replacing WSDL service operation by C/C++ functions and XML schema data types by C/C++ data types.</p>
<p>To generate C code, we use <a href="#wsdl2h-c"><b><code>wsdl2h -c</code></b> option <b><code>-c</code></b></a>: </p><pre class="fragment"> wsdl2h -c -o calc.h http://www.genivia.com/calc.wsdl
</pre><p>For more details on the wsdl2h tool and its options, see Section <a class="el" href="index.html#wsdlin">The wsdl2h tool</a> .</p>
<p>When upgrading gSOAP to a newer version it is often not necessary to perform this first step again, since newer versions are backward compatible to previous interface header files generated by wsdl2h.</p>
<p>Looking into the file <em><code>calc.h</code></em> we see that the SOAP service methods are specified as function prototypes. For example, the <code>add</code> function to add two doubles is declared as:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns2__add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result);</div></div><!-- fragment --><p>The <code>ns2__add</code> function uses an XML namespace prefix to distinguish it from operations defined in other namespaces, thus nicely preventing name clashes in this way. The convention to add an XML namespace prefix to the names of operations, types, and <code>struct</code> and <code>class</code> members is universally used by the gSOAP tools and automatically added by wsdl2h.</p>
<p>Next, the <em><code>calc.h</code></em> header file is input to the soapcpp2 tool to generate the gluing code's logic to invoke the Web service from a client application: </p><pre class="fragment">soapcpp2 calc.h
</pre><p>The function prototypes in <em><code>calc.h</code></em> are converted by the soapcpp2 tool to stub functions for remote calls:</p>
<ul>
<li><em><code>soapStub.h</code></em> annotated copy of the header file's definitions.</li>
<li><em><code>soapH.h</code></em> XML serializers declarations</li>
<li><em><code>soapC.cpp</code></em> XML serializers implementations</li>
<li><em><code>soapClient.cpp</code></em> the client calling stub functions</li>
</ul>
<p>The logic of the generated <em><code>soapClient.cpp</code></em> stub functions allow client applications to seamlessly interact with existing SOAP Web services as illustrated by the client code example in the next section.</p>
<p>The input and output parameters of a service operation may be primitive data types or compound data types, such as containers and pointer-based linked data structures. These are defined in the interface header file, which is either generated by the wsdl2h tool or it may be specified by hand. The soapcpp2 tool automatically generates XML serializers and XML deserializers for these data types to enable the generated stub functions to serialize the contents of the parameters of the service operations in XML.</p>
<p>The soapcpp2 tool also generates "skeleton functions" <em><code>soapServer.cpp</code></em> for each of the service operations specified in the interface header file. The skeleton functions can be readily used to implement one or more of the service operations in a new XML Web service.</p>
<p>To develop C++ client applications, a useful option to use with soapcpp2 is <em><code>-j</code></em> to generate proxy classes to invoke services, instead of global functions: </p><pre class="fragment">soapcpp2 -j calc.h
</pre><p>The function prototypes in <em><code>calc.h</code></em> are converted by the soapcpp2 tool to the following function:</p>
<ul>
<li><em><code>soapStub.h</code></em> annotated copy of the header file's definitions.</li>
<li><em><code>soapH.h</code></em> XML serializers declarations</li>
<li><em><code>soapC.cpp</code></em> XML serializers implementations</li>
<li><em><code>soapcalcProxy.h</code></em> the client proxy class</li>
<li><em><code>soapcalcProxy.cpp</code></em> the client proxy class implementation</li>
</ul>
<p>To use the proxy class, <code>#include "soapcalcProxy.h"</code> and compile and link <code>soapcalcProxy.cpp</code>. See the following section.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example1"></a>
Example</h3>
<p>The <code>add</code> service operation declared in the <em><code>calc.h</code></em> file obtained with the wsdl2h tool in the previous section, adds two doubles. The WSDL description of the service provides the endpoint to invoke the service operations and the XML namespace used by the operations:</p>
<ul>
<li>Endpoint URL: <em><code><a href="http://websrv.cs.fsu.edu/~engelen/calcserver.cgi">http://websrv.cs.fsu.edu/~engelen/calcserver.cgi</a></code></em></li>
<li>XML namespace: <em><code>urn:calc</code></em></li>
</ul>
<p>Each SOAP-specific service operation also has a "SOAP action", which is an optional string to identify the operation, which is mainly used with WS-Addressing. The request and response messages for SOAP RPC-encoded services are simply represented by C functions with input and output parameters. For the <code>add</code> operation, the SOAP binding details are:</p>
<ul>
<li>SOAP style: RPC</li>
<li>SOAP encoding: encoded</li>
<li>SOAP action: ""</li>
</ul>
<p>This information is translated to the wsdl2h-generated interface header file with the service definitions. The <em><code>calc.h</code></em> header file for C++ generated by wsdl2h contains the following directives and declarations:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns2 schema namespace:   urn:calc</span></div><div class="line"><span class="comment">//gsoap ns2 schema form:        unqualified</span></div><div class="line"></div><div class="line"><span class="comment">//gsoap ns2 service name:       calc</span></div><div class="line"><span class="comment">//gsoap ns2 service type:       calcPortType</span></div><div class="line"><span class="comment">//gsoap ns2 service port:       http://websrv.cs.fsu.edu/~engelen/calcserver.cgi </span></div><div class="line"><span class="comment">//gsoap ns2 service namespace:  urn:calc </span></div><div class="line"><span class="comment">//gsoap ns2 service transport:  http://schemas.xmlsoap.org/soap/http</span></div><div class="line"></div><div class="line"><span class="comment">//gsoap ns2 service method-protocol:    add SOAP </span></div><div class="line"><span class="comment">//gsoap ns2 service method-style:       add rpc </span></div><div class="line"><span class="comment">//gsoap ns2 service method-encoding:    add http://schemas.xmlsoap.org/soap/encoding/ </span></div><div class="line"><span class="comment">//gsoap ns2 service method-action:      add &quot;&quot; </span></div><div class="line"><span class="keywordtype">int</span> ns2__add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result);</div></div><!-- fragment --><p>The actual contents may vary depending on the release version and the options used to control the output.</p>
<p>The other calculator service operations are similar and were elided for clarity.</p>
<p>The <code>//gsoap</code> directives are interpreted by the soapcpp2 tool to generate code that is compliant to the SOAP protocol. For this service the SOAP protocol with the "SOAP 1.1 RPC encoding style" is used. This produces XML messages with the familiar SOAP envelope and body in the SOAP 1.1 namespace and a <em><code>SOAP-ENV:encodingStyle</code></em> attribute for SOAP RPC encoding (a simple XML serialization format) as can be seen in the XML request message:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;http://tempuri.org/ns.xsd&quot;</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span> <span class="keyword">SOAP-ENV:encodingStyle</span>=&quot;<span class="keyword">http:</span>//<span class="keyword">schemas.xmlsoap.org</span>/<span class="keyword">soap</span>/<span class="keyword">encoding</span>/&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">ns:add</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &lt;<span class="keywordtype">a</span>&gt;1.0&lt;/<span class="keywordtype">a</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &lt;<span class="keywordtype">b</span>&gt;2.0&lt;/<span class="keywordtype">b</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &lt;/<span class="keywordtype">ns:add</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>Another style is "document/literal" which is also defined by SOAP 1.1/1.2.</p>
<p>To use SOAP document/literal style is indicated for each service operation as follows in the interface file specification, which also switches to the SOAP 1.2 protocol:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns2 service method-protocol:    add SOAP1.2</span></div><div class="line"><span class="comment">//gsoap ns2 service method-style:       add document</span></div><div class="line"><span class="comment">//gsoap ns2 service method-encoding:    add literal</span></div><div class="line"><span class="comment">//gsoap ns2 service method-action:      add &quot;&quot; </span></div><div class="line"><span class="keywordtype">int</span> ns2__add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result);</div></div><!-- fragment --><p>This produces XML messages with the familiar SOAP envelope and body with the SOAP 1.2 namespace and without the encodingStyle attribute as can be seen in the XML request message:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://www.w3.org/2003/05/soap-envelope&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://www.w3.org/2003/05/soap-encoding&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;urn:calc&quot;</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">ns:add</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &lt;<span class="keywordtype">a</span>&gt;1.0&lt;/<span class="keywordtype">a</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &lt;<span class="keywordtype">b</span>&gt;2.0&lt;/<span class="keywordtype">b</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &lt;/<span class="keywordtype">ns:add</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>REST instead of SOAP is specified with <code>HTTP</code> instead of <code>SOAP</code> with the <code>//gsoap &lt;prefix&gt; service method-protocol:</code> directive to carry our XML messages using the HTTP POST method without a SOAP envelope:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns2 service method-protocol:    add HTTP</span></div><div class="line"><span class="keywordtype">int</span> ns2__add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result);</div></div><!-- fragment --><p>This produces non-SOAP XML messages with HTTP POST. For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">ns:add</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;urn:calc&quot;</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;<span class="keywordtype">a</span>&gt;1.0&lt;/<span class="keywordtype">a</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;<span class="keywordtype">b</span>&gt;2.0&lt;/<span class="keywordtype">b</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;/<span class="keywordtype">ns:add</span>&gt;</div></div><!-- fragment --> </div><p>Likewise you can specify <code>POST</code>, <code>PUT</code>, and <code>GET</code> HTTP methods for direct XML messaging instead of <code>SOAP</code>. However, all XML Web services protocols such as WS-Security and WS-Addressing require SOAP to include the SOAP Headers.</p>
<p>Note that the function declaration itself and the client-side calling stub and server-side skeleton functions are unchanged. The internals of the generated functions are changed to accommodate the protocol specified with the directives.</p>
<p>For more details about the <code>//gsoap</code> directives, see Section <a class="el" href="index.html#directives">Directives</a> .</p>
<p>So as you can see, the Web service operations are declared as function prototypes. When the parameters of the function are structs and classes, then all of these interdependent data types are included in the wsdl2h-generated header file.</p>
<p>In this simple example the parameters are primitive types. The calculator <code>add</code> operation takes two double floats <code>a</code> and <code>b</code>, and returns the sum in <code>result</code>. By convention, all parameters are input parameters except the last parameter which is an output parameter or specified as <code>void</code> for one-way messages. The last parameter is always a single output parameter, if not <code>void</code>. A <code>struct</code> or <code>class</code> is used to wrap multiple output parameters, see also Section <a class="el" href="index.html#multiple">How to specify multiple output parameters</a> . This last parameter must be a pointer or reference. By contrast, the input parameters support pass by value or by pointer, but not pass by C++ reference due to complications when generating compilable source code for the stub and skeleton functions.</p>
<p>The function prototype associated with a service operation always returns an <code>int</code>. The return value indicates success with <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> (zero) or failure with a nonzero value. See Section <a class="el" href="index.html#errcodes">Run-time error codes</a> for the error codes.</p>
<p>The role of the namespace prefix (<code>ns2__</code>) in the service operation name specified as a function prototype associates an XML namespace with the service operation as a qualified name, i.e. qualified by means of a namespace prefix. This is discussed in detail in Section <a class="el" href="index.html#namespace">XML namespace considerations</a> . Basically, the namespace prefix is added to a function name or type name with a pair of underscores, as in <code>ns2__add</code>, where <code>ns2</code> is the namespace prefix and <code>add</code> is the service operation name. This mechanism ensures uniqueness of operations and types associated with a service.</p>
<p>When using wsdl2h it is strongly recommended to set the namespace prefix to a name of your choice by modifying the <em><code>typemap.dat</code></em> file that is used by wsdl2h. This file can be copied from <em><code>gsoap/typemap.dat</code></em> and modified in the local directory where you run wsdl2h. This avoids problems when running wsdl2h on multiple WSDLs where the sequence of prefixes <code>ns1</code>, <code>ns2</code>, and so on are arbitrarily assigned to the services. To choose a prefix name for all the operations and types of a service, say prefix <code>c__</code> for the calculator service, add the following line to <em><code>typemap.dat</code></em>: </p><pre class="fragment">c = "urn:calc"
</pre><p>and rerun wsdl2h. Moreover, the <em><code>typemap.dat</code></em> configures wsdl2h to use specific bindings and data types for services. The result is that <code>c__add</code> is used to uniquely identify the operation rather than the more arbitrary name <code>ns2__add</code>.</p>
<p>A note on the use of underscores in names: a single underscore in an identifier name will be translated into a dash in XML, because dashes are more frequently used in XML compared to underscores, see Section <a class="el" href="index.html#idtrans">C/C++ identifier name to XML tag name translation</a> . Double underscores separate the namespace prefix from the unqualified part of the qualified name.</p>
<p>Next, the soapcpp2 tool is invoked from the command line to process the <em><code>calc.h</code></em> service definitions: </p><pre class="fragment"> soapcpp2 calc.h
</pre><p>The tool generates the client stub functions for the service operations. Stub functions can be invoked by a client program to invoke the remote service operations. The interface of the generated stub function is identical to the function prototype in the <em><code>calc.h</code></em> service definition file, but with additional parameters to pass the engine's context <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code>, an endpoint URL (or NULL for the default), and a SOAP action (or NULL for the default):</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> soap_call_c__add(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *URL, <span class="keywordtype">char</span> *action, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result);</div></div><!-- fragment --><p>This stub function is saved in <em><code>soapClient.cpp</code></em>. The file <em><code>soapC.cpp</code></em> contains the serializer and deserializer functions for the data types used by the stub. You can use <a href="#wsdl2h-c"><b><code>wsdl2h -c</code></b> option <b><code>-c</code></b></a> to generate pure C code. Likewise, <b><code>soapcpp2 -c</code></b> option <b><code>-c</code></b> generates pure C code, if the input interface file is written in C of course.</p>
<p>The <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> parameter of the stub function shown above must be a valid pointer to a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context. The <code>URL</code> parameter when non-NULL overrides the default endpoint address defined by the WSDL and the <code>//gsoap &lt;prefix&gt; service port:</code> directive. The <code>action</code> parameter when non-NULL overrides the default SOAP action defined by the WSDL and the <code>//gsoap &lt;prefix&gt; service method-action:</code> directive.</p>
<p>The following example C/C++ client program uses the generated stub function to invoke the remote service operation:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span>    <span class="comment">// include the generated declarations</span></div><div class="line"><span class="preprocessor">#include &quot;calc.nsmap&quot;</span> <span class="comment">// include the generated namespace table </span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keywordtype">double</span> sum; </div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); <span class="comment">// the context </span></div><div class="line">  <span class="keywordflow">if</span> (soap_call_c__add(soap, NULL, NULL, 1.0, 2.0, &amp;sum) == <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>) </div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Sum = &quot;</span> &lt;&lt; sum &lt;&lt; std::endl; </div><div class="line">  <span class="keywordflow">else</span> <span class="comment">// an error occurred </span></div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); <span class="comment">// display the SOAP fault message on the stderr stream </span></div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); <span class="comment">// delete managed class instances </span></div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);    <span class="comment">// finalize and free the context</span></div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">}</div></div><!-- fragment --><p>The <code>soap_call_c__add</code> call returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> (zero) on success and a nonzero error on failure. When an error occurred you can print the fault message with the <code><a class="el" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af" title="Print error message on the specified output. ">soap_print_fault(struct soap*, FILE*)</a></code> function. Use <code><a class="el" href="group__group__fault.html#gafc9d67060889f7243381299047f0e8e6" title="Print error message to the specified string buffer. ">soap_sprint_fault(struct soap*, char *buf, size_t len)</a></code> to save the fault message to a string buffer <code>buf[0...len-1]</code>. Use <code><a class="el" href="group__group__fault.html#gaab984763de3f5fdd4363aa62b4f250c2" title="Print error message on the specified output stream. ">soap_stream_fault(struct soap*, std::ostream&amp;)</a></code> to send the fault message to a stream.</p>
<p>The following functions are used to explicitly set up a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context and finalize it:</p>
<ul>
<li><code><a class="el" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c" title="Allocate and initialize a new soap context. ">soap_new()</a></code> allocates, initializes, and returns a pointer to a new <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context.</li>
<li><code><a class="el" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658" title="Allocate and initialize a new soap context with input and output soap_mode flags. ...">soap_new1(soap_mode mode)</a></code> allocates, initializes and sets both in- and out-mode flags to the same mode, and returns a pointer to a new <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context.</li>
<li><code><a class="el" href="group__group__context.html#ga12a87f6795b62b05164edc392b2adb1d" title="Allocate and initialize a new soap context with separate input and output soap_mode flags...">soap_new2(soap_mode imode, soap_mode omode)</a></code> allocates, initializes and sets in- and out-mode flags, and returns a pointer to a new <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context.</li>
<li><code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy(struct soap*)</a></code> allocates and returns a new context by copying the given context with <code><a class="el" href="group__group__context.html#gabcb00978a07439254c4dd44c6332b2bf" title="Copy a given soap context to an uninitialized destination soap context. ">soap_copy_context</a></code>, such that the new context returned does not share any data with the given context.</li>
<li><code><a class="el" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c" title="Initialize a stack-allocated soap context. ">soap_init(struct soap*)</a></code> initializes a stack-allocated <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context in C, when not using <code><a class="el" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c" title="Allocate and initialize a new soap context. ">soap_new</a></code>, for C++ use the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> constructors instead.</li>
<li><code><a class="el" href="group__group__context.html#gac87126c3e45d2fda488e9832c2dd5be1" title="Initialize a stack-allocated soap context with input and output soap_mode flags. ">soap_init1(struct soap*, soap_mode mode)</a></code> initializes a stack-allocated <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context, when not using <code><a class="el" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658" title="Allocate and initialize a new soap context with input and output soap_mode flags. ...">soap_new1</a></code>, and sets both in- and out-mode flags to the same mode, for C++ use the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> constructors instead.</li>
<li><code><a class="el" href="group__group__context.html#ga3c70b587fc4f65553cfe69751d1a157e" title="Initialize a stack-allocated soap context with input and output soap_mode flags. ">soap_init2(struct soap*, soap_mode imode, soap_mode omode)</a></code> initializes a stack-allocated <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context, when not using <code><a class="el" href="group__group__context.html#ga12a87f6795b62b05164edc392b2adb1d" title="Allocate and initialize a new soap context with separate input and output soap_mode flags...">soap_new2</a></code>, and sets in- and out-mode flags, for C++ use the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> constructors instead.</li>
<li><code><a class="el" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a" title="Finalize the given soap context, i.e. when the soap context is stack allocated, automatically invoked...">soap_done(struct soap*)</a></code> finalizes a context but does not delete the specified <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context (for example when stack-allocated). The context can be re-initialized afterwards with <code><a class="el" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c" title="Initialize a stack-allocated soap context. ">soap_init</a></code>. In C++, a stack-allocated context invokes this function in its destructor when the context is deleted.</li>
<li><code><a class="el" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a" title="Finalize and free the given soap context from unmanaged heap memory. ">soap_free(struct soap*)</a></code> finalizes and deletes the given context, when created with <code><a class="el" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c" title="Allocate and initialize a new soap context. ">soap_new</a></code> or <code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy</a></code>.</li>
</ul>
<p>A <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context can be reused as many times as necessary and does not need to be reinitialized when doing so. However, a new context is required for each thread that runs independently to guarantee exclusive access to a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context by each thread.</p>
<p>Also the use of any client calls within an active service operation implemented at the server side requires a new context, since <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> is still processing with the current <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context that must be maintained while the service operation and response has not been completed yet.</p>
<p>The soapcpp2 code generator tool generates a service proxy class for C++ client applications (and service objects for server applications) with the <b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b> (or <b><code>-i</code></b> option): </p><pre class="fragment"> soapcpp2 -j calc.h
</pre><p>The proxy is defined in:</p>
<ul>
<li><em><code>soapcalcProxy.h</code></em> client proxy class</li>
<li><em><code>soapcalcProxy.cpp</code></em> client proxy class</li>
</ul>
<p>Without the <b><code>-j</code></b> option, C-like <em><code>soapClient.cpp</code></em> and <em><code>soapServer.cpp</code></em> source codes are is generated. Use option <b><code>-i</code></b> as an alternative to <b><code>-j</code></b> to generate classes with the same functionality, but that are inherited from the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> struct. With the <b><code>-j</code></b> option, the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> engine context is a pointer member of the generated proxy and service classes and can therefore be shared with other proxy or service class instances. The choice of option to use is application-dependent, but the choice is also important when services are chained to serve requests on the same server port, see Section <a class="el" href="index.html#chaining">How to chain C++ server classes to accept messages on the same port</a> .</p>
<p>The generated C++ proxy class initializes the context and offers the service interface as a collection of methods:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapcalcProxy.h&quot;</span> <span class="comment">// get proxy </span></div><div class="line"><span class="preprocessor">#include &quot;calc.nsmap&quot;</span>      <span class="comment">// include the generated namespace table </span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  calcProxy calc(<a class="code" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69">SOAP_XML_INDENT</a>); </div><div class="line">  <span class="keywordtype">double</span> sum; </div><div class="line">  <span class="keywordflow">if</span> (calc.add(1.0, 2.0, sum) == <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>) </div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Sum = &quot;</span> &lt;&lt; sum &lt;&lt; std::endl; </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">    calc.soap_stream_fault(std::cerr); </div><div class="line">  calc.destroy();</div><div class="line">  <span class="keywordflow">return</span> calc.soap-&gt;error; <span class="comment">// nonzero when error </span></div><div class="line">}</div></div><!-- fragment --><p>The proxy constructor takes context mode parameters to initialize the context, e.g. <code><a class="el" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69" title="soap_mode XML output flag value to enable XML (and JSON) message indentation in messages sent ...">SOAP_XML_INDENT</a></code> in this example.</p>
<p>The code is compiled and linked with <em><code>soapcalcProxy.cpp</code></em>, <em><code>soapC.cpp</code></em>, and <em><code>gsoap/stdsoap2.cpp</code></em>.</p>
<p>The proxy class name is extracted from the WSDL content and may not always be in a short format. You can change this directive to customize the service name:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap c service name: calc</span></div></div><!-- fragment --><p>then rerun soapcpp2 to generate code that uses the new name.</p>
<p>When the example client application is invoked, a SOAP request is performed: </p><pre class="fragment">POST /~engelen/calcserver.cgi HTTP/1.1 
Host: websrv.cs.fsu.edu 
User-Agent: gSOAP/2.8 
Content-Type: text/xml; charset=utf-8 
Content-Length: 464 
Connection: close 
SOAPAction: "" 
</pre> <div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="keyword">xmlns:c</span>=<span class="stringliteral">&quot;urn:calc&quot;</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span> <span class="keyword">SOAP-ENV:encodingStyle</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">c:add</span>&gt; </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &lt;<span class="keywordtype">a</span>&gt;1&lt;/<span class="keywordtype">a</span>&gt; </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &lt;<span class="keywordtype">b</span>&gt;2&lt;/<span class="keywordtype">b</span>&gt; </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &lt;/<span class="keywordtype">c:add</span>&gt; </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>The SOAP response message is: </p><pre class="fragment">HTTP/1.1 200 OK 
Date: Wed, 05 May 2010 16:02:21 GMT 
Server: Apache/2.0.52 (Scientific Linux) 
Content-Length: 463 
Connection: close 
Content-Type: text/xml; charset=utf-8 
</pre> <div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;urn:calc&quot;</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span> <span class="keyword">SOAP-ENV:encodingStyle</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">ns:addResponse</span>&gt; </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &lt;<span class="keywordtype">result</span>&gt;3&lt;/<span class="keywordtype">result</span>&gt; </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &lt;/<span class="keywordtype">ns:addResponse</span>&gt; </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>A client can invoke a sequence of service operations, like so:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapcalcProxy.h&quot;</span> <span class="comment">// get proxy </span></div><div class="line"><span class="preprocessor">#include &quot;calc.nsmap&quot;</span>      <span class="comment">// include the generated namespace table </span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  calcProxy calc(<a class="code" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2">SOAP_IO_KEEPALIVE</a>); <span class="comment">// keep-alive improves connection performance </span></div><div class="line">  <span class="keywordtype">double</span> sum = 0.0; </div><div class="line">  <span class="keywordtype">double</span> val[] = { 5.0, 3.5, 7.1, 1.2 }; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; i++) </div><div class="line">    <span class="keywordflow">if</span> (calc.add(sum, val[i], sum)) </div><div class="line">      <span class="keywordflow">return</span> calc.soap-&gt;error; </div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Sum = &quot;</span> &lt;&lt; sum &lt;&lt; std::endl; </div><div class="line">  calc.destroy();</div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">}</div></div><!-- fragment --><p>In the example shown above, no deserialized data is deallocated until <code>calc.destroy()</code>. To deallocate deserialized data between the calls we change the loop as follows:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; i++) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (calc.add(sum, val[i], sum)) </div><div class="line">    <span class="keywordflow">return</span> calc.soap-&gt;error; </div><div class="line">  calc.destroy(); </div><div class="line">}</div></div><!-- fragment --><p>Deallocation is safe here, since the float values were copied and saved in <code>sum</code>. In other scenarios we should make sure data is copied to local data structures when the data should be preserved. There are tooling options for deep copy and delete of entire data structures to simplify this task, see Section <a class="el" href="index.html#deep">Generating deep copy and deletion functions</a>.</p>
<p>To delegate deletion to another context for later removal, use <code><a class="el" href="group__group__context.html#gaa959ff61609f7b324527e88655c2377f" title="Delegate the deletion of all managed objects and data from the specified soap context to another soap...">soap_delegate_deletion(struct soap *soap_from, struct soap *soap_to)</a></code>. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap soap; </div><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">{</div><div class="line">  <span class="comment">// create proxy </span></div><div class="line">  calcProxy calc; </div><div class="line">  ... <span class="comment">// data produced, e.g. deserialized data with client-side calls</span></div><div class="line">  <a class="code" href="group__group__context.html#gaa959ff61609f7b324527e88655c2377f">soap_delegate_deletion</a>(&amp;calc, &amp;soap); </div><div class="line">  calc.destroy();</div><div class="line">}</div><div class="line">... <span class="comment">// data can still be used</span></div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap); <span class="comment">// delete managed class instances </span></div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line"><a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);    <span class="comment">// finalize the context</span></div></div><!-- fragment --><p>In C we use <a href="#wsdl2h-c"><b><code>wsdl2h -c</code></b> option <b><code>-c</code></b></a> to generate C. The example client calculator program would be written as:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;calc.nsmap&quot;</span> </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <span class="keywordtype">double</span> sum = 0.0; </div><div class="line">  <span class="keywordtype">double</span> val[] = { 5.0, 3.5, 7.1, 1.2 }; </div><div class="line">  <span class="keywordtype">int</span> i; </div><div class="line">  <a class="code" href="group__group__context.html#gac87126c3e45d2fda488e9832c2dd5be1">soap_init1</a>(&amp;soap, <a class="code" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2">SOAP_IO_KEEPALIVE</a>); </div><div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) </div><div class="line">    <span class="keywordflow">if</span> (soap_call_c__add(&amp;soap, NULL, NULL, sum, val[i], &amp;sum)) </div><div class="line">      <span class="keywordflow">return</span> soap.<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>; </div><div class="line">  printf(<span class="stringliteral">&quot;Sum = %lg\n&quot;</span>, sum); </div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap); </div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">}</div></div><!-- fragment --><p>The code above is compiled and linked with the soapcpp2-generated <em><code>soapClient.c</code></em> and <em><code>soapC.c</code></em> files, and <em><code>gsoap/stdsoap2.c</code></em> (or compile with <b><code>-bgsoap</code></b>).</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="namespace"></a>
XML namespace considerations</h3>
<p>The declaration of the <code>ns2__add</code> function prototype discussed in the previous section uses the namespace prefix <code>ns2__</code> of the service operation XML namespace, which is distinguished by a pair of underscores in the function name to separate the namespace prefix from the service operation name. The purpose of a namespace prefix is to associate a service operation name with a service in order to prevent naming conflicts, e.g. to distinguish identical service operation names used by different services.</p>
<p>Note that the XML response of the service example uses a namespace prefix that may be different (e.g. <em><code>ns</code></em>) as long as it bound to the same namespace name <em><code>urn:calc</code></em> through the <em><code>xmlns:ns="urn:calc"</code></em> binding. The use of namespace prefixes and namespace names is also required to enable SOAP applications to validate the content of SOAP messages. The namespace name in the service response is verified by the stub function by using the information supplied in a namespace mapping table that is required to be part of gSOAP client and service application codes. The table is accessed at run time to resolve namespace bindings, both by the generated stub's data structure serializer for encoding the client request and by the generated stub's data structure deserializer to decode and validate the service response. The namespace mapping table should not be part of the header file input to the soapcpp2 tool. Service details including namespace bindings may be provided with gSOAP directives in a header file, see Section <a class="el" href="index.html#directives">Directives</a> .</p>
<p>The namespace mapping table is:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  <span class="comment">// { &quot;prefix&quot;, &quot;URI&quot;, &quot;URI-pattern&quot; (optional) } </span></div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>}, <span class="comment">// must be first </span></div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>}, <span class="comment">// must be second </span></div><div class="line">  { <span class="stringliteral">&quot;xsi&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>}, <span class="comment">// must be third </span></div><div class="line">  { <span class="stringliteral">&quot;xsd&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>},          <span class="comment">// 2001 XML Schema </span></div><div class="line">  { <span class="stringliteral">&quot;ns2&quot;</span>,      <span class="stringliteral">&quot;urn:calc&quot;</span>},                                  <span class="comment">// given by the service description </span></div><div class="line">  { NULL,       NULL}                                         <span class="comment">// end of table </span></div><div class="line">};</div></div><!-- fragment --><p>The first four namespace entries in the table consist of the standard namespaces used by the SOAP protocol. In fact, the namespace mapping table is explicitly declared to enable a programmer to specify the SOAP encoding style and to allow the inclusion of namespace-prefix with namespace-name bindings to comply to the namespace requirements of a specific SOAP service. For example, the namespace prefix <em><code>ns2</code></em>, which is bound to <em><code>urn:calc</code></em> by the namespace mapping table shown above, is used by the generated stub function to encode the <code>add</code> request. This is performed automatically by the soapcpp2 tool by using the <code>ns2</code> prefix of the <code>ns2__add</code> method name specified in the <em><code>calc.h</code></em> header file. In general, if a function name of a service operation, <code>struct</code> name, <code>class</code> name, <code>enum</code> name, or member name of a <code>struct</code> or <code>class</code> has a pair of underscores, the name has a namespace prefix that must be defined in the namespace mapping table.</p>
<p>The namespace mapping table will be output as part of the SOAP Envelope by the stub function. For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:ns2</span>=<span class="stringliteral">&quot;urn:calc&quot;</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;...</div></div><!-- fragment --> </div><p>The namespace bindings will be used by a SOAP service to validate the SOAP request.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example2"></a>
Example</h3>
<p>The incorporation of namespace prefixes into C++ identifier names is necessary to distinguish service operations that share the same name but are provided by separate Web services and/or organizations. It avoids potential name clashes, while sticking to the C syntax since C has no support for namespaces. The C++ proxy classes generated with <b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b> (or option <b><code>-i</code></b>) drop the namespace prefix from the method names.</p>
<p>The namespace prefix convention is also be applied to non-primitive types. For example, <code>class</code> names are prefixed to avoid name clashes when the same name is used by multiple XML schemas. This ensures that the XML databinding never suffers from conflicting schema content. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>e__Address <span class="comment">// an electronic address from schema &#39;e&#39; </span></div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">char</span> *email; </div><div class="line">    <span class="keywordtype">char</span> *url; </div><div class="line">}; </div><div class="line"><span class="keyword">class </span>s__Address <span class="comment">// a street address from schema &#39;s&#39; </span></div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">char</span> *street; </div><div class="line">    <span class="keywordtype">int</span> number; </div><div class="line">    <span class="keywordtype">char</span> *city; </div><div class="line">};</div></div><!-- fragment --><p>At this point you may ask why the gSOAP tools do no use C++ namespaces to implement XML namespaces. The answer is not too complicated. XML namespaces are semantically more rich than C++ namespaces. For example, XML schema complexTypes may reference elements in another schema and these elements may be qualified in XML. There could also be element name clashes when element names are the same but referenced in different schemas. In gSOAP this is resolved by naming <code>struct</code> and <code>class</code> members with the namespace prefix notation, thereby ensuring that name clashes among members cannot occur.</p>
<p>An instance of <code>e__Address</code> is encoded by the generated serializer for this type as an Address element with namespace prefix <code>e</code>:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">e:Address</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">email</span>&gt;<span class="keyword">me</span>@<span class="keyword">home</span>&lt;/<span class="keywordtype">email</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">url</span>&gt;<span class="keyword">www.me.com</span>&lt;/<span class="keywordtype">url</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;/<span class="keywordtype">e:Address</span>&gt;</div></div><!-- fragment --> </div><p>While an instance of <code>s__Address</code> is encoded by the generated serializer for this type as an Address element with namespace prefix <code>s</code>:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">s:Address</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">street</span>&gt;<span class="keyword">Technology</span> <span class="keyword">Drive</span>&lt;/<span class="keywordtype">street</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">number</span>&gt;5&lt;/<span class="keywordtype">number</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;<span class="keywordtype">city</span>&gt;<span class="keyword">Softcity</span>&lt;/<span class="keywordtype">city</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">s:Address</span>&gt;</div></div><!-- fragment --> </div><p>The namespace mapping table of the client program must have entries for <code>e</code> and <code>s</code> that refer to the XML Schemas of the data types:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> },</div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> },</div><div class="line">  { <span class="stringliteral">&quot;xsi&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> },</div><div class="line">  { <span class="stringliteral">&quot;xsd&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> },</div><div class="line">  { <span class="stringliteral">&quot;e&quot;</span>, <span class="stringliteral">&quot;http://www.me.com/schemas/electronic-address&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;s&quot;</span>, <span class="stringliteral">&quot;http://www.me.com/schemas/street-address&quot;</span> }, </div><div class="line">  { NULL, NULL }</div><div class="line">};</div></div><!-- fragment --><p>This table is automatically generated by soapcpp2 and saved as a <em><code>.nsmap</code></em> file that can be included in the source code.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="proxy"></a>
How to generate C++ client proxy classes</h3>
<p>Proxy classes for C++ client applications are automatically generated by the soapcpp2 tool, as was shown in Section <a class="el" href="index.html#example1">Example</a> .</p>
<p>A new and improved code generation capability is implemented in soapcpp2 for C++ proxy classes by using <b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b> (or option <b><code>-i</code></b>). These new proxy classes have a cleaner interface and offer more capabilities compared to the gSOAP 2.7 proxy and service classes.</p>
<p>In C++ you can also use <a href="#wsdl2h-q"><b><code>wsdl2h -q name</code></b> option <b><code>-q name</code></b></a> to generate the proxy class and serializers in the specified C++ namespace <code>name</code>. This is very useful if you want to create multiple proxies for services by repeated use of wsdl2h and then combine them in one code. Alternatively, you can run wsdl2h just once on all service WSDLs and have soapcpp2 generate multiple proxies for you. The latter approach does not use C++ namespaces and actually reduces the overall amount of source code by avoiding code duplication.</p>
<p>To illustrate the generation of a proxy class, the <em><code>calc.h</code></em> header file example of the previous section used.</p>
<div class="fragment"><div class="line"><span class="comment">// Content of file &quot;calc.h&quot;: </span></div><div class="line"><span class="comment">//gsoap ns2 schema namespace:   urn:calc</span></div><div class="line"><span class="comment">//gsoap ns2 schema form:        unqualified</span></div><div class="line"></div><div class="line"><span class="comment">//gsoap ns2 service name:       calc</span></div><div class="line"><span class="comment">//gsoap ns2 service type:       calcPortType</span></div><div class="line"><span class="comment">//gsoap ns2 service port:       http://websrv.cs.fsu.edu/~engelen/calcserver.cgi </span></div><div class="line"><span class="comment">//gsoap ns2 service namespace:  urn:calc </span></div><div class="line"><span class="comment">//gsoap ns2 service transport:  http://schemas.xmlsoap.org/soap/http</span></div><div class="line"></div><div class="line"><span class="comment">//gsoap ns2 service method-protocol:    add SOAP </span></div><div class="line"><span class="comment">//gsoap ns2 service method-style:       add rpc </span></div><div class="line"><span class="comment">//gsoap ns2 service method-encoding:    add http://schemas.xmlsoap.org/soap/encoding/ </span></div><div class="line"><span class="comment">//gsoap ns2 service method-action:      add &quot;&quot; </span></div><div class="line"><span class="keywordtype">int</span> ns2__add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line"></div><div class="line"><span class="comment">//gsoap ns2 service method-protocol:    sub SOAP </span></div><div class="line"><span class="comment">//gsoap ns2 service method-style:       sub rpc </span></div><div class="line"><span class="comment">//gsoap ns2 service method-encoding:    sub http://schemas.xmlsoap.org/soap/encoding/ </span></div><div class="line"><span class="comment">//gsoap ns2 service method-action:      sub &quot;&quot; </span></div><div class="line"><span class="keywordtype">int</span> ns2__sub(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line"></div><div class="line"><span class="comment">//gsoap ns2 service method-protocol:    mul SOAP </span></div><div class="line"><span class="comment">//gsoap ns2 service method-style:       mul rpc </span></div><div class="line"><span class="comment">//gsoap ns2 service method-encoding:    mul http://schemas.xmlsoap.org/soap/encoding/ </span></div><div class="line"><span class="comment">//gsoap ns2 service method-action:      mul &quot;&quot; </span></div><div class="line"><span class="keywordtype">int</span> ns2__mul(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div></div><!-- fragment --><p>The <code>namespace</code> directives declare the XML schema namespace and WSDL service namespace, which are the same in this example. The <code>name</code>, <code>type</code>, and <code>port</code> directives declare service details, which are used by soapcpp2 to name the proxy class, the WSDL port type, and the service location port which is the endpoint URL of the service. The messaging <code>transport</code> mode is HTTP.</p>
<p>The groups of four directives per service operation declare the operation SOAP style (RPC) and encoding (SOAP encoded), and SOAP action string, which is optional and used mostly for HTTP-based routing of messages and by WS-Addressing. In this example, the protocol is SOAP 1.1 RPC encoding. More recent uses of SOAP focus on document/literal style messaging, which is also declared with directives without affecting the rest of the interface header file. For <code>//gsoap</code> directive details, see Section <a class="el" href="index.html#directives">Directives</a> .</p>
<p>Run <b><code>soapcpp2 -j</code></b> on this interface header file with the calculator service specification to generate <em><code>soapcalcProxy.cpp</code></em> and <em><code>soapcalcProxy.h</code></em> with the proxy class declaration:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="group__group__soap.html#gabf2fb2ac6e257152f809b985f093fd94">SOAP_CMAC</a> calcProxy {</div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Context to manage proxy IO and data</span></div><div class="line">    <span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>;</div><div class="line">    <span class="comment">// flag indicating that this context is owned by this proxy when context is shared</span></div><div class="line">    <span class="keywordtype">bool</span> soap_own;</div><div class="line">    <span class="comment">// Endpoint URL of service &#39;calcProxy&#39; (change as needed)</span></div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *soap_endpoint;</div><div class="line">    <span class="comment">// Variables globally declared in calc.h, if any</span></div><div class="line">    <span class="comment">// Construct a proxy with new managing context</span></div><div class="line">    calcProxy();</div><div class="line">    <span class="comment">// Copy constructor</span></div><div class="line">    calcProxy(<span class="keyword">const</span> calcProxy&amp; rhs);</div><div class="line">    <span class="comment">// Construct proxy given a shared managing context</span></div><div class="line">    calcProxy(<span class="keyword">struct</span> soap*);</div><div class="line">    <span class="comment">// Construct proxy given a shared managing context and endpoint URL</span></div><div class="line">    calcProxy(<span class="keyword">struct</span> soap*, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structsoap.html#aed1b86b8a34aea86103751a932c9dce9">endpoint</a>);</div><div class="line">    <span class="comment">// Constructor taking an endpoint URL</span></div><div class="line">    calcProxy(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structsoap.html#aed1b86b8a34aea86103751a932c9dce9">endpoint</a>);</div><div class="line">    <span class="comment">// Constructor taking input and output mode flags for the new managing context</span></div><div class="line">    calcProxy(<a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> iomode);</div><div class="line">    <span class="comment">// Constructor taking endpoint URL and input and output mode flags for the new managing context</span></div><div class="line">    calcProxy(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structsoap.html#aed1b86b8a34aea86103751a932c9dce9">endpoint</a>, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> iomode);</div><div class="line">    <span class="comment">// Constructor taking input and output mode flags for the new managing context</span></div><div class="line">    calcProxy(<a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a4c24dec1ac79111c4ebeb30ba73cca65">imode</a>, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a0f7cfb4dd32a7be1ec63a20f55e12521">omode</a>);</div><div class="line">    <span class="comment">// Destructor deletes non-shared managing context only (use destroy() to delete deserialized data)</span></div><div class="line">    <span class="keyword">virtual</span> ~calcProxy();</div><div class="line">    <span class="comment">// Initializer used by constructors</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> calcProxy_init(<a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a4c24dec1ac79111c4ebeb30ba73cca65">imode</a>, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a0f7cfb4dd32a7be1ec63a20f55e12521">omode</a>);</div><div class="line">    <span class="comment">// Return a copy that has a new managing context with the same engine state</span></div><div class="line">    <span class="keyword">virtual</span> calcProxy *copy();</div><div class="line">    <span class="comment">// Copy assignment</span></div><div class="line">    calcProxy&amp; <a class="code" href="structsoap.html#ae731dd4b82b3a91b679c410756ee4faa">operator=</a>(<span class="keyword">const</span> calcProxy&amp;);</div><div class="line">    <span class="comment">// Delete all deserialized data (uses soap_destroy() and soap_end())</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structsoap.html#a0c714b6ed5245dbe34cf7b747aa226ac">destroy</a>();</div><div class="line">    <span class="comment">// Delete all deserialized data and reset to default</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> reset();</div><div class="line">    <span class="comment">// Disables and removes SOAP Header from message by setting soap-&gt;header = NULL</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> soap_noheader();</div><div class="line">    <span class="comment">// Get SOAP Header structure (i.e. soap-&gt;header, which is NULL when absent)</span></div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="struct_s_o_a_p___e_n_v_____header.html">SOAP_ENV__Header</a> *<a class="code" href="group__group__header.html#ga08d35d1900a1982fdde6f78e43fc9635">soap_header</a>();</div><div class="line">    <span class="comment">// Get SOAP Fault structure (i.e. soap-&gt;fault, which is NULL when absent)</span></div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="struct_s_o_a_p___e_n_v_____fault.html">SOAP_ENV__Fault</a> *<a class="code" href="group__group__fault.html#ga0fe8da8d6501355a199d59204ef1e330">soap_fault</a>();</div><div class="line">    <span class="comment">// Get SOAP Fault subcode QName string (NULL when absent)</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="group__group__fault.html#ga950543b654e24e726c0e31b31f529fea">soap_fault_subcode</a>();</div><div class="line">    <span class="comment">// Get SOAP Fault string/reason (NULL when absent)</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="group__group__fault.html#gabba65cbc38ea589f5cb28463c1657107">soap_fault_string</a>();</div><div class="line">    <span class="comment">// Get SOAP Fault detail XML string (NULL when absent)</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="group__group__fault.html#gaa713e4a2ad1af8304db9d048d96bcd10">soap_fault_detail</a>();</div><div class="line">    <span class="comment">// Close connection (normally automatic, except for send_X ops)</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> soap_close_socket();</div><div class="line">    <span class="comment">// Force close connection (can kill a thread blocked on IO)</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> soap_force_close_socket();</div><div class="line">    <span class="comment">// Print fault</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(FILE*);</div><div class="line"><span class="preprocessor">#ifndef WITH_LEAN</span></div><div class="line"><span class="preprocessor">#ifndef WITH_COMPAT</span></div><div class="line">    <span class="comment">// Print fault to stream</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="group__group__fault.html#gaab984763de3f5fdd4363aa62b4f250c2">soap_stream_fault</a>(std::ostream&amp;);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="comment">// Write fault to buffer</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">char</span> *<a class="code" href="group__group__fault.html#gafc9d67060889f7243381299047f0e8e6">soap_sprint_fault</a>(<span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="comment">// Web service operation &#39;add&#39; (returns SOAP_OK or error code)</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> *result)</div><div class="line">    { <span class="keywordflow">return</span> this-&gt;add(NULL, NULL, a, b, result); }</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> add(<span class="keyword">const</span> <span class="keywordtype">char</span> *soap_endpoint, <span class="keyword">const</span> <span class="keywordtype">char</span> *soap_action, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> *result);</div><div class="line">    <span class="comment">// Web service operation &#39;sub&#39; (returns SOAP_OK or error code)</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> sub(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> *result)</div><div class="line">    { <span class="keywordflow">return</span> this-&gt;sub(NULL, NULL, a, b, result); }</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> sub(<span class="keyword">const</span> <span class="keywordtype">char</span> *soap_endpoint, <span class="keyword">const</span> <span class="keywordtype">char</span> *soap_action, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> *result);</div><div class="line">    <span class="comment">// Web service operation &#39;mul&#39; (returns SOAP_OK or error code)</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> mul(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> *result)</div><div class="line">    { <span class="keywordflow">return</span> this-&gt;mul(NULL, NULL, a, b, result); }</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> mul(<span class="keyword">const</span> <span class="keywordtype">char</span> *soap_endpoint, <span class="keyword">const</span> <span class="keywordtype">char</span> *soap_action, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> *result);</div><div class="line">};</div></div><!-- fragment --><p>The above shows the raw source code with comments generated by soapcpp2. To obtain an annotated markdown document with documented the proxy and service classes and documented data types used by the service operations, run <b><code>soapcpp2 -r</code></b> option <b><code>-r</code></b> to generate a <em><code>soapReadme.md</code></em> report. This markdown file can be converted to HTML or other document formats with tools such as <a href="www.doxygen.org">Doxygen</a>.</p>
<p>This generated proxy class can be included into a client application together with the generated namespace table as shown in this example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapcalcProxy.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;calc.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  calcProxy calc(<a class="code" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69">SOAP_XML_INDENT</a>); </div><div class="line">  <span class="keywordtype">double</span> r; </div><div class="line">  <span class="keywordflow">if</span> (calc.add(1.0, 2.0, r) == <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>) </div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Sum of 1.0 and 2.0 is &quot;</span> &lt;&lt; r &lt;&lt; std::endl; </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">    calc.soap_stream_fault(std::cerr); </div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">}</div></div><!-- fragment --><p>The XML message sent by the client proxy:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> <span class="keyword">xmlns:ns2</span>=<span class="stringliteral">&quot;urn:calc&quot;</span> ...&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">ns2:add</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">a</span>&gt;1.0&lt;/<span class="keywordtype">a</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &lt;<span class="keywordtype">b</span>&gt;2.0&lt;/<span class="keywordtype">b</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;/<span class="keywordtype">ns2:add</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt; </div></div><!-- fragment --> </div><p>The XML message returned by the service:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> <span class="keyword">xmlns:ns2</span>=<span class="stringliteral">&quot;urn:calc&quot;</span> ...&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">ns2:addResponse</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">result</span>&gt;3.0&lt;/<span class="keywordtype">result</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;/<span class="keywordtype">ns2:addResponse</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt; </div></div><!-- fragment --> </div><p>With <b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b>, the constructor of the proxy class allocates and initializes a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context as a pointer member of the class. With <b><code>soapcpp2 -i</code></b> option <b><code>-i</code></b> the proxy class is derived from the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> struct instead and this context is initialized when the proxy class constructor is invoked.</p>
<p>To place the proxy class in a C++ namespace <code>name</code>, use <b><code>soapcpp2 -q name</code></b> option <b><code>-q name</code></b>. See Section <a class="el" href="index.html#soapcpp2options">soapcpp2 options</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="encoding"></a>
XSD type serialization</h3>
<p>XML Web services use XML schemas to define the data types of XML data structures in the XML message payloads. The default encoding assumed by soapcpp2 is SOAP 1.1 document/literal style messaging but this is easily changed using options, such as <b><code>-2</code></b> (SOAP 1.2), <b><code>-0</code></b> (non-SOAP XML REST), and <b><code>-e</code></b> (SOAP with RPC encoding). See Section <a class="el" href="index.html#soapcpp2options">soapcpp2 options</a>.</p>
<p>Primitive XSD types are mapped to C/C++ primitive types by means of <code>typedef</code> declarations in the interface header file for soapcpp2 to generate the XML data binding serialization code. A <code>typedef</code> binds an XML schema type name to a C/C++ type. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__anyURI;        <span class="comment">// encode xsd:anyURI values as a strings</span></div><div class="line"><span class="keyword">typedef</span> std::string xsd__NMTOKEN; <span class="comment">// encode xsd:NMTOKEN values as strings</span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">float</span> xsd__float;         <span class="comment">// encode xsd:float values as floats</span></div></div><!-- fragment --><p>This simple mechanism informs the soapcpp2 tool to generate serializers and deserializers that explicitly encode and decode the primitive C++ types as built-in primitive XSD types. At the same time, the use of <code>typedef</code> does not force any source code rewriting of a client or Web service application because the internal types used by the application are not required to be changed by using this <code>typedef</code> mechanism.</p>
<p>The built-in XSD types are covered by <code>typedef</code> mappings and we could map XSD <em><code>xsd:base64Binary</code></em> and <em><code>xsd:hexBinary</code></em> to strings, but that would be cumbersome since the application should populate the strings properly. Instead, we can defined the following structs or classes to contain binary content that the generated serializers serialize in base64 and hexadecimal, respectively:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structxsd____base64_binary.html">xsd__base64Binary</a></div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6ba9f9e291b2b26e0696bd48f4e983be">__ptr</a>; <span class="comment">// points to raw binary data</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structxsd____base64_binary.html#aa2dfd4d99f8280c413b9ff25a69a8729">__size</a>;           <span class="comment">// length of raw binary data</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span><a class="code" href="structxsd____hex_binary.html">xsd__hexBinary</a></div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6ba9f9e291b2b26e0696bd48f4e983be">__ptr</a>; <span class="comment">// points to raw binary data</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structxsd____base64_binary.html#aa2dfd4d99f8280c413b9ff25a69a8729">__size</a>;           <span class="comment">// length of raw binary data</span></div><div class="line">};</div></div><!-- fragment --><p>Also <em><code>xsd:boolean</code></em> in C can be mapped to a <code>enum</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> xsd__boolean { false_, true_ };</div></div><!-- fragment --><p>The trailing underscores are removed in XML payloads and are used here to avoid potential name clashes with C++ <code>false</code> and <code>true</code> keywords.</p>
<p>Annotations with <code>typedef</code> types introduce validation constraints that are verified by the XML parser:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">float</span> ns__price <span class="stringliteral">&quot;%.2g&quot;</span> ;                     <span class="comment">// 2 fractional digits</span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">int</span> ns__percent 0:100 ;                      <span class="comment">// integer between 0 and 100</span></div><div class="line"><span class="keyword">typedef</span> std::string ns__letter <span class="stringliteral">&quot;[a-z]&quot;</span> 1:1 ;         <span class="comment">// string of length 1 with letter (using XSD regex)</span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> xsd__positiveInteger 1: ; <span class="comment">// positive integer</span></div></div><!-- fragment --><p>The soapcpp2 tool generates a schema with the following types (<em><code>xsd::positiveInteger</code></em> is a built-in XSD type and therefore omitted from the generated schema):</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;price&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:float&quot;</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">fractionDigits</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;2&quot;</span>/&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;/<span class="keywordtype">restriction</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;percent&quot;</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:int&quot;</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;<span class="keywordtype">minInclusive</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">maxInclusive</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;100&quot;</span>/&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &lt;/<span class="keywordtype">restriction</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;letter&quot;</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    &lt;<span class="keywordtype">pattern</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;[a-z]&quot;</span>/&gt;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    &lt;<span class="keywordtype">length</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  &lt;/<span class="keywordtype">restriction</span>&gt;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div></div><!-- fragment --> </div><p>For more details on mapping C/C++ data types with their value space constraints to XML schema and vice versa, see <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example3"></a>
Example</h3>
<p>Reconsider the calculator example of the previous sections, now rewritten with an explicit XSD type for <code>double</code> to illustrate the effect:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;calc.h&quot;: </span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">double</span> xsd__double; </div><div class="line"><span class="keywordtype">int</span> ns2__add(xsd__double a, xsd__double b, xsd__double&amp; result);</div></div><!-- fragment --><p>In C a pointer is used instead of a reference for the output parameter <code>result</code>.</p>
<p>The soapcpp2 tool generates the client stub function:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> soap_call_ns2__add(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *URL, <span class="keywordtype">char</span> *action, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result);</div></div><!-- fragment --><p>This means that the client application does not need to be rewritten and can still call the client stub or use the generated C++ proxy class as before.</p>
<p>Likewise, <code>typedef</code> can be used to declare user-defined schema types:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;calc.h&quot;: </span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">double</span> ns2__number; </div><div class="line"><span class="keywordtype">int</span> ns2__add(ns2__number a, ns2__number b, ns2__number&amp; result);</div></div><!-- fragment --><p>This lets soapcpp2 generate a WSDL and XML schema that declares the <em><code>ns2:number</code></em> type:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;urn:calc&quot;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="keyword">xmlns:ns2</span>=<span class="stringliteral">&quot;urn:calc&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="keyword">xmlns</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    <span class="keyword">elementFormDefault</span>=<span class="stringliteral">&quot;unqualified&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    <span class="keyword">attributeFormDefault</span>=<span class="stringliteral">&quot;unqualified&quot;</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &lt;<span class="keywordtype">import</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>/&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  &lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;number&quot;</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:double&quot;</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    &lt;/<span class="keywordtype">restriction</span>&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  &lt;/<span class="keywordtype">simpleType</span>&gt;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;&lt;/<span class="keywordtype">schema</span>&gt;</div></div><!-- fragment --> </div><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="response"></a>
How to change the response element name</h3>
<p>There is no standardized convention for the response element name in a SOAP RPC encoded response message, although it is recommended that the response element name is the method name ending with "&lt;i&gt;`Response`&lt;/i&gt;". For example, the response element of <em><code>add</code></em> is <em><code>addResponse</code></em>.</p>
<p>The response element name can be specified explicitly using a <code>struct</code> or <code>class</code> declaration in the interface header file for soapcpp2. This name should be qualified by a namespace prefix, just as the operation name should use a namespace prefix. The <code>struct</code> or <code>class</code> name represents the SOAP response element name used by the service. Consequently, the output parameter of the service operation must be declared as a member of the <code>struct</code> or <code>class</code>. The use of a <code>struct</code> or a <code>class</code> for the service response is fully SOAP 1.1/1.2 compliant. In fact, the absence of a <code>struct</code> or <code>class</code> indicates to the soapcpp2 tool to automatically generate a <code>struct</code> for the response which is internally used by a stub.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example4"></a>
Example</h3>
<p>Reconsider the calculator service operation specification which can be rewritten with an explicit declaration of a SOAP response element as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;calc.h&quot;: </span></div><div class="line"><span class="keyword">struct </span>ns2__addResponse { <span class="keywordtype">double</span> result; }; </div><div class="line"><span class="keywordtype">int</span> ns2__add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keyword">struct</span> ns2__addResponse&amp; r);</div></div><!-- fragment --><p>This wraps the output parameters in a struct <code>ns2__addResponse</code>. Note that in C a pointer is used instead of a reference for the output wrapper parameter <code>r</code>.</p>
<p>In this example we just made an explicit output parameter wrapper, meaning that SOAP request and response messages will be the same as before without this wrapper:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> <span class="keyword">xmlns:ns2</span>=<span class="stringliteral">&quot;urn:calc&quot;</span> ...&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">ns2:addResponse</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">result</span>&gt;3.0&lt;/<span class="keywordtype">result</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;/<span class="keywordtype">ns2:addResponse</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt; </div></div><!-- fragment --> </div><p>We can use any other name with a namespace prefix for the wrapper struct or class to change the response element name.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="multiple"></a>
How to specify multiple output parameters</h3>
<p>The soapcpp2 tool uses the convention that the last parameter of the function prototype declaration of a service operation in an interface header file is the output parameter of the service operation. All other parameters are considered input parameters of the service operation.</p>
<p>To specify a service operation with multiple output parameters, a <code>struct</code> or <code>class</code> is declared to wrap the service operation response parameters, see also Section <a class="el" href="index.html#response">How to change the response element name</a> . The name of the <code>struct</code> or <code>class</code> should have a namespace prefix, just as the service method name. The members of the <code>struct</code> or <code>class</code> are the output parameters of the service operation.</p>
<p>The order of the input parameters in the function prototype and the order of the output parameters (the members of the wrapper <code>struct</code> or <code>class</code>) is not significant. However, the SOAP 1.1 RPC encoding specification states that input and output parameters may be treated as anonymous parameter names, which requires a particular ordering of these parameters, see Section <a class="el" href="index.html#anonymous">How to specify anonymous parameter names</a> .</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example5"></a>
Example</h3>
<p>As an example, consider a hypothetical service operation <code>getNames</code> with a single input parameter <code>SSN</code> and two output parameters <code>first</code> and <code>last</code>. This can be specified as:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;getNames.h&quot;: </span></div><div class="line"><span class="keywordtype">int</span> ns3__getNames(<span class="keywordtype">char</span> *SSN, <span class="keyword">struct</span> ns3__getNamesResponse { <span class="keywordtype">char</span> *first; <span class="keywordtype">char</span> *last; } &amp;r);</div></div><!-- fragment --><p>The soapcpp2 tool takes this header file as input and generates source code for the function <code>soap_call_ns3__getNames</code>. When invoked by a client application, this stub function produces the XML request message:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> <span class="keyword">xmlns:ns3</span>=<span class="stringliteral">&quot;urn:names&quot;</span> ...&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">ns3:getNames</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">SSN</span>&gt;999 99 9999&lt;/<span class="keywordtype">SSN</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;/<span class="keywordtype">ns3:getNames</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>The response XML message:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> <span class="keyword">xmlns:ns3</span>=<span class="stringliteral">&quot;urn:names&quot;</span> ...&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">ns3:getNamesResponse</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">first</span>&gt;<span class="keyword">John</span>&lt;/<span class="keywordtype">first</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &lt;<span class="keywordtype">last</span>&gt;<span class="keyword">Doe</span>&lt;/<span class="keywordtype">last</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;/<span class="keywordtype">ns3:getNamesResponse</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>where <em><code>first</code></em> and <em><code>last</code></em> are the output parameters wrapped in the <code>getNamesResponse</code> struct.</p>
<p>As another example, consider a service operation <code>copy</code> with an input parameter and an output parameter with identical parameter names (this is not prohibited by the SOAP 1.1/1.2 protocols). This can be specified using a wrapper struct for the output parameters, thus avoiding the name clash we would run into without this wrapper:</p>
<div class="fragment"><div class="line"><span class="comment">// Content of file &quot;copy.h&quot;: </span></div><div class="line"><span class="keywordtype">int</span> X_rox__copy_name(<span class="keywordtype">char</span> *name, <span class="keyword">struct</span> X_rox__copy_nameResponse { <span class="keywordtype">char</span> *name; } &amp;r);</div></div><!-- fragment --><p>The use of a <code>struct</code> or <code>class</code> for the service operation response enables the declaration of service operations that have parameters that are passed both as input and output parameters.</p>
<p>The soapcpp2 tool takes the <em><code>copy.h</code></em> header file as input and generates the <code>soap_call_X_rox__copy_name</code> stub function. When invoked by a client application, the stub function produces the XML request message:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> <span class="keyword">xmlns:X-rox</span>=<span class="stringliteral">&quot;urn:copy&quot;</span> ...&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">X-rox:copy-name</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">hello</span>&lt;/<span class="keywordtype">name</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;/<span class="keywordtype">X-rox:copy-name</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>The response XML message:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> <span class="keyword">xmlns:X-rox</span>=<span class="stringliteral">&quot;urn:copy&quot;</span> ...&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">X-rox:copy-nameResponse</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">SOAP</span>&lt;/<span class="keywordtype">name</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;/<span class="keywordtype">X-rox:copy-nameResponse</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>The name will be parsed and decoded by the stub function and returned as the <code>name</code> member of the <code>struct X_rox__copy_nameResponse &amp;r</code> parameter.</p>
<p>You can use the service operation name as a wrapper for the response:</p>
<div class="fragment"><div class="line"><span class="comment">// Content of file &quot;copy.h&quot;: </span></div><div class="line"><span class="keywordtype">int</span> X_rox__copy_name(<span class="keywordtype">char</span> *name, <span class="keyword">struct</span> X_rox__copy_name &amp;r);</div></div><!-- fragment --><p>where the struct <code>X_rox__copy_name</code> is generated by soapcpp2 automatically and does not need to be redeclared.</p>
<p>The response XML message in this case would be:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> <span class="keyword">xmlns:X-rox</span>=<span class="stringliteral">&quot;urn:copy&quot;</span> ...&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">X-rox:copy-name</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">SOAP</span>&lt;/<span class="keywordtype">name</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;/<span class="keywordtype">X-rox:copy-name</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="compound"></a>
How to specify output parameters with compound data types</h3>
<p>If the single output parameter of a service operation is a compound data type such as a <code>struct</code> or <code>class</code> it is necessary to specify the response element of the service operation as a <code>struct</code> or <code>class</code> at all times. Otherwise, the output parameter will be considered the response element (!), because of the response element specification convention used by gSOAP, as discussed in Section <a class="el" href="index.html#response">How to change the response element name</a> .</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example6"></a>
Example</h3>
<p>This is best illustrated with an example. Suppose we have a Flighttracker service that provides real time flight information. It requires an airline code and flight number as parameters. The service operation name is <code>getFlightInfo</code> that has two string parameters: the airline code and flight number. The method returns a <code>getFlightResponse</code> response element with a <code>return</code> output parameter that is of a compound data type <code>FlightInfo</code>. The type <code>FlightInfo</code> is represented by a <code>class</code> in the header file:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;flight.h&quot;: </span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__string; </div><div class="line"><span class="keyword">class </span>ns2__FlightInfo </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    xsd__string airline; </div><div class="line">    xsd__string flightNumber; </div><div class="line">    xsd__string altitude; </div><div class="line">    xsd__string currentLocation; </div><div class="line">    xsd__string equipment; </div><div class="line">    xsd__string speed; </div><div class="line">}; </div><div class="line"><span class="keyword">struct </span>ns1__getFlightInfoResponse { ns2__FlightInfo return_; }; </div><div class="line"><span class="keywordtype">int</span> ns1__getFlightInfo(xsd__string param1, xsd__string param2, <span class="keyword">struct</span> ns1__getFlightInfoResponse &amp;r);</div></div><!-- fragment --><p>The response element <code>ns1__getFlightInfoResponse</code> is explicitly declared and it has one member: <code>return_</code> of type <code>ns2__FlightInfo</code>. Note that <code>return_</code> has a trailing underscore to avoid a name clash with the <code>return</code> keyword, see Section <a class="el" href="index.html#idtrans">C/C++ identifier name to XML tag name translation</a> for details on the translation of C/C++ identifiers to XML names.</p>
<p>The soapcpp2 tool generates the <code>soap_call_ns1__getFlightInfo</code> stub function. Here is an example fragment of a client application that uses this proxy to request flight information:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;ns1.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#gac87126c3e45d2fda488e9832c2dd5be1">soap_init1</a>(&amp;soap, <a class="code" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69">SOAP_XML_INDENT</a>); </div><div class="line">  ns2__FlightInfo flight;</div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns1__getFlightInfo(&amp;soap, <span class="stringliteral">&quot;testvger.objectspace.com/soap/servlet/rpcrouter&quot;</span>, <span class="stringliteral">&quot;urn:galdemo:flighttracker&quot;</span>, <span class="stringliteral">&quot;UAL&quot;</span>, <span class="stringliteral">&quot;184&quot;</span>, flight))</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); <span class="comment">// nonzero return means that an error occurred</span></div><div class="line">  <span class="keywordflow">else</span></div><div class="line">    cout &lt;&lt; flight.return_.equipment &lt;&lt; <span class="stringliteral">&quot; flight &quot;</span> &lt;&lt; flight.return_.airline &lt;&lt; flight.return_.flightNumber </div><div class="line">         &lt;&lt; <span class="stringliteral">&quot; traveling &quot;</span> &lt;&lt; flight.return_.speed &lt;&lt; <span class="stringliteral">&quot; mph &quot;</span> &lt;&lt; <span class="stringliteral">&quot; at &quot;</span> &lt;&lt; flight.return_.altitude </div><div class="line">         &lt;&lt; <span class="stringliteral">&quot; ft, is located &quot;</span> &lt;&lt; flight.return_.currentLocation &lt;&lt; endl;</div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap); <span class="comment">// delete managed class instances </span></div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);    <span class="comment">// finalize the context</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>,<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsi&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsd&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;ns1&quot;</span>, <span class="stringliteral">&quot;urn:galdemo:flighttracker&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;ns2&quot;</span>, <span class="stringliteral">&quot;http://galdemo.flighttracker.com&quot;</span> }, </div><div class="line">  { NULL, NULL } </div><div class="line">};</div></div><!-- fragment --><p>When invoked by a client application, the stub function produces the XML request: </p><pre class="fragment">POST /soap/servlet/rpcrouter HTTP/1.1 
Host: testvger.objectspace.com 
Content-Type: text/xml 
Content-Length: 634 
SOAPAction: "urn:galdemo:flighttracker" 
</pre> <div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="keyword">xmlns:ns1</span>=<span class="stringliteral">&quot;urn:galdemo:flighttracker&quot;</span> </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    <span class="keyword">xmlns:ns2</span>=<span class="stringliteral">&quot;http://galdemo.flighttracker.com&quot;</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span> <span class="keyword">SOAP-ENV:encodingStyle</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>&gt; </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    &lt;<span class="keywordtype">ns1:getFlightInfo</span>&gt; </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &lt;<span class="keywordtype">param1</span>&gt;<span class="keyword">UAL</span>&lt;/<span class="keywordtype">param1</span>&gt; </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;      &lt;<span class="keywordtype">param2</span>&gt;184&lt;/<span class="keywordtype">param2</span>&gt; </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    &lt;/<span class="keywordtype">ns1:getFlightInfo</span>&gt; </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>The service responds with: </p><pre class="fragment">HTTP/1.1 200 OK 
Date: Thu, 30 Aug 2011 00:34:17 GMT 
Server: IBM_HTTP_Server/1.3.12.3 Apache/1.3.12 (Win32) 
Content-Length: 861 
Content-Type: text/xml; charset=utf-8 
</pre> <div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;<span class="keywordtype">ns1:getFlightInfoResponse</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        <span class="keyword">xmlns:ns1</span>=<span class="stringliteral">&quot;urn:galdemo:flighttracker&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        <span class="keyword">SOAP-ENV:encodingStyle</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>&gt; </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &lt;<span class="keywordtype">return</span> <span class="keyword">xmlns:ns2</span>=<span class="stringliteral">&quot;http://galdemo.flighttracker.com&quot;</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;ns2:FlightInfo&quot;</span>&gt; </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        &lt;<span class="keywordtype">equipment</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;<span class="keyword">A320</span>&lt;/<span class="keywordtype">equipment</span>&gt; </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        &lt;<span class="keywordtype">airline</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;<span class="keyword">UAL</span>&lt;/<span class="keywordtype">airline</span>&gt; </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        &lt;<span class="keywordtype">currentLocation</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;188 <span class="keyword">mi</span> <span class="keyword">W</span> <span class="keyword">of</span> <span class="keyword">Lincoln</span>, <span class="keyword">NE</span>&lt;/<span class="keywordtype">currentLocation</span>&gt; </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        &lt;<span class="keywordtype">altitude</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;37000&lt;/<span class="keywordtype">altitude</span>&gt; </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        &lt;<span class="keywordtype">speed</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;497&lt;/<span class="keywordtype">speed</span>&gt; </div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        &lt;<span class="keywordtype">flightNumber</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;184&lt;/<span class="keywordtype">flightNumber</span>&gt; </div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;      &lt;/<span class="keywordtype">return</span>&gt; </div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    &lt;/<span class="keywordtype">ns1:getFlightInfoResponse</span>&gt; </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>The stub function returns the service response in variable <code>flight</code> of type <code>struct ns1__getFlightInfoResponse</code> and this information can be displayed by the client application: </p><pre class="fragment">A320 flight UAL184 traveling 497 mph at 37000 ft, is located 188 mi W of Lincoln, NE
</pre><p>Note that the response includes <em><code>xsi:type</code></em> attributes indicating the schema types of the elements in the XML message. This was common practice in earlier SOAP implementations and some SOAP implementations relied on it, but it was never mandated by the specifications. You can let soapcpp2 generate serializers that produce the <em><code>xsi:type</code></em> type information in XML messages with <b><code>soapcpp2 -t</code></b> option <b><code>-t</code></b>. Otherwise, the serializers will not include <em><code>xsi:type</code></em> attributes in the XML message payloads unless a derived type value is used in the XML payload in place of a base type, for example a derived class in place of a base class. In this way, SOAP/XML messaging implements object inheritance cleanly and efficiently because the leading <em><code>xsi:type</code></em> attribute value corresponding to the serialized derived class in an XML message lets an XML parser and deserializer instantiate the derived class to populate it immediately (something that can't be claimed of JSON since JSON has no attributes and object properties are unordered).</p>
<dl class="section note"><dt>Note</dt><dd>: the flight tracker service is no longer available since 9/11/2001. It is kept in the documentation as an example to illustrate the use of structs/classes and response types.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="anonymous"></a>
How to specify anonymous parameter names</h3>
<p>The SOAP RPC encoding protocol allows parameter names to be anonymous. That is, the name(s) of the output parameters of a service operation are not strictly required to match a client's view of the parameters names. Also, the input parameter names of a service operation are not strictly required to match a service's view of the parameter names. The soapcpp2 tool can generate stub and skeleton functions that support anonymous parameters. Parameter names are implicitly anonymous by omitting the parameter names in the function prototype of the service operation. For example:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;calc.h&quot;: </span></div><div class="line"><span class="keywordtype">int</span> ns2__add(<span class="keywordtype">double</span>, <span class="keywordtype">double</span>, <span class="keywordtype">double</span>&amp;);</div></div><!-- fragment --><p>This enumerates the parameter names as <code>_param_1</code>, <code>_param_2</code>, and <code>_param_3</code>, where the leading underscore makes these names anonymous, meaning that the XML parser and deserializer will accept any parameter name to extract their values, that is, even when the name of the XML element representing the parameter differs.</p>
<p>To make parameter names explicitly anonymous, specify parameter names that start with an underscore (<code>_</code>) in the function prototype in the header file.</p>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;calc.h&quot;: </span></div><div class="line"><span class="keywordtype">int</span> ns2__add(<span class="keywordtype">double</span> _a, <span class="keywordtype">double</span> _b, <span class="keywordtype">double</span>&amp; _return);</div></div><!-- fragment --><p>In this example, the <code>_a</code>, <code>_b</code>, and <code>_return</code> are anonymous parameters.</p>
<dl class="section warning"><dt>Warning</dt><dd>When anonymous parameter names are used, the order of the parameters in the function prototype of a service operation is significant.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="noinparam"></a>
How to specify a service operation with no input parameters</h3>
<p>To specify a service operation that has no input parameters, just provide a function prototype with one parameter which is the output parameter that is either a pointer or a reference, for example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__getValue(<span class="keywordtype">double</span>&amp; value);</div></div><!-- fragment --><p>The soapcpp2 tool generates a struct for each service operation request message, which in this case is an empty struct. To prevent C compilers from throwing an error, the empty struct is patched at compile time with the compile-time flag <code><a class="el" href="group__group__with.html#gaa0f80155c2f036cd4da1735cafc9e60b">WITH_NOEMPTYSTRUCT</a></code>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="nooutparam"></a>
How to specify a service operation with no output parameters</h3>
<p>To specify a service operation that has no output parameters, just define a function prototype with a response struct that is empty, for example:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ns__event { off, on, stand_by }; </div><div class="line"><span class="keywordtype">int</span> ns__signal(<span class="keyword">enum</span> ns__event <a class="code" href="struct_namespace.html#a0cf9dde9e30a474943fd2bdc566e4826">in</a>, <span class="keyword">struct</span> ns__signalResponse { } *<a class="code" href="struct_namespace.html#a18b3d9994735b97920ba882e3cf72367">out</a>);</div></div><!-- fragment --><p>Since the response struct is empty, no output parameters are specified. The SOAP response message has an empty response element <em><code>ns:signalResponse</code></em>.</p>
<p>Specifying an empty response is not identical to SOAP one-way messaging, which is asynchronous and does not expect an XML response message to be transmitted at all, just an empty HTTP OK response to a HTTP POST request. See Section <a class="el" href="index.html#oneway1">Asynchronous one-way message passing</a> on one-way messaging.</p>
<h3><a class="anchor" id="restclient"></a>
How to switch to REST from SOAP</h3>
<p>To switch to RESTful Web APIs from SOAP Web services APIs is simple, just use a directive.</p>
<p>To declare HTTP POST as the default HTTP method to use with client-side calls for all service operations associated with the <code>ns</code> namespace prefix:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service protocol: POST</span></div></div><!-- fragment --><p>To declare the HTTP POST method for a specific service operation, use:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service protocol: POST</span></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(...);</div></div><!-- fragment --><p>You can specify <code>GET</code>, <code>PUT</code>, <code>POST</code>, and <code>DELETE</code>. With <code>GET</code> the input parameters of the service operations should be primitive types. See Section <a class="el" href="index.html#directives-1">Service directives</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="services"></a>
How to build Web services APIs</h2>
<p>The soapcpp2 tool generates skeleton functions in C or C++ source code for each of the service operations specified as function prototypes in the interface header file input to soapcpp2. The skeleton functions can be readily used to implement the service operations in a new Web service. The compound data types used by the input and output parameters of service operations must be declared in the interface header file, such as structs, classes, arrays, C++ containers, and pointer-based data structures (e.g. data structure trees and arbitrary operation. The soapcpp2 tool automatically generates serializers and deserializers for the data types to enable the generated skeleton functions to encode and decode the contents of the parameters of the service operations. The soapcpp2 tool also generates a service operation request dispatcher function <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> that serves requests by calling the appropriate skeleton.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example7"></a>
Example</h3>
<p>The following example specifies three service operations of a Web service:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;calc.h&quot;: </span></div><div class="line"><span class="comment">//gsoap ns service namespace: urn:simple-calc</span></div><div class="line"><span class="keywordtype">int</span> ns__add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line"><span class="keywordtype">int</span> ns__sub(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line"><span class="keywordtype">int</span> ns__sqrt(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span>&amp; result); </div></div><!-- fragment --><p>The <code>add</code> and <code>sub</code> methods are intended to add and subtract two double floating point numbers stored in input parameters <code>a</code> and <code>b</code> and should return the result of the operation in the <code>result</code> output parameter. The <code>sqrt</code> method is intended to take the square root of input parameter <code>a</code> and to return the result in the output parameter <code>result</code>.</p>
<p>To generate the skeleton functions, the soapcpp2 tool is invoked from the command line with: </p><pre class="fragment"> soapcpp2 calc.h
</pre><p>The soapcpp2 tool generates the skeleton functions in file <em><code>soapServer.cpp</code></em> for the <code>add</code>, <code>sub</code>, and <code>sqrt</code> service operations specified in the <em><code>calc.h</code></em> header file. The skeleton functions are respectively <code>soap_serve_ns__add</code>, <code>soap_serve_ns__sub</code>, and <code>soap_serve_ns__sqrt</code>. The generated file <em><code>soapC.cpp</code></em> contains serializers and deserializers for the skeleton. The soapcpp2 tool also generates a service dispatcher: the <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> function handles client requests and dispatches the service operation requests to the appropriate skeleton functions to serve the requests. The skeleton in turn calls the service operation implementation function. The function prototype of the service operation implementation function is specified in the header file that is input to the soapcpp2 tool.</p>
<p>Here is an example CGI service application that uses the generated <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> skeleton function to handle client requests:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;calc.cpp&quot;: </span></div><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span> </div><div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span> <span class="comment">// for sqrt() </span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(<a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>());</div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">// Implementation of the &quot;add&quot; service operation: </span></div><div class="line"><span class="keywordtype">int</span> ns__add(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result) </div><div class="line">{</div><div class="line">  result = a + b; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">// Implementation of the &quot;sub&quot; service operation: </span></div><div class="line"><span class="keywordtype">int</span> ns__sub(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result) </div><div class="line">{</div><div class="line">  result = a - b; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">// Implementation of the &quot;sqrt&quot; service operation: </span></div><div class="line"><span class="keywordtype">int</span> ns__sqrt(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span>&amp; result) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (a &lt; 0) </div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6">soap_receiver_fault</a>(soap, <span class="stringliteral">&quot;Square root of negative number&quot;</span>, <span class="stringliteral">&quot;I can only take the square root of a non-negative number&quot;</span>); </div><div class="line">  result = sqrt(a); </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsi&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsd&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;ns&quot;</span>,       <span class="stringliteral">&quot;urn:simple-calc&quot;</span> }, <span class="comment">// binds &quot;ns&quot; namespace prefix to schema URI</span></div><div class="line">  { NULL, NULL } </div><div class="line">};</div></div><!-- fragment --><p>Note that the service operations have an extra input parameter which is a pointer to the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context.</p>
<p>The implementation of the service operations must return <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a nonzero error code. The code <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> denotes success. A nonzero error code is returned with <code><a class="el" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6" title="Set SOAP 1.1 server fault / SOAP 1.2 receiver fault string and detail. ">soap_receiver_fault</a></code> and <code><a class="el" href="group__group__fault.html#gac20c8569833053318196d898fe2566af" title="Set SOAP 1.1 client fault / SOAP 1.2 sender fault string and detail. ">soap_sender_fault</a></code>. These functions also set up a SOAP Fault structure with the details of the fault returned. This is done by setting the <code><a class="el" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0" title="The soap::fault points to a SOAP_ENV__Fault structure with the SOAP Fault that was received or that c...">soap::fault</a></code> which points to <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html" title="SOAP Fault structure. ">SOAP_ENV__Fault</a></code> structure. Its <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html#ac08b3725c7c6b2e9c636995e82876a9a" title="Optional element faultstring of XSD type xsd:string ">SOAP_ENV__Fault::faultstring</a></code> string and <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html#af49c2a1926ebf4c865ddd444960b9adb" title="Optional element detail of XSD type SOAP-ENV:Detail ">SOAP_ENV__Fault::detail</a></code>details are populated with the fault string (XML text) and fault detail (XML string). SOAP 1.2 requires the <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html#a921e9d8c41d62f32ab6d4d39a2e71bc9" title="Optional element SOAP-ENV:Reason of XSD type SOAP-ENV:Reason ">SOAP_ENV__Fault::SOAP_ENV__Reason</a></code> and the <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html#a560e6fd07a6b2f51cef97aa12282c870" title="Optional element SOAP-ENV:Detail of XSD type SOAP-ENV:Detail ">SOAP_ENV__Fault::SOAP_ENV__Detail</a></code> strings to be assigned instead.</p>
<p>This service application can be readily installed as a CGI application, which is a simple stateless way to deploy services. To deploy this service as a multi-threaded stand-alone server application see Sections <a class="el" href="index.html#stand-alone">How to create a stand-alone server</a> and <a class="el" href="index.html#mt">How to create a multi-threaded stand-alone service</a>.</p>
<p>Besides generating the skeleton functions and serializers in source code, the soapcpp2 tool also generates a WSDL file for this service, see Section <a class="el" href="index.html#wsdl">How to generate WSDL service descriptions</a> for details on WSDL.</p>
<p>As per SOAP protocol (when applicable), "SOAP actions" are HTTP headers that are specific to the SOAP protocol and provide a means for routing service requests and for security reasons, for example firewall software can inspect SOAP action headers to grant or deny the SOAP request. Use <b><code>soapcpp2 -a</code></b> option <b><code>-a</code></b> or <b><code>soapcpp2 -A</code></b> option <b><code>-A</code></b> to let the generated skeleton functions dispatch the requests based on the SOAP action HTTP header together with (or instead) the name of the XML request element.</p>
<p>Note that soapcpp2 generates both clients and services based on the interface header file input. Which means that there is no need to modify the interface header file for client side or server side deployments. For example, the generated <code>soap_call_ns__add</code> stub function is saved to the <em><code>soapClient.cpp</code></em> file after invoking the soapcpp2 tool on the <em><code>calc.h</code></em> header file.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="msvc"></a>
MSVC++ builds</h3>
<ul>
<li>Win32 builds require winsock2 (MS Visual C++ <code>ws2_32.lib</code>) To do this in Visual C++, go to <b>Project</b>, <b>Properties</b>, select <b>Link</b> and add <code>ws2_32.lib</code> to the <b>Object library modules</b> entry.</li>
<li>Use files with extension <em><code>.cpp</code></em> only. This means that you may have to rename all <em><code>.c</code></em> files to <em><code>.cpp</code></em>.</li>
<li>Turn pre-compiled headers off.</li>
<li>When creating a new project, you can specify a custom build step to automatically invoke the soapcpp2 tool on a interface header file for soapcpp2. In this way you can incrementally build a new service by adding new operations and data types to the header file. For the latest instruction on how to specify a custom build step to run soapcpp2, see the gSOAP download and installation page <a href="https://www.genivia.com/downloads.html">https://www.genivia.com/downloads.html</a>.</li>
<li>You may want to use the ISAPI extension or WinInet plugin available in the <em><code>gsoap/mod_gsoap</code></em> directory of the gSOAP package to simplify Internet access and deal with encryption, proxies, and authentication. See the gSOAP <a href="../../isapi/html/index.html">ISAPI extension</a> documentation and the gSOAP <a href="../../wininet/html/index.html">WinInet plugin</a> documentation.</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="stand-alone"></a>
How to create a stand-alone server</h3>
<p>The deployment of a Web service as a CGI application is an easy means to provide your service on the Internet. However, CGI is stateless and the performance of CGI is not great. Instead, gSOAP services can be run as stand-alone services on any port by using the built-in HTTP and TCP/IP stacks of the engine. The recommended mechanism to deploy a service is through the gSOAP Apache module or ISAPI extension. These servers and modules are designed for server load balancing and access control. See the gSOAP <a href="../../apache/html/index.html">Apache module</a> documentation and the gSOAP <a href="../../isapi/html/index.html">ISAPI extension</a> documentation for details.</p>
<p>See also the getting started page <a href="https://www.genivia.com/dev.html">https://www.genivia.com/dev.html</a> and tutorial page <a href="https://www.genivia.com/tutorial.html">https://www.genivia.com/tutorial.html</a> to get started with developing client and stand-alone server applications using the gSOAP tools.</p>
<p>To create a stand-alone service, the <code>main</code> function of the service application should call <code><a class="el" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18" title="Bind and listen to a port. ">soap_bind</a></code> to bind a port and then loop over <code><a class="el" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6" title="Accept a connection with a client. ">soap_accept</a></code> to accept requests to serve with <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code>. Also call <code><a class="el" href="group__group__ssl.html#ga990083effa5d8ed931fd75dc2630a2cc" title="Accept SSL/TLS connection. ">soap_ssl_accept</a></code> when HTTPS is used, which is set up with <code><a class="el" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7" title="Initialize the server-side SSL/TLS context. ">soap_ssl_server_context</a></code>.</p>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69">SOAP_XML_INDENT</a>);</div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474">send_timeout</a> = 10;     <span class="comment">// 10 seconds max socket delay </span></div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388">recv_timeout</a> = 10;     <span class="comment">// 10 seconds max socket delay </span></div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a78199a81c504833047224a0ceff6f906">accept_timeout</a> = 3600; <span class="comment">// server stops after 1 hour of inactivity </span></div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a1d7aca6ac1d62302102c17508a8b0ec0">max_keep_alive</a> = 100;  <span class="comment">// max keep-alive sequence </span></div><div class="line">  <span class="comment">// soap_ssl_server_context(soap, ...); // call this function when HTTPS is used</span></div><div class="line">  <a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> m, s;                      <span class="comment">// master and slave sockets </span></div><div class="line">  m = <a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(soap, NULL, 18083, 10);  <span class="comment">// small BACKLOG for iterative servers </span></div><div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(m)) </div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">  {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Socket connection successful: master socket = %d\n&quot;</span>, m); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; ; i++) </div><div class="line">    {</div><div class="line">      s = <a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(soap); </div><div class="line">      <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(s)) </div><div class="line">      {</div><div class="line">        <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">        <span class="keywordflow">break</span>; </div><div class="line">      } </div><div class="line">      <span class="comment">// soap_ssl_accept(soap); // call when HTTPS is used</span></div><div class="line">      fprintf(stderr, <span class="stringliteral">&quot;%d: accepted connection from IP=%d.%d.%d.%d socket=%d&quot;</span>, i, (soap-&gt;<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;24)&amp;0xFF, (soap-&gt;<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;16)&amp;0xFF, (soap-&gt;<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;8)&amp;0xFF, soap-&gt;<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&amp;0xFF, s); </div><div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(soap))</div><div class="line">        <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">      <span class="keywordflow">else</span></div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;request served\n&quot;</span>); </div><div class="line">      <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); <span class="comment">// delete managed class instances </span></div><div class="line">      <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line">    } </div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap); <span class="comment">// finalize and delete the context </span></div><div class="line">}</div></div><!-- fragment --><p>The <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> dispatcher handles one request or multiple requests when HTTP keep-alive is enabled with the <code><a class="el" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2" title="soap_mode IO input and output flag value to keep the socket connection alive for SOAP_MAXKEEPALIVE me...">SOAP_IO_KEEPALIVE</a></code> flag, which should only be used with client applications or with stand-alone multi-threaded services, see the next section and Section <a class="el" href="index.html#keepalive">TCP and HTTP keep-alive</a>.</p>
<p>The gSOAP functions that are frequently used for server-side coding are:</p>
<ul>
<li><code>soap_bind(struct soap *soap, char *host, int port, int backlog)</code> binds <code><a class="el" href="structsoap.html#ab649b8f3b71081d14ec6350ab4b06794" title="The socket set by soap_bind (or the C++ service class bind method) to serve as the master socket boun...">soap::master</a></code> socket to the specified port and host name (or NULL for the current machine), using a backlog queue size of pending requests, returns master socket. We check the return value with <code><a class="el" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c" title="Function macro to check if a socket is valid, i.e. not equal to SOAP_INVALID_SOCKET ...">soap_valid_socket</a></code>. The backlog queue size should be small, say 2 to 10, for iterative (not multi-threaded) stand-alone servers to ensure fairness among connecting clients. A smaller value increases fairness and defends against denial of service, but hampers performance because connection requests may be refused.</li>
<li><code><a class="el" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6" title="Accept a connection with a client. ">soap_accept(struct soap *soap)</a></code> returns <code><a class="el" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439" title="Macro that defines a portable socket type, usually int, but the type may depend on the platform being...">SOAP_SOCKET</a></code> socket <code><a class="el" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046" title="The socket set by soap_accept (or the C++ service class accept method) or soap_connect or soap_connec...">soap::socket</a></code> when connected. We check the return value with <code><a class="el" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c" title="Function macro to check if a socket is valid, i.e. not equal to SOAP_INVALID_SOCKET ...">soap_valid_socket</a></code>.</li>
<li><code><a class="el" href="group__group__ssl.html#ga990083effa5d8ed931fd75dc2630a2cc" title="Accept SSL/TLS connection. ">soap_ssl_accept(struct soap *soap)</a></code> returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> when the HTTPS handshake successfully completed.</li>
</ul>
<p>The IPv4 address is stored in <code><a class="el" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f" title="The IPv4 address in numeric form of the client as received on the server side by soap_accept (or the ...">soap::ip</a></code>. If IPv6 is enabled with <code><a class="el" href="group__group__with.html#ga40cbd680e7dbdeb63bce1d6d4b7b9620" title="When this macro is defined at compile time (undefined by default), IPv6 support is enabled and both I...">WITH_IPV6</a></code> then <code><a class="el" href="structsoap.html#a3d942a41712800a7d81b0e0fe3f10613" title="The IPv6 address in numeric form (upper ip6[0] to lower ip6[3]) of the client as received on the serv...">soap::ip6</a></code> contains the IPv6 address.</p>
<p>The <code><a class="el" href="structsoap.html#a78199a81c504833047224a0ceff6f906" title="User-definable timeout when waiting to accept a request from a client at the server-side with soap_ac...">soap::accept_timeout</a></code> context variable of the context specifies the timeout value for a non-blocking <code><a class="el" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6" title="Accept a connection with a client. ">soap_accept</a></code> call. See Section <a class="el" href="index.html#timeout">Timeout management for non-blocking operations</a> for more details on timeout management.</p>
<p>The <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> function parses the inbound HTTP request and dispatches the request to the skeleton functions that call the service operations implemented.</p>
<p>See Section <a class="el" href="index.html#memory">Memory management</a> for more details on memory management.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="mt"></a>
How to create a multi-threaded stand-alone service</h3>
<p>Stand-alone multi-threading a Web Service is essential when the response times for handling requests by the service are long or when HTTP keep-alive is enabled, see also Section <a class="el" href="index.html#keepalive">TCP and HTTP keep-alive</a> .</p>
<p>In case of long response times, the latencies introduced by the unrelated requests may become prohibitive for a successful deployment of a stand-alone service. When HTTP keep-alive is enabled, a client and server remain connected until 100 (<code><a class="el" href="group__group__soap.html#ga9750ea0479df8aa88e06f6a148b2a670" title="User-definable maximum iterations in the server-side soap_serve loop (or the C++ service class serve ...">SOAP_MAXKEEPALIVE</a></code>) request-response iterations later as specified by <code><a class="el" href="structsoap.html#a1d7aca6ac1d62302102c17508a8b0ec0" title="User-definable maximum number of keep-alive message exchanges per connection (the value is SOAP_MAXKE...">soap::max_keep_alive</a></code> or when a timeout occurred. Thereby preventing other clients from connecting.</p>
<p>The recommended mechanism to deploy a service is through the gSOAP Apache module or ISAPI extension. These servers and modules are designed for server load balancing and access control. See the gSOAP <a href="../../apache/html/index.html">Apache module</a> documentation and the gSOAP <a href="../../isapi/html/index.html">ISAPI extension</a> documentation for details.</p>
<p>See also the getting started page <a href="https://www.genivia.com/dev.html">https://www.genivia.com/dev.html</a> and tutorial page <a href="https://www.genivia.com/tutorial.html">https://www.genivia.com/tutorial.html</a> to get started with developing client and stand-alone server applications using the gSOAP tools.</p>
<p>The following example illustrates the use of threads to improve the quality of service by handling new requests in separate threads:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;plugin/threads.h&quot;</span></div><div class="line"><span class="preprocessor">#define BACKLOG (100) // Max request backlog of pending requests</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  <span class="keywordflow">if</span> (argc &lt; 2) <span class="comment">// no args: assume this is a CGI application </span></div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(&amp;soap);   <span class="comment">// serve request, one thread, CGI style </span></div><div class="line">    <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap); <span class="comment">// delete managed class instances </span></div><div class="line">    <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line">  } </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">  {</div><div class="line">    <span class="keywordtype">void</span> *process_request(<span class="keywordtype">void</span>*); </div><div class="line">    <span class="keyword">struct </span>soap *tsoap; </div><div class="line">    <a class="code" href="group__group__threads.html#ga53ca774b0fc84afe282a5419d2d7239a">THREAD_TYPE</a> tid; </div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structsoap.html#acef722da5f6789721603beeb0b505838">port</a> = atoi(argv[1]); <span class="comment">// first command-line arg is port </span></div><div class="line">    <a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> m, s; </div><div class="line">    soap.<a class="code" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474">send_timeout</a> = 10; <span class="comment">// 10 seconds max socket delay </span></div><div class="line">    soap.<a class="code" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388">recv_timeout</a> = 10; <span class="comment">// 10 seconds max socket delay </span></div><div class="line">    soap.<a class="code" href="structsoap.html#a78199a81c504833047224a0ceff6f906">accept_timeout</a> = 3600; <span class="comment">// server stops after 1 hour of inactivity </span></div><div class="line">    soap.<a class="code" href="structsoap.html#a1d7aca6ac1d62302102c17508a8b0ec0">max_keep_alive</a> = 100; <span class="comment">// max keep-alive sequence </span></div><div class="line">    m = <a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(&amp;soap, NULL, port, BACKLOG); </div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(m)) </div><div class="line">      exit(EXIT_FAILURE); </div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Socket connection successful %d\n&quot;</span>, m); </div><div class="line">    <span class="keywordflow">while</span> (1)</div><div class="line">    {</div><div class="line">      s = <a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(&amp;soap); </div><div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(s)) </div><div class="line">      {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Accept socket %d connection from IP %d.%d.%d.%d\n&quot;</span>, s, (soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;24)&amp;0xFF, (soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;16)&amp;0xFF, (soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;8)&amp;0xFF, soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&amp;0xFF); </div><div class="line">        tsoap = <a class="code" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a">soap_copy</a>(&amp;soap); <span class="comment">// make a copy </span></div><div class="line">        <span class="keywordflow">if</span> (!tsoap) </div><div class="line">          <a class="code" href="group__group__io.html#ga0ca0c64dc76af8617956a62cf117db94">soap_force_closesock</a>(&amp;soap);</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">          <span class="keywordflow">while</span> (<a class="code" href="group__group__threads.html#gabee88cce937a2709b4799ed8df36d486">THREAD_CREATE</a>(&amp;tid, (<span class="keywordtype">void</span>*(*)(<span class="keywordtype">void</span>*))process_request, (<span class="keywordtype">void</span>*)tsoap))</div><div class="line">            sleep(1); <span class="comment">// failed, try again</span></div><div class="line">      }</div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (soap.<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a>) <span class="comment">// accept failed, try again after 1 second</span></div><div class="line">      {</div><div class="line">        <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">        sleep(1);</div><div class="line">      } </div><div class="line">      <span class="keywordflow">else</span></div><div class="line">      {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;server timed out\n&quot;</span>); </div><div class="line">        <span class="keywordflow">break</span>; </div><div class="line">      } </div><div class="line">    } </div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap); <span class="comment">// finalize context</span></div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> *process_request(<span class="keywordtype">void</span>* tsoap) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = (<span class="keyword">struct </span>soap*)tsoap;</div><div class="line">  <a class="code" href="group__group__threads.html#ga5848fc7adb50b3a15e40955dce7f8f53">THREAD_DETACH</a>(<a class="code" href="group__group__threads.html#ga9ab5a77b8cf2b98f7d6c1b48bb421f69">THREAD_ID</a>); </div><div class="line">  <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(soap); </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); <span class="comment">// delete managed class instances </span></div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);    <span class="comment">// finalize and delete the context</span></div><div class="line">  <span class="keywordflow">return</span> NULL; </div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// ... the service operations are defined here ...</span></div></div><!-- fragment --><p>For this multi-threaded application the <em><code>gsoap/plugin/threads.h</code></em> and <em><code>gsoap/plugin/threads.c</code></em> portable threads and mutex API is used.</p>
<p>The server spawns a thread per request. Each thread executes a <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> using a copy of the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context created with <code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy</a></code> (if <code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy</a></code> fails due to out of memory then we can still recover as shown, recovery from errors is an important aspect of gSOAP's design and API implementation). Note that the server does not wait for threads to join the main thread upon program termination.</p>
<p>The <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> dispatcher handles one request or multiple requests when HTTP keep-alive is set with <code><a class="el" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2" title="soap_mode IO input and output flag value to keep the socket connection alive for SOAP_MAXKEEPALIVE me...">SOAP_IO_KEEPALIVE</a></code>. The <code><a class="el" href="structsoap.html#a1d7aca6ac1d62302102c17508a8b0ec0" title="User-definable maximum number of keep-alive message exchanges per connection (the value is SOAP_MAXKE...">soap::max_keep_alive</a></code> value can be set to the maximum keep-alive calls allowed, which is important to avoid a client from holding a thread indefinitely. The send and receive timeouts are set to avoid (intentionally) slow clients from holding a socket connection too long. The accept timeout is used to let the server terminate automatically after a period of inactivity.</p>
<p>The following example limits the number of concurrent threads to reduce the machine's CPU resource utilization:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;plugin/threads.h&quot;</span> </div><div class="line"><span class="preprocessor">#define BACKLOG (100) // Max request backlog of pending requests</span></div><div class="line"><span class="preprocessor">#define MAX_THR (10)  // Max threads to serve requests </span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  <span class="keywordflow">if</span> (argc &lt; 2) <span class="comment">// no args: assume this is a CGI application </span></div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(&amp;soap);   <span class="comment">// serve request, one thread, CGI style </span></div><div class="line">    <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap); <span class="comment">// delete managed class instances </span></div><div class="line">    <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line">  } </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">  {</div><div class="line">    <span class="keyword">struct </span>soap *soap_thr[MAX_THR]; <span class="comment">// each thread needs a context </span></div><div class="line">    <a class="code" href="group__group__threads.html#ga53ca774b0fc84afe282a5419d2d7239a">THREAD_TYPE</a> tid[MAX_THR];       <span class="comment">// array of thread IDs</span></div><div class="line">    <span class="keywordtype">int</span> port = atoi(argv[1]);       <span class="comment">// first command-line arg is port </span></div><div class="line">    <a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> m, s; </div><div class="line">    <span class="keywordtype">int</span> i; </div><div class="line">    soap.<a class="code" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474">send_timeout</a> = 10;     <span class="comment">// 10 seconds max socket delay </span></div><div class="line">    soap.<a class="code" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388">recv_timeout</a> = 10;     <span class="comment">// 10 seconds max socket delay </span></div><div class="line">    soap.<a class="code" href="structsoap.html#a78199a81c504833047224a0ceff6f906">accept_timeout</a> = 3600; <span class="comment">// server stops after 1 hour of inactivity </span></div><div class="line">    soap.<a class="code" href="structsoap.html#a1d7aca6ac1d62302102c17508a8b0ec0">max_keep_alive</a> = 100;  <span class="comment">// max keep-alive sequence </span></div><div class="line">    m = <a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(&amp;soap, NULL, port, BACKLOG); </div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(m)) </div><div class="line">      exit(EXIT_FAILURE);</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Socket connection successful %d\n&quot;</span>, m); </div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_THR; i++) </div><div class="line">      soap_thr[i] = NULL; </div><div class="line">    <span class="keywordflow">while</span> (1)</div><div class="line">    {</div><div class="line">      <span class="keywordflow">for</span> (i = 0; i &lt; MAX_THR; i++) </div><div class="line">      {</div><div class="line">        s = <a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(&amp;soap); </div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(s)) </div><div class="line">        {</div><div class="line">          fprintf(stderr, <span class="stringliteral">&quot;Thread %d accepts socket %d connection from IP %d.%d.%d.%d\n&quot;</span>, i, s, (soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;24)&amp;0xFF, (soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;16)&amp;0xFF, (soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;8)&amp;0xFF, soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&amp;0xFF); </div><div class="line">          <span class="keywordflow">if</span> (!soap_thr[i]) <span class="comment">// first time around </span></div><div class="line">          {</div><div class="line">            soap_thr[i] = <a class="code" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a">soap_copy</a>(&amp;soap); </div><div class="line">            <span class="keywordflow">if</span> (!soap_thr[i]) </div><div class="line">              exit(EXIT_FAILURE); <span class="comment">// could not allocate </span></div><div class="line">          } </div><div class="line">          <span class="keywordflow">else</span> <span class="comment">// recycle threaded soap contexts</span></div><div class="line">          {</div><div class="line">            <span class="comment">// optionally, we can cancel the current thread when stuck on IO:</span></div><div class="line">            <span class="comment">// soap_close_connection(soap_thr[i]); // requires compiling 2.8.71 or greater with -DWITH_SELF_PIPE</span></div><div class="line">            <a class="code" href="group__group__threads.html#ga6bad18c2ce46fa43f1f4d83c8010a43b">THREAD_JOIN</a>(tid[i]); </div><div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Thread %d completed\n&quot;</span>, i); </div><div class="line">            <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap_thr[i]);            <span class="comment">// delete managed class instances of thread </span></div><div class="line">            <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap_thr[i]);                <span class="comment">// delete managed data and temporaries of thread </span></div><div class="line">            <a class="code" href="group__group__context.html#gad3f0f1ab9bdd15a2db5cff3534ccd5cc">soap_copy_stream</a>(soap_thr[i], &amp;soap); <span class="comment">// pass the connection on to the thread</span></div><div class="line">          } </div><div class="line">          <span class="keywordflow">while</span> (<a class="code" href="group__group__threads.html#gabee88cce937a2709b4799ed8df36d486">THREAD_CREATE</a>(&amp;tid[i], (<span class="keywordtype">void</span>*(*)(<span class="keywordtype">void</span>*))<a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>, (<span class="keywordtype">void</span>*)soap_thr[i]))</div><div class="line">            sleep(1); <span class="comment">// failed, try again</span></div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (soap.<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a>) <span class="comment">// accept failed, try again after 1 second</span></div><div class="line">        {</div><div class="line">          <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">          sleep(1);</div><div class="line">        } </div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">          fprintf(stderr, <span class="stringliteral">&quot;Server timed out\n&quot;</span>); </div><div class="line">          <span class="keywordflow">goto</span> end;</div><div class="line">        } </div><div class="line">      } </div><div class="line">    } </div><div class="line">end:</div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_THR; i++) </div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (soap_thr[i]) </div><div class="line">      {</div><div class="line">        <a class="code" href="group__group__threads.html#ga6bad18c2ce46fa43f1f4d83c8010a43b">THREAD_JOIN</a>(tid[i]); </div><div class="line">        <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap_thr[i]);</div><div class="line">        <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap_thr[i]);</div><div class="line">        <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap_thr[i]);</div><div class="line">      }</div><div class="line">    }</div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// ... the service operations are defined here ...</span></div></div><!-- fragment --><p>The advantage of the code shown above is that the machine cannot be overloaded with requests, since the number of active services is limited. However, threads are still started and terminated. This overhead can be eliminated using a queue of requests (a queue of accepted socket connections):</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;plugin/threads.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define BACKLOG (100)    // Max. request backlog of pending requests</span></div><div class="line"><span class="preprocessor">#define MAX_THR (64)     // Size of thread pool </span></div><div class="line"><span class="preprocessor">#define MAX_QUEUE (1000) // Max. size of request queue </span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> *process_queue(<span class="keywordtype">void</span>*); </div><div class="line"><span class="keywordtype">int</span> enqueue(<a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a>); </div><div class="line"><a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> dequeue(); </div><div class="line"></div><div class="line"><span class="keyword">static</span> <a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> queue[MAX_QUEUE]; <span class="comment">// The global request queue of sockets </span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> head = 0, tail = 0;</div><div class="line"><span class="keyword">static</span> <a class="code" href="group__group__threads.html#ga94ada48918e73511c91e3e0e885fe763">MUTEX_TYPE</a> queue_lock;    <span class="comment">// mutex for queue ops critical sections</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="group__group__threads.html#ga889adb32271e98bd621f32a6bb9808b7">COND_TYPE</a> queue_notempty; <span class="comment">// condition variable when queue is empty</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="group__group__threads.html#ga889adb32271e98bd621f32a6bb9808b7">COND_TYPE</a> queue_notfull;  <span class="comment">// condition variable when queue is full</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  <span class="keywordflow">if</span> (argc &lt; 2) <span class="comment">// no args: assume this is a CGI application </span></div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(&amp;soap);   <span class="comment">// serve request, one thread, CGI style </span></div><div class="line">    <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap); <span class="comment">// delete managed class instances </span></div><div class="line">    <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);     <span class="comment">// delete managed data and temporaries </span></div><div class="line">  } </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">  {</div><div class="line">    <span class="keyword">struct </span>soap *soap_thr[MAX_THR]; <span class="comment">// each thread needs a context </span></div><div class="line">    <a class="code" href="group__group__threads.html#ga53ca774b0fc84afe282a5419d2d7239a">THREAD_TYPE</a> tid[MAX_THR]; </div><div class="line">    <span class="keywordtype">int</span> port = atoi(argv[1]); <span class="comment">// first command-line arg is port </span></div><div class="line">    <a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> m, s; </div><div class="line">    <span class="keywordtype">int</span> i; </div><div class="line">    m = <a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(&amp;soap, NULL, port, BACKLOG); </div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(m)) </div><div class="line">      exit(EXIT_FAILURE); </div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Socket connection successful %d\n&quot;</span>, m); </div><div class="line">    <a class="code" href="group__group__threads.html#gaebadda8d216cdac28b0d9763be7fe689">MUTEX_SETUP</a>(queue_lock); </div><div class="line">    <a class="code" href="group__group__threads.html#ga719d6c562837c107353b9e94d3668745">COND_SETUP</a>(queue_notempty); </div><div class="line">    <a class="code" href="group__group__threads.html#ga719d6c562837c107353b9e94d3668745">COND_SETUP</a>(queue_notfull); </div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_THR; i++) </div><div class="line">    {</div><div class="line">      soap_thr[i] = <a class="code" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a">soap_copy</a>(&amp;soap); </div><div class="line">      fprintf(stderr, <span class="stringliteral">&quot;Starting thread %d\n&quot;</span>, i); </div><div class="line">      <span class="keywordflow">while</span> (<a class="code" href="group__group__threads.html#gabee88cce937a2709b4799ed8df36d486">THREAD_CREATE</a>(&amp;tid[i], (<span class="keywordtype">void</span>*(*)(<span class="keywordtype">void</span>*))process_queue, (<span class="keywordtype">void</span>*)soap_thr[i]))</div><div class="line">        sleep(1); <span class="comment">// failed, try again</span></div><div class="line">    } </div><div class="line">    <span class="keywordflow">while</span> (1)</div><div class="line">    {</div><div class="line">      s = <a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(&amp;soap); </div><div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(s)) </div><div class="line">      {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Accept socket %d connection from IP %d.%d.%d.%d\n&quot;</span>, s, (soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;24)&amp;0xFF, (soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;16)&amp;0xFF, (soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;8)&amp;0xFF, soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&amp;0xFF); </div><div class="line">        enqueue(s);</div><div class="line">      }</div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (soap.<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a>) <span class="comment">// accept failed, try again after 1 second</span></div><div class="line">      {</div><div class="line">        <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">        sleep(1);</div><div class="line">      } </div><div class="line">      <span class="keywordflow">else</span></div><div class="line">      {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Server timed out\n&quot;</span>); </div><div class="line">        <span class="keywordflow">break</span>; </div><div class="line">      } </div><div class="line">    } </div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_THR; i++) </div><div class="line">      enqueue(<a class="code" href="group__group__soap.html#gab9e77b1557780293eec0b269ef191472">SOAP_INVALID_SOCKET</a>);</div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_THR; i++) </div><div class="line">    {</div><div class="line">      fprintf(stderr, <span class="stringliteral">&quot;Waiting for thread %d to terminate... &quot;</span>, i); </div><div class="line">      <a class="code" href="group__group__threads.html#ga6bad18c2ce46fa43f1f4d83c8010a43b">THREAD_JOIN</a>(tid[i]); </div><div class="line">      fprintf(stderr, <span class="stringliteral">&quot;terminated\n&quot;</span>); </div><div class="line">      <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap_thr[i]); </div><div class="line">    } </div><div class="line">    <a class="code" href="group__group__threads.html#ga59b186c1985a9361782b1a6d67cf8ef5">COND_CLEANUP</a>(queue_notfull); </div><div class="line">    <a class="code" href="group__group__threads.html#ga59b186c1985a9361782b1a6d67cf8ef5">COND_CLEANUP</a>(queue_notempty); </div><div class="line">    <a class="code" href="group__group__threads.html#ga295d2586aa4d2379248805e622b43742">MUTEX_CLEANUP</a>(queue_lock); </div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap); </div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> *process_queue(<span class="keywordtype">void</span> *tsoap) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = (<span class="keyword">struct </span>soap*)tsoap; </div><div class="line">  <span class="keywordflow">while</span> (1)</div><div class="line">  {</div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046">socket</a> = dequeue(); </div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(soap-&gt;<a class="code" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046">socket</a>)) </div><div class="line">      <span class="keywordflow">break</span>; </div><div class="line">    <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(soap); </div><div class="line">    <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line">    <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;served\n&quot;</span>); </div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div><div class="line">  <span class="keywordflow">return</span> NULL; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">/* add job (socket with pending request) to queue */</span></div><div class="line"><span class="keywordtype">void</span> enqueue(<a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> s)</div><div class="line">{</div><div class="line">  <span class="keywordtype">int</span> next;</div><div class="line">  <a class="code" href="group__group__threads.html#ga4a9fdd824c39252e5bf292df736e5648">MUTEX_LOCK</a>(queue_lock);</div><div class="line">  next = (tail + 1) % MAX_QUEUE;</div><div class="line">  <span class="keywordflow">if</span> (next == head)</div><div class="line">    <a class="code" href="group__group__threads.html#ga418ccb7a075721a1f6296ef1229c6ef2">COND_WAIT</a>(queue_notfull, queue_lock);</div><div class="line">  queue[tail] = s;</div><div class="line">  tail = next;</div><div class="line">  <a class="code" href="group__group__threads.html#gaff925917acd5b6addbf1def943c302e4">COND_SIGNAL</a>(queue_notempty);</div><div class="line">  <a class="code" href="group__group__threads.html#ga706e720f96e7405766dd119e654e03f9">MUTEX_UNLOCK</a>(queue_lock);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/* remove job (socket with request) from queue */</span></div><div class="line"><a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> dequeue()</div><div class="line">{</div><div class="line">  <a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> s;</div><div class="line">  <a class="code" href="group__group__threads.html#ga4a9fdd824c39252e5bf292df736e5648">MUTEX_LOCK</a>(queue_lock);</div><div class="line">  <span class="keywordflow">if</span> (head == tail)</div><div class="line">    <a class="code" href="group__group__threads.html#ga418ccb7a075721a1f6296ef1229c6ef2">COND_WAIT</a>(queue_notempty, queue_lock);</div><div class="line">  s = queue[head];</div><div class="line">  head = (head + 1) % MAX_QUEUE;</div><div class="line">  <a class="code" href="group__group__threads.html#gaff925917acd5b6addbf1def943c302e4">COND_SIGNAL</a>(queue_notfull);</div><div class="line">  <a class="code" href="group__group__threads.html#ga706e720f96e7405766dd119e654e03f9">MUTEX_UNLOCK</a>(queue_lock);</div><div class="line">  <span class="keywordflow">return</span> s;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// ... the service operations are defined here ...</span></div></div><!-- fragment --><p>For this multi-threaded application the <em><code>gsoap/plugin/threads.h</code></em> and <em><code>gsoap/plugin/threads.c</code></em> portable threads and mutex API is used.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="user"></a>
How to pass application state info to service operations</h3>
<p>The <code>void* <a class="el" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b" title="User-definable variable that may point to user-specified data of any type to pass the data through to...">soap::user</a></code> variable can be used to pass application state information to service operations and to plugins. This variable can be set before the <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> call. The service method can access this variable to use the application-dependent data. The following example shows how a non-static database handle is initialized and passed to the service methods:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  database_handle_type database_handle; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap);</div><div class="line">  soap.<a class="code" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b">user</a> = (<span class="keywordtype">void</span>*)database_handle; </div><div class="line">  ... <span class="comment">//</span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(&amp;soap))</div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  ... <span class="comment">//</span></div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keyword">struct</span> soap *soap, ...) </div><div class="line">{</div><div class="line">  fetch((database_handle_type*)soap-&gt;<a class="code" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b">user</a>); <span class="comment">// use database handle</span></div><div class="line">  ... <span class="comment">//</span></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>Another way to maintain and pass state information with the context is done with plugins, see Section <a class="el" href="index.html#plugins">Plugins, modules, and extensions</a> .</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="object"></a>
How to generate C++ server classes</h3>
<p>Server object classes for C++ server applications are automatically generated by the soapcpp2 tool using <b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b> or <b><code>soapcpp2 -i</code></b> option <b><code>-i</code></b>. Without these options the soapcpp2 tool generates C-based stub and skeleton functions.</p>
<p>We illustrate the use of server classes with the following example interface header file:</p>
<div class="fragment"><div class="line"><span class="comment">// Content of file &quot;calc.h&quot;: </span></div><div class="line"><span class="comment">//gsoap ns service name: Calculator </span></div><div class="line"><span class="comment">//gsoap ns service protocol: SOAP1.2</span></div><div class="line"><span class="comment">//gsoap ns service style: document</span></div><div class="line"><span class="comment">//gsoap ns service encoding: literal </span></div><div class="line"><span class="comment">//gsoap ns service location: http://www.cs.fsu.edu/~engelen/calc.cgi </span></div><div class="line"><span class="comment">//gsoap ns schema namespace: urn:calc </span></div><div class="line"><span class="keywordtype">int</span> ns__add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line"><span class="keywordtype">int</span> ns__sub(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line"><span class="keywordtype">int</span> ns__mul(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line"><span class="keywordtype">int</span> ns__div(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result);</div></div><!-- fragment --><p>The directives provide the service name which is used to name the service class, the protocol (SOAP 1.2) and style (document/literal), service location (endpoint URL), and the schema namespace URI.</p>
<p>We run <b><code>soapcpp2 -i calc.h</code></b> with option <b><code>-i</code></b> to generate <em><code>soapCalculatorService.h</code></em> which declares the C++ sever class that has the following structure:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"><span class="keyword">class </span>CalculatorService : <span class="keyword">public</span> soap </div><div class="line">{</div><div class="line"> <span class="keyword">public</span>: </div><div class="line">  Calculator() { <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(<span class="keyword">this</span>); }; </div><div class="line">  ... <span class="comment">// more constructors, elided here for clarity</span></div><div class="line">  ~Calculator() { <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(<span class="keyword">this</span>); }; </div><div class="line">  <a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> bind(<span class="keyword">const</span> <span class="keywordtype">char</span> *host, <span class="keywordtype">int</span> port, <span class="keywordtype">int</span> backlog) { <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(<span class="keyword">this</span>, host, port, backlog); }</div><div class="line">  <a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> accept() { <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(<span class="keyword">this</span>); }</div><div class="line">  <span class="keywordtype">int</span> serve() { <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(<span class="keyword">this</span>); }; </div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="structsoap.html#a0c714b6ed5245dbe34cf7b747aa226ac">destroy</a>() { <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(<span class="keyword">this</span>); <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(<span class="keyword">this</span>); }</div><div class="line">  ... <span class="comment">// more methods, elided here for clarity</span></div><div class="line">  <span class="comment">// user-defined service operations:</span></div><div class="line">  <span class="keywordtype">int</span> add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line">  <span class="keywordtype">int</span> sub(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line">  <span class="keywordtype">int</span> mul(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line">  <span class="keywordtype">int</span> div(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result);</div><div class="line">};</div></div><!-- fragment --><p>This generated server class <code>serve</code> method calls the <code>add</code>, <code>sub</code>, <code>mul</code>, and <code>div</code> methods upon receiving an XML request message. These methods should be implemented, for example as follows in a CGI-based service:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapCalculatorService.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Calculator.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  CalculatorService calc; </div><div class="line">  calc.serve();</div><div class="line">  calc.destroy();</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> calc::add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result) </div><div class="line">{</div><div class="line">  result = a + b; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> calc::sub(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result) </div><div class="line">{</div><div class="line">  result = a - b; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> calc::mul(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result) </div><div class="line">{</div><div class="line">  result = a * b; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> calc::div(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (b == 0.0)</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__fault.html#gac20c8569833053318196d898fe2566af">soap_sender_fault</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;Division by zero&quot;</span>, NULL);</div><div class="line">  result = a / b; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div></div><!-- fragment --><p>If we run <b><code>soapcpp2 -j calc.h</code></b> with option <b><code>-j</code></b> to generate <em><code>soapCalculatorService.h</code></em> then we get the same class as with option <b><code>-i</code></b> but the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context is not a base class but is a member of the service class:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"><span class="keyword">class </span>CalculatorService</div><div class="line">{</div><div class="line"> <span class="keyword">public</span>: </div><div class="line">  <span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>;</div><div class="line">  Calculator() { soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); }; </div><div class="line">  ... <span class="comment">// more constructors, elided here for clarity</span></div><div class="line">  ~Calculator() { <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap); }; </div><div class="line">  <a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> bind(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structsoap.html#ab8f356cfb0a1ba87c26cb0ae4c9ee713">host</a>, <span class="keywordtype">int</span> port, <span class="keywordtype">int</span> backlog) { <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(soap, host, port, backlog); }</div><div class="line">  <a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> accept() { <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(soap); }</div><div class="line">  <span class="keywordtype">int</span> serve() { <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(soap); }; </div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="structsoap.html#a0c714b6ed5245dbe34cf7b747aa226ac">destroy</a>() { <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); }</div><div class="line">  ... <span class="comment">// more methods, elided here for clarity</span></div><div class="line">  <span class="comment">// user-defined service operations:</span></div><div class="line">  <span class="keywordtype">int</span> add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result);</div><div class="line">  <span class="keywordtype">int</span> sub(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line">  <span class="keywordtype">int</span> mul(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line">  <span class="keywordtype">int</span> div(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result);</div><div class="line">};</div></div><!-- fragment --><p>The only difference we make to implement the service application is to use the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> member of the class instead of <code>this</code> when referring to the context, which in our example changes only one line of code in the <code>div</code> method:</p>
<div class="fragment"><div class="line">  <span class="keywordflow">if</span> (b == 0.0)</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__fault.html#gac20c8569833053318196d898fe2566af">soap_sender_fault</a>(soap, <span class="stringliteral">&quot;Division by zero&quot;</span>, NULL);</div><div class="line">} </div></div><!-- fragment --><p>In fact, the service classes have <code>soap_sender_fault</code> and <code>soap_receiver_fault</code> methods that can be used instead.</p>
<p>You can declare a C++ namespace <code>name</code> with <b><code>soapcpp2 -q name</code></b> to create a server class in the <code>name</code> namespace, see Section <a class="el" href="index.html#codenamespace">How to build a client or server in a C++ code namespace</a> . For more options, see also Sections <a class="el" href="index.html#soapcpp2options">soapcpp2 options</a> and <a class="el" href="index.html#dylibs">How to create client/server libraries</a>.</p>
<p>The example above serves CGI requests. The generated service classes also have <code>bind</code> and <code>accept</code> methods, which can be used to implement stand-alone services, see also Section <a class="el" href="index.html#stand-alone">How to create a stand-alone server</a> .</p>
<p>A better alternative is to use <b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b> or option <b><code>-i</code></b>. With option <b><code>-j</code></b> the C++ proxy and service classes have a <code>soap</code> context pointer. This context pointer can be set and shared among many proxy and service classes. With option <b><code>-i</code></b> the C++ proxy and server classes are derived from the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context, which simplifies the proxy invocation and service operation implementations.</p>
<p>Compilation of the above header file with <b><code>soapcpp2 -i</code></b> creates new files <em><code>soapCalculatorService.h</code></em> and <em><code>soapCalculatorService.cpp</code></em> (rather than the C-style <em><code>soapServer.cpp</code></em>).</p>
<p>This generated server object class can be included into a server application together with the generated namespace table as shown in this example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapCalculatorService.h&quot;</span> <span class="comment">// get server object </span></div><div class="line"><span class="preprocessor">#include &quot;Calculator.nsmap&quot;</span>        <span class="comment">// include the generated namespace table</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  soapCalculatorService c; </div><div class="line">  <span class="keywordflow">return</span> c.serve(); <span class="comment">// calls soap_serve to serve as CGI application (using stdin/out) </span></div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">// The &#39;add&#39; service method (soapcpp2 w/ option -i) </span></div><div class="line"><span class="keywordtype">int</span> soapCalculatorService::add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> &amp;result) </div><div class="line">{</div><div class="line">  result = a + b; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line">... <span class="comment">// sub(), mul(), and div() implementations</span></div></div><!-- fragment --><p>Note that the service operation does not need a prefix (<code>ns__</code>) and there is no <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context passed to the service operation since the service object itself is the context (it is derived from the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context struct).</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="chaining"></a>
How to chain C++ server classes to accept messages on the same port</h3>
<p>When combining multiple services into one application, you can run wsdl2h on multiple WSDLs to generate the single all-inclusive service definitions interface header file for soapcpp2. This header file is then processed with soapcpp2 to generate skeleton functions in C or server classes in C++ when using <b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b> (or option <b><code>-i</code></b>).</p>
<p>This approach works well for C and C++ too, but the problem in C++ is that we end up with multiple service classes, each for a collection of service operations that the class is supposed to implement. But what if we need to provide one endpoint port for all services and operations? In this case invoking the server object's <code>serve</code> method is not sufficient, since only one service can accept requests while we want multiple services to listen to the same port.</p>
<p>For example, say we have three service classes <code>soapABCService</code>, <code>soapUVWService</code>, and <code>soapXYZService</code>. We run <b><code>soapcpp2 -i -S -q name</code></b> three times (on the same interface file when applicable): </p><pre class="fragment">soapcpp2 -i -S -qAbc file.h
soapcpp2 -i -S -qUvw file.h
soapcpp2 -i -S -qXyz file.h
</pre><p>To generate the common <em><code>envH.h</code></em> file for SOAP Header and SOAP Fault definitions is done on a <em><code>env.h</code></em> file that is empty or has the SOAP Header and SOAP Fault detail structures <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> and <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code> specified: </p><pre class="fragment">soapcpp2 -CSL -penv env.h
</pre><p>The approach is to chain the service dispatchers, as shown below:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;AbcABCService.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;UvwUVWService.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;XyzXYZService.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;envH.h&quot;</span> <span class="comment">// include this file last, if this file is needed </span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  Abc::soapABCService abc; <span class="comment">// generated with soapcpp2 -i -S -qAbc </span></div><div class="line">  Uvw::soapUVWService uvw; <span class="comment">// generated with soapcpp2 -i -S -qUvw </span></div><div class="line">  Xyz::soapXYZService xyz; <span class="comment">// generated with soapcpp2 -i -S -qXyz </span></div><div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(abc.bind(NULL, 8080, 100)))</div><div class="line">    exit(EXIT_FAILURE);</div><div class="line">  <span class="keywordflow">while</span> (1)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(abc.accept()))</div><div class="line">      exit(EXIT_FAILURE);</div><div class="line">    <span class="comment">// abc.ssl_accept(); // when HTTPS is used</span></div><div class="line">    ... <span class="comment">//</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga5652f1b77271d434d0a4b66d5a607adb">soap_begin_serve</a>(&amp;abc)) <span class="comment">// available in 2.8.2 and later </span></div><div class="line">    {</div><div class="line">      abc.soap_stream_fault(std::cerr); </div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (abc.dispatch() == <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>) </div><div class="line">    {</div><div class="line">      <a class="code" href="group__group__context.html#gad3f0f1ab9bdd15a2db5cff3534ccd5cc">soap_copy_stream</a>(&amp;uvw, &amp;abc); </div><div class="line">      <a class="code" href="group__group__context.html#ga7eade923b1556d7e947681e16a09aaa3">soap_free_stream</a>(&amp;abc); <span class="comment">// abc no longer uses this stream </span></div><div class="line">      <span class="keywordflow">if</span> (uvw.dispatch() == <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>) </div><div class="line">      {</div><div class="line">        <a class="code" href="group__group__context.html#gad3f0f1ab9bdd15a2db5cff3534ccd5cc">soap_copy_stream</a>(&amp;xyz, &amp;uvw); </div><div class="line">        <a class="code" href="group__group__context.html#ga7eade923b1556d7e947681e16a09aaa3">soap_free_stream</a>(&amp;uvw); <span class="comment">// uvw no longer uses this stream </span></div><div class="line">        <span class="keywordflow">if</span> (xyz.dispatch()) </div><div class="line">        {</div><div class="line">          <a class="code" href="group__group__io.html#gab03e7a2c2605004c7f74be27738cc629">soap_send_fault</a>(&amp;xyz); <span class="comment">// send fault to client </span></div><div class="line">          xyz.soap_stream_fault(std::cerr); </div><div class="line">        } </div><div class="line">        xyz.destroy(); </div><div class="line">      } </div><div class="line">      <span class="keywordflow">else</span> </div><div class="line">      {</div><div class="line">        <a class="code" href="group__group__io.html#gab03e7a2c2605004c7f74be27738cc629">soap_send_fault</a>(&amp;uvw); <span class="comment">// send fault to client </span></div><div class="line">        uvw.soap_stream_fault(std::cerr); </div><div class="line">      } </div><div class="line">      uvw.destroy(); </div><div class="line">    } </div><div class="line">    <span class="keywordflow">else</span> </div><div class="line">    {</div><div class="line">      abc.soap_stream_fault(std::cerr); </div><div class="line">    }</div><div class="line">    abc.destroy(); </div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>The <code>dispatch</code> method parses the SOAP/XML request and invokes the service operations, unless there is no matching operation and <code><a class="el" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad" title="A soap_status error code: the service request dispatcher did not find a matching service operation fo...">SOAP_NO_METHOD</a></code> is returned. The <code><a class="el" href="group__group__context.html#gad3f0f1ab9bdd15a2db5cff3534ccd5cc" title="Copy the input/output stream state of the given soap context to another context. ">soap_copy_stream</a></code> ensures that the service object uses the currently open socket. The copied streams are freed with <code><a class="el" href="group__group__context.html#ga7eade923b1556d7e947681e16a09aaa3" title="Free the input/output stream state of the given soap context. ">soap_free_stream</a></code>. Do not enable keep-alive support, as the socket may stay open indefinitely afterwards as a consequence. Also, the <code>dispatch</code> method does not send a fault to the client, which has to be explicitly done with the <code><a class="el" href="group__group__io.html#gab03e7a2c2605004c7f74be27738cc629" title="Return an HTTP error with a SOAP Fault message from a service. ">soap_send_fault</a></code> operation when an error occurs.</p>
<p>In this way, multiple services can be chained to accept messages on the same port. This approach also works with SSL for HTTPS services.</p>
<p>However, this approach is not recommended for certain plugins, because plugins must be registered with all service objects and some plugins require state information to be used across the service objects, which will add significantly to the complexity.</p>
<p>Therefore, it is best to have all services share the same context. This means that <b><code>soapcpp2 -j</code></b> with option <b><code>-j</code></b> should be used instead of option <b><code>-i</code></b>. As a result, we can make each service class instance to share the same <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context and the same plugins. </p><pre class="fragment">soapcpp2 -j -S -qAbc file.h
soapcpp2 -j -S -qUvw file.h
soapcpp2 -j -S -qXyz file.h
</pre><p>Chaining the services is also simpler to implement since we use one <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;AbcABCService.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;UvwUVWService.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;XyzXYZService.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;envH.h&quot;</span> <span class="comment">// include this file last, if it is needed </span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">  Abc::soapABCService abc(soap); <span class="comment">// generated with soapcpp2 -j -S -qAbc </span></div><div class="line">  Uvw::soapUVWService uvw(soap); <span class="comment">// generated with soapcpp2 -j -S -qUvw </span></div><div class="line">  Xyz::soapXYZService xyz(soap); <span class="comment">// generated with soapcpp2 -j -S -qXyz </span></div><div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(<a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(soap, NULL, 8080, BACKLOG)))</div><div class="line">    exit(EXIT_FAILURE);</div><div class="line">  <span class="keywordflow">while</span> (1)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(<a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(soap)))</div><div class="line">      exit(EXIT_FAILURE);</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga5652f1b77271d434d0a4b66d5a607adb">soap_begin_serve</a>(soap)) </div><div class="line">    {</div><div class="line">      <a class="code" href="group__group__fault.html#gaab984763de3f5fdd4363aa62b4f250c2">soap_stream_fault</a>(soap, std::cerr);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (abc.dispatch() == <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>) </div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (uvw.dispatch() == <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>) </div><div class="line">      {</div><div class="line">        <span class="keywordflow">if</span> (xyz.dispatch() == <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>) </div><div class="line">          <a class="code" href="group__group__io.html#gab03e7a2c2605004c7f74be27738cc629">soap_send_fault</a>(soap); <span class="comment">// send fault to client </span></div><div class="line">      } </div><div class="line">    } </div><div class="line">    <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line">    <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line">  }</div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap); <span class="comment">// safe to delete when abc, uvw, xyz are also deleted</span></div><div class="line">}</div></div><!-- fragment --><p>However, the while loop iterates for each new connection that is established with <code><a class="el" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6" title="Accept a connection with a client. ">soap_accept</a></code> and does not allow for HTTP keep-alive connections to persist. For our final improvement we want to support HTTP keep-alive connections that require looping over the service dispatches until the connection closes on either end, after which we resume the outer loop. The resulting code is very close to the soapcpp2-generated <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> code and the <code>serve</code> service class methods, with the addition of the chain of service dispatches in the loop body:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;AbcABCService.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;UvwUVWService.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;XyzXYZService.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;envH.h&quot;</span> <span class="comment">// include this file last, if it is needed </span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">  Abc::soapABCService abc(soap); <span class="comment">// generated with soapcpp2 -j -S -qAbc </span></div><div class="line">  Uvw::soapUVWService uvw(soap); <span class="comment">// generated with soapcpp2 -j -S -qUvw </span></div><div class="line">  Xyz::soapXYZService xyz(soap); <span class="comment">// generated with soapcpp2 -j -S -qXyz </span></div><div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(<a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(soap, NULL, 8080, BACKLOG)))</div><div class="line">    exit(EXIT_FAILURE);</div><div class="line">  <span class="keywordflow">while</span> (1)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(<a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(soap)))</div><div class="line">      exit(EXIT_FAILURE);</div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#a3d93ba968bb58373f5884177a7ec0d83">keep_alive</a> = soap-&gt;<a class="code" href="structsoap.html#a1d7aca6ac1d62302102c17508a8b0ec0">max_keep_alive</a> + 1; <span class="comment">// max keep-alive iterations</span></div><div class="line">    <span class="keywordflow">do</span></div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> ((soap-&gt;<a class="code" href="structsoap.html#a3d93ba968bb58373f5884177a7ec0d83">keep_alive</a> &gt; 0) &amp;&amp; (soap-&gt;<a class="code" href="structsoap.html#a1d7aca6ac1d62302102c17508a8b0ec0">max_keep_alive</a> &gt; 0))</div><div class="line">        soap-&gt;<a class="code" href="structsoap.html#a3d93ba968bb58373f5884177a7ec0d83">keep_alive</a>--;</div><div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga5652f1b77271d434d0a4b66d5a607adb">soap_begin_serve</a>(soap))</div><div class="line">      {</div><div class="line">        <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> &gt;= <a class="code" href="group__group__errors.html#gaa03308d50b94828cbc49724d049d9d2d">SOAP_STOP</a>) <span class="comment">// if a plugin has served the request</span></div><div class="line">          <span class="keywordflow">continue</span>;                   <span class="comment">// then continue with the next request</span></div><div class="line">        <span class="keywordflow">break</span>;                        <span class="comment">// an error occurred</span></div><div class="line">      }</div><div class="line">      <span class="keywordflow">if</span> (abc.dispatch() == <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>) </div><div class="line">      {</div><div class="line">        <span class="keywordflow">if</span> (uvw.dispatch() == <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>) </div><div class="line">        {</div><div class="line">          <span class="keywordflow">if</span> (xyz.dispatch() == <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>) </div><div class="line">            <a class="code" href="group__group__io.html#gab03e7a2c2605004c7f74be27738cc629">soap_send_fault</a>(soap); <span class="comment">// send fault to client </span></div><div class="line">        } </div><div class="line">      } </div><div class="line">      <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line">      <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line">    } <span class="keywordflow">while</span> (soap-&gt;<a class="code" href="structsoap.html#a3d93ba968bb58373f5884177a7ec0d83">keep_alive</a>);</div><div class="line">    <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line">    <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line">  }</div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap); <span class="comment">// safe to delete when abc, uvw, xyz are also deleted</span></div><div class="line">}</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl"></a>
How to generate WSDL service descriptions</h3>
<p>The soapcpp2 tool generates WSDL (Web Service Description Language) service descriptions and XML schema files (XSDs) when processing an interface header file that wasn't generated with wsdl2h. The soapcpp2 tool produces one WSDL file for a set of service operations in the header file. If the header file has no service operations (i.e. no function prototypes) then no WSDL will be generated. The names of the function prototypes of the service operations must use the same namespace prefix and the namespace prefix is used to name the WSDL file. The WSDL file and services can be named with a <code>//gsoap &lt;prefix&gt; service name:</code> directive to specify a service name for each namespace prefix.</p>
<p>If multiple namespace prefixes are used to define service operations, then multiple WSDL files will be created and each file describes the set of service operations belonging to that namespace prefix.</p>
<p>The soapcpp2 tool also generates XML schema files (XSD files) for all serializable C/C++ types declared in the interface header file input to soapcpp2. These XSD files do not have to be published as the WSDL file already contains the appropriate XML Schema definitions.</p>
<p>To customize the WSDL output, use <code>//gsoap</code> directives to declare the service name, the endpoint port, and namespace etc:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service name: example </span></div><div class="line"><span class="comment">//gsoap ns service type: examplePortType</span></div><div class="line"><span class="comment">//gsoap ns service port: http://www.example.com/example </span></div><div class="line"><span class="comment">//gsoap ns service namespace: urn:example</span></div></div><!-- fragment --><p>These are some examples and defaults will be used when directives are not specified. Recommended is to specify at least the service name and namespace URI. More details and settings for the service can be declared as well. See Section <a class="el" href="index.html#directives">Directives</a> for more details.</p>
<p>In addition to the generation of the WSDL files, a file with a namespace mapping table is generated by the gSOAP soapcpp2 tool. An example mapping table is shown below:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsi&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/XMLSchema-instance&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsd&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>,          <span class="stringliteral">&quot;http://www.w3.org/*/XMLSchema&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;ns&quot;</span>,       <span class="stringliteral">&quot;urn:example&quot;</span> }, <span class="comment">// binds &quot;ns&quot; namespace prefix to schema URI</span></div><div class="line">  { NULL, NULL } </div><div class="line">};</div></div><!-- fragment --><p>This file should be included in the client or service application, see Section <a class="el" href="index.html#nstable">XML namespaces and the namespace mapping table</a> for details on namespace mapping tables.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example8"></a>
Example</h3>
<p>For example, suppose the following service operations are defined in the <em><code>calc.h</code></em> header file:</p>
<div class="fragment"><div class="line"><span class="comment">// Content of file &quot;calc.h&quot;: </span></div><div class="line"><span class="comment">//gsoap ns service name: calc</span></div><div class="line"><span class="keywordtype">int</span> ns__add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line"><span class="keywordtype">int</span> ns__sub(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span>&amp; result); </div><div class="line"><span class="keywordtype">int</span> ns__sqrt(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span>&amp; result); </div></div><!-- fragment --><p>One WSDL file <em><code>calc.wsdl</code></em> will be generated that describes the three service operations:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">definitions</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Service&quot;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;http://tempuri.org/ns.xsd/Service.wsdl&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  <span class="keyword">xmlns:tns</span>=<span class="stringliteral">&quot;http://tempuri.org/ns.xsd/Service.wsdl&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;http://tempuri.org/ns.xsd&quot;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="keyword">xmlns:SOAP</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  <span class="keyword">xmlns:HTTP</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/wsdl/http/&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  <span class="keyword">xmlns:MIME</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/wsdl/mime/&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="keyword">xmlns:DIME</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/ws/2002/04/dime/wsdl/&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  <span class="keyword">xmlns:WSDL</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/wsdl/&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="keyword">xmlns</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/wsdl/&quot;</span>&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;&lt;<span class="keywordtype">types</span>&gt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  &lt;<span class="keywordtype">schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;http://tempuri.org/ns.xsd&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;      <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;      <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;      <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;      <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;http://tempuri.org/ns.xsd&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;      <span class="keyword">xmlns</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;      <span class="keyword">elementFormDefault</span>=<span class="stringliteral">&quot;unqualified&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;      <span class="keyword">attributeFormDefault</span>=<span class="stringliteral">&quot;unqualified&quot;</span>&gt;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    &lt;<span class="keywordtype">import</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>/&gt;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    </div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;add&quot;</span>&gt;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;      &lt;<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;          &lt;<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;            &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;a&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:double&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;            &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;b&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:double&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;          &lt;/<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      &lt;/<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    &lt;/<span class="keywordtype">element</span>&gt;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    </div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;addResponse&quot;</span>&gt;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      &lt;<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;          &lt;<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;result&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:double&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;          &lt;/<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      &lt;/<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    &lt;/<span class="keywordtype">element</span>&gt;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    </div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;sub&quot;</span>&gt;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      &lt;<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;          &lt;<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;a&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:double&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;            &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;b&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:double&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;          &lt;/<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      &lt;/<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    &lt;/<span class="keywordtype">element</span>&gt;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    </div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;subResponse&quot;</span>&gt;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      &lt;<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;          &lt;<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;result&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:double&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;          &lt;/<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      &lt;/<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    &lt;/<span class="keywordtype">element</span>&gt;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    </div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;sqrt&quot;</span>&gt;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      &lt;<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;          &lt;<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;a&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:double&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;          &lt;/<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      &lt;/<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    &lt;/<span class="keywordtype">element</span>&gt;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    </div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;sqrtResponse&quot;</span>&gt;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      &lt;<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;          &lt;<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;result&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:double&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;          &lt;/<span class="keywordtype">sequence</span>&gt;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      &lt;/<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    &lt;/<span class="keywordtype">element</span>&gt;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  &lt;/<span class="keywordtype">schema</span>&gt;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;&lt;/<span class="keywordtype">types</span>&gt;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;&lt;<span class="keywordtype">message</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;addRequest&quot;</span>&gt;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  &lt;<span class="keywordtype">part</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Body&quot;</span> <span class="keyword">element</span>=<span class="stringliteral">&quot;ns:add&quot;</span>/&gt;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;&lt;/<span class="keywordtype">message</span>&gt;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;&lt;<span class="keywordtype">message</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;addResponse&quot;</span>&gt;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  &lt;<span class="keywordtype">part</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Body&quot;</span> <span class="keyword">element</span>=<span class="stringliteral">&quot;ns:addResponse&quot;</span>/&gt;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;&lt;/<span class="keywordtype">message</span>&gt;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;&lt;<span class="keywordtype">message</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;subRequest&quot;</span>&gt;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  &lt;<span class="keywordtype">part</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Body&quot;</span> <span class="keyword">element</span>=<span class="stringliteral">&quot;ns:sub&quot;</span>/&gt;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;&lt;/<span class="keywordtype">message</span>&gt;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;&lt;<span class="keywordtype">message</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;subResponse&quot;</span>&gt;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  &lt;<span class="keywordtype">part</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Body&quot;</span> <span class="keyword">element</span>=<span class="stringliteral">&quot;ns:subResponse&quot;</span>/&gt;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;&lt;/<span class="keywordtype">message</span>&gt;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;&lt;<span class="keywordtype">message</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;sqrtRequest&quot;</span>&gt;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  &lt;<span class="keywordtype">part</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Body&quot;</span> <span class="keyword">element</span>=<span class="stringliteral">&quot;ns:sqrt&quot;</span>/&gt;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;&lt;/<span class="keywordtype">message</span>&gt;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;&lt;<span class="keywordtype">message</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;sqrtResponse&quot;</span>&gt;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  &lt;<span class="keywordtype">part</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Body&quot;</span> <span class="keyword">element</span>=<span class="stringliteral">&quot;ns:sqrtResponse&quot;</span>/&gt;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;&lt;/<span class="keywordtype">message</span>&gt;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;&lt;<span class="keywordtype">portType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ServicePortType&quot;</span>&gt;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  &lt;<span class="keywordtype">operation</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;add&quot;</span>&gt;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    &lt;<span class="keywordtype">documentation</span>&gt;<span class="keyword">Service</span> <span class="keyword">definition</span> <span class="keyword">of</span> <span class="keyword">function</span> <span class="keyword">ns__add</span>&lt;/<span class="keywordtype">documentation</span>&gt;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    &lt;<span class="keywordtype">input</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;tns:addRequest&quot;</span>/&gt;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    &lt;<span class="keywordtype">output</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;tns:addResponse&quot;</span>/&gt;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  &lt;/<span class="keywordtype">operation</span>&gt;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  &lt;<span class="keywordtype">operation</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;sub&quot;</span>&gt;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    &lt;<span class="keywordtype">documentation</span>&gt;<span class="keyword">Service</span> <span class="keyword">definition</span> <span class="keyword">of</span> <span class="keyword">function</span> <span class="keyword">ns__sub</span>&lt;/<span class="keywordtype">documentation</span>&gt;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    &lt;<span class="keywordtype">input</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;tns:subRequest&quot;</span>/&gt;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    &lt;<span class="keywordtype">output</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;tns:subResponse&quot;</span>/&gt;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  &lt;/<span class="keywordtype">operation</span>&gt;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  &lt;<span class="keywordtype">operation</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;sqrt&quot;</span>&gt;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    &lt;<span class="keywordtype">documentation</span>&gt;<span class="keyword">Service</span> <span class="keyword">definition</span> <span class="keyword">of</span> <span class="keyword">function</span> <span class="keyword">ns__sqrt</span>&lt;/<span class="keywordtype">documentation</span>&gt;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    &lt;<span class="keywordtype">input</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;tns:sqrtRequest&quot;</span>/&gt;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    &lt;<span class="keywordtype">output</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;tns:sqrtResponse&quot;</span>/&gt;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  &lt;/<span class="keywordtype">operation</span>&gt;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;&lt;/<span class="keywordtype">portType</span>&gt;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;&lt;<span class="keywordtype">binding</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Service&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;tns:ServicePortType&quot;</span>&gt;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  &lt;<span class="keywordtype">SOAP:binding</span> <span class="keyword">style</span>=<span class="stringliteral">&quot;document&quot;</span> <span class="keyword">transport</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/http&quot;</span>/&gt;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  &lt;<span class="keywordtype">operation</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;add&quot;</span>&gt;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    &lt;<span class="keywordtype">SOAP:operation</span> <span class="keyword">soapAction</span>=<span class="stringliteral">&quot;&quot;</span>/&gt;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    &lt;<span class="keywordtype">input</span>&gt;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;          &lt;<span class="keywordtype">SOAP:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span> <span class="keyword">parts</span>=<span class="stringliteral">&quot;Body&quot;</span>/&gt;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    &lt;<span class="keywordtype">output</span>&gt;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;          &lt;<span class="keywordtype">SOAP:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span> <span class="keyword">parts</span>=<span class="stringliteral">&quot;Body&quot;</span>/&gt;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  &lt;/<span class="keywordtype">operation</span>&gt;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  &lt;<span class="keywordtype">operation</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;sub&quot;</span>&gt;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    &lt;<span class="keywordtype">SOAP:operation</span> <span class="keyword">soapAction</span>=<span class="stringliteral">&quot;&quot;</span>/&gt;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    &lt;<span class="keywordtype">input</span>&gt;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;          &lt;<span class="keywordtype">SOAP:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span> <span class="keyword">parts</span>=<span class="stringliteral">&quot;Body&quot;</span>/&gt;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    &lt;<span class="keywordtype">output</span>&gt;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;          &lt;<span class="keywordtype">SOAP:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span> <span class="keyword">parts</span>=<span class="stringliteral">&quot;Body&quot;</span>/&gt;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  &lt;/<span class="keywordtype">operation</span>&gt;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  &lt;<span class="keywordtype">operation</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;sqrt&quot;</span>&gt;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    &lt;<span class="keywordtype">SOAP:operation</span> <span class="keyword">soapAction</span>=<span class="stringliteral">&quot;&quot;</span>/&gt;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    &lt;<span class="keywordtype">input</span>&gt;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;          &lt;<span class="keywordtype">SOAP:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span> <span class="keyword">parts</span>=<span class="stringliteral">&quot;Body&quot;</span>/&gt;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    &lt;<span class="keywordtype">output</span>&gt;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;          &lt;<span class="keywordtype">SOAP:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span> <span class="keyword">parts</span>=<span class="stringliteral">&quot;Body&quot;</span>/&gt;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  &lt;/<span class="keywordtype">operation</span>&gt;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;&lt;/<span class="keywordtype">binding</span>&gt;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;&lt;<span class="keywordtype">service</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Service&quot;</span>&gt;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  &lt;<span class="keywordtype">documentation</span>&gt;<span class="keyword">gSOAP</span> 2.8.70 <span class="keyword">generated</span> <span class="keyword">service</span> <span class="keyword">definition</span>&lt;/<span class="keywordtype">documentation</span>&gt;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  &lt;<span class="keywordtype">port</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Service&quot;</span> <span class="keyword">binding</span>=<span class="stringliteral">&quot;tns:Service&quot;</span>&gt;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    &lt;<span class="keywordtype">SOAP:address</span> <span class="keyword">location</span>=<span class="stringliteral">&quot;http://localhost:80&quot;</span>/&gt;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  &lt;/<span class="keywordtype">port</span>&gt;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;&lt;/<span class="keywordtype">service</span>&gt;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;&lt;/<span class="keywordtype">definitions</span>&gt;</div></div><!-- fragment --> </div><p>The above uses the default settings for the service name, port, and namespace which can be set in the header file with <code>//gsoap</code> directives, see Section <a class="el" href="index.html#directives">Directives</a> .</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="clientinservice"></a>
How to make client-side calls within a service operation</h3>
<p>Invoking a server-side client call requires the use of a new <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context in the service operation itself, which is best illustrated with an example. The following example combines the functionality of two Web services into one new SOAP Web service. The service provides a currency-converted stock quote. To serve a request, the service in turn requests the stock quote and the currency-exchange rate from two services. The currency-converted quote is then calculated and returned.</p>
<p>In addition to being a client of two Web services, this service application can also be used as a client of itself to test the implementation. As a client invoked from the command-line, it will return a currency-converted stock quote by connecting to a copy of itself installed as a CGI application on the Web to retrieve the quote after which it will print the quote on the terminal.</p>
<p>The header file input to the soapcpp2 tool is given below. The example is for illustrative purposes only because the XMethods stock quote and currency rate services are no longer operational:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;quotex.h&quot;: </span></div><div class="line"><span class="comment">// the first service: stock quotes</span></div><div class="line"><span class="comment">//gsoap ns1 service namespace:  urn:xmethods-delayed-quotes</span></div><div class="line"><span class="comment">//gsoap ns1 service style:      rpc</span></div><div class="line"><span class="comment">//gsoap ns1 service encoding:   encoded</span></div><div class="line"><span class="keywordtype">int</span> ns1__getQuote(<span class="keywordtype">char</span> *symbol, <span class="keywordtype">float</span>&amp; result);</div><div class="line"><span class="comment">// the second service: currency exchange</span></div><div class="line"><span class="comment">//gsoap ns2 service namespace:  urn:xmethods-CurrencyExchange</span></div><div class="line"><span class="comment">//gsoap ns2 service style:      rpc</span></div><div class="line"><span class="comment">//gsoap ns2 service encoding:   encoded</span></div><div class="line"><span class="keywordtype">int</span> ns2__getRate(<span class="keywordtype">char</span> *country1, <span class="keywordtype">char</span> *country2, <span class="keywordtype">float</span>&amp; result);</div><div class="line"><span class="comment">// our new service operation: returns currency-converted stock quote</span></div><div class="line"><span class="comment">//gsoap ns3 service name:       quotex</span></div><div class="line"><span class="comment">//gsoap ns3 service style:      rpc</span></div><div class="line"><span class="comment">//gsoap ns3 service encoding:   encoded</span></div><div class="line"><span class="comment">//gsoap ns3 schema  namespace:  urn:quotex</span></div><div class="line"><span class="keywordtype">int</span> ns3__getQuote(<span class="keywordtype">char</span> *symbol, <span class="keywordtype">char</span> *country, <span class="keywordtype">float</span>&amp; result);</div></div><!-- fragment --><p>We run: </p><pre class="fragment">soapcpp2 quotex.h
</pre><p>This generates <em><code>soapStub.h</code></em>, <em><code>soapH.h</code></em>, <em><code>soapC.cpp</code></em> (serializers), <em><code>soapClient.cpp</code></em> (client stub functions), <em><code>soapServer.cpp</code></em> (server skeleton functions).</p>
<p>The <em><code>quotex.cpp</code></em> CGI service application is (for source code to create a stand-alone service, see Section <a class="el" href="index.html#stand-alone">How to create a stand-alone server</a>):</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;quotex.cpp&quot;: </span></div><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;ns1.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns3__getQuote(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *symbol, <span class="keywordtype">char</span> *country, <span class="keywordtype">float</span>&amp; result) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap tsoap;</div><div class="line">  <span class="keywordtype">float</span> q, r; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;tsoap);</div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns1__getQuote(tsoap, <span class="stringliteral">&quot;http://services.xmethods.net/soap&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, symbol, &amp;q)</div><div class="line">   || soap_call_ns2__getRate(tsoap, <span class="stringliteral">&quot;http://services.xmethods.net/soap&quot;</span>, NULL, <span class="stringliteral">&quot;us&quot;</span>, country, &amp;r)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__context.html#gaa959ff61609f7b324527e88655c2377f">soap_delegate_deletion</a>(&amp;tsoap, &amp;soap); <span class="comment">// move tsoap-deserialized data to the soap context</span></div><div class="line">    <span class="keywordflow">if</span> (tsoap-&gt;fault)</div><div class="line">    {</div><div class="line">      soap-&gt;<a class="code" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0">fault</a> = tsoap-&gt;fault; <span class="comment">// if one of the calls returned a SOAP Fault, we use it</span></div><div class="line">      <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;tsoap);</div><div class="line">      <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#gaf27d1f10130e4da080975711a7192f07">SOAP_FAULT</a>;</div><div class="line">    }</div><div class="line">    <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;tsoap);</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6">soap_receiver_fault</a>(soap, <span class="stringliteral">&quot;Cannot access services&quot;</span>, NULL);</div><div class="line">  }</div><div class="line">  result = q * r; </div><div class="line">  <a class="code" href="group__group__context.html#gaa959ff61609f7b324527e88655c2377f">soap_delegate_deletion</a>(&amp;tsoap, &amp;soap); <span class="comment">// move tsoap-deserialized data to the soap context</span></div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;tsoap);</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">/* Since this app is a combined client-server, it is put together with </span></div><div class="line"><span class="comment"> * one header file that describes all service operations. However, as a consequence we </span></div><div class="line"><span class="comment"> * have to implement the methods that are not ours. Since these implementations are </span></div><div class="line"><span class="comment"> * never called (this code is client-side), we can make them dummies as below. </span></div><div class="line"><span class="comment"> */</span> </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns1__getQuote(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *symbol, <span class="keywordtype">float</span> &amp;result) </div><div class="line">{</div><div class="line">  <span class="comment">// dummy: will never be called </span></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns2__getRate(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *country1, <span class="keywordtype">char</span> *country2, <span class="keywordtype">float</span> &amp;result) </div><div class="line">{</div><div class="line">  <span class="comment">// dummy: will never be called </span></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsi&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/XMLSchema-instance&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsd&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>,          <span class="stringliteral">&quot;http://www.w3.org/*/XMLSchema&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;ns1&quot;</span>,      <span class="stringliteral">&quot;urn:xmethods-delayed-quotes&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;ns2&quot;</span>,      <span class="stringliteral">&quot;urn:xmethods-CurrencyExchange&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;ns3&quot;</span>,      <span class="stringliteral">&quot;urn:quotex&quot;</span> }, </div><div class="line">  { NULL, NULL } </div><div class="line">};</div></div><!-- fragment --><p>When combining clients and service functionalities, it is recommended to use a single interface header file input to the soapcpp2 tool, since this header file declares both client and server functionalities. As a consequence, however, stub and skeleton functions are generated for all service operations, while the client part will only use the stub functions and the service part will use the skeleton functions. Thus, dummy implementations of the unused service operations are implemented as shown in the example above, which are in fact never used.</p>
<p>Three WSDL files are generated by soapcpp2: <em><code>ns1.wsdl</code></em>, <em><code>ns2.wsdl</code></em>, and <em><code>ns3.wsdl</code></em>. Only the <em><code>ns3.wsdl</code></em> file is required to be published as it contains the description of the combined service, while the others are generated as a side-effect.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="restservice"></a>
How to switch to REST from SOAP</h3>
<p>To switch to RESTful Web APIs from SOAP Web services APIs is simple, just use a directive.</p>
<p>To declare HTTP POST as the default HTTP method to use with client-side calls for all service operations associated with the <code>ns</code> namespace prefix:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service protocol: POST</span></div></div><!-- fragment --><p>To declare the HTTP POST method for a specific service operation, use:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service protocol: POST</span></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(...);</div></div><!-- fragment --><p>You can specify <code>GET</code>, <code>PUT</code>, <code>POST</code>, and <code>DELETE</code>. With <code>GET</code> the input parameters of the service operations should be primitive types. See Section <a class="el" href="index.html#directives-1">Service directives</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="oneway1"></a>
Asynchronous one-way message passing</h2>
<p>SOAP messaging is typically synchronous: the client sends a HTTP POST and blocks until the server responds to the request. The gSOAP tools also support asynchronous one-way messaging over HTTP.</p>
<p>One-way SOAP service operations are declared as function prototypes with the output parameter specified as a <code>void</code> type to indicate the absence of a return value, for example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__event(<span class="keywordtype">int</span> eventNo, <span class="keywordtype">void</span>);</div></div><!-- fragment --><p>The soapcpp2 tool generates the following functions in <em><code>soapClient.cpp</code></em>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> soap_send_ns__event(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> URL, <span class="keyword">const</span> <span class="keywordtype">char</span> action, <span class="keywordtype">int</span> event); </div><div class="line"><span class="keywordtype">int</span> soap_recv_ns__event(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> ns__event *dummy); </div></div><!-- fragment --><p>The <code>soap_send_ns__event</code> function transmits the message to the destination URL by opening a socket and sending the SOAP encoded message. The socket will remain open after the send. To complete the HTTP POST operation we need to call <code><a class="el" href="group__group__io.html#ga8bb9d541b641a6c261d8879363c7694c" title="Receive an HTTP response message from the server that is assumed to be empty. ">soap_recv_empty_response</a></code> to accept the server's HTTP OK or Accept response message that should have an empty message body:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (soap_send_ns__event(soap, eventNo) || <a class="code" href="group__group__io.html#ga8bb9d541b641a6c261d8879363c7694c">soap_recv_empty_response</a>(soap)</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div></div><!-- fragment --><p>The generated <code>soap_recv_ns__event</code> function can be used to parse a SOAP message, e.g. on the server side. But it is not used on the client side. The <code>ns__event</code> structure is declared as:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__event </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> eventNo; </div><div class="line">}</div></div><!-- fragment --><p>The gSOAP generated <em><code>soapServer.cpp</code></em> code includes a skeleton function called by <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> to process the one-way request message:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> soap_serve_ns__event(<span class="keyword">struct</span> soap *soap);</div></div><!-- fragment --><p> This skeleton function calls the user-defined <code>ns__event(struct soap *soap, int eventNo)</code> function (note the absence of the void parameter!). However, when this function returns, the skeleton function does not respond with a SOAP response message since no response data is specified. Instead, the user-defined <code>ns__event</code> function should call <code><a class="el" href="group__group__io.html#ga6ac5e550072a59c8b6d432b63cc3543a" title="Return an HTTP response message with an empty HTTP body from a service back to the client or peer...">soap_send_empty_response</a></code> to return an empty response message. For example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__event(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">int</span> eventNo) </div><div class="line">{</div><div class="line">  ... <span class="comment">// handle event </span></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga6ac5e550072a59c8b6d432b63cc3543a">soap_send_empty_response</a>(soap, 202); <span class="comment">// HTTP 202 Accepted</span></div><div class="line">}</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="bindings"></a>
How to use XML serializers to save and load application data</h2>
<p>The gSOAP XML databindings for C and C++ allow a seamless integration of XML in C and C++ applications. Data can be serialized in XML and vice versa. WSDL and XML schema files can be converted to C or C++ definitions. C and C++ definitions can be translated to WSDL and schemas to support legacy ANSI C applications for example.</p>
<p>This section explains the basics of mapping XML schema types to C/C++ types using the wsdl2h tool. A more in-depth presentation of C/C++ XML data bindings in gSOAP is documented in <a href="../../databinding/html/index.html">C and C++ XML data bindings</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h"></a>
Converting WSDL, WADL, and XML schema to C/C++ with wsdl2h</h3>
<p>The wsdl2h tool takes WSDL, WADL, and XSD files or URLs to WSDL, WADL, and XSD and generates an interface header file with the command: </p><pre class="fragment"> wsdl2h [options] WSDL WADL and XSD files or URLs...
</pre><p>The WSDL 1.1 and 2.0 standards are supported and WADL. If you have any trouble with wsdl2h being able to process WSDLs and XSD files or URLs, then please contact Genivia technical support for assistance.</p>
<p>The gSOAP tools support the entire XML schema 1.1 standard, except XPath expressions and assertions. This covers all of the following schema components with their optional attributes shown:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:any</span> <span class="keyword">minOccurs</span> <span class="keyword">maxOccurs</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">xsd:anyAttribute</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;<span class="keywordtype">xsd:all</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;<span class="keywordtype">xsd:choice</span> <span class="keyword">minOccurs</span> <span class="keyword">maxOccurs</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;<span class="keywordtype">xsd:sequence</span> <span class="keyword">minOccurs</span> <span class="keyword">maxOccurs</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;<span class="keywordtype">xsd:group</span> <span class="keyword">name</span> <span class="keyword">ref</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;<span class="keywordtype">xsd:attributeGroup</span> <span class="keyword">name</span> <span class="keyword">ref</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;<span class="keywordtype">xsd:attribute</span> <span class="keyword">name</span> <span class="keyword">ref</span> <span class="keyword">type</span> <span class="keyword">use</span> <span class="keyword">default</span> <span class="keyword">fixed</span> <span class="keyword">form</span> <span class="keyword">wsdl:arrayType</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span> <span class="keyword">ref</span> <span class="keyword">type</span> <span class="keyword">default</span> <span class="keyword">fixed</span> <span class="keyword">form</span> <span class="keyword">nillable</span> <span class="keyword">abstract</span> <span class="keyword">substitutionGroup</span> <span class="keyword">minOccurs</span> <span class="keyword">maxOccurs</span>&gt; </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&lt;<span class="keywordtype">xsd:simpleType</span> <span class="keyword">name</span>&gt; </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span> <span class="keyword">abstract</span> <span class="keyword">mixed</span>&gt;</div></div><!-- fragment --> </div><p>The supported schema facets are:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:enumeration</span>&gt;        <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">enum</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">xsd:simpleContent</span>&gt;      <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">primitive</span> <span class="keyword">type</span> <span class="keyword">or</span> <span class="keyword">a</span> <span class="keyword">typedef</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;<span class="keywordtype">xsd:complexContent</span>&gt;     <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">a</span> <span class="keyword">struct</span> <span class="keyword">or</span> <span class="keyword">class</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;<span class="keywordtype">xsd:list</span>&gt;               <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">enum</span>* (<span class="keyword">bitmask</span>)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;<span class="keywordtype">xsd:extension</span>&gt;          <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">extended</span> <span class="keyword">struct</span> <span class="keyword">or</span> <span class="keyword">class</span> <span class="keyword">with</span> <span class="keyword">a</span> <span class="keyword">base</span> <span class="keyword">class</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;<span class="keywordtype">xsd:restriction</span>&gt;        <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">typedef</span>, <span class="keyword">struct</span> <span class="keyword">or</span> <span class="keyword">class</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;<span class="keywordtype">xsd:length</span>&gt;             <span class="keyword">validates</span> <span class="keyword">string</span> <span class="keyword">lengths</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;<span class="keywordtype">xsd:minLength</span>&gt;          <span class="keyword">validates</span> <span class="keyword">string</span> <span class="keyword">lengths</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;<span class="keywordtype">xsd:maxLength</span>&gt;          <span class="keyword">validates</span> <span class="keyword">string</span> <span class="keyword">lengths</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&lt;<span class="keywordtype">xsd:minInclusive</span>&gt;       <span class="keyword">validates</span> <span class="keyword">integer</span> <span class="keyword">and</span> <span class="keyword">float</span> <span class="keyword">types</span> </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&lt;<span class="keywordtype">xsd:maxInclusive</span>&gt;       <span class="keyword">validates</span> <span class="keyword">integer</span> <span class="keyword">and</span> <span class="keyword">float</span> <span class="keyword">types</span> </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;&lt;<span class="keywordtype">xsd:minExclusive</span>&gt;       <span class="keyword">validates</span> <span class="keyword">integer</span> <span class="keyword">and</span> <span class="keyword">float</span> <span class="keyword">types</span> </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;<span class="keywordtype">xsd:maxExclusive</span>&gt;       <span class="keyword">validates</span> <span class="keyword">integer</span> <span class="keyword">and</span> <span class="keyword">float</span> <span class="keyword">types</span> </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&lt;<span class="keywordtype">xsd:precision</span>&gt;          <span class="keyword">float</span> <span class="keyword">with</span> <span class="keyword">formatted</span> <span class="keyword">output</span> </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;&lt;<span class="keywordtype">xsd:scale</span>&gt;              <span class="keyword">float</span> <span class="keyword">with</span> <span class="keyword">formatted</span> <span class="keyword">output</span> </div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;&lt;<span class="keywordtype">xsd:totalDigits</span>&gt;        <span class="keyword">float</span> <span class="keyword">with</span> <span class="keyword">formatted</span> <span class="keyword">output</span> </div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;&lt;<span class="keywordtype">xsd:fractionDigits</span>&gt;     <span class="keyword">float</span> <span class="keyword">with</span> <span class="keyword">formatted</span> <span class="keyword">output</span> </div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;&lt;<span class="keywordtype">xsd:pattern</span>&gt;            <span class="keyword">regex</span> <span class="keyword">pattern</span>, <span class="keyword">not</span> <span class="keyword">automatically</span> <span class="keyword">validated</span>, <span class="keyword">see</span> <span class="keyword">note</span> <span class="keyword">below</span> </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;&lt;<span class="keywordtype">xsd:union</span>&gt;              <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span>, <span class="keyword">content</span> <span class="keyword">not</span> <span class="keyword">validated</span></div></div><!-- fragment --> </div><p>Also supported are:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:import</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">xsd:include</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;<span class="keywordtype">xsd:redefine</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;<span class="keywordtype">xsd:override</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;<span class="keywordtype">xsd:annotation</span>&gt;</div></div><!-- fragment --> </div><p>A subset of the default type mappings is shown below:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">xsd:string</span>              <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> (<span class="keyword">char</span>* <span class="keyword">or</span> <span class="keyword">std::string</span>)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">xsd:boolean</span>             <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">bool</span> (<span class="keyword">C</span>++) <span class="keyword">or</span> <span class="keyword">enum</span> <span class="keyword">xsd__boolean</span> (<span class="keyword">C</span>) </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">xsd:float</span>               <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">float</span> </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">xsd:double</span>              <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">double</span> </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">xsd:decimal</span>             <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span>, <span class="keyword">or</span> <span class="keyword">use</span> #<span class="keyword">import</span> <span class="stringliteral">&quot;custom/float128.h&quot;</span> </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">xsd:duration</span>            <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span>, <span class="keyword">or</span> <span class="keyword">use</span> #<span class="keyword">import</span> <span class="stringliteral">&quot;custom/duration.h&quot;</span> </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">xsd:dateTime</span>            <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">time_t</span>, <span class="keyword">or</span> <span class="keyword">use</span> #<span class="keyword">import</span> <span class="stringliteral">&quot;custom/struct_tm.h&quot;</span> </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">xsd:time</span>                <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> (<span class="keyword">white</span> <span class="keyword">space</span> <span class="keyword">collapse</span> <span class="keyword">applied</span>)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">xsd:date</span>                <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> (<span class="keyword">white</span> <span class="keyword">space</span> <span class="keyword">collapse</span> <span class="keyword">applied</span>)</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">xsd:gYearMonth</span>          <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> (<span class="keyword">white</span> <span class="keyword">space</span> <span class="keyword">collapse</span> <span class="keyword">applied</span>)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">xsd:gYear</span>               <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> (<span class="keyword">white</span> <span class="keyword">space</span> <span class="keyword">collapse</span> <span class="keyword">applied</span>) </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">xsd:gMonth</span>              <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> (<span class="keyword">white</span> <span class="keyword">space</span> <span class="keyword">collapse</span> <span class="keyword">applied</span>) </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">xsd:hexBinary</span>           <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">struct</span> <span class="keyword">xsd__hexBinary</span> </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">xsd:base64Binary</span>        <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">struct</span> <span class="keyword">xsd__base64Binary</span> </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">xsd:anyURI</span>              <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> (<span class="keyword">white</span> <span class="keyword">space</span> <span class="keyword">collapse</span> <span class="keyword">applied</span>)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">xsd:anyType</span>             <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">an</span> <span class="keyword">XML</span> <span class="keyword">string</span> <span class="keyword">or</span> <span class="keyword">DOM</span> <span class="keyword">with</span> <span class="keyword">wsdl2h</span> -<span class="keyword">d</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">xsd:QName</span>               <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">_QName</span> (<span class="keyword">QName</span> <span class="keyword">normalization</span> <span class="keyword">applied</span>)</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">xsd:NOTATION</span>            <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> (<span class="keyword">white</span> <span class="keyword">space</span> <span class="keyword">collapse</span> <span class="keyword">applied</span>)</div></div><!-- fragment --> </div><p>Automatic validation of <em><code>xsd:pattern</code></em>-restricted content is possible with a hook to a regex pattern matching engine, see the <code><a class="el" href="group__group__callbacks.html#ga6a5e29b860d28f855c8d9a67c096d311" title="Callback to validate strings against XML regex patterns. ">soap::fsvalidate</a></code> and <code><a class="el" href="group__group__callbacks.html#ga1a38366b5b84730713c45ccada84e3ca" title="Callback to validate wide strings against XML regex patterns. ">soap::fwvalidate</a></code> callback documentation in Section <a class="el" href="index.html#callback">Function callbacks for customized I/O and HTTP handling</a> .</p>
<p>User-defined mappings can be added to <em><code>typemap.dat</code></em>, which is used by wsdl2h to map schema types to C/C++ types. For example, the map <em><code>xsd:duration</code></em> to a custom serializer, add this line to <em><code>typemap.dat</code></em>: </p><pre class="fragment">xsd__duration = #import "custom/duration.h" | xsd__duration
</pre><p>Then run wsdl2h with the <em><code>typemap.dat</code></em> file in the current directory or use <a href="#wsdl2h-t"><b><code>wsdl2h -t mapfile.dat</code></b> option <code>-t mapfile.dat</code></a> to use <em><code>mapfile.dat</code></em> instead. This requires compiling <em><code>gsoap/custom/duration.c</code></em> with your build.</p>
<p>Another example is <em><code>xsd:dateTime</code></em> which is mapped to <code>time_t</code>. To expand the range and precision of <em><code>xsd:dateTime</code></em> we can map <em><code>xsd:dateTime</code></em> to <code>struct tm</code>: </p><pre class="fragment">xsd__dateTime = #import "custom/struct_tm.h" | xsd__dateTime
</pre><p>or to <code>struct timeval</code>: </p><pre class="fragment">xsd__dateTime = #import "custom/struct_timeval.h" | xsd__dateTime
</pre><p>This requires compiling <em><code>gsoap/custom/struct_tm.c</code></em> or <em><code>gsoap/custom/struct_timeval.c</code></em>, respectively.</p>
<p>Non-primitive XSD types are supported, with the default mapping shown below:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">xsd:normalizedString</span>    <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">xsd:token</span>               <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">xsd:language</span>            <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">xsd:IDREFS</span>              <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">xsd:ENTITIES</span>            <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">xsd:NMTOKEN</span>             <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">xsd:NMTOKENS</span>            <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">xsd:Name</span>                <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">xsd:NCName</span>              <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">xsd:ID</span>                  <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">xsd:IDREF</span>               <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">xsd:ENTITY</span>              <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">xsd:integer</span>             <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span> </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">xsd:nonPositiveInteger</span>  <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">xsd:negativeInteger</span>     <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">xsd:long</span>                <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">LONG64</span> </div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">xsd:int</span>                 <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">int</span> </div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">xsd:short</span>               <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">short</span> </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">xsd:byte</span>                <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">byte</span> </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">xsd:nonNegativeInteger</span>  <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">xsd:unsignedLong</span>        <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">ULONG64</span> </div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">xsd:unsignedInt</span>         <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> </div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">xsd:unsignedShort</span>       <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">unsigned</span> <span class="keyword">short</span> </div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">xsd:unsignedByte</span>        <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">unsigned</span> <span class="keyword">byte</span> </div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">xsd:positiveInteger</span>     <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">xsd:yearMonthDuration</span>   <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">xsd:dayTimeDuration</span>     <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">xsd:dateTimeStamp</span>       <span class="keyword">maps</span> <span class="keyword">to</span> <span class="keyword">string</span></div></div><!-- fragment --> </div><p>String targets are defined in the <em><code>typemap.dat</code></em> file used by wsdl2h to map XSD types. This allows the use of <code>char*</code> and <code>std::string</code>. It is possible to map any string types to <code>wchar_t</code> and <code>std::wstring</code> by adding the following line to <em><code>typemap.dat</code></em>: </p><pre class="fragment">xsd__string = | wchar_t* | wchar_t*
</pre><p>and </p><pre class="fragment">xsd__string = | std::wstring
</pre><p>By default strings are either <code>char*</code> (for C) or <code>std::string</code> (for C++) which contain ASCII or UTF-8 content enabled with the runtime flag <code><a class="el" href="group__group__flags.html#ga9006d22d0abc39831dfe3ce1e491ce6f" title="soap_mode C-related input/output flag value to serialize and deserialize 8-bit C/C++ strings containi...">SOAP_C_UTFSTRING</a></code>.</p>
<p>Note that the XSD types for unlimited numeric values such as <em><code>xsd:integer</code></em> and <em><code>xsd:decimal</code></em> are mapped to strings, to preserve the value in case it is too large to store in a 64-bit integer or float. The mapping can be redefined as follows in <em><code>typemap.dat</code></em>: </p><pre class="fragment">xsd__decimal            = | double
xsd__integer            = | LONG64
xsd__nonNegativeInteger = typedef xsd__integer xsd__nonNegativeInteger 0 :   ; | xsd__nonNegativeInteger
xsd__nonPositiveInteger = typedef xsd__integer xsd__nonPositiveInteger   : 0 ; | xsd__nonPositiveInteger
xsd__positiveInteger    = typedef xsd__integer xsd__positiveInteger    1 :   ; | xsd__positiveInteger
xsd__negativeInteger    = typedef xsd__integer xsd__negativeInteger      : -1; | xsd__negativeInteger
</pre><p>We can also use a <code>quadmath.h</code> 128 bit float to store <em><code>xsd:decimal</code></em>: </p><pre class="fragment">xsd__decimal = #import "custom/float128.h" | xsd__decimal
</pre><p>where <code>xsd__decimal</code> is a <code>__float128</code> <code>quadmath.h</code> type.</p>
<p>There are several initialization flags to control XML serialization at run-time:</p>
<ul>
<li>XML validation is more strictly enforced with <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code>.</li>
<li>XML namespaces are enforced when parsing XML, unless disabled with <code><a class="el" href="group__group__flags.html#ga8b2d0f16b4872a26c28f36243c4ea6a9" title="soap_mode XML input flag value to ignore XML namespaces in messages received ">SOAP_XML_IGNORENS</a></code>.</li>
<li>XML exclusive canonicalization is enabled with <code><a class="el" href="group__group__flags.html#ga757fa32433be64f8c228b1ecce727815" title="soap_mode XML output flag value to send XML messages in exclusive canonical format as per W3C XML C14...">SOAP_XML_CANONICAL</a></code>.</li>
<li>XML default <code>xmlns="..."</code> namespace bindings are enforced with <code><a class="el" href="group__group__flags.html#gaabf4437aeb9a8ae91bfbc3cdce538a6b" title="soap_mode XML output flag value to send XML messages with XML default namespaces for elements instead...">SOAP_XML_DEFAULTNS</a></code>.</li>
<li>XML is indented for enhanced readability with <code><a class="el" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69" title="soap_mode XML output flag value to enable XML (and JSON) message indentation in messages sent ...">SOAP_XML_INDENT</a></code>.</li>
<li>XML <em><code>xsi:nil</code></em> for NULL struct and class members are serialized with <code><a class="el" href="group__group__flags.html#ga4954f2e4d1f7a42a8502e91e6d7988bb" title="soap_mode XML output flag value to serialize C/C++ NULL pointers in XML as elements with attribute xs...">SOAP_XML_NIL</a></code>.</li>
<li>UTF-8 is stored in <code>char*</code> and <code>std::string</code> with <code><a class="el" href="group__group__flags.html#ga9006d22d0abc39831dfe3ce1e491ce6f" title="soap_mode C-related input/output flag value to serialize and deserialize 8-bit C/C++ strings containi...">SOAP_C_UTFSTRING</a></code>.</li>
</ul>
<p>Strict validation catches all structural XML validation violations. For primitive type values it depends on the C/C++ target type that XSD types are mapped to, to catch primitive value content pattern violations. Primitive value content validation is performed on non-string types such as numerical and time values. String values are not automatically validated, unless a <em><code>xsd:pattern</code></em> is given and the <code><a class="el" href="group__group__callbacks.html#ga6a5e29b860d28f855c8d9a67c096d311" title="Callback to validate strings against XML regex patterns. ">soap::fsvalidate</a></code> and <code><a class="el" href="group__group__callbacks.html#ga1a38366b5b84730713c45ccada84e3ca" title="Callback to validate wide strings against XML regex patterns. ">soap::fwvalidate</a></code> callbacks are implemented by the user. Alternatively, deserialized string content can be checked at the application level.</p>
<p>To obtain C or C++ type definitions for XML schema components, run wsdl2h on the schemas to generate a data binding interface header file. This header file defines the C/C++ type representations of the XML schema components. The header file is then processed by the soapcpp2 tool to generate the serializers for these types. See Section <a class="el" href="index.html#databindings">Introduction to XML data bindings</a> for an overview to use wsdl2h and soapcpp2 to map schemas to C/C++ types to obtain XML data bindings.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2mapping"></a>
Mapping C/C++ to XML schema with soapcpp2</h3>
<p>To generate serialization code, execute: </p><pre class="fragment"> soapcpp2 [options] file.h
</pre><p>The following C/C++ types are supported in the data binding interface header file:</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> </div><div class="line"><span class="keyword">enum</span>, <span class="keyword">enum</span> * (<span class="keyword">enum</span> * is a <span class="stringliteral">&quot;product enumeration&quot;</span> representing a bitmask) </div><div class="line">(<span class="keywordtype">signed</span> or <span class="keywordtype">unsigned</span>) char, int8_t, short, int16_t, int, int32_t, long, <span class="keywordtype">long</span> long, int64_t, <a class="code" href="group__group__soap.html#ga78b36c5636eb5283d651b69d8684c6ae">LONG64</a></div><div class="line">size_t (<span class="keyword">transient</span>, not serializable)</div><div class="line">float, double, <span class="keywordtype">long</span> double (#<span class="keyword">import</span> <span class="stringliteral">&quot;custom/long_double.h&quot;</span>) </div><div class="line">std::<span class="keywordtype">string</span>, std::wstring, <span class="keywordtype">char</span>[], <span class="keywordtype">char</span>*, <span class="keywordtype">wchar_t</span>* </div><div class="line"><a class="code" href="group__group__fault.html#ga5c62d26b4823b76c5b4ef29e7865d3f0">_XML</a> (a <span class="keywordtype">char</span>* type to hold literal XML <span class="keywordtype">string</span> content) </div><div class="line"><a class="code" href="group__group__fault.html#gaa178a46d0cf703ff226a5c148483286d">_QName</a> (a <span class="keywordtype">char</span>* type with normalized QName content of the form prefix:name) </div><div class="line">struct, class (with single inheritance) </div><div class="line">std::vector, std::list, std::deque, std::set</div><div class="line">union (requires preceding discriminant member) </div><div class="line">typedef </div><div class="line">time_t </div><div class="line">template &lt;&gt; class (containers require begin(), end(), size(), and insert() methods)  </div><div class="line"><span class="keywordtype">void</span>* (requires a preceding __type member to indicate the <span class="keywordtype">object</span> pointed to) </div><div class="line">struct <a class="code" href="structxsd____hex_binary.html">xsd__hexBinary</a> (special pre-defined type to hold binary content) </div><div class="line">struct <a class="code" href="structxsd____base64_binary.html">xsd__base64Binary</a> (special pre-defined type to hold binary content) </div><div class="line">struct tm (<span class="preprocessor">#import &quot;custom/struct_tm.h&quot;) </span></div><div class="line"><span class="keyword">struct </span>timeval (#import &quot;custom/struct_timeval.h&quot;) </div><div class="line">pointers to any of the above (any pointer-linked structures are serializable, including cyclic graphs) </div><div class="line">std::shared_ptr, std::unique_ptr, std::auto_ptr</div><div class="line">fixed-size arrays of all of the above</div></div><!-- fragment --><p>Additional features and C/C++ syntax requirements:</p>
<ul>
<li>A header file should not include any code statements, only data type declarations.</li>
<li>Nested structs, classes, and unions are un-nested.</li>
<li>Use <code>#import "file.h"</code> instead of <code>#include</code> to import other header files. The <code>#include</code> and <code>#define</code> directives are fine to use, but these are moved into the generated code and then used by the C/C++ compiler.</li>
<li>C++ namespaces are supported, but must cover the entire header file content.</li>
<li>Optional DOM support can be used to store mixed content or literal XML content can be stored in <code>_XML</code> strings. Otherwise, mixed content may be lost. Use <b><code>soapcpp2 -d</code></b> option <b><code>-d</code></b> for DOM support. See the <a href="../../dom/html/index.html">XML DOM API</a> documentation for details.</li>
<li>Types are denoted transient using the <code>extern</code> qualifier, which prevents serialization of types or struct and class members: <div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="keyword">class </span>classname; <span class="comment">// this class is not serializable </span></div><div class="line"><span class="keyword">struct </span>structname</div><div class="line">{</div><div class="line">    <span class="keyword">extern</span> <span class="keywordtype">char</span> *name; <span class="comment">// this member is not serializable</span></div><div class="line">    <span class="keywordtype">int</span> num;</div><div class="line">};</div></div><!-- fragment --></li>
<li>Only public members of a class can be serialized: <div class="fragment"><div class="line"><span class="keyword">class </span>name</div><div class="line">{ <span class="keyword">private</span>:</div><div class="line">    <span class="keywordtype">char</span> *secret; <span class="comment">// private and protected members are not serializable</span></div><div class="line">};</div></div><!-- fragment --> and members are public by default in the interface header file for soapcpp2.</li>
<li>Types may be declared <code>volatile</code> which means that they are declared elsewhere in the project's source code base and should not be redefined in the soapcpp2-generated code nor changed by the soapcpp2 tool, for example this makes <code>struct tm</code> of <code>time.h</code> serializable with a selection of its members specified, where <code>volatile</code> prevents soapcpp2 from declaring this struct again: <div class="fragment"><div class="line"><span class="keyword">volatile</span> <span class="keyword">struct </span>tm</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> tm_sec;  </div><div class="line">    <span class="keywordtype">int</span> tm_min;  </div><div class="line">    <span class="keywordtype">int</span> tm_hour; </div><div class="line">    <span class="keywordtype">int</span> tm_mday; </div><div class="line">    <span class="keywordtype">int</span> tm_mon;  </div><div class="line">    <span class="keywordtype">int</span> tm_year; </div><div class="line">};</div></div><!-- fragment --></li>
<li>Classes and structs may be declared <code>mutable</code> means that they can be augmented with additional members using redefinitions of the struct or class: <div class="fragment"><div class="line"><span class="keyword">mutable</span> <span class="keyword">class </span>classname</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">int</span> n; <span class="comment">// classname has a member &#39;n&#39; </span></div><div class="line">};</div><div class="line"><span class="keyword">mutable</span> <span class="keyword">class </span>name</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">float</span> x; <span class="comment">// classname also has a member &#39;x&#39;</span></div><div class="line">};</div></div><!-- fragment --> The <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> struct is mutable as well as the <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html" title="SOAP Fault structure. ">SOAP_ENV__Fault</a></code>, <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code>, <code><a class="el" href="struct_s_o_a_p___e_n_v_____reason.html" title="SOAP Fault Reason structure generated by soapcpp2. ">SOAP_ENV__Reason</a></code>, and <code><a class="el" href="struct_s_o_a_p___e_n_v_____code.html" title="SOAP Fault Code structure. ">SOAP_ENV__Code</a></code> structs. The reason is that these structures are augmented with additional members by plugins such as WS-Addressing <em><code>gsoap/plugin/wsaapi.h</code></em> to support these SOAP-based protocols.</li>
<li>Members of a struct or class are serialized as XML attributes when qualified with '@', for example: <div class="fragment"><div class="line"><span class="keyword">struct </span>record</div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> *name; <span class="comment">// XML attribute name</span></div><div class="line">    <span class="keywordtype">int</span> num;    <span class="comment">// XML element num</span></div><div class="line">};</div></div><!-- fragment --></li>
<li>Strings with 8-bit content hold ASCII by default or hold UTF-8 when enabled with runtime flag <code><a class="el" href="group__group__flags.html#ga9006d22d0abc39831dfe3ce1e491ce6f" title="soap_mode C-related input/output flag value to serialize and deserialize 8-bit C/C++ strings containi...">SOAP_C_UTFSTRING</a></code>. When enabled, all <code>std::string</code> and <code>char*</code> strings contain UTF-8. In this way the deserializers populate strings with UTF-8 content and serializers will output strings as holding UTF-8 content.</li>
</ul>
<p>The soapcpp2 tool generates serializers and deserializers for all wsdl2h-generated or user-defined data structures that are specified in the header file input to the soapcpp2 tool. The serializers and deserializers can be found in the soapcpp2-generated <em><code>soapC.cpp</code></em> file. These serializers and deserializers can be used separately by an application without the need to build a Web services client or service application. This is useful for applications that need to save or export their data in XML or need to import or load data stored in XML format.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="serialize"></a>
Serializing C/C++ data to XML</h3>
<p>The soapcpp2 tool generates the following readers and writers for each serializable data type defined in the data bindings interface file input to soapcpp2:</p>
<ul>
<li><code>int soap_read_T(struct soap*, T *data)</code> parse XML and deserialize into C/C++ data of type <code>T</code>, returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> on success.</li>
<li><code>int soap_write_T(struct soap* T *data)</code> serialize C/C++ data of type <code>T</code> into XML, returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> on success.</li>
</ul>
<p>Where <code>T</code> is the name of the data type, such as the struct or class name. For other types, see the table further below for the naming conventions used by soapcpp2 to generate these functions.</p>
<p>The following <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context variables control the destination and source for XML serialization and deserialization:</p>
<ul>
<li><code>SOAP_SOCKET <a class="el" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046" title="The socket set by soap_accept (or the C++ service class accept method) or soap_connect or soap_connec...">soap::socket</a></code> socket file descriptor for socket connection input and output (or <code><a class="el" href="group__group__soap.html#gab9e77b1557780293eec0b269ef191472" title="Macro that defines a portable invalid socket value (usually -1, but the value depends on the OS) ...">SOAP_INVALID_SOCKET</a></code> when not set).</li>
<li><code>ostream *<a class="el" href="structsoap.html#a27b166e404c7c98cfa45d6d7a5da90c0" title="The sink to write data to when non-NULL, which in C++ is a std::ostream object and in C is a pointer ...">soap::os</a></code> C++ only: output stream used for send operations when non-NULL.</li>
<li><code>const char **<a class="el" href="structsoap.html#a27b166e404c7c98cfa45d6d7a5da90c0" title="The sink to write data to when non-NULL, which in C++ is a std::ostream object and in C is a pointer ...">soap::os</a></code> C only: points to a string pointer to be set with the string content produced, the saved string is allocated and managed by the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context.</li>
<li><code>istream *<a class="el" href="structsoap.html#a285e8a3584ffb1cea07a700c951e436d" title="The source to read data from when non-NULL, which in C++ is a std::istream object and in C is a 0-ter...">soap::is</a></code> C++ only: input stream used for receive operations when non-NULL.</li>
<li><code>const char *<a class="el" href="structsoap.html#a285e8a3584ffb1cea07a700c951e436d" title="The source to read data from when non-NULL, which in C++ is a std::istream object and in C is a 0-ter...">soap::is</a></code> C only: string with input to parse, this pointer advances over the string until a <code>\0</code> is found.</li>
<li><code>int <a class="el" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9" title="The file descriptor to write data to when no socket communications are set (soap::socket == SOAP_INVA...">soap::sendfd</a></code> when <code><a class="el" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046" title="The socket set by soap_accept (or the C++ service class accept method) or soap_connect or soap_connec...">soap::socket</a></code> = <code><a class="el" href="group__group__soap.html#gab9e77b1557780293eec0b269ef191472" title="Macro that defines a portable invalid socket value (usually -1, but the value depends on the OS) ...">SOAP_INVALID_SOCKET</a></code>, this fd is used for send operations, default fd is 1 (stdout).</li>
<li><code>int <a class="el" href="structsoap.html#a192c25cc206668600212fd34f6541f34" title="The file descriptor to read data from when no socket communications are set (soap::socket == SOAP_INV...">soap::recvfd</a></code> when <code><a class="el" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046" title="The socket set by soap_accept (or the C++ service class accept method) or soap_connect or soap_connec...">soap::socket</a></code> = <code><a class="el" href="group__group__soap.html#gab9e77b1557780293eec0b269ef191472" title="Macro that defines a portable invalid socket value (usually -1, but the value depends on the OS) ...">SOAP_INVALID_SOCKET</a></code>, this fd is used for receive operations, default fd is 0 (stdin).</li>
</ul>
<p>Additional functions are generated by soapcpp2 for each serializable data type <code>T</code> to dynamically allocate data of type <code>T</code> on the context-managed heap and to initialize data of type <code>T</code>:</p>
<ul>
<li><code>T * soap_new_T(struct soap*)</code> allocates and initializes data of type <code>T</code> in context-managed heap memory, managed data is deleted with <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code> (deletes C++ objects) and <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> (deletes all other data), and you can also use <code><a class="el" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c" title="Allocate a block of heap memory managed by the specified soap context. ">soap_malloc</a></code> to allocate uninitialized context-managed memory.</li>
<li><code>void soap_default_T(struct soap*, T*)</code> initializes data of type <code>T</code>, but C++ classes are augmented with a <code>soap_default(struct soap*)</code> method that should be called instead to (re)initialize the class instance. If the class has a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context pointer member then this member will be set to the first argument passed to this function.</li>
</ul>
<p>The following extra functions are generated by soapcpp2 for deep copying and deletion of entire data structures when using <b><code>soapcpp2 -Ecd</code></b> options <b><code>-Ec</code></b> (deep copy) and <b><code>-Ed</code></b> (deep deletion):</p>
<ul>
<li><code>T * soap_dup_T(struct soap*, T *dst, const T *src)</code> deep copy <code>src</code> into <code>dst</code>, replicating all deep cycles and shared pointers when a managing <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context is provided. When <code>dst</code> is NULL, allocates space for <code>dst</code> and returns a pointer to the allocated copy. Deep copy results in a tree when the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context is NULL, but the presence of deep cycles will lead to non-termination. Use flag <code>SOAP_XML_TREE</code> with managing context to copy into a tree without cycles and pointers to shared objects. Returns <code>dst</code> or the allocated copy when <code>dst</code> is NULL.</li>
<li><code>void soap_del_T(const T*)</code> deletes all heap-allocated members of this object by deep deletion ONLY IF this object and all of its (deep) members are not managed by a soap context AND the deep structure is a tree (no cycles and co-referenced objects by way of multiple (non-smart) pointers pointing to the same data). Can be safely used after <code>soap_dup(NULL)</code> to delete the deep copy. Does not delete the object itself.</li>
</ul>
<p>The following initializing and finalizing functions should be used before and after calling lower-level IO functions such as <code><a class="el" href="group__group__io.html#ga7712f5bc36127050a11ad995d0593bdc" title="Send a string. ">soap_send</a></code>, <code><a class="el" href="group__group__io.html#gab3b1ba631a0c47d67fe31474982bde86" title="Send raw bytes. ">soap_send_raw</a></code>, <code><a class="el" href="group__group__io.html#gac5cd5455317210135c78a04c45ed8f55" title="Get next byte without consuming it. ">soap_get0</a></code>, <code><a class="el" href="group__group__io.html#gaf9fb9f0468ed93132119bcf600b3b0a6" title="Get next byte. ">soap_get1</a></code>, and <code><a class="el" href="group__group__io.html#gae2cd37f875d3314eec314b8723e2ffd8" title="Get the HTTP body message as a string. ">soap_http_get_body</a></code> (this is not needed when calling the <code>soap_read_T</code> and <code>soap_write_T</code> functions):</p>
<ul>
<li><code>int <a class="el" href="group__group__io.html#ga9c251be717c7c4044dac7a79ecd6163a" title="Initialize the context for sending. ">soap_begin_send(struct soap*)</a></code> start a sending phase.</li>
<li><code>int <a class="el" href="group__group__io.html#ga290ddb46afdbf5ec6669b6ac8daca5c9" title="Finalize the context after sending. ">soap_end_send(struct soap*)</a></code> flush the send buffer.</li>
<li><code>int <a class="el" href="group__group__io.html#gaf4ce538944f65ac97d82bfeaa9345c42" title="Initialize the context for receiving. ">soap_begin_recv(struct soap*)</a></code> start a receiving phase, if an HTTP header is present, parse it first.</li>
<li><code>int <a class="el" href="group__group__io.html#ga86b0c04e8baa911fc57e7f1220f9eb8f" title="Finalize the context after receiving. ">soap_end_recv(struct soap*)</a></code> finalize receiving, read attachments if any, perform SOAP id/href consistency check on deserialized data.</li>
</ul>
<p>These operations do not setup or open or close files or connections. The application should open and close connections or files and set the <code><a class="el" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046" title="The socket set by soap_accept (or the C++ service class accept method) or soap_connect or soap_connec...">soap::socket</a></code>, <code><a class="el" href="structsoap.html#a27b166e404c7c98cfa45d6d7a5da90c0" title="The sink to write data to when non-NULL, which in C++ is a std::ostream object and in C is a pointer ...">soap::os</a></code> or <code><a class="el" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9" title="The file descriptor to write data to when no socket communications are set (soap::socket == SOAP_INVA...">soap::sendfd</a></code>, <code><a class="el" href="structsoap.html#a285e8a3584ffb1cea07a700c951e436d" title="The source to read data from when non-NULL, which in C++ is a std::istream object and in C is a 0-ter...">soap::is</a></code> or <code><a class="el" href="structsoap.html#a192c25cc206668600212fd34f6541f34" title="The file descriptor to read data from when no socket communications are set (soap::socket == SOAP_INV...">soap::recvfd</a></code> streams or descriptors. When <code><a class="el" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046" title="The socket set by soap_accept (or the C++ service class accept method) or soap_connect or soap_connec...">soap::socket</a></code> is <code><a class="el" href="group__group__soap.html#gab9e77b1557780293eec0b269ef191472" title="Macro that defines a portable invalid socket value (usually -1, but the value depends on the OS) ...">SOAP_INVALID_SOCKET</a></code> and none of the streams and descriptors are set, then the standard input and output will be used.</p>
<p>The following options are available to control serialization:</p>
<div class="fragment"><div class="line"><a class="code" href="group__group__context.html#ga84f52a67a41009b260ff2c036df7f6ab">soap_set_mode</a>(soap, <a class="code" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493">SOAP_XML_TREE</a>);                 <span class="comment">// use this for XML without id-ref (no cycles!)</span></div><div class="line"><a class="code" href="group__group__context.html#ga84f52a67a41009b260ff2c036df7f6ab">soap_set_mode</a>(soap, <a class="code" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645">SOAP_XML_GRAPH</a>);                <span class="comment">// or use this for XML with id-ref (including cycles)</span></div><div class="line"><a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, <span class="keyword">struct</span> <a class="code" href="struct_namespace.html">Namespace</a> *nsmap); <span class="comment">// set a XML namespace table with xmlns bindings</span></div></div><!-- fragment --><p>See also Section <a class="el" href="index.html#flags">Run-time flags</a> to control the I/O buffering and content encoding such as compression.</p>
<p>To accurately and safely serialize data structures with cycles and co-referenced objects to an XML stream, two generated functions are called by <code>soap_write_T</code> to serialize data of type <code>T</code>: <code>soap_serialize_T</code> to perform a deep analysis of pointers to detect co-referenced data and cycles, and <code>soap_put_T</code> to output the data in XML with id-href (or id-ref) attributes for co-referenced data and cycles. Multi-references with id-href (and id-ref) are part of the SOAP protocol to serialize data accurately, i.e. retaining the structural integrity of the data sent and received. Flag <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> turns id-href (id-ref) attributes off (makes <code>soap_serialize_T</code> a no-op and ignores them on the receiving end). Flag <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> should be used with non-SOAP XML output to accurately and safely serialize data structure graphs with co-referenced objects and cycles.</p>
<p>The <code>soap_serialize_T</code> and <code>soap_put_T</code> calls are performed by the generated <code>soap_write_T</code> functions, which also call <code><a class="el" href="group__group__io.html#ga9c251be717c7c4044dac7a79ecd6163a" title="Initialize the context for sending. ">soap_begin_send</a></code> and <code><a class="el" href="group__group__io.html#ga290ddb46afdbf5ec6669b6ac8daca5c9" title="Finalize the context after sending. ">soap_end_send</a></code>.</p>
<p>The following table lists the type naming conventions used by soapcpp2 to generate functions:</p>
<table class="doxtable">
<tr>
<th>type </th><th>name  </th></tr>
<tr>
<td><code>char*</code> </td><td><code>string</code> </td></tr>
<tr>
<td><code>wchar_t*</code> </td><td><code>wstring</code> </td></tr>
<tr>
<td><code>std::string</code> </td><td><code>std__string</code> </td></tr>
<tr>
<td><code>std::wstring</code> </td><td><code>std__wstring</code> </td></tr>
<tr>
<td><code>char</code> </td><td><code>byte</code> </td></tr>
<tr>
<td><code>bool</code> </td><td><code>bool</code> </td></tr>
<tr>
<td><code>double</code> </td><td><code>double</code> </td></tr>
<tr>
<td><code>int</code> </td><td><code>int</code> </td></tr>
<tr>
<td><code>float</code> </td><td><code>float</code> </td></tr>
<tr>
<td><code>long</code> </td><td><code>long</code> </td></tr>
<tr>
<td><code>long long</code> </td><td><code>LONG64</code> </td></tr>
<tr>
<td><code>short</code> </td><td><code>short</code> </td></tr>
<tr>
<td><code>time_t</code> </td><td><code>time</code> </td></tr>
<tr>
<td><code>unsigned char</code> </td><td><code>unsignedByte</code> </td></tr>
<tr>
<td><code>unsigned int</code> </td><td><code>unsignedInt</code> </td></tr>
<tr>
<td><code>unsigned long</code> </td><td><code>unsignedLong</code> </td></tr>
<tr>
<td><code>unsigned long long</code> </td><td><code>ULONG64</code> </td></tr>
<tr>
<td><code>unsigned short</code> </td><td><code>unsignedShort</code> </td></tr>
<tr>
<td><code>T</code>[N] </td><td><code>ArrayN</code>OfType where Type is the type name of T </td></tr>
<tr>
<td><code>T*</code> </td><td><code>PointerToType</code> where Type is the type name of T </td></tr>
<tr>
<td><code>std::vector&lt;T&gt;</code> </td><td><code>TemplateOfType</code> where Type is the type name of T </td></tr>
<tr>
<td><code>struct Name</code> </td><td><code>Name</code> </td></tr>
<tr>
<td><code>class Name</code> </td><td><code>Name</code> </td></tr>
<tr>
<td><code>enum Name</code> </td><td><code>Name</code> </td></tr>
</table>
<p>Consider for example the following interface header file for soapcpp2 declares a <code>struct ns__Person</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__Person</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name;</div><div class="line">};</div></div><!-- fragment --><p>To parse and deserialize a person variable <code>p</code> from XML:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line"><span class="keyword">struct </span>ns__Person *p = soap_new_ns__Person(soap, -1); <span class="comment">// -1 is one (non-array)</span></div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a> = 0;       <span class="comment">// parse from stdout</span></div><div class="line"><span class="comment">// soap-&gt;is = &amp;std::in; // parse from stdin stream (C++ only)</span></div><div class="line"><span class="comment">// soap-&gt;is = cs;       // parse from a char *cs string (C only)</span></div><div class="line"><span class="keywordflow">if</span> (soap_read_ns__Person(soap, p))</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">... <span class="comment">// use value p</span></div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div></div><!-- fragment --><p>To parse and deserialize XML from a file:</p>
<div class="fragment"><div class="line">soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a> = open(file, O_RDONLY); </div><div class="line"><span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a> &gt;= 0)</div><div class="line">  <span class="keywordflow">if</span> (soap_read_ns__Person(soap, p))</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">close(soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a>);</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a> = 0;</div></div><!-- fragment --><p>To parse and deserialize XML from a C++ file stream:</p>
<div class="fragment"><div class="line">std::fstream fs;</div><div class="line">fs.open(file, std::ios::in);</div><div class="line"><span class="keywordflow">if</span> (fs)</div><div class="line">{</div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a285e8a3584ffb1cea07a700c951e436d">is</a> = &amp;fs;</div><div class="line">  <span class="keywordflow">if</span> (soap_read_ns__Person(soap, p))</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">  fd.close();</div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a285e8a3584ffb1cea07a700c951e436d">is</a> = NULL;</div><div class="line">}</div></div><!-- fragment --><p>Or to parse and deserialize XML from a string stream in C++:</p>
<div class="fragment"><div class="line">std::stringstream ss;</div><div class="line">... <span class="comment">// populate stream ss</span></div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a285e8a3584ffb1cea07a700c951e436d">is</a> = &amp;ss;</div><div class="line"><span class="keywordflow">if</span> (soap_read_ns__Person(soap, p))</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a285e8a3584ffb1cea07a700c951e436d">is</a> = NULL;</div></div><!-- fragment --><p>To parse and deserialize XML from a string <code>cs</code> in C:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *cs = <span class="stringliteral">&quot;...&quot;</span>; <span class="comment">// populate string cs</span></div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a285e8a3584ffb1cea07a700c951e436d">is</a> = &amp;cs;</div><div class="line"><span class="keywordflow">if</span> (soap_read_ns__Person(soap, p))</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a285e8a3584ffb1cea07a700c951e436d">is</a> = NULL;</div></div><!-- fragment --><p>To serialize a person variable <code>p</code> in XML:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69">SOAP_XML_INDENT</a>);</div><div class="line"><span class="keyword">struct </span>ns__Person *p = soap_new_ns__Person(soap, -1); <span class="comment">// -1 is one (non-array)</span></div><div class="line">p-&gt;name = <span class="stringliteral">&quot;Joe&quot;</span>;</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9">sendfd</a> = 1;         <span class="comment">// send to stdout</span></div><div class="line"><span class="comment">// soap-&gt;os = &amp;std::cout; // send to stdout stream (C++ only)</span></div><div class="line"><span class="comment">// soap-&gt;os = &amp;cs;        // send to a char *cs string (C only)</span></div><div class="line"><span class="keywordflow">if</span> (soap_write_ns__Person(soap, p))</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div></div><!-- fragment --><p>This produces:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:Person</span> <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;...&quot;</span> ... &gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">Joe</span>&lt;/<span class="keywordtype">name</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">ns:Person</span>&gt;</div></div><!-- fragment --> </div><p>To send the output to a file:</p>
<div class="fragment"><div class="line">soap-&gt;<a class="code" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9">sendfd</a> = open(file, O_RDWR|O_CREAT, S_IWUSR|S_IRUSR); </div><div class="line"><span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9">sendfd</a> &gt;= 0)</div><div class="line">  <span class="keywordflow">if</span> (soap_write_ns__Person(soap, p))</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">close(soap-&gt;<a class="code" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9">sendfd</a>);</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9">sendfd</a> = 1;</div></div><!-- fragment --><p>To send the output to a C++ file stream:</p>
<div class="fragment"><div class="line">std::fstream fs;</div><div class="line">fs.open(file, std::ios::out);</div><div class="line"><span class="keywordflow">if</span> (fs)</div><div class="line">{</div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a27b166e404c7c98cfa45d6d7a5da90c0">os</a> = &amp;fs;</div><div class="line">  <span class="keywordflow">if</span> (soap_write_ns__Person(soap, p))</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">  fd.close();</div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a27b166e404c7c98cfa45d6d7a5da90c0">os</a> = NULL;</div><div class="line">}</div></div><!-- fragment --><p>Or send the output to a C++ string stream to save XML in a string:</p>
<div class="fragment"><div class="line">std::stringstream ss;</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a27b166e404c7c98cfa45d6d7a5da90c0">os</a> = &amp;ss;</div><div class="line"><span class="keywordflow">if</span> (soap_write_ns__Person(soap, p))</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">std::strings s = ss.str();</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a27b166e404c7c98cfa45d6d7a5da90c0">os</a> = NULL;</div></div><!-- fragment --><p>To save the output to a string <code>cs</code> in C:</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> *cs;</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a27b166e404c7c98cfa45d6d7a5da90c0">os</a> = &amp;cs;</div><div class="line"><span class="keywordflow">if</span> (soap_write_ns__Person(soap, p))</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a27b166e404c7c98cfa45d6d7a5da90c0">os</a> = NULL;</div></div><!-- fragment --><p>The string <code>cs</code> is populated with XML when successful. This string is managed by the context and deleted with <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code>.</p>
<p>As we explained, the <code>soap_write_T</code> functions call <code>soap_serialize_T</code>, which must be called when the data structure graph to serialize contains co-referenced data and cycles. It must be called to preserve the logical coherence of pointer-based data structures, where pointers may refer to co-referenced objects. By calling <code>soap_serialize_T</code>, data structures shared through pointers are serialized only once and referenced in XML using id-refs attributes. The actual id-refs used depend on the SOAP encoding. To turn off SOAP encoding, remove or avoid using the SOAP-ENV and SOAP-ENC namespace bindings in the namespace table. In addition, the <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> and <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> flags can be used to control the output by restricting serialization to XML trees or by enabling multi-ref graph serialization with id-ref attributes.</p>
<p>To save the data as an XML tree (with one root) without any id-ref attributes, use the <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> flag. The data structure must not contain pointer-based cycles. This flag also instructs the XML parser and deserializer to ignore id-ref attributes.</p>
<p>To preserve the exact structure of the data object graph and create XML with one root, use the <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> output-mode flag (see Section <a class="el" href="index.html#flags">Run-time flags</a> ). Using the <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> flag assures the preservation of the logical structure of the data.</p>
<p>Using <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> means that no id-refs are output or parsed. With this flag the output will serialize nodes as a tree in XML, which means that nodes may be duplicated when shared by multiple pointers and cycles are broken to prevent infinite serialization. To preserve the graph structure of the nodes in the data structure, use <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> or use SOAP 1.1 or 1.2 multi-reference serialization (this is the default mode with SOAP serialization).</p>
<p>Consider for example the following <code>struct</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Tricky</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *p; </div><div class="line">    <span class="keywordtype">int</span> n; </div><div class="line">    <span class="keywordtype">int</span> *q; </div><div class="line">};</div></div><!-- fragment --><p>The following fragment initializes the pointer members <code>p</code> and <code>q</code> to point to the value of member <code>n</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line"><span class="keyword">struct </span>Tricky X; </div><div class="line">X.n = 123; </div><div class="line">X.p = &amp;X.n; </div><div class="line">X.q = &amp;X.n; </div><div class="line">soap_write_Tricky(soap, &amp;X);</div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div></div><!-- fragment --><p>What is special about this data structure is that members <code>p</code> and <code>q</code> both point to member <code>n</code>. When using SOAP 1.1 with gSOAP, the serializers strategically place id elements (also called SOAP 1.1 independent elements) after the root element to identify shared values, where the href attributes of elements <em><code>p</code></em> and <em><code>q</code></em> point to:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">Tricky</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">p</span> <span class="keyword">href</span>=<span class="stringliteral">&quot;#_1&quot;</span>/&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">n</span>&gt;1&lt;/<span class="keywordtype">n</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;<span class="keywordtype">q</span> <span class="keyword">href</span>=<span class="stringliteral">&quot;#_1&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">Tricky</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;<span class="keywordtype">id</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;_1&quot;</span>&gt;123&lt;/<span class="keywordtype">id</span>&gt;</div></div><!-- fragment --> </div><p>The above is not valid as plain XML, because there is no single root element, but it is valid XML when placed in a SOAP Body element as intended with SOAP 1.1 messaging.</p>
<p>When SOAP 1.2 is used with gSOAP, the output is more accurate, because now both elements <em><code>p</code></em> and <em><code>q</code></em> point to element <em><code>n</code></em>:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">Tricky</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">p</span> <span class="keyword">SOAP-ENC:ref</span>=<span class="stringliteral">&quot;_1&quot;</span>/&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">n</span> <span class="keyword">SOAP-ENC:id</span>=<span class="stringliteral">&quot;_1&quot;</span>&gt;123&lt;/<span class="keywordtype">n</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;<span class="keywordtype">q</span> <span class="keyword">SOAP-ENC:ref</span>=<span class="stringliteral">&quot;_1&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">ns:Tricky</span>&gt;</div></div><!-- fragment --> </div><p>Without using SOAP encoding but using plain XML instead with the <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> flag set, the output is also accurate with both elements <em><code>p</code></em> and <em><code>q</code></em> pointing to element <em><code>n</code></em>:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">Tricky</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">p</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;_1&quot;</span>/&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">n</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;_1&quot;</span>&gt;123&lt;/<span class="keywordtype">n</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;<span class="keywordtype">q</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;_1&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">Tricky</span>&gt;</div></div><!-- fragment --> </div><p>In the last two cases, the generated deserializer for this data type will be able to accurately reconstruct the instance with members <code>p</code> and <code>q</code> pointing to member <code>n</code>.</p>
<p>Finally, serialization with <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> produces XML trees, which may benefit interoperability but sacrifices the true meaning of serialization, giving three copies of the shared value <code>1</code>:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">Tricky</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">p</span>&gt;123&lt;/<span class="keywordtype">p</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">n</span>&gt;123&lt;/<span class="keywordtype">n</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;<span class="keywordtype">q</span>&gt;123&lt;/<span class="keywordtype">q</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">Tricky</span>&gt;</div></div><!-- fragment --> </div><p>With the soapcpp2-generated serializers you can define a C++ operator that serializes a specified class instance or type as follows, assuming the <code>ns__Person</code> class is declared in an interface header file for soapcpp2:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ns__Person</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    ns__Person();</div><div class="line">    ~ns__Person();</div><div class="line">    <span class="keywordtype">void</span> set_name(<span class="keyword">const</span> <span class="keywordtype">char</span> *);</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *get_name();</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *name;</div><div class="line">    <span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>;</div><div class="line">};</div></div><!-- fragment --><p>Run <b><code>soapcpp2 -0</code></b> on this file to generate the serializers with non-SOAP XML namespaces, which we then use in our main program as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span></div><div class="line"></div><div class="line">ns__Person::ns__Person()</div><div class="line">{</div><div class="line">  name = NULL;</div><div class="line">  soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69">SOAP_XML_INDENT</a> | <a class="code" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493">SOAP_XML_TREE</a>); <span class="comment">// or SOAP_XML_GRAPH</span></div><div class="line">}</div><div class="line"></div><div class="line">ns__Person::~ns__Person()</div><div class="line">{</div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ns__Person::set_name(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)</div><div class="line">{</div><div class="line">  this-&gt;name = <a class="code" href="group__group__context.html#ga41747ef145667bdff9c66cdd2bc86653">soap_strdup</a>(this-&gt;soap, name);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *ns__Person::get_name()</div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> this-&gt;name;</div><div class="line">}</div><div class="line"></div><div class="line">std::ostream&amp; operator&lt;&lt;(std::ostream&amp; o, ns__Person&amp; p)</div><div class="line">{</div><div class="line">  p.soap-&gt;os = &amp;o;</div><div class="line">  soap_write_ns__Person(p.soap, &amp;p);</div><div class="line">  p.soap-&gt;os = NULL;</div><div class="line">  <span class="keywordflow">return</span> o;</div><div class="line">}</div><div class="line"></div><div class="line">std::istream&amp; operator&gt;&gt;(std::istream&amp; i, ns__Person&amp; p)</div><div class="line">{</div><div class="line">  p.soap-&gt;is = &amp;i;</div><div class="line">  soap_read_ns__Person(p.soap, &amp;p);</div><div class="line">  p.soap-&gt;is = NULL;</div><div class="line">  <span class="keywordflow">return</span> i;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  ns__Person p;</div><div class="line">  p.set_name(<span class="stringliteral">&quot;Joe&quot;</span>);</div><div class="line">  <span class="comment">// serialize person p in XML to stdout:</span></div><div class="line">  std::cout &lt;&lt; p &lt;&lt; std::endl;</div><div class="line">  <span class="comment">// then parse and deserialize XML from stdin into person p:</span></div><div class="line">  std::cin &gt;&gt; p;</div><div class="line">  <span class="comment">// destructor cleans up person p and its deserialized data</span></div><div class="line">}</div></div><!-- fragment --><p>In this example we construct an instance of <code>ns__Person</code> by setting its <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context struct pointer data member to a new valid context that is deleted by the destructor of this instance.</p>
<dl class="section warning"><dt>Warning</dt><dd>Deserialized class instances with a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context struct pointer member will have their <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> contexts set automatically by the deserializer's context, because <code>soap_default_T</code> (or <code>soap_default</code> class method) is called that sets the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context struct pointer of the instance. For example, <code>soap_read_ns__Person</code> sets the deserialized <code>ns__Person::soap</code> member to the first argument <code>soap</code> of <code>soap_read_ns__Person</code>, which happens to be <code>ns__Person::soap</code> anyway in the example shown above. See Section <a class="el" href="index.html#classmemory">Intra-class memory management</a> .</dd></dl>
<p>The output of this program is:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">ns:Person</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;http://tempuri.org/ns.xsd&quot;</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">Joe</span>&lt;/<span class="keywordtype">name</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/<span class="keywordtype">ns:Person</span>&gt;</div></div><!-- fragment --> </div><p>The <em><code>xsi</code></em> and <em><code>xsd</code></em> namespaces are used when attributes such as <em><code>xsi:nil</code></em> and <em><code>xsi:type</code></em> are serialized, where <em><code>xsi:type</code></em> may refer to a XSD type such as <em><code>xsd:string</code></em>. The <em><code>xsi:nil</code></em> attribute is output when an element is nillable but its corresponding pointer member is NULL and <em><code>xsi:type</code></em> is output for structs and classes with polymorphic members that are declared with <code>int __type</code> member and a <code>void*</code> pointer to serialize the value pointed to. Attribute <em><code>xsi:type</code></em> is also output to serialize derived instances in place of base class instances. Therefore, removing these namespaces from the XML namespace table (<em><code>ns.nsmap</code></em>) may cause XML parsing and validation issues.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example9"></a>
Example</h3>
<p>As an example, consider the following data type declarations:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;person.h&quot;: </span></div><div class="line"><span class="keyword">enum</span> ns__Gender { male, female }; </div><div class="line"></div><div class="line"><span class="keyword">class </span>ns__Address </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *street; </div><div class="line">    uint32_t    number; </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *city; </div><div class="line">}; </div><div class="line"></div><div class="line"><span class="keyword">class </span>ns__Person </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>     *name; </div><div class="line">    <span class="keyword">enum</span> ns__Gender gender; </div><div class="line">    ns__Address     address; </div><div class="line">    ns__Person     *mother; </div><div class="line">    ns__Person     *father; </div><div class="line">};</div></div><!-- fragment --><p>The following program uses these data types to write to standard output a data structure that contains the data of a person named "John" living at Downing st. 10 in Londen. He has a mother "Mary" and a father "Stuart". After initialization, the class instance for "John" is serialized and encoded in XML to the standard output stream using gzip compression (requires the Zlib library, compile sources with the compile-time flag <code><a class="el" href="group__group__with.html#gad30a07ea604aea8cb00f41f6310cf30f" title="When this macro is defined at compile time (undefined by default), enables linkage with the zlib libr...">WITH_GZIP</a></code>):</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;person.cpp&quot;: </span></div><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645">SOAP_XML_GRAPH</a>); </div><div class="line">  ns__Person mother, father, john; </div><div class="line">  mother.soap_default(soap);</div><div class="line">  father.soap_default(soap);</div><div class="line">  john.soap_default(soap);</div><div class="line">  mother.name = <span class="stringliteral">&quot;Mary&quot;</span>; </div><div class="line">  mother.gender = female; </div><div class="line">  mother.address.street = <span class="stringliteral">&quot;Downing st.&quot;</span>; </div><div class="line">  mother.address.number = 10; </div><div class="line">  mother.address.city = <span class="stringliteral">&quot;London&quot;</span>; </div><div class="line">  mother.mother = NULL; </div><div class="line">  mother.father = NULL; </div><div class="line">  father.name = <span class="stringliteral">&quot;Stuart&quot;</span>; </div><div class="line">  father.gender = male; </div><div class="line">  father.address.street = <span class="stringliteral">&quot;Main st.&quot;</span>; </div><div class="line">  father.address.number = 5; </div><div class="line">  father.address.city = <span class="stringliteral">&quot;London&quot;</span>; </div><div class="line">  father.mother = NULL; </div><div class="line">  father.father = NULL; </div><div class="line">  john.name = <span class="stringliteral">&quot;John&quot;</span>; </div><div class="line">  john.gender = male; </div><div class="line">  john.address = mother.address; </div><div class="line">  john.mother = &amp;mother; </div><div class="line">  john.father = &amp;father; </div><div class="line">  soap_write_ns__Person(soap, &amp;john);</div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap); </div><div class="line">} </div></div><!-- fragment --><p>The <em><code>person.h</code></em> interface header file is input to soapcpp2 and the generated code compiled together with <em><code>person.cpp</code></em>: </p><pre class="fragment"> soapcpp2 -0 person.h
 c++ -o person person.cpp soapC.cpp stdsoap2.cpp
</pre><p>We run the application: </p><pre class="fragment"> ./person
</pre><p>The output is:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:Person</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;urn:person&quot;</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">John</span>&lt;/<span class="keywordtype">name</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;<span class="keywordtype">gender</span>&gt;<span class="keyword">male</span>&lt;/<span class="keywordtype">gender</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;<span class="keywordtype">address</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;<span class="keywordtype">street</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;_3&quot;</span>&gt;<span class="keyword">Dowling</span> <span class="keyword">st.</span>&lt;/<span class="keywordtype">street</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">number</span>&gt;10&lt;/<span class="keywordtype">number</span>&gt; </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    &lt;<span class="keywordtype">city</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;_4&quot;</span>&gt;<span class="keyword">London</span>&lt;/<span class="keywordtype">city</span>&gt; </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  &lt;/<span class="keywordtype">address</span>&gt; </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  &lt;<span class="keywordtype">mother</span>&gt; </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">Mary</span>&lt;/<span class="keywordtype">name</span>&gt; </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    &lt;<span class="keywordtype">gender</span>&gt;<span class="keyword">female</span>&lt;/<span class="keywordtype">gender</span>&gt; </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    &lt;<span class="keywordtype">address</span>&gt; </div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;      &lt;<span class="keywordtype">street</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;_3&quot;</span>/&gt; </div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;      &lt;<span class="keywordtype">number</span>&gt;5&lt;/<span class="keywordtype">number</span>&gt; </div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      &lt;<span class="keywordtype">city</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;_4&quot;</span>/&gt; </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    &lt;/<span class="keywordtype">address</span>&gt; </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  &lt;/<span class="keywordtype">mother</span>&gt; </div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  &lt;<span class="keywordtype">father</span>&gt; </div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">Stuart</span>&lt;/<span class="keywordtype">name</span>&gt; </div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    &lt;<span class="keywordtype">gender</span>&gt;<span class="keyword">male</span>&lt;/<span class="keywordtype">gender</span>&gt; </div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    &lt;<span class="keywordtype">address</span>&gt; </div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;      &lt;<span class="keywordtype">street</span>&gt;<span class="keyword">Main</span> <span class="keyword">st.</span>&lt;/<span class="keywordtype">street</span>&gt; </div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;      &lt;<span class="keywordtype">number</span>&gt;13&lt;/<span class="keywordtype">number</span>&gt; </div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;      &lt;<span class="keywordtype">city</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;_4&quot;</span>/&gt; </div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    &lt;/<span class="keywordtype">address</span>&gt; </div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  &lt;/<span class="keywordtype">father</span>&gt; </div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;&lt;/<span class="keywordtype">ns:Person</span>&gt;</div></div><!-- fragment --> </div><p>Because the C++ compiler stores the constant strings <code>"Dowling st."</code> and <code>"London"</code> just once, references are included in the output with flag <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> that preserves the original structure of the data structure serialized.</p>
<p>The following program decodes this content from standard input and reconstructs the original data structure on the heap:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">  ns__Person john;</div><div class="line">  <span class="keywordflow">if</span> (soap_read_ns__Person(soap, &amp;john))</div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">  {</div><div class="line">    ns__Person *mother = john-&gt;mother; </div><div class="line">    ns__Person *father = john-&gt;father; </div><div class="line">    ... <span class="comment">// use the data</span></div><div class="line">  }</div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); <span class="comment">// deletes john, mother and father</span></div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);     <span class="comment">// deletes other managed data and temporaries</span></div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);    <span class="comment">// finalize and delete the context</span></div><div class="line">} </div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="default"></a>
Default values for omitted XML elements and attributes</h3>
<p>The soapcpp2 tool generates <code>soap_default_T</code> functions for serializable types <code>T</code> specified in an interface header file for soapcpp2 The default values of primitive C/C++ types can be easily specified by defining any one or all of the following macros before including the <em><code>gsoap/stdsoap2.h</code></em> file or by using <code><a class="el" href="group__group__with.html#ga176c2f40b17a2952361c37c4602a4c37" title="When this macro is defined at compile time (undefined by default) then the header file specified by t...">SOAPDEFS_H</a></code> or <code><a class="el" href="group__group__with.html#ga24620333a812a36ed84902ff3d897ff6" title="When this macro is defined at compile time (undefined by default), a user-supplied file named soapdef...">WITH_SOAPDEFS_H</a></code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_bool </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_byte </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_double </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_float </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_int </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_long </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_LONG64 </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_short </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_string </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_time </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_unsignedByte </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_unsignedInt </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_unsignedLong </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_unsignedLONG64 </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_unsignedShort </span></div><div class="line"><span class="preprocessor">#define SOAP_DEFAULT_wstring</span></div></div><!-- fragment --><p>The absence of a data value in a receiving SOAP message will result in the assignment of a default value to a primitive type upon deserialization.</p>
<p>Default values can also be assigned to individual <code>struct</code> and <code>class</code> members of primitive type or pointers to primitive types. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>MyRecord </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name = <span class="stringliteral">&quot;Unknown&quot;</span>; <span class="comment">// optional</span></div><div class="line">    <span class="keywordtype">int</span> value = 9999; </div><div class="line">    <span class="keyword">enum</span> Status { active, passive } status = passive; </div><div class="line">}</div></div><!-- fragment --><p>Default values are assigned to the members of a struct or class when parsing and deserializing XML into data when XML elements or attributes with the respective values are absent. Assigning default values to members makes these members optional elements and attributes in the corresponding XML schema.</p>
<p>Because service operation requests and responses are essentially structs (internally they are structs), default values can also be assigned to service operation parameters. These default parameter values do not specify optional parameters as we normally see with C/C++ function calls. Rather, the default parameter values are used in case an inbound request or response message lacks the XML elements that comprise these parameters. For example, a Web service can use default values to fill-in absent parameters in a SOAP request as follows:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__login(<span class="keywordtype">char</span> *uid = <span class="stringliteral">&quot;anonymous&quot;</span>, <span class="keywordtype">char</span> *pwd = <span class="stringliteral">&quot;guest&quot;</span>, <span class="keywordtype">bool</span> granted = <span class="keyword">true</span>);</div></div><!-- fragment --><p>When the request message lacks <em><code>uid</code></em> or <em><code>pwd</code></em> elements then the default values are assigned instead.</p>
<p>In addition, the default values will show up in the SOAP or XML request and response message examples generated by the soapcpp2 tool.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="wsdlin"></a>
The wsdl2h tool</h1>
<p>The wsdl2h tool is an advanced XML data binding tool to convert WSDLs and XML schemas (XSD files) to C or C++. The tool takes WSDL and XSD files or URLs to WSDLs and XSDs, then converts these to a C or C++ interface header file that specifies the properties of the WSDLs and XSDs in a familiar C/C++ syntax. This header file is not intended to be included in your code directly. It should be converted by soapcpp2 to generate the logic for the data bindings. It can however be safely converted by a documentation tool such as Doxygen to analyze and represent the service operations and data in a convenient layout. To this end, the generated interface header file is self-explanatory.</p>
<p>The wsdl2h tool can also be used without WSDLs to convert XML schemas (XSDs) to C/C++ to implement XML data bindings in C and C++. The wsdl2h tool generates the XML data binding interface header file with the C/C++ data type equivalents to the XML schema types and components.</p>
<p>The soapcpp2 tool then generates the XML data binding implementation source code from the data binding interface header file, meaning the serialization source code to serialize C/C++ data in XML and the client-side stub functions to invoke remote service operations and the server-side skeleton functions to implement XML Web services.</p>
<p>Therefore, the creation of C and C++ applications from one of more WSDLs or XSDs is a two-step process.</p>
<p>First, to convert a WSDL to C++ we use: </p><pre class="fragment"> wsdl2h file.wsdl
</pre><p>This generates an interface header file <em><code>file.h</code></em>. When using a URL to the WSDL we use <a href="#wsdl2h-o"><b><code>wsdl2h -o file.h</code></b> option <b><code>-o file.h</code></b></a> to save the file: </p><pre class="fragment"> wsdl2h -ofile.h http://www.example.com/file.wsdl
</pre><p>Web service operations in the generated <em><code>file.h</code></em> header file are converted to function prototypes. Schema types are converted to the equivalent C/C++ types, using file <em><code>typemap.dat</code></em> to map XML schema types to C/C++ types.</p>
<p>The generated header file also contains instructions for the user and has documentation copies from the WSDL as well as various directives related to the Web service properties defined in the WSDL.</p>
<p>Multiple WSDL specifications can be processed at once and saved to one interface header file with <a href="#wsdl2h-o"><b><code>wsdl2h -o file.h</code></b> option <b><code>-o file.h</code></b></a>: </p><pre class="fragment"> wsdl2h -o file.h file1.wsdl file2.wsdl file3.wsdl
</pre><p>To generate C source code, use <a href="#wsdl2h-c"><b><code>wsdl2h -c</code></b> option <b><code>-c</code></b></a>: </p><pre class="fragment"> wsdl2h -c file.wsdl
</pre><p>The wsdl2h tool does not require WSDLs, it also works for XSDs: </p><pre class="fragment"> wsdl2h -o file.h file1.xsd file2.xsd file3.xsd
</pre><p>In this case no service operations are found and therefore the interface header file generated does not contain function prototypes representing service operations.</p>
<p>When upgrading gSOAP to a newer version it is often not necessary to perform this first step again, since newer versions are backward compatible to previous interface header files generated by wsdl2h.</p>
<p>Next, the wsdl2h-generated interface header file <em><code>file.h</code></em> is input to the soapcpp2 tool to generate the XML data binding implementation logic in C or C++: </p><pre class="fragment"> soapcpp2 file.h
</pre><p>You can use soapcpp2 without wsdl2h, by specifying an input interface header file that is not generated by wsdl2h but written by hand for example, see <a class="el" href="index.html#soapcpp2">The soapcpp2 tool</a>.</p>
<p>There are many cases when wsdl2h generates code with <code>#import</code> directives, such as <code>#import "stlvector.h"</code>, that requires the soapcpp2 tool to import definitions from the <em><code>gsoap/import</code></em> directory, which can be specified as follows: </p><pre class="fragment"> soapcpp2 -I some_path_to/gsoap/import file.h
</pre><p>When WSDLs are converted to C++ source code, you may want to use <a href="#wsdl2h-j"><b><code>wsdl2h -j</code></b> option <b><code>-j</code></b></a> (or <a href="#wsdl2h-i"><b><code>wsdl2h -j</code></b> option <b><code>-i</code></b></a>) to generate proxy and service classes: </p><pre class="fragment"> soapcpp2 -j file.h
</pre><p>This command generates a couple of C++ source files, more details will follow in Section <a class="el" href="index.html#soapcpp2">The soapcpp2 tool</a>.</p>
<p>Consider for example the following commands to implement a C++ client application: </p><pre class="fragment"> wsdl2h -o calc.h http://www.genivia.com/calc.wsdl 
 soapcpp2 -C -j -I path_to/gsoap/import calc.h
</pre><p>The first command generates <em><code>calc.h</code></em> from the WSDL at the specified URL. The header file is then processed by the soapcpp2 tool to generate the proxy class declared in <em><code>soapcalcProxy.h</code></em> class and defined in <em><code>soapcalcProxy.cpp</code></em>. It also generates a file <em><code>calc.nsmap</code></em> with a XML namespace table which should be included in our source code. The tool also generates <em><code>soapStub</code></em>, <em><code>soapH.h</code></em>, and <em><code>soapC.cpp</code></em>. The latter is also compiled with our application together with <em><code>gsoap/stdsoap2.cpp</code></em>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="wsdl2hoptions"></a>
wsdl2h options</h2>
<p>The wsdl2h tool generates one XML data binding interface header file, a file that includes all of the information gathered from the WSDLs and XSDs input to the wsdl tool as command-line arguments. The default output file name of wsdl2h is the first WSDL/schema input file name but with extension <em><code>.h</code></em> that replaces <em><code>.wsdl</code></em> (or replaces <em><code>.xsd</code></em> in case of XSD files specified). When an input file is absent or a WSDL file is loaded from a Web URL, the header output will be produced on the standard output unless <a href="#wsdl2h-o"><b><code>wsdl2h -o file.h</code></b> option <b><code>-o file.h</code></b></a> is used to save the output to <em><code>file.h</code></em> (or any other file name specified).</p>
<p>The wsdl2h command-line options are:</p>
<table class="doxtable">
<tr>
<th>option </th><th>result  </th></tr>
<tr>
<td><a href="#wsdl2h-a"><code>-a</code></a> </td><td>generate indexed struct names for local elements with anonymous types </td></tr>
<tr>
<td><a href="#wsdl2h-b"><code>-b</code></a> </td><td>generate bi-directional operations to serve one-way response messages (duplex) </td></tr>
<tr>
<td><a href="#wsdl2h-c"><code>-c</code></a> </td><td>generate C source code </td></tr>
<tr>
<td><a href="#wsdl2h-c"><code>-c++</code></a> </td><td>generate C++ source code (default) </td></tr>
<tr>
<td><a href="#wsdl2h-c"><code>-c++11</code></a> </td><td>generate C++11 source code </td></tr>
<tr>
<td><a href="#wsdl2h-D"><code>-D</code></a> </td><td>make attribute members with default/fixed values optional with pointers </td></tr>
<tr>
<td><a href="#wsdl2h-d"><code>-d</code></a> </td><td>generate DOM code for xsd:any and xsd:anyType elements </td></tr>
<tr>
<td><a href="#wsdl2h-e"><code>-e</code></a> </td><td>don't qualify enum names </td></tr>
<tr>
<td><a href="#wsdl2h-F"><code>-F</code></a> </td><td>add transient members to structs to simulate struct-type derivation in C </td></tr>
<tr>
<td><a href="#wsdl2h-f"><code>-f</code></a> </td><td>generate flat C++ class hierarchy by removing inheritance </td></tr>
<tr>
<td><a href="#wsdl2h-g"><code>-g</code></a> </td><td>generate global top-level element and attribute declarations </td></tr>
<tr>
<td><a href="#wsdl2h-h"><code>-h</code></a> </td><td>display help info and exit </td></tr>
<tr>
<td><a href="#wsdl2h-I"><code>-I</code></a> <code>path</code> </td><td>use <code>path</code> to locate WSDL and XSD files </td></tr>
<tr>
<td><a href="#wsdl2h-i"><code>-i</code></a> </td><td>don't import (advanced option) </td></tr>
<tr>
<td><a href="#wsdl2h-j"><code>-j</code></a> </td><td>don't generate <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> and <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code> definitions </td></tr>
<tr>
<td><a href="#wsdl2h-k"><code>-k</code></a> </td><td>don't generate <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> <code>mustUnderstand</code> qualifiers </td></tr>
<tr>
<td><a href="#wsdl2h-L"><code>-L</code></a> </td><td>generate less documentation by removing generic <code>@note</code> comments </td></tr>
<tr>
<td><a href="#wsdl2h-l"><code>-l</code></a> </td><td>display license information </td></tr>
<tr>
<td><a href="#wsdl2h-M"><code>-M</code></a> </td><td>suppress error "must understand element with wsdl:required='true'" </td></tr>
<tr>
<td><a href="#wsdl2h-m"><code>-m</code></a> </td><td>use xsd.h module to import primitive types </td></tr>
<tr>
<td><a href="#wsdl2h-N"><code>-N</code></a> <code>name</code> </td><td>use <code>name</code> for service prefixes to produce a service for each binding </td></tr>
<tr>
<td><a href="#wsdl2h-n"><code>-n</code></a> <code>name</code> </td><td>use <code>name</code> as the base namespace prefix name instead of <code>ns</code> </td></tr>
<tr>
<td><a href="#wsdl2h-O"><code>-O1</code></a> </td><td>optimize by omitting duplicate choice/sequence members </td></tr>
<tr>
<td><a href="#wsdl2h-O"><code>-O2</code></a> </td><td>optimize <code>-O1</code> and omit unused schema types (unreachable from roots) </td></tr>
<tr>
<td><a href="#wsdl2h-O"><code>-O3</code></a> </td><td>optimize <code>-O2</code> and omit unused schema root attributes </td></tr>
<tr>
<td><a href="#wsdl2h-O"><code>-O4</code></a> </td><td>optimize <code>-O3</code> and omit unused schema root elements (use only with WSDLs) </td></tr>
<tr>
<td><a href="#wsdl2h-O"><code>-Ow2</code></a> </td><td>optimize <code>-O2</code> while retaining all derived types of used base types </td></tr>
<tr>
<td><a href="#wsdl2h-O"><code>-Ow3</code></a> </td><td>optimize <code>-O3</code> while retaining all derived types of used base types </td></tr>
<tr>
<td><a href="#wsdl2h-O"><code>-Ow4</code></a> </td><td>optimize <code>-O4</code> while retaining all derived types of used base types </td></tr>
<tr>
<td><a href="#wsdl2h-o"><code>-o</code></a> <code>file</code> </td><td>output to file </td></tr>
<tr>
<td><a href="#wsdl2h-P"><code>-P</code></a> </td><td>don't create polymorphic types inherited from <code>xsd__anyType</code> </td></tr>
<tr>
<td><a href="#wsdl2h-p"><code>-p</code></a> </td><td>create polymorphic types inherited from base <code>xsd__anyType</code> (automatic when the WSDL or XSD contains polymorphic definitions) </td></tr>
<tr>
<td><a href="#wsdl2h-Q"><code>-Q</code></a> </td><td>make <code>xsd__anySimpleType</code> equal to <code>xsd__anyType</code> to use as the base type </td></tr>
<tr>
<td><a href="#wsdl2h-q"><code>-q</code></a> <code>name</code> </td><td>use <code>name</code> for the C++ namespace of all declarations </td></tr>
<tr>
<td><a href="#wsdl2h-R"><code>-R</code></a> </td><td>generate REST operations for REST bindings in the WSDL </td></tr>
<tr>
<td><a href="#wsdl2h-r"><code>-r</code></a> <code>host[:port[:uid:pwd]]</code> </td><td>connect via proxy <code>host</code>, <code>port</code>, and proxy credentials <code>uid</code> and <code>pwd</code> </td></tr>
<tr>
<td><a href="#wsdl2h-r"><code>-r</code></a> <code>:uid:pwd</code> </td><td>connect with authentication credentials <code>uid</code> and <code>pwd</code> </td></tr>
<tr>
<td><a href="#wsdl2h-S"><code>-S</code></a> <code>name</code> </td><td>use <code>name</code> instead of <code>soap</code> for the soap context included in C++ classes as a member variable or use <code>-S ""</code> to remove it </td></tr>
<tr>
<td><a href="#wsdl2h-s"><code>-s</code></a> </td><td>don't generate STL code (no std::string and no std::vector) </td></tr>
<tr>
<td><a href="#wsdl2h-t"><code>-t</code></a> <code>file</code> </td><td>use type map file instead of the default file typemap.dat </td></tr>
<tr>
<td><a href="#wsdl2h-U"><code>-U</code></a> </td><td>map Unicode XML names to UTF-8-encoded Unicode C/C++ identifiers </td></tr>
<tr>
<td><a href="#wsdl2h-u"><code>-u</code></a> </td><td>don't generate unions </td></tr>
<tr>
<td><a href="#wsdl2h-V"><code>-V</code></a> </td><td>display the current version and exit </td></tr>
<tr>
<td><a href="#wsdl2h-v"><code>-v</code></a> </td><td>verbose output </td></tr>
<tr>
<td><a href="#wsdl2h-W"><code>-W</code></a> </td><td>suppress warnings </td></tr>
<tr>
<td><a href="#wsdl2h-w"><code>-w</code></a> </td><td>always wrap response parameters in a response struct </td></tr>
<tr>
<td><a href="#wsdl2h-X"><code>-X</code></a> </td><td>don't qualify part names to disambiguate doc/lit wrapped patterns </td></tr>
<tr>
<td><a href="#wsdl2h-x"><code>-x</code></a> </td><td>don't generate <code>_XML any</code> and <code>_XML anyAttribute</code> extensibility elements </td></tr>
<tr>
<td><a href="#wsdl2h-y"><code>-y</code></a> </td><td>generate typedef synonyms for structs and enums </td></tr>
<tr>
<td><a href="#wsdl2h-z"><code>-z1</code></a> </td><td>compatibility with 2.7.6e: generate pointer-based arrays </td></tr>
<tr>
<td><a href="#wsdl2h-z"><code>-z2</code></a> </td><td>compatibility with 2.7.15: (un)qualify element/attribute referenced members </td></tr>
<tr>
<td><a href="#wsdl2h-z"><code>-z3</code></a> </td><td>compatibility with 2.7.16 to 2.8.7: (un)qualify element/attribute referenced members </td></tr>
<tr>
<td><a href="#wsdl2h-z"><code>-z4</code></a> </td><td>compatibility up to 2.8.11: don't generate union structs in std::vector </td></tr>
<tr>
<td><a href="#wsdl2h-z"><code>-z5</code></a> </td><td>compatibility up to 2.8.15: don't include minor improvements </td></tr>
<tr>
<td><a href="#wsdl2h-z"><code>-z6</code></a> </td><td>compatibility up to 2.8.17: don't include minor improvements </td></tr>
<tr>
<td><a href="#wsdl2h-z"><code>-z7</code></a> </td><td>compatibility up to 2.8.59: don't generate <code>std::vector</code> of class of union </td></tr>
<tr>
<td><a href="#wsdl2h-z"><code>-z8</code></a> </td><td>compatibility up to 2.8.74: don't generate qualifiers for doc/lit wrapped patterns </td></tr>
<tr>
<td><a href="#wsdl2h-z"><code>-z9</code></a> </td><td>compatibility up to 2.8.93: always qualify element/attribute referenced members, even when defined in the same namespace with default forms unqualified </td></tr>
<tr>
<td><a href="#wsdl2h-z"><code>-z10</code></a> </td><td>compatibility up to 2.8.96: generate qualifiers even when defined without namespace </td></tr>
<tr>
<td><a href="#wsdl2h-_"><code>-_</code></a> </td><td>don't generate <code>_USCORE</code> (replace with Unicode <code>_x005f</code>) </td></tr>
</table>
<p>The following subsections explain the options in detail. The source code examples generated by wsdl2h are slightly simplified by removing comments and some other details without changing their meaning to improve readability.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-a"></a>
wsdl2h -a</h3>
<p>This option generates indexed identifier names for structs, classes, unions, and enums declared for local elements with local (i.e. anonymous) types. When local elements and attributes have local types that are mapped to a struct, class, union, or enum, the generated type name is normally the outer struct/class name concatenated with the element/attribute name.</p>
<p>For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;TypeWithNestedType&quot;</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;element&quot;</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &lt;<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;          &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;            &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;nested-element&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd::string&quot;</span>/&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;          &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &lt;/<span class="keywordtype">xsd:element</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;/<span class="keywordtype">xsd:schema</span>&gt;</div></div><!-- fragment --> </div><p>By default without this option, this schema is translated by wsdl2h to the following interface header file declaration:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ns__TypeWithNestedType             <span class="comment">// complexType</span></div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keyword">class </span>ns__TypeWithNestedType_element <span class="comment">// local complexType</span></div><div class="line">    { <span class="keyword">public</span>:</div><div class="line">        std::string nested_element;      <span class="comment">// nested required element</span></div><div class="line">    } element;                           <span class="comment">// required element</span></div><div class="line">};</div></div><!-- fragment --><p>By contrast, with <b><code>wsdl2h -a</code></b> option <b><code>-a</code></b> we obtain an indexed local class <code>_ns__struct_1</code> in the generated interface header file for soapcpp2:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ns__TypeWithNestedType          <span class="comment">// complexType</span></div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keyword">class </span>_ns__struct_1               <span class="comment">// local complexType</span></div><div class="line">    { <span class="keyword">public</span>:</div><div class="line">        std::string nested_element;   <span class="comment">// nested required element</span></div><div class="line">    } element;                        <span class="comment">// required element</span></div><div class="line">};</div></div><!-- fragment --><p>The next local struct or class is named <code>_ns__struct_2</code> and so on. The same indexing applies to local unions and enums.</p>
<dl class="section note"><dt>Note</dt><dd>The soapcpp2 tool always un-nests nested struct, class, union and enum declarations, which means that the above eventially results in the following source code generated by soapcpp2:</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">class </span>_ns__struct_1</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    std::string nested_element;</div><div class="line">};</div><div class="line"><span class="keyword">class </span>ns__TypeWithNestedType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    _ns__struct_1 element;</div><div class="line">};</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-b"></a>
wsdl2h -b</h3>
<p>This option generates bi-directional operations (duplex operations) intended for asynchrounous server operations. The bi-directional operations for server response messages are generated in addition to the request-response operations.</p>
<p>For example, the wsdl2h tool generates the following declaration of a service operation <code>ns__add</code> for a hypothetical calculator Web service:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__add(</div><div class="line">    <span class="keywordtype">double</span> a,</div><div class="line">    <span class="keywordtype">double</span> b,</div><div class="line">    <span class="keywordtype">double</span>&amp; result</div><div class="line">);</div></div><!-- fragment --><p>By contrast, with this option <b><code>-b</code></b> we obtain an additional one-way operation <code>ns__addResponse</code> to send and receive one-way response messages:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__addResponse(</div><div class="line">    <span class="keywordtype">double</span> result,</div><div class="line">    <span class="keywordtype">void</span></div><div class="line">);</div><div class="line"><span class="keywordtype">int</span> ns__add(</div><div class="line">    <span class="keywordtype">double</span> a,</div><div class="line">    <span class="keywordtype">double</span> b,</div><div class="line">    <span class="keywordtype">double</span>&amp; result</div><div class="line">);</div></div><!-- fragment --><p>Where <code>void</code> as a result parameter means that the operation uses "one-way" messaging, in this case to send and receive response messages one-way asynchronously:</p>
<ul>
<li><code>int soap_send_ns__addResponse(struct soap *soap, const char *endpoint, const char *action, double&amp; result)</code></li>
<li><code>int soap_recv_ns__addResponse(struct soap *soap, double&amp; result)</code></li>
</ul>
<p>At the sender side use <code>soap_send_ns__addResponse</code> to send the message one-way, followed by <code><a class="el" href="group__group__io.html#ga8bb9d541b641a6c261d8879363c7694c" title="Receive an HTTP response message from the server that is assumed to be empty. ">soap_recv_empty_response</a></code> to receive the HTTP acknowledgment. At the receiver side use <code>soap_recv_ns__addResponse</code>. To develop a server, simply implement <code>soap_ns__addResponse</code> to handle the service operation and in this function call <code><a class="el" href="group__group__io.html#ga6ac5e550072a59c8b6d432b63cc3543a" title="Return an HTTP response message with an empty HTTP body from a service back to the client or peer...">soap_send_empty_response</a></code> to send the HTTP acknowledgment. The same applies to C++ proxy classes generated by soapcpp2.</p>
<dl class="section note"><dt>Note</dt><dd>Version 2.8.75 of gSOAP and greater generate send and receive functions for each client-side call function. This means that a client application can simply call <code>soap_send_ns__add</code> to send the request and then call <code>soap_recv_ns__add</code> to receive the response after polling the server connection with <code><a class="el" href="group__group__io.html#ga115be6d4b62bd840bd7750fde1bb73fe" title="Check if the connection is ready to receive pending data. ">soap_ready</a></code> to check if the server is ready (<code><a class="el" href="group__group__io.html#ga115be6d4b62bd840bd7750fde1bb73fe" title="Check if the connection is ready to receive pending data. ">soap_ready</a></code> returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code>) to send the response message as a reply message to be received by the client. Therefore, this option <b><code>-b</code></b> is not required to implement asynchronous request-response messaging but rather adds one-way asynchronous response messaging as well.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-c"></a>
wsdl2h -c -c++ -c++11</h3>
<p>This option sets the source code output to C, C++, or C++11, respectively.</p>
<p>For C++ and C++11 you can also use <a href="#wsdl2h-s"><b><code>wsdl2h -s</code></b> option <b><code>-s</code></b></a> to replace <code>std::vector</code> by arrays and replaces <code>std::string</code> by <code>char*</code>. Use a <a href="#typemap"><em><code>typemap.dat</code></em> file</a> to specify further details for the source code output generated by wsdl2h.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-D"></a>
wsdl2h -D</h3>
<p>This option makes attribute members of a struct or class with default or fixed values optional with pointers. Elements with default and fixed values are not affected by this option.</p>
<p>Without this option, optional attributes with default or fixed values are always output in XML, because the struct/class attribute member is not a pointer. This does not negatively affect the meaning of the XML produced, because omitted attributes are replaced by their default or fixed value.</p>
<p>For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;data&quot;</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;foo&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">default</span>=<span class="stringliteral">&quot;abc&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;<span class="keywordtype">xsd:attribute</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;bar&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:int&quot;</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;optional&quot;</span> <span class="keyword">default</span>=<span class="stringliteral">&quot;123&quot;</span>/&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;/<span class="keywordtype">xsd:schema</span>&gt;</div></div><!-- fragment --> </div><p>By default without this option, this schema is translated by wsdl2h to the following interface header file declaration:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ns__data</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    std::string* foo 0 = <span class="stringliteral">&quot;abc&quot;</span>; <span class="comment">// optional element with default value &quot;abc&quot;</span></div><div class="line">  @ <span class="keywordtype">int</span> bar 0 = 123;            <span class="comment">// optional with default value 123</span></div><div class="line">};</div></div><!-- fragment --><p>The deserializer populates the attribute value with the default or fixed value when the attribute is omitted from XML. The element is populated when the element is empty, i.e. <em><code>&lt;bar/&gt;</code></em> or <em><code>&lt;bar&gt;&lt;/bar&gt;</code></em>, but not when it is omitted, as per the W3C XML Schema standards.</p>
<p>This option forces the optional attributes to be pointer-based members, meaning that their output can be turned on or off by setting the pointer to a value or to NULL:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ns__data</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    std::string* foo 0 = <span class="stringliteral">&quot;abc&quot;</span>; <span class="comment">// optional element with default value &quot;abc&quot;</span></div><div class="line">  @ <span class="keywordtype">int</span>* bar 0 = 123;           <span class="comment">// optional with default value 123</span></div><div class="line">};</div></div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>In this case the deserializer will not populate the attribute value with the default or fixed value when the attribute is omitted from XML, which differs from the W3C XML schema standards.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-d"></a>
wsdl2h -d</h3>
<p>This option replaces literal XML strings <code>_XML</code> (a <code>char*</code> string with XML content) with DOM nodes that are used to store the content of <em><code>xsd:any</code></em>, <em><code>xsd:anyAttribute</code></em> <em><code>xsd:anyType</code></em>, and mixed content values. The <a href="#dom">DOM API</a> offers more features to manipulate XML content compared to the literal <code>_XML</code> string type.</p>
<p>The DOM node type <code>xsd__anyType</code> of the gSOAP <a href="#dom">DOM API</a> is imported in the wsdl2h-generated interface header file with <code>#import "dom.h"</code> where <em><code>dom.h</code></em> is located in the <em><code>gsoap/import</code></em> directory. This requires compiling <em><code>gsoap/dom.c</code></em> in C and <em><code>gsoap/dom.cpp</code></em> in C++.</p>
<p>For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;data&quot;</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;foo&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:anyType&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &lt;<span class="keywordtype">xsd:any</span>/&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;<span class="keywordtype">xsd:anyAttribute</span> <span class="keyword">processContents</span>=<span class="stringliteral">&quot;lax&quot;</span>/&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;/<span class="keywordtype">xsd:schema</span>&gt;</div></div><!-- fragment --> </div><p>By default without this option, this schema is translated by wsdl2h to the following interface header file declarations:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>xsd__anyType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <a class="code" href="group__group__fault.html#ga5c62d26b4823b76c5b4ef29e7865d3f0">_XML</a> __item; <span class="comment">// XML string content</span></div><div class="line">};</div><div class="line"><span class="keyword">class </span>ns__data : <span class="keyword">public</span> xsd__anyType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    xsd__anyType* foo;</div><div class="line">    <a class="code" href="group__group__fault.html#ga5c62d26b4823b76c5b4ef29e7865d3f0">_XML</a> __any;          <span class="comment">// Store any element content in XML string</span></div><div class="line">  @ <a class="code" href="group__group__fault.html#ga5c62d26b4823b76c5b4ef29e7865d3f0">_XML</a> __anyAttribute; <span class="comment">// A placeholder that has no effect</span></div><div class="line">};</div></div><!-- fragment --><p>The <code>xsd__anyType</code> type has <code>_XML</code> simpleContent stored in <code>__item</code>. Names starting with double underscores have no representation in XML as elements or attribute names, meaning that only their values matter. Therefore, <code>_XML __any</code> holds the element and its content in a string.</p>
<p>With <b><code>wsdl2h -d</code></b> option <b><code>-d</code></b> we obtain:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;dom.h&quot;</span> <span class="comment">// imports xsd__anyType as a DOM node</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>ns__data : <span class="keyword">public</span> xsd__anyType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    xsd__anyType* foo;                <span class="comment">// Store &lt;foo&gt; element in DOM soap_dom_element</span></div><div class="line">    xsd__anyType __any;               <span class="comment">// Store any element content in DOM soap_dom_element</span></div><div class="line">  @ xsd__anyAttribute __anyAttribute; <span class="comment">// Store anyAttribute content in DOM soap_dom_attribute linked node structure</span></div><div class="line">};</div></div><!-- fragment --><p>See <a href="#dom">DOM API</a> for details on how to use the <code>xsd__anyType</code> and <code>xsd__anyAttribute</code>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-e"></a>
wsdl2h -e</h3>
<p>This option removes the prefix qualifier from enumeration names.</p>
<p>Without this option all enumeration names are prefixed by their <code>enum</code> name to ensure that enumeration names do not clash with other constants and enumeration names.</p>
<p>For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xsd:simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;engine&quot;</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">xsd:restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">xsd:enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;ON&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &lt;<span class="keywordtype">xsd:enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;OFF&quot;</span>/&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;/<span class="keywordtype">xsd:restriction</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;/<span class="keywordtype">xsd:simpleType</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;<span class="keywordtype">xsd:simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;light&quot;</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">xsd:restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &lt;<span class="keywordtype">xsd:enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;ON&quot;</span>/&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &lt;<span class="keywordtype">xsd:enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;OFF&quot;</span>/&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &lt;/<span class="keywordtype">xsd:restriction</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  &lt;/<span class="keywordtype">xsd:simpleType</span>&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&lt;/<span class="keywordtype">xsd:schema</span>&gt;</div></div><!-- fragment --> </div><p>By default without this option, this schema is translated by wsdl2h to the following interface header file declarations:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ns__engine { ns__engine__ON, ns__engine__OFF };</div><div class="line"><span class="keyword">enum</span> ns__light { ns__light__ON, ns__light__OFF, ns__light__BROKEN };</div></div><!-- fragment --><p>By contrast, with <b><code>wsdl2h -e</code></b> option <b><code>-e</code></b> we obtain:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ns__engine { ON, OFF };</div><div class="line"><span class="keyword">enum</span> ns__light { ON_, OFF_, BROKEN };</div></div><!-- fragment --><p>Where enumeration names are suffixed with underscores to make them unique.</p>
<p>Note that C++11 scoped enumerations can be used with <a href="#wsdl2h-c"><b><code>wsdl2h -c++11</code></b> option <b><code>-c++11</code></b></a>, which makes option <b><code>-e</code></b> useless.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-F"></a>
wsdl2h -F</h3>
<p>This option produces interface header files with struct/class declarations that simulate inheritance using transient pointer members to derived types. This option is particularly useful for C source code generation when derived types are required by the application. Derived type values are indicated by <em><code>xsi:type</code></em> attributes in XML with the derived type name.</p>
<p>This option can also be used for C++ to replace class inheritance by simulated inheritance using transient pointer members in base classes that point to the value of a derived type, meaning that the base class instance is replaced by the derived class instance. This option also removes pointers from array and container item types. These pointers are normally added to ensure containers can contain derived type values, but pointers are no longer needed by the simulated approach that add pointer members to the base classes.</p>
<p>For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:tns</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;base&quot;</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;value&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:int&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;derived1&quot;</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &lt;<span class="keywordtype">xsd:extension</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;tns:base&quot;</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;          &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;name&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;      &lt;/<span class="keywordtype">xsd:extension</span>&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    &lt;/<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;derived2&quot;</span>&gt;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    &lt;<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      &lt;<span class="keywordtype">xsd:extension</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;tns:base&quot;</span>&gt;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;          &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;x&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:float&quot;</span>/&gt;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      &lt;/<span class="keywordtype">xsd:extension</span>&gt;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    &lt;/<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;derived3&quot;</span>&gt;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    &lt;<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;      &lt;<span class="keywordtype">xsd:extension</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;tns:derived1&quot;</span>&gt;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;          &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;x&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:float&quot;</span>/&gt;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;      &lt;/<span class="keywordtype">xsd:extension</span>&gt;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    &lt;/<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;&lt;/<span class="keywordtype">xsd:schema</span>&gt;</div></div><!-- fragment --> </div><p>By default without this option, this schema is translated by <b><code>wsdl2h -c</code></b> option <b><code>-c</code></b> to the following interface header file declaration in C that lacks inheritance:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__base</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> value;</div><div class="line">};</div><div class="line"><span class="keyword">struct </span>ns__derived1</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> value;  <span class="comment">// base type value of ns__base</span></div><div class="line">    <span class="keywordtype">char</span> *name; <span class="comment">// extension</span></div><div class="line">};</div><div class="line"><span class="keyword">struct </span>ns__derived2</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> value;  <span class="comment">// base type value of ns__base</span></div><div class="line">    <span class="keywordtype">float</span> x;    <span class="comment">// extension</span></div><div class="line">};</div><div class="line"><span class="keyword">struct </span>ns__derived3</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> value;  <span class="comment">// derived1 type value of ns__base</span></div><div class="line">    <span class="keywordtype">char</span> *name; <span class="comment">// derived1 type</span></div><div class="line">    <span class="keywordtype">float</span> x;    <span class="comment">// extension</span></div><div class="line">};</div></div><!-- fragment --><p>By contrast, with <b><code>wsdl2h -c -F</code></b> option <b><code>-F</code></b> we obtain an interface header file with simulated inheritance using transient pointer members of base types pointing to derived types:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__base</div><div class="line">{</div><div class="line">    [ <span class="keyword">struct </span>ns__derived1 *ns__derived1; ] <span class="comment">// points to derived type</span></div><div class="line">    [ <span class="keyword">struct </span>ns__derived2 *ns__derived2; ] <span class="comment">// points to derived type</span></div><div class="line">    <span class="keywordtype">int</span> value;</div><div class="line">};</div><div class="line"><span class="keyword">struct </span>ns__derived1</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> value;                             <span class="comment">// base type value of ns__base</span></div><div class="line">    <span class="keywordtype">char</span> *name;                            <span class="comment">// extension</span></div><div class="line">    [ <span class="keyword">struct </span>ns__derived3 *ns__derived3; ] <span class="comment">// points to derived type</span></div><div class="line">};</div><div class="line"><span class="keyword">struct </span>ns__derived2</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> value;                             <span class="comment">// base type value of ns__base</span></div><div class="line">    <span class="keywordtype">float</span> x;                               <span class="comment">// extension</span></div><div class="line">};</div><div class="line"><span class="keyword">struct </span>ns__derived3</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> value;                             <span class="comment">// derived1 type value of ns__base</span></div><div class="line">    <span class="keywordtype">char</span> *name;                            <span class="comment">// derived1 type</span></div><div class="line">    <span class="keywordtype">float</span> x;                               <span class="comment">// extension</span></div><div class="line">};</div></div><!-- fragment --><p>Each transient pointer member name that is used to point to a derived type must match the type name as shown, but trailing underscores are allowed in the member name and type name, to prevent name clashes.</p>
<p>This latter form supports <em><code>xsi:type</code></em> attributes in XML with the derived type name to replace base type values by derived type values at runtime by setting one of the transient pointer members to non-NULL. For example, assume <em><code>ns:data</code></em> has a base type <code>ns__base</code> (i.e. declared as <code>struct ns__base data</code>) then the following is legal and serializable:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:data</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">value</span>&gt;123&lt;/<span class="keywordtype">value</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">ns:data</span>&gt;</div></div><!-- fragment --> </div><p>This is serialized XML for <code>data.value</code> with <code>data.ns__derived1</code> and <code>data.ns__derived2</code> both set to NULL.</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:data</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;ns:derived1&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">value</span>&gt;123&lt;/<span class="keywordtype">value</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">abc</span>&lt;/<span class="keywordtype">name</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;/<span class="keywordtype">ns:data</span>&gt;</div></div><!-- fragment --> </div><p>This is serialized XML for <code>data.ns__derived1-&gt;value</code> and <code>data.ns__derived1-&gt;name</code> where <code>data.ns__derived1</code> is non-NULL, for example allocated and set with <code>data.ns__derived1 = soap_new_ns__derived1(soap)</code>.</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:data</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;ns:derived2&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">value</span>&gt;123&lt;/<span class="keywordtype">value</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">x</span>&gt;3.14&lt;/<span class="keywordtype">x</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;/<span class="keywordtype">ns:data</span>&gt;</div></div><!-- fragment --> </div><p>This is serialized XML for <code>data.ns__derived2-&gt;value</code> and <code>data.ns__derived2-&gt;x</code> where <code>data.ns__derived1</code> is NULL and <code>data.ns__derived2</code> is non-NULL, for example allocated and set with <code>data.ns__derived2 = soap_new_ns__derived2(soap)</code>.</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:data</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;ns:derived3&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">value</span>&gt;123&lt;/<span class="keywordtype">value</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">abc</span>&lt;/<span class="keywordtype">name</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;<span class="keywordtype">x</span>&gt;3.14&lt;/<span class="keywordtype">x</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">ns:data</span>&gt;</div></div><!-- fragment --> </div><p>This is serialized XML for <code>data.ns__derived1-&gt;ns__derived3-&gt;value</code>, <code>data.ns__derived1-&gt;ns__derived3-&gt;name</code>, and <code>data.ns__derived1-&gt;ns__derived3-&gt;x</code> where <code>data.ns__derived1</code> and <code>data.ns__derived1-&gt;ns__derived3</code> are non-NULL.</p>
<p>Note that C++ class inheritance achieves the same results for base and derived types, but without the use of transient pointer members. However, this requires container values to be pointers to support type derivation (class members are already pointers), as generated by wsdl2h for C++.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-f"></a>
wsdl2h -f</h3>
<p>This option removes C++ class inheritance to produce a flat C++ class hierarchy similar to structs in C as generated by wsdl2h.</p>
<p>As a side effect, derived type values can no longer be serialized in place of base type values, see also <a href="#wsdl2h-F"><b><code>wsdl2h -F</code></b> option <b><code>-F</code></b></a>.</p>
<p>Basically this option removes support for <em><code>xsi:type</code></em> in XML that indicates a derived type that is restricted or extended from its base type.</p>
<p>This option also removes pointers from array and container item types, because there are no derived types that could extend the item value types. These pointers are normally added to ensure containers can contain derived type values in addition to the base type values.</p>
<p>For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:tns</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;base&quot;</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;value&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:int&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;derived1&quot;</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &lt;<span class="keywordtype">xsd:extension</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;tns:base&quot;</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;          &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;name&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;      &lt;/<span class="keywordtype">xsd:extension</span>&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    &lt;/<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;derived2&quot;</span>&gt;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    &lt;<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      &lt;<span class="keywordtype">xsd:extension</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;tns:base&quot;</span>&gt;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;          &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;x&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:float&quot;</span>/&gt;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      &lt;/<span class="keywordtype">xsd:extension</span>&gt;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    &lt;/<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;derived3&quot;</span>&gt;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    &lt;<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;      &lt;<span class="keywordtype">xsd:extension</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;tns:derived1&quot;</span>&gt;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;          &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;x&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:float&quot;</span>/&gt;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;      &lt;/<span class="keywordtype">xsd:extension</span>&gt;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    &lt;/<span class="keywordtype">xsd:complexContent</span>&gt;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;&lt;/<span class="keywordtype">xsd:schema</span>&gt;</div></div><!-- fragment --> </div><p>By default without this option, this schema is translated to the following interface header file declaration in C++ with base and derived classes:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ns__base</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">int</span> value;</div><div class="line">};</div><div class="line"><span class="keyword">class </span>ns__derived1 : <span class="keyword">public</span> ns__base</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">char</span> *name; <span class="comment">// extension</span></div><div class="line">};</div><div class="line"><span class="keyword">class </span>ns__derived2 : <span class="keyword">public</span> ns__base</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">float</span> x;    <span class="comment">// extension</span></div><div class="line">};</div><div class="line"><span class="keyword">class </span>ns__derived3 : <span class="keyword">public</span> ns__derived1</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">float</span> x;    <span class="comment">// extension</span></div><div class="line">};</div></div><!-- fragment --><p>By contrast, with <b><code>wsdl2h -f</code></b> option <b><code>-f</code></b> we obtain an interface header file without inheritance but with classes that are extended with the base class members:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ns__base</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">int</span> value;</div><div class="line">};</div><div class="line"><span class="keyword">class </span>ns__derived1</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">int</span> value;  <span class="comment">// base type value of ns__base</span></div><div class="line">    <span class="keywordtype">char</span> *name; <span class="comment">// extension</span></div><div class="line">};</div><div class="line"><span class="keyword">class </span>ns__derived2</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">int</span> value;  <span class="comment">// base type value of ns__base</span></div><div class="line">    <span class="keywordtype">float</span> x;    <span class="comment">// extension</span></div><div class="line">};</div><div class="line"><span class="keyword">class </span>ns__derived3</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">int</span> value;  <span class="comment">// derived1 type value of ns__base</span></div><div class="line">    <span class="keywordtype">char</span> *name; <span class="comment">// derived1 type</span></div><div class="line">    <span class="keywordtype">float</span> x;    <span class="comment">// extension</span></div><div class="line">};</div></div><!-- fragment --><p>This former form supports <em><code>xsi:type</code></em> attributes in XML with the derived type name to replace base type values by derived type values at runtime. But this latter form does not support <em><code>xsi:type</code></em> attributes in XML and only the base class can be serialized, for example <code>ns__base data</code>:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:data</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">value</span>&gt;123&lt;/<span class="keywordtype">value</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">ns:data</span>&gt;</div></div><!-- fragment --> </div><p>This is serialized XML for <code>data.value</code>.</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:data</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;ns:derived1&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">value</span>&gt;123&lt;/<span class="keywordtype">value</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">abc</span>&lt;/<span class="keywordtype">name</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;/<span class="keywordtype">ns:data</span>&gt;</div></div><!-- fragment --> </div><p>This example can be deserialized when <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> is not enabled, but only the <code>value</code> is retained in <code>data.value</code>. However, when <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> is enabled, deserialization fails due to the additional element <em><code>name</code></em> that is rejected.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-g"></a>
wsdl2h -g</h3>
<p>This option adds global top-level element and attribute declarations to the interface header file generated by wsdl2h.</p>
<p>For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:tns</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xsd:attribute</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;type&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:QName&quot;</span>/&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;data&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;tns:record&quot;</span>/&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;record&quot;</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;name&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;value&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:int&quot;</span>/&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&lt;/<span class="keywordtype">xsd:schema</span>&gt;</div></div><!-- fragment --> </div><p>By default without this option, this schema is translated to the following C++ interface header file (the C interface header file is similar) that declares the <code>ns__record</code> type for <em><code>tns:record</code></em> but does not declare attribute <em><code>tns:type</code></em> and element <em><code>tns:data</code></em>:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> std::string xsd__QName;</div><div class="line"><span class="keyword">class </span>ns__record</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    std::string name;</div><div class="line">    <span class="keywordtype">int</span> value;</div><div class="line">};</div></div><!-- fragment --><p>By contrast, with <b><code>wsdl2h -g</code></b> option <b><code>-g</code></b> we obtain an interface header file with the attribute and element declarations:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> std::string xsd__QName;</div><div class="line"><span class="keyword">class </span>ns__record</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    std::string name;</div><div class="line">    <span class="keywordtype">int</span> value;</div><div class="line">};</div><div class="line"><span class="keyword">typedef</span> ns__record _ns__data; </div><div class="line"><span class="keyword">typedef</span> xsd__QName _ns__type;</div></div><!-- fragment --><p>This defines <code>_ns__type</code> and <code>_ns__data</code>, where the latter can be used as a root element to serialize its content with the soapcpp2-generated readers and writers:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">_ns__data data;</div><div class="line"><span class="keywordflow">if</span> (soap_read__ns__data(soap, &amp;data))</div><div class="line">  ... <span class="comment">// error</span></div><div class="line"><span class="keywordflow">if</span> (soap_write__ns__data(soap, &amp;data))</div><div class="line">  ... <span class="comment">// error</span></div></div><!-- fragment --><p>which parses and re-writes the XML fragment:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:data</span> <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;urn:example&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">abc</span>&lt;/<span class="keywordtype">name</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">value</span>&gt;123&lt;/<span class="keywordtype">value</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;/<span class="keywordtype">ns:data</span>&gt;</div></div><!-- fragment --> </div><p>Note that top-level element and attribute type names start with an underscore to distinguish them from types. This convention is also used by soapcpp2 to generate schemas that define top-level attributes and elements.</p>
<p>Note that a schema may define a global top-level element with a local type, for example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:tns</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;record&quot;</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;name&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;value&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:int&quot;</span>/&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &lt;/<span class="keywordtype">xsd:element</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&lt;/<span class="keywordtype">xsd:schema</span>&gt;</div></div><!-- fragment --> </div><p>This schema is translated to the following C++ interface header file (the C interface header file is simular) that declares the <code>_ns__record</code> type and element for the <em><code>tns:record</code></em> top-level element:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>_ns__record</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    std::string name;</div><div class="line">    <span class="keywordtype">int</span> value;</div><div class="line">};</div></div><!-- fragment --><p>In this case option <b><code>-g</code></b> has no effect, because <em><code>tns:record</code></em> has a local type that may be used elsewhere in the schema.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-h"></a>
wsdl2h -h</h3>
<p>This option displays help info and then exits.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-I"></a>
wsdl2h -I</h3>
<p>This option specifies a directory path to search for WSDL and XSD files.</p>
<p>For example: </p><pre class="fragment">wsdl2h -I path file.wsdl
</pre><p>This searches <em><code>path</code></em> for <em><code>.wsdl</code></em> and <em><code>.xsd</code></em> files that are imported by <em><code>file.wsdl</code></em> and by other imported files.</p>
<p>When a WSDL or XSD file imports another file then:</p>
<ul>
<li>a file name referenced by <code><a href="http://">http://</a></code> or by <code><a href="https://">https://</a></code> is retrieved from the specified URL.</li>
<li>a file name referenced by <code><a href="file://">file://</a></code> is retrieved from the path specified relative to the directory in which <b><code>wsdl2h</code></b> is run and the <b><code>-I</code></b> option can be used to change that location to import from.</li>
<li>a file name without a path (i.e. has no <code>/</code>) or a file name with path stating with <code>../</code> are considered files located at relative path locations with respect to the current WSDL and XSD that is importing this file</li>
<li>otherwise, imported files are considered relative to the directory in which <b><code>wsdl2h</code></b> is run and the <b><code>-I</code></b> option can be used to change that location to import from.</li>
</ul>
<p>WSDL and XSD files that import other WSDL and XSD files typically use relative paths, at least that is recommended by best practices. If absolute paths are used then wsdl2h may fail to find the imported WSDLs and XSDs. This option resolves relative paths but does not help to resolve absolute paths. In the worst case one must edit the WSDLs and XSDs to refer to proper file locations.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-i"></a>
wsdl2h -i</h3>
<p>This option skips over schema <em><code>import</code></em> and as a result none of the imported schemas and their components are imported.</p>
<p>There are two reasons to use this option:</p>
<ul>
<li>when imported components are already declared in interface header files that are imported into the main interface header file with <code>#import</code>, and</li>
<li>when imported schemas are explicitly provided with the wsdl2h command as command line arguments, which means that the specified schemas will be used instead of the imported schemas. This may help to resolve issues when imported files are not found by wsdl2h. The schema <em><code>targetNamespace</code></em> namespace names are relevant when schemas reference imported schemas by their namespace, not the schema file name.</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-j"></a>
wsdl2h -j</h3>
<p>This option skips the generation of <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> and <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code> structure definitions, assuming that these are manually replaced in the generated interface header file for soapcpp2.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-k"></a>
wsdl2h -k</h3>
<p>This option skips the generation of <code>mustUnderstand</code> qualifiers for <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> members. This removes the <em><code>mustUnderstand="true"</code></em> XML attributes from SOAP Headers in SOAP messages. As per SOAP standard, SOAP Headers with <em><code>mustUnderstand="true"</code></em> must not be ignored by receivers.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-L"></a>
wsdl2h -L</h3>
<p>This option generates less documentation by removing generic <code>@note</code> comments from the interface header file output, thereby reducing the size of the output without removing critical information.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-l"></a>
wsdl2h -l</h3>
<p>This option displays license information.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-M"></a>
wsdl2h -M</h3>
<p>This option suppresses the wsdl2h error message </p><pre class="fragment">"must understand element with wsdl:required='true'"
</pre><p>This error indicates that a (special) WSDL construct was used that is marked <em><code>wsdl:required="true"</code></em>, meaning that must not be ignored by the WSDL processor (unless the developer knows what he or she is doing).</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-m"></a>
wsdl2h -m</h3>
<p>This option tells wsdl2h to use <em><code>xsd.h</code></em> to define the primitive XSD types instead of generating them in the interface header file for soapcpp2. This option offers an alternative to the use of <em><code>typemap.dat</code></em> to redefine primitive XSD types by defining them all together instead of on a type-by-type basis. The interface header file output by wsdl2h includes <code>#import "xsd.h"</code>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-N"></a>
wsdl2h -N</h3>
<p>This option specifies a name to be used as a service namespace prefix for each WSDL binding.</p>
<p>By default without this option, the wsdl2h tool warns when it reads one or more WSDLs that define multiple bindings: </p><pre class="fragment">Warning: 3 service bindings found, but collected as one service (use option -Nname to produce a separate service for each binding)
</pre><p>This means that all 3 services will be collected under one name. When proxy and service classes are generated with <b><code>soapcpp2 -i</code></b> option <b><code>-i</code></b> or with <b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b> then the service operations are collected into one proxy and service class. Essentially only one namespace is used. This may lead to clashes when multiple bindings define the same Web service operations (name clashes are resolved by wsdl2h by adding trailing underscores).</p>
<p>By contrast, with <b><code>wsdl2h -N name</code></b> option <b><code>-N name</code></b> we obtain an interface header file that uses the specified name as a prefix to define the service bindings and service operations.</p>
<p>For example: </p><pre class="fragment">wsdl2h -N foo file.wsdl
</pre><p>If <em><code>file.wsdl</code></em> has multiple bindings, then the Web service operations associated with each binding are identified by their prefix <code>foo1</code>, <code>foo2</code>, <code>foo3</code>, and so on. As a result, we obtain more than one proxy and service class generated by soapcpp2, one for each binding.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-n"></a>
wsdl2h -n</h3>
<p>This option changes the default <code>ns</code> namespace prefix to the specified prefix name.</p>
<p>By default without this option, the XML namespace prefix is <code>ns</code> which results in the generation of prefixes <code>ns1</code>, <code>ns2</code>, <code>ns3</code>, and so on.</p>
<p>For example: </p><pre class="fragment">wsdl2h -n foo file.wsdl
</pre><p>This generates namespace prefixes <code>foo1</code>, <code>foo2</code>, <code>foo3</code>, and so on.</p>
<dl class="section warning"><dt>Warning</dt><dd>It is strongly recommended to define namespace prefixes in the <a href="#typemap"><em><code>typemap.dat</code></em> file</a> to prevent future runs of wsdl2h to produce namespace prefixes that are not in the same original order. For example when the order of WSDLs and XSDs changes or if new WSDLs and XSDs are added. Therefore, do not use this option unless the single WSDL processed by wsdl2h is relatively simple and does not import WSDLs and XSDs.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-O"></a>
wsdl2h -O</h3>
<p>This option optimizes the generated interface header file:</p>
<ul>
<li><b><code>-O1</code></b> removes duplicate choice/sequence members;</li>
<li><b><code>-O2</code></b> optimize with <b><code>-O1</code></b> and remove unused schema types (types that are unreachable from top-level schema element and attribute roots);</li>
<li><b><code>-O3</code></b> optimize with <b><code>-O2</code></b> and remove unused schema top-level root attributes;</li>
<li><b><code>-O4</code></b> optimize with <b><code>-O3</code></b> and remove unused schema top-level root elements, only retain the root elements used by WSDLs. Use this option only when converting WSDLs (and their associated XSD schemas) to source code, not when solely converting XSD schemas to source code.</li>
</ul>
<p>Option <b><code>-O4</code></b> is the most aggressive. When used only for one or more XSDs as input to wsdl2h, the output will be empty because removing the root elements (and attributes) results in removing all types from the schema. However, this option is safe to use with WSDLs to aggressively remove all unused schema components that are unreachable from the Web service operation parameter elements and types. Option <b><code>-O3</code></b> is safe to use with one or more XSDs as input to wsdl2h instead of WSDLs, for example when developing an XML application that serializes data as XML root elements (<b><code>wsdl2h -g</code></b> <a href="#wsdl2h-g">option <b><code>-g</code></b></a> is recommended in this case).</p>
<p>Optimization by schema slicing removes unused types, which are types that are unreachable from top-level schema element and attribute roots. A type is marked as <em>used</em> when:</p>
<ul>
<li>it is explicitly used by one or more top-level elements and attributes;</li>
<li>it is used as a type by a child element or attribute of a complexType that is marked as <em>used</em>;</li>
<li>it is used as the base type of an extension or restriction of a simpleType or complexType that is marked as <em>used</em>.</li>
</ul>
<p>Marking proceeds recursively until no more types can be marked. All remaining unused types are removed. Top-level elements and attributes are selectively marked unused and removed depending on the level of optimization applied, with <b><code>-O3</code></b> removing unused top-level attributes and <b><code>-O4</code></b> removing unused top-level elements except for all elements used in the specified WSDLs.</p>
<p>Aggressive optimization with options <b><code>-O2</code></b>, <b><code>-O3</code></b>, and <b><code>-O4</code></b> removes derived type extensions of a base type when the derived types are not marked as <em>used</em>. However, in certain messaging scenarios this may have the undesired effect that this limits the choice of derived types that can be used to replace a base type in XML messages, because a derived type may have been removed when it is not marked as <em>used</em> elsewhere in the WSDLs and XSD schemas. A derived type that replaces a base type in an XML message is indicated by a <em><code>xsi:type</code></em> attribute with the QName value of the derived type. The wsdl2h tool generates a C++ class hierarchy to support type derivation, so assigning a derived type value instead of a base type value to a pointer member is automatically serialized in XML with the specified derived value (which is indicated by <em><code>xsi:type</code></em> attribute in the XML message). For C applications, we should use <b><code>wsdl2h -c -F</code></b> <a href="#wsdl2h-c">option <b><code>-c</code></b></a> and <a href="#wsdl2h-F">option <b><code>-F</code></b></a> to simulate inheritance in C. In both cases it is recommended to use the following options to retain all derived type extensions of a base type that is marked as <em>used</em>:</p>
<ul>
<li><b><code>-Ow2</code></b> optimize with <b><code>-O2</code></b> to remove unused schema types, but retain types that are derived types of base types that are marked as used. .</li>
<li><b><code>-Ow3</code></b> optimize with <b><code>-O3</code></b> to remove unused schema top-level root attributes, but retain types that are derived types of base types that are marked as used..</li>
<li><b><code>-Ow4</code></b> optimize with <b><code>-O4</code></b> to remove unused schema top-level root elements, but retain types that are derived types of base types that are marked as used.</li>
</ul>
<p>This permits a base type value (typically a struct or class member that is a pointer to a base type) to be assigned a derived type in C++, which is serialized in XML with a <em><code>xsi:type</code></em> attribute to indicate the type of the derived value. Likewise, XML data with derived type values are deserialized to C/C++ data automatically. Inheritance is simulated in C, see <a href="#wsdl2h-F">option <b><code>-F</code></b></a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-o"></a>
wsdl2h -o</h3>
<p>This option specifies a file name for the wsdl2h interface header file output.</p>
<p>By default without this option, the wsdl2h tool writes the interface header file to the file named after the first file name input at the command line, but using <em><code>.h</code></em> as the file name extension.</p>
<p>When the input to the wsdl2h tool consists of URLs, the wsdl2h tool writes its output to standard output (usually the screen). Use this option to specify a file instead.</p>
<p>For example: </p><pre class="fragment">wsdl2h calc.wsdl
</pre><p>This saves <em><code>calc.h</code></em> because the first file specified on the command line is <em><code>calc.wsdl</code></em>.</p>
<p>Option <b><code>-o</code></b> should be used when a URL is specified on the command line: </p><pre class="fragment">wsdl2h -o calc.h http://www.genivia.com/calc.wsdl
</pre><p>This saves the interface header file <em><code>calc.h</code></em>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-P"></a>
wsdl2h -P</h3>
<p>This option disables the generation of types inherited from the <code>xsd__anyType</code> base type.</p>
<p>This option has effect only when <a href="#wsld2h-p"><b><code>wsdl2h -p</code></b> option <b><code>-p</code></b></a> is used or when the wsdl2h tool detects that <em><code>xsd:anyType</code></em> is used (thereby implicitly and automatically enabling option <b><code>-p</code></b>), which means that <code>xsd__anyType</code> should be a base type for all possible types defined in the schemas.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-p"></a>
wsdl2h -p</h3>
<p>This option makes all types inherit <code>xsd__anyType</code> to support full polymorphism.</p>
<p>This option is automatically enabled when the wsld2h tool detects that <em><code>xsd:anyType</code></em> is used, which means that <code>xsd__anyType</code> should be a base type for all possible types defined in the schemas. To disable, use <a href="#wsld2h-P"><b><code>wsdl2h -P</code></b> option <b><code>-P</code></b></a>.</p>
<p>For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;data&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;data&quot;</span>/&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;data&quot;</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;value&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;item&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:anyType&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;unbounded&quot;</span>/&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;/<span class="keywordtype">xsd:schema</span>&gt;</div></div><!-- fragment --> </div><p>This schema is translated to the following C++ interface header file that declares the <code>xsd__anyType</code> type with <code>_XML</code> simpleContent (meaning that <code>__item</code> contains element content as per gSOAP convention) and the <code>ns__data</code> class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>xsd__anyType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <a class="code" href="group__group__fault.html#ga5c62d26b4823b76c5b4ef29e7865d3f0">_XML</a> __item;</div><div class="line">};</div><div class="line"><span class="keyword">class </span>xsd__string_ : <span class="keyword">public</span> xsd__anyType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    std::string __item;</div><div class="line">};</div><div class="line"><span class="keyword">class </span>ns__data : <span class="keyword">public</span> xsd__anyType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    std::string value;</div><div class="line">    std::vector&lt;xsd__anyType*&gt; item;</div><div class="line">};</div></div><!-- fragment --><p>The <code>xsd__anyType</code> pointer values of the items of the vector can be assigned derived class instances to serialize any type of value declared in the interface header file, including the <code>xsd__string_</code> wrapper class with simpleContent and the <code>ns__data</code> class with complexContent.</p>
<p>This schema is translated to the following C interface header file with <b><code>wsdl2h -c -F</code></b> <a href="#wsdl2h-c">option <b><code>-c</code></b></a> and <a href="#wsdl2h-F">option <b><code>-F</code></b></a> to simulate inheritance in C:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>xsd__string_</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span>* __item;</div><div class="line">};</div><div class="line"><span class="keyword">struct </span>xsd__anyType_</div><div class="line">{</div><div class="line">    <a class="code" href="group__group__fault.html#ga5c62d26b4823b76c5b4ef29e7865d3f0">_XML</a> __item;</div><div class="line">  [ <span class="keyword">struct </span>xsd__string_ *xsd__string; ]</div><div class="line">  [ <span class="keyword">struct </span>ns__data *ns__data; ]</div><div class="line">};</div><div class="line"><span class="keyword">struct </span>ns__data</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span>* value;</div><div class="line">  $ <span class="keywordtype">int</span> __sizeitem;</div><div class="line">    <span class="keyword">struct </span>xsd__anyType_* item;</div><div class="line">};</div></div><!-- fragment --><p>The <code>xsd__anyType_</code> values of items of the dynamic array (<code>item</code> points to an array of size <code>__sizeitem</code> which is a special member to indicate dynamic arrays) can be assigned base <code>xsd__anyType_</code> and derived types, see <a href="#wsdl2h-F"><b><code>wsdlh2 -F</code></b> option <b><code>-F</code></b></a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-Q"></a>
wsdl2h -Q</h3>
<p>This option makes <code>xsd__anySimpleType</code> equal to <code>xsd__anyType</code> to use as the base type for derivation. This option is more effective when used with <a href="#wsdl2h-p"><b><code>wsdl2h -p</code></b> option <b><code>-p</code></b></a> for C++ applications and <a href="#wsdl2h-F"><b><code>wsdl2h -F</code></b> option <b><code>-F</code></b></a> for C applications. This option can also be used with <a href="#wsdl2h-d"><b><code>wsdl2h -d</code></b> option <b><code>-d</code></b></a> to make <code>xsd__anySimpleType</code> equal to a DOM node.</p>
<p>Without option <b><code>-Q</code></b>, the <code>xsd__anySimpleType</code> type is just a C/C++ string generated by wsdl2h:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span>* xsd__anySimpleType;        <span class="comment">// in case of C</span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> std::string xsd__anySimpleType;  <span class="comment">// in case of C++</span></div></div><!-- fragment --><p>The reason for this choice is that some WSDLs and XSD schemas use <em><code>xsd:anySimpleType</code></em> to declare XML attributes of any type (because XML attributes must be simple types <em><code>xsd:anyType</code></em> is invalid to use for attributes). The values of XML attributes of type <em><code>xsd:anySimpleType</code></em> can be any character data essentially. There is no mechanism to indicate the actual type of the attribute value used, unlike elements that are annotated with <em><code>xsi:type</code></em> attribute with the derived type as its QName value. Therefore, by considering <code>xsd__anySimpleType</code> just strings we can provide any value for XML attributes of type <em><code>xsd:anySimpleType</code></em>.</p>
<p>However, there are other uses of <code>xsd__anySimpleType</code> in XSD schemas, where essentially <code>xsd__anySimpleType</code> serves the same purpose as <code>xsd__anyType</code> to provide a base type for derived types, but restricts the derived types to simple types.</p>
<p>Unfortunately, these two cases clash: we want to use C/C++ strings for XML attributes of type <em><code>xsd:anySimpleType</code></em> and also use <em><code>xsd:anySimpleType</code></em> as a base class for derived types.</p>
<p>Option <b><code>-Q</code></b> enables the latter case by making <code>xsd__anySimpleType</code> equal to <code>xsd__anyType</code> so that elements of type <em><code>xsd:anySimpleType</code></em> can be serialized with a derived type, using inheritance in C++ and by using simulated inheritance in C using <a href="#wsdl2h-F"><b><code>wsdl2h -F</code></b> option <b><code>-F</code></b></a>.</p>
<p>For example, option <b><code>-Q</code></b> changes this generated code for C++ applications:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>xsd__anyType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <a class="code" href="group__group__fault.html#ga5c62d26b4823b76c5b4ef29e7865d3f0">_XML</a> __item;</div><div class="line">    <span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> std::string xsd__anySimpleType;</div><div class="line"></div><div class="line"><span class="keyword">class </span>ns__record : <span class="keyword">public</span> xsd__anyType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    xsd__anySimpleType value;  <span class="comment">// non-polymorphic xsd:anySimpleType value</span></div><div class="line">}</div></div><!-- fragment --><p>into:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>xsd__anyType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <a class="code" href="group__group__fault.html#ga5c62d26b4823b76c5b4ef29e7865d3f0">_XML</a> __item;</div><div class="line">    <span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span>ns__record : <span class="keyword">public</span> xsd__anyType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    xsd__anyType *value;  <span class="comment">// polymorphic xsd:anySimpleType value</span></div><div class="line">}</div></div><!-- fragment --><p>where all other classes generated by wsdl2h <a href="#wsdl2h-p">option <b><code>-p</code></b></a> are derived from <code>xsd__anyType</code>, meaning that <code>value</code> can be assigned any one of these classes as long as the class is a simple type wrapper (wsdl2h generates comments to indicate that the polymorhpic value should be a <em><code>xsd:anySimpleType</code></em>).</p>
<p>Similar code is generated by wsdl2h <a href="#wsdl2h-F">option <b><code>-F</code></b></a> for C applications.</p>
<p>On the other hand this option invalidates XML attributes of type <em><code>xsd:anySimpleType</code></em>. The soapcpp2 tool warns about this invalid attribute type as a result.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-q"></a>
wsdl2h -q</h3>
<p>This option specifies a C++ namespace name. The interface header file declarations are placed in the given C++ namespace.</p>
<p>For example: </p><pre class="fragment">wsdl2h -q api file.wsdl
</pre><p>The generated interface header file for soapcpp2 places all declarations in the <code>api</code> C++ namespace:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>api {</div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>It is more difficult to use SOAP Headers and SOAP Faults when C++ namespaces are used. When wsdl2h finds SOAP Headers and SOAP Fault Details it collects these into <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> and <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code> structures, which become part of the given C++ namespace. However, to use the <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> and <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code> structures these should be declared at the global scope. This option places these structures with the types used by their members in the given C++ namespace, making them unavailable to the global scope.</dd></dl>
<p>See <a class="el" href="index.html#codenamespace">How to build a client or server in a C++ code namespace</a> for details on using C++ namespaces to build client and server applications, which requires a <em><code>env.h</code></em> file with SOAP Header and Fault definitions to be compiled with: </p><pre class="fragment"> soapcpp2 -penv env.h
</pre><p>The generated <em><code>envC.cpp</code></em> file holds the SOAP Header and Fault serializers and you can link this file with your client and server applications.</p>
<p>This option has no effect for C source code output.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-R"></a>
wsdl2h -R</h3>
<p>This option enables the generation of REST service operations in the interface header file saved by wsdl2h for soapcpp2.</p>
<p>By default without this option, REST service operations defined in one or more WSDLs are ignored.</p>
<p>With this option, both REST and SOAP service operations are declared in the interface header file.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-r"></a>
wsdl2h -r</h3>
<p>This option specifies a proxy host name and port number with proxy credentials to connect to web sites through a proxy server.</p>
<p>This option can also be used to specify credentials to access a web site that requires authentication (HTTP basic or digest authentication).</p>
<p>For example: </p><pre class="fragment">wsdl2h -r proxy.example.org:80:proxyuserid:proxypasswd -r userid:passwd
</pre><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-S"></a>
wsdl2h -S</h3>
<p>This option renames the <code>soap</code> members of the generated C++ classes in the interface header file for soapcpp2.</p>
<p>By default without this option, wsdl2h adds <code>struct soap *soap</code> members to classes and structs. This member points to the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context that manages the instance, when the instance was allocated by the gSOAP engine.</p>
<p>To remove the <code>struct soap *soap</code> members use this option with an empty name: </p><pre class="fragment">wsdl2h -S '' file.wsdl
</pre><p>To rename the <code>struct soap *soap</code> members, specify a name for the member, for example <code>ctx</code>: </p><pre class="fragment">wsdl2h -S ctx file.wsdl
</pre><p>This option has no effect for C source code output.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-s"></a>
wsdl2h -s</h3>
<p>This option replaces STL <code>std::vector</code> and <code>std::string</code> by C-like equivalents and is intended for systems with limited support for C++ libraries.</p>
<p>The <code>std::vector</code> struct/class member is replaced by a dynamic array, declared with a <code>__size</code> member followed by a pointer member to the array items.</p>
<p>The <code>std::string</code> is replaced by <code>char*</code>.</p>
<p>This option has no effect for C source code output.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-t"></a>
wsdl2h -t</h3>
<p>This option specifies an alternate file or path for <em><code>typemap.dat</code></em>. See <a href="#typemap"><em><code>typemap.dat</code></em> file</a>.</p>
<p>For example: </p><pre class="fragment">wsdl2h -t $GSOAP/gsoap/typemap.dat file.wsdl
</pre><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-U"></a>
wsdl2h -U</h3>
<p>This option allows UTF-8-encoded Unicode C/C++ identifier names in the generated interface header file for soapcpp2. This assumes that the C/C++ compiler that is used to compile a gSOAP client or server application supports Unicode identifier names.</p>
<p>By default without this option, Unicode XML names in WSDLs and XSDs are preserved using the gSOAP convention for UCS-2 characters in identifier names with <code>_xHHHH</code> where <code>HHHH</code> is a hexadecimal Unicode character code point.</p>
<p>With this option, Unicode XML names in WSDLs and XSDs are preserved "as is" in C/C++ identifier names.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-u"></a>
wsdl2h -u</h3>
<p>This option replaces unions with structs/classes in the generated interface header file for soapcpp2. Union members are used to represent <em><code>xsd:choice</code></em> of elements. A choice of elements can also be represented by pointer members of a struct/class such that only one member is non-NULL. However, when using a struct/class instead of a union, the deserialization validator will not reject additional elements when present.</p>
<p>For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:schema</span> <span class="keyword">targetNamespace</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;data&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;data&quot;</span>/&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;data&quot;</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;value&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;      &lt;<span class="keywordtype">xsd:choice</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;string&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;number&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:float&quot;</span>/&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &lt;/<span class="keywordtype">xsd:choice</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  &lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;&lt;/<span class="keywordtype">xsd:schema</span>&gt;</div></div><!-- fragment --> </div><p>By default without this option, wsdl2h generates a tagged <code>union</code> for the <em><code>xsd:choice</code></em>, where the tag is a special member <code>int __union_data</code> that is set to <code>SOAP_UNION__ns__union_data_string</code> when the <code>string</code> union member is valid or <code>SOAP_UNION__ns__union_data_number</code> when the <code>number</code> union member is valid:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ns__data</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    std::string value;</div><div class="line">  $ <span class="keywordtype">int</span> __union_data;</div><div class="line">    <span class="keyword">union </span>_ns__union_data</div><div class="line">    {</div><div class="line">        std::string* string;</div><div class="line">        <span class="keywordtype">float</span> number;</div><div class="line">    } union_data;</div><div class="line">};</div></div><!-- fragment --><p>With this option, wsdl2h removes the <code>union</code> and replaces it with pointer members to produce a simpler structure:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ns__data</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    std::string value;</div><div class="line"><span class="comment">//  BEGIN CHOICE &lt;xs:choice&gt;</span></div><div class="line">    std::string* string; <span class="comment">// Choice of element (one of multiple choices)</span></div><div class="line">    <span class="keywordtype">float</span>* number;       <span class="comment">// Choice of element (one of multiple choices)</span></div><div class="line"><span class="comment">//  END OF CHOICE</span></div><div class="line">};</div></div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>This option removes the uniqueness check on choices from the deserialization validator. When serializing data, only one of the choice pointer members should be non-NULL.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-V"></a>
wsdl2h -V</h3>
<p>This option displays the current wsdl2h tool version and then exits.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-v"></a>
wsdl2h -v</h3>
<p>This option enables verbose output to assist in debugging the wsdl2h tool.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-W"></a>
wsdl2h -W</h3>
<p>This option suppresses all warnings produced by wsdl2h. Errors are not suppressed.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-w"></a>
wsdl2h -w</h3>
<p>This option wraps response parameters in a response struct.</p>
<p>The last parameter of a service operation declared as a function in the interface header file is the response parameter. When multiple response parameters are returned by the service operation or if the response parameter is a complexType (a struct or class), then the parameters should be wrapped in a special "response struct". However, if a single response parameter is a primitive type value then this parameter does not need to be wrapped in a response struct.</p>
<p>This option consistently wraps response parameters in a response struct, even when a single response parameter is a primitive type value.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-X"></a>
wsdl2h -X</h3>
<p>Document/literal wrapped patterns may cause ambiguities with respect to message namespace qualification. A <em><code>part</code></em> name associated with a <em><code>type</code></em> is implicitly qualified by the targetNamespace of the WSDL but may also be associated with the namespace of the type. By default, the wsdl2h tool uses the namespace of the type when the type is not a primitive XSD type, otherwise the WSDL targetNamespace is used.</p>
<p>As an example of a document/literal wrapped pattern message, consider:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">wsdl:types</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xs:schema</span> ...&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">xs:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Record&quot;</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      ...</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">wsdl:types</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;...</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;<span class="keywordtype">wsdl:message</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Message&quot;</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;<span class="keywordtype">wsdl:part</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Name&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xs:string&quot;</span>/&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &lt;<span class="keywordtype">wsdl:part</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Info&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;tns:Record&quot;</span>/&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&lt;/<span class="keywordtype">wsdl:message</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;...</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;&lt;<span class="keywordtype">wsdl:operation</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Operation&quot;</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  &lt;<span class="keywordtype">wsdl:input</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;tns:Message&quot;</span>/&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  &lt;<span class="keywordtype">wsdl:output</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;tns:MessageResponse&quot;</span>/&gt;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;&lt;/<span class="keywordtype">wsdl:operation</span>&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;...</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;&lt;<span class="keywordtype">wsdl:binding</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Binding&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;tns:PortType&quot;</span>&gt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  &lt;<span class="keywordtype">soap:binding</span> <span class="keyword">style</span>=<span class="stringliteral">&quot;document&quot;</span> <span class="keyword">transport</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/http&quot;</span>/&gt;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  &lt;<span class="keywordtype">wsdl:operation</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Operation&quot;</span>&gt;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    &lt;<span class="keywordtype">soap:operation</span> <span class="keyword">soapAction</span>=<span class="stringliteral">&quot;Action&quot;</span>/&gt;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    &lt;<span class="keywordtype">wsdl:input</span>&gt;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      &lt;<span class="keywordtype">soap:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span>/&gt;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    &lt;/<span class="keywordtype">wsdl:input</span>&gt;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    &lt;<span class="keywordtype">wsdl:output</span>&gt;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;      &lt;<span class="keywordtype">soap:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span>/&gt;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    &lt;/<span class="keywordtype">wsdl:output</span>&gt;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  &lt;/<span class="keywordtype">wsdl:operation</span>&gt;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  ...</div></div><!-- fragment --> </div><p>Note that <em><code>message name="Message"</code></em> has two parts with both a type, which makes these part namespaces amiguous. The generated interface header file declares a wrapper for the <em><code>Name</code></em> request message and the <em><code>Info</code></em> response message:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> __ns1__Operation(</div><div class="line">    std::string Name,</div><div class="line">    ns1__Record ns2__Info</div><div class="line">    );</div></div><!-- fragment --><p>Here, <em><code>Name</code></em> belongs to the <em><code>ns1</code></em> namespace, i.e. by the <em><code>__ns1__Operation</code></em>, whereas <em><code>Info</code></em> belongs to the <code>ns2</code> namespace. The <em><code>__ns1__Operation</code></em> is just a wrapper for the operation and is not visible in XML. Only <em><code>Name</code></em> and <em><code>Info</code></em> are serialized in XML as the request and response message, respectively.</p>
<p>With option <b><code>-X</code></b> the <em><code>ns2</code></em> qualifier is removed:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> __ns1__Operation(</div><div class="line">    std::string Name,</div><div class="line">    ns1__Record Info</div><div class="line">    );</div></div><!-- fragment --><p>Now both <em><code>Name</code></em> and <em><code>Info</code></em> belong to the <em><code>ns1</code></em> namespace, i.e. by the <em><code>__ns1__Operation</code></em>.</p>
<p>However, best practices for document/literal messaging recommend to avoid this wrapped pattern construct in favor of using elements defined in schemas:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">wsdl:types</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xs:schema</span> ...&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">xs:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Name&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xs:string&quot;</span>/&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">xs:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Info&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;tns:Record&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;<span class="keywordtype">xs:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Record&quot;</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;      ...</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    ...</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;/<span class="keywordtype">wsdl:types</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;...</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&lt;<span class="keywordtype">wsdl:message</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Message&quot;</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  &lt;<span class="keywordtype">wsdl:part</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Name&quot;</span> <span class="keyword">element</span>=<span class="stringliteral">&quot;tns:Name&quot;</span>/&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  &lt;<span class="keywordtype">wsdl:part</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Info&quot;</span> <span class="keyword">element</span>=<span class="stringliteral">&quot;tns:Record&quot;</span>/&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;/<span class="keywordtype">wsdl:message</span>&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;...</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;&lt;<span class="keywordtype">wsdl:operation</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Operation&quot;</span>&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  &lt;<span class="keywordtype">wsdl:input</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;tns:Message&quot;</span>/&gt;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  &lt;<span class="keywordtype">wsdl:output</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;tns:MessageResponse&quot;</span>/&gt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;&lt;/<span class="keywordtype">wsdl:operation</span>&gt;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;...</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;&lt;<span class="keywordtype">wsdl:binding</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;netfileOverSoap&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;tns:netfileOverSoap&quot;</span>&gt;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  &lt;<span class="keywordtype">soap:binding</span> <span class="keyword">style</span>=<span class="stringliteral">&quot;document&quot;</span> <span class="keyword">transport</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/http&quot;</span>/&gt;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  &lt;<span class="keywordtype">wsdl:operation</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Operation&quot;</span>&gt;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    &lt;<span class="keywordtype">soap:operation</span> <span class="keyword">soapAction</span>=<span class="stringliteral">&quot;Action&quot;</span>/&gt;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    &lt;<span class="keywordtype">wsdl:input</span>&gt;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;      &lt;<span class="keywordtype">soap:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span>/&gt;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    &lt;/<span class="keywordtype">wsdl:input</span>&gt;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    &lt;<span class="keywordtype">wsdl:output</span>&gt;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;      &lt;<span class="keywordtype">soap:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span>/&gt;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    &lt;/<span class="keywordtype">wsdl:output</span>&gt;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  &lt;/<span class="keywordtype">wsdl:operation</span>&gt;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  ...</div></div><!-- fragment --> </div><p>The elements <em><code>Name</code></em> and <em><code>Record</code></em> are the actual message names, qualified by the schema's targetNamespace:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> __ns1__Operation(</div><div class="line">    std::string ns2__Name,</div><div class="line">    ns1__Record ns2__Info</div><div class="line">    );</div></div><!-- fragment --><p>See also wsdl2h <a href="#wsdl2h-z">option <b><code>-z7</code></b></a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-x"></a>
wsdl2h -x</h3>
<p>This option removes <code>_XML</code> type members of structs and classes that are generated for <em><code>xsd:any</code></em> and <em><code>xsd:anyAttribute</code></em> components.</p>
<p>There are two options to represent <em><code>xsd:any</code></em> and <em><code>xsd:anyAttribute</code></em> components: the literal <code>_XML</code> string type with XML content (a <code>char*</code> string) or a DOM node. DOM nodes are generated for <em><code>xsd:any</code></em> and <em><code>xsd:anyAttribute</code></em> components with <a href="#wsdl2h-d"><b><code>wsdl2h -d</code></b> option <b><code>-d</code></b></a>, which also defines <em><code>xsd:anyType</code></em> as the DOM node <code>xsd__anyType</code> in C and C++.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-y"></a>
wsdl2h -y</h3>
<p>This option adds typedef synonyms for structs and enums to the interface header file, which is useful for C source code. A typedef synonym for a struct is declared by <code>typedef struct name name;</code> and for an enum is declared by <code>typedef enum name name;</code>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-z"></a>
wsdl2h -z</h3>
<p>These options are for backward compatiility with older gSOAP releases:</p>
<ul>
<li><b><code>-z1</code></b> compatibility with 2.7.6e: generate pointer-based arrays</li>
<li><b><code>-z2</code></b> compatibility with 2.7.15: (un)qualify element/attribute referenced members</li>
<li><b><code>-z3</code></b> compatibility with 2.7.16 to 2.8.7: (un)qualify element/attribute referenced members</li>
<li><b><code>-z4</code></b> compatibility up to 2.8.11: don't generate union structs in std::vector</li>
<li><b><code>-z5</code></b> compatibility up to 2.8.15: don't include minor improvements</li>
<li><b><code>-z6</code></b> compatibility up to 2.8.17: don't include minor improvements</li>
<li><b><code>-z7</code></b> compatibility up to 2.8.59: don't generate <code>std::vector</code> of class of union</li>
<li><b><code>-z8</code></b> compatibility up to 2.8.74: don't generate qualifiers for doc/lit wrapped patterns</li>
<li><b><code>-z9</code></b> compatibility up to 2.8.93: always qualify element/attribute referenced members, even when defined in the same namespace with default forms unqualified</li>
<li><b><code>-z10</code></b> compatibility up to 2.8.96: generate qualifiers even when defined without namespace</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsdl2h-_"></a>
wsdl2h -_</h3>
<p>This option replaces <code>_USCORE</code> by the Unicode <code>_x005f</code> character code point in identifier names in C and C++ in the generated interface header file.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="typemap"></a>
Customizing XML data bindings with the typemap.dat file</h2>
<p>The <em><code>typemap.dat</code></em> file for the wsdl2h tool can be used to customize or optimize the type bindings by mapping schema types to C/C++ types. This file contains custom XML schema to C/C++ type bindings and XML namespace bindings for namespace prefixes to be generated by the wsdl2h tool. You can edit this file to enable features such as custom serializers for schema types, C++11 smart pointers to replace regular pointers, bind XML namespace prefixes to XML namespace URIs, and specify bindings for schema types.</p>
<p>Here is a simple example of a <em><code>typemap.dat</code></em> file: </p><pre class="fragment">#       This file contains custom definitions of the XML Schema types and 
#       C/C++ types for your project, and XML namespace prefix definitions. 
#       The wsdl2h WSDL importer consults this file to determine bindings. 
[ 
// This comment will be included in the generated .h file 
// You can include any additional declarations, includes, imports, etc. 
// within [ ] sections. The brackets must appear at the start of a line 
] 
#       XML namespace prefix definitions can be provided to override the 
#       default choice of ns1, ns2, ... prefixes. For example: 
i = "http://www.soapinterop.org/" 
s = "http://www.soapinterop.org/xsd"
</pre><p>The <code>i</code> and <code>s</code> prefixes are declared such that the header file output by wsdl2h uses these prefixes instead of the default <code>ns1</code>, <code>ns2</code>, etc. It is strongly recommended to name the prefixes in this way, because future runs of wsdl2h may result in a different assignment of the default <code>ns1</code>, <code>ns2</code>, ... prefixes. Therefore, it is recommended that application code should not rely on the default prefixes.</p>
<p>Type bindings can be provided to bind XML schema types to C/C++ types for your project. These type bindings have four parts: </p><pre class="fragment">prefix__type = declaration | use | ptr-use
</pre><p>where <code>prefix__type</code> is the C/C++ type name of the schema type (using gSOAP's type naming conventions), the <code>declaration</code> part declares the C/C++ type in the generated header file which may be empty to omit, the optional <code>use</code> part specifies how the type is used by other types such as by member declarations and as function parameters, and the optional <code>ptr-use</code> part specifies how the type is used as a pointer type by other types and as function parameters. </p><pre class="fragment">#       Example XML Schema and C/C++ type bindings: 
xsd__int          = | int 
xsd__string       = | char* | char* 
xsd__boolean      = enum xsd__boolean { false_, true_ }; | enum xsd__boolean 
xsd__base64Binary = class xsd__base64Binary { unsigned char *__ptr; int __size; }; | xsd__base64Binary | xsd__base64Binary
#       You can extend structs and classes with member data and functions. 
#       For example, adding a constructor to ns__myClass:
ns__myClass       = $ ns__myClass(); 
#       The general form is
#       class_name = $ member; 
</pre><p>XML Schema types are associated with an optional C/C++ type declaration, a use reference, and a pointer-use reference. The pointer-use reference of the <code>xsd__byte</code> type for example, is <code>int*</code> because <code>char*</code> is reserved for strings.</p>
<p>For example, you can replace the <code>std::string</code> that used by default for C++ with a wide string: </p><pre class="fragment">xsd__string = | std::wstring
</pre><p>Or replace the <code>char*</code> strings that are used by default for C with <code>wchar_t*</code>: </p><pre class="fragment">xsd__string = | wchar_t* | wchar_t*
</pre><p>When a type binding requires only the usage to be changed, the declaration part can be an ellipsis <code>...</code>, as in: </p><pre class="fragment">prefix__type = ... | use | ptr-use
</pre><p>The <code>...</code> ellipsis ensures that the wsdl2h-generated type definition is preserved, while the <code>use</code> and <code>ptr-use</code> parts are amended as specified.</p>
<p>This method is useful to serialize types dynamically, when XML elements carry the <em><code>xsi:type</code></em> attribute indicating the type of element content. The following illustrates an "any" type mapping for the <em><code>ns:sometype</code></em> XSD type in a schema. This type will be replaced with a "any" type wrapper that supports dynamic serialization of element types indicated by the <em><code>xsi:type</code></em> attribute: </p><pre class="fragment">[ 
struct __any 
{
  int __type;   // set to a SOAP_TYPE_T value
  void *__item; // points to data of type T as serialized per SOAP_TYPE_T
} 
] 
xsd__anyType = ... | struct __any | struct __any
</pre><p>where <code>__type</code> and <code>__item</code> are used to serialize any data type in the wrapper. The <code>__item</code> member points to the value (de)serialized, with the type of this value indicated by <code>__type</code> which is a <code>SOAP_TYPE_T</code> value for type named <code>T</code>.</p>
<p>To match an element with content to (de)serialize, rename the <code>__item</code> member to the XML element name, as usual.</p>
<p>Additional members can be specified to extend a generated struct or class. Class and struct extensions are of the form: </p><pre class="fragment">prefix__type = $ member-declaration
</pre><p>For example, to add getter and setter methods to class <code>myns__record</code> (see also Section <a class="el" href="index.html#gettersetter">Get and set methods</a>): </p><pre class="fragment">myns__record = $ int get(struct soap *soap) const;
myns__record = $ int set(struct soap *soap);
</pre><p>Another way to use <em><code>typemap.dat</code></em> is to remap one C/C++ type to another type: </p><pre class="fragment">prefix__type1 == prefix__type2
</pre><p>This replaces <code>prefix__type1</code> by <code>prefix__type2</code> in the wsdl2h output. For example: </p><pre class="fragment">SOAP_ENC__boolean == xsd__boolean
</pre><p>where <em><code>SOAP_ENC__boolean</code></em> is replaced by <em><code>xsd__boolean</code></em>, which in turn may be mapped to a C <code>enum xsd__boolean</code> type or C++ <code>bool</code> type.</p>
<p>The <b><code>$CONTAINER</code></b> variable defines the container type to use in the wsdl2h-generated declarations for C++, which is <code>std::vector</code> by default. For example, to use <code>std::list</code> as the container in the wsdl2h-generated declarations we add the following line to <em><code>typemap.dat</code></em>: </p><pre class="fragment">$CONTAINER = std::list
</pre><p>Also a Qt container can be used instead of the default <code>std::vector</code>, for example <code>QVector</code>: </p><pre class="fragment">[
#include &lt;QVector&gt;
]
$CONTAINER = QVector
</pre><p>To remove containers, use <b><code>wsdl2h -s</code></b>. This also removes <code>std::string</code>, but you can re-introduce <code>std::string</code> with </p><pre class="fragment">xsd__string = | std::string
</pre><p>The <em><code>typemap.dat</code></em> <b><code>$POINTER</code></b> variable defines the smart pointer to use in the wsdl2h-generated declarations for C++, which replaces the use of <code>*</code> pointers. For example: </p><pre class="fragment">$POINTER = std::shared_ptr
</pre><p>Not all pointers in the generated output are replaced by smart pointers by wsdl2h, such as pointers as union members and pointers as struct/class members that point to arrays of values.</p>
<p>The variable <b><code>$SIZE</code></b> defines the type of array sizes, which is <code>int</code> by default. For example, to change array size types to <code>size_t</code>: </p><pre class="fragment">$SIZE = size_t
</pre><p>Permissible types are <code>int</code> and <code>size_t</code>. This variable does not affect the size of dynamic arrays, <code><a class="el" href="structxsd____hex_binary.html" title="XSD hexBinary structure with attachment data. ">xsd__hexBinary</a></code> and <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> types, which is always <code>int</code>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="soapcpp2"></a>
The soapcpp2 tool</h1>
<p>The soapcpp2 tool is invoked from the command line and optionally takes the name of a header file as an argument or, when the file name is absent, parses the standard input: </p><pre class="fragment"> soapcpp2 file.h
</pre><p>where <em><code>file.h</code></em> is an interface header file generated by wsdl2h or developed manually to specify the service operations as function prototypes and C/C++ data types to serialize in XML.</p>
<p>The soapcpp2 tool produces the XML data binding implementation source code, client-side stub functions, and server-side skeleton functions.</p>
<p>The type of files generated by soapcpp2 are:</p>
<ul>
<li><em><code>soapStub.h</code></em> a modified and annotated header file produced from the input interface header file, this file is compilable by C/C++ compilers while the input interface header file is not.</li>
<li><em><code>soapH.h</code></em> the main header file to be included by the application source code, this file also includes <em><code>soapStub.h</code></em>.</li>
<li><em><code>soapC.cpp</code></em> (or <em><code>.c</code></em> for C) the serializers for the C/C++ types specified in the interface header file.</li>
<li><em><code>soapClient.cpp</code></em> (or <em><code>.c</code></em> for C) the client-side stub functions to invoke remote service operations.</li>
<li><em><code>soapServer.cpp</code></em> (or <em><code>.c</code></em> for C) the server-side skeleton functions to dispatch service requests to user-define service functions.</li>
<li><em><code>soapClientLib.cpp</code></em> (or <em><code>.c</code></em> for C) the client-side stub functions combined with local static serializers to be integrated as one big "library".</li>
<li><em><code>soapServerLib.cpp</code></em> (or <em><code>.c</code></em> for C) the service-side skeleton functions combined with local static serializers to be integrated as one big "library"</li>
<li><em><code>soapXYZProxy.h</code></em> the C++ proxy class declaration generated with <b><code>soapcpp2 -i</code></b> or <b><code>soapcpp2 -j</code></b></li>
<li><em><code>soapXYZProxy.cpp</code></em> the C++ proxy class implementation generated with <b><code>soapcpp2 -i</code></b> or <b><code>soapcpp2 -j</code></b></li>
<li><em><code>soapXYZService.h</code></em> the C++ service class declaration generated with <b><code>soapcpp2 -i</code></b> or <b><code>soapcpp2 -j</code></b></li>
<li><em><code>soapXYZService.cpp</code></em> the C++ service class implementation generated with <b><code>soapcpp2 -i</code></b> or <b><code>soapcpp2 -j</code></b></li>
<li><em><code>*.xsd</code></em> files are generated containing XML schemas for each namespace prefix <code>ns</code> used in the interface header file input to the soapcpp2 tool, see also Section <a class="el" href="index.html#wsdl">How to generate WSDL service descriptions</a> . Not applicable when the interface header file was generated with wsdl2h.</li>
<li><em><code>*.wsdl</code></em> files are generated containing WSDL descriptions for each namespace prefix <code>ns</code> used by service operations in the interface header file input to the soapcpp2 tool, see also Section <a class="el" href="index.html#wsdl">How to generate WSDL service descriptions</a> . Not applicable when the interface header file was generated with wsdl2h.</li>
<li><em><code>*.xml</code></em> files with SOAP or XML request and response messages are generated.</li>
<li><em><code>*.nsmap</code></em> the XML namespace mapping table, generated for the first namespace prefix <code>ns</code> found in the interface header file input to the soapcpp2 tool.</li>
</ul>
<p>If client and service applications are to be developed for the same Web services API then the same interface header file can be used to generate the source code for both the client and the service. There is no need to generate a WSDL with soapcpp2 and then use that WSDL to generate a new interface header file with wsdl2h. The new header file generated by this approach will not be identical to the original header file.</p>
<p>The <em><code>soapClientLib.cpp</code></em> and <em><code>soapServerLib.cpp</code></em> can be used to build client and server libraries. The serialization functions are declared static to avoid link symbol conflicts. For this approach to compile, we also should create a separate interface header file <em><code>env.h</code></em> with SOAP Header and Fault structures with serializers that are non-static, i.e. globally declared and implemented, as described in Section <a class="el" href="index.html#dylibs">How to create client/server libraries</a> .</p>
<p>The following files are part of the gSOAP source code package and are required to build gSOAP applications:</p>
<ul>
<li><em><code>gsoap/stdsoap2.h</code></em> the header file to include in your source code, but already included when including <em><code>soapH.h</code></em>.</li>
<li><em><code>gsoap/stdsoap2.c</code></em> the C source code of the entire gSOAP engine.</li>
<li><em><code>gsoap/stdsoap2.cpp</code></em> (or <em><code>.c</code></em> for C) the source code of the entire gSOAP engine.</li>
<li><em><code>gsoap/dom.cpp</code></em> (or <em><code>.c</code></em> for C) the source code of the DOM parser, which is optional and only required when using DOM such as with WS-Security.</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="soapcpp2options"></a>
soapcpp2 options</h2>
<p>The soapcpp2 tool supports the following command-line options:</p>
<table class="doxtable">
<tr>
<th>option </th><th>result  </th></tr>
<tr>
<td><a href="#soapcpp2-0"><code>-0</code></a> </td><td>no SOAP, generate REST source code </td></tr>
<tr>
<td><a href="#soapcpp2-1"><code>-1</code></a> </td><td>generate SOAP 1.1 source code </td></tr>
<tr>
<td><a href="#soapcpp2-2"><code>-2</code></a> </td><td>generate SOAP 1.2 source code </td></tr>
<tr>
<td><a href="#soapcpp2-A"><code>-A</code></a> </td><td>require HTTP SOAPAction headers to invoke server-side operations </td></tr>
<tr>
<td><a href="#soapcpp2-a"><code>-a</code></a> </td><td>use HTTP SOAPAction headers with WS-Addressing to invoke server-side operations </td></tr>
<tr>
<td><a href="#soapcpp2-b"><code>-b</code></a> </td><td>serialize byte arrays <code>char[N]</code> as string </td></tr>
<tr>
<td><a href="#soapcpp2-C"><code>-C</code></a> </td><td>generate client-side source code only </td></tr>
<tr>
<td><a href="#soapcpp2-c"><code>-c</code></a> </td><td>generate C source code </td></tr>
<tr>
<td><a href="#soapcpp2-c"><code>-c++</code></a> </td><td>generate C++ source code (default) </td></tr>
<tr>
<td><a href="#soapcpp2-c"><code>-c++11</code></a> </td><td>generate C++ source code optimized for C++11 (compile with <code>-std=c++11</code>) </td></tr>
<tr>
<td><a href="#soapcpp2-d"><code>-d</code></a> <code>path</code> </td><td>use <code>path</code> to save files </td></tr>
<tr>
<td><a href="#soapcpp2-E"><code>-Ec</code></a> </td><td>generate extra functions for deep copying </td></tr>
<tr>
<td><a href="#soapcpp2-E"><code>-Ed</code></a> </td><td>generate extra functions for deep deletion </td></tr>
<tr>
<td><a href="#soapcpp2-E"><code>-Et</code></a> </td><td>generate extra functions for data traversals with callback functions </td></tr>
<tr>
<td><a href="#soapcpp2-e"><code>-e</code></a> </td><td>generate SOAP RPC encoding style bindings (also use <code>-1</code> or <code>-2</code>) </td></tr>
<tr>
<td><a href="#soapcpp2-f"><code>-f</code></a> <code>N</code> </td><td>multiple <code>soapC</code> files, with <code>N</code> serializer definitions per file (N&gt;=10) </td></tr>
<tr>
<td><a href="#soapcpp2-g"><code>-g</code></a> </td><td>generate XML sample messages in template format for <a href="../../testmsgr/html/index.html">testmsgr</a> </td></tr>
<tr>
<td><a href="#soapcpp2-h"><code>-h</code></a> </td><td>display help info and exit </td></tr>
<tr>
<td><a href="#soapcpp2-I"><code>-I</code></a> <code>path</code> </td><td>use <code>path</code>(s) for <code>#import</code> (paths separated with <code>:</code>) </td></tr>
<tr>
<td><a href="#soapcpp2-i"><code>-i</code></a> </td><td>generate C++ service proxies and objects inherited from soap struct </td></tr>
<tr>
<td><a href="#soapcpp2-j"><code>-j</code></a> </td><td>generate C++ service proxies and objects that share a soap struct </td></tr>
<tr>
<td><a href="#soapcpp2-L"><code>-L</code></a> </td><td>don't generate <code>soapClientLib</code> and <code>soapServerLib</code> </td></tr>
<tr>
<td><a href="#soapcpp2-l"><code>-l</code></a> </td><td>generate linkable modules (experimental) </td></tr>
<tr>
<td><a href="#soapcpp2-m"><code>-m</code></a> </td><td>generate source code for the Matlab(tm) MEX compiler (deprecated) </td></tr>
<tr>
<td><a href="#soapcpp2-n"><code>-n</code></a> </td><td>use service name to rename service functions and namespace table </td></tr>
<tr>
<td><a href="#soapcpp2-p"><code>-p</code></a> <code>name</code> </td><td>save files with new prefix <code>name</code> instead of <code>soap</code> </td></tr>
<tr>
<td><a href="#soapcpp2-Q"><code>-Q</code></a> <code>name</code> </td><td>use <code>name</code> as the C++ namespace, including custom serializers </td></tr>
<tr>
<td><a href="#soapcpp2-q"><code>-q</code></a> <code>name</code> </td><td>use <code>name</code> as the C++ namespace, excluding custom serializers </td></tr>
<tr>
<td><a href="#soapcpp2-r"><code>-r</code></a> </td><td>generate soapReadme.md report </td></tr>
<tr>
<td><a href="#soapcpp2-S"><code>-S</code></a> </td><td>generate server-side source code only </td></tr>
<tr>
<td><a href="#soapcpp2-s"><code>-s</code></a> </td><td>generate stub and skeleton functions with strict XML validation checks </td></tr>
<tr>
<td><a href="#soapcpp2-T"><code>-T</code></a> </td><td>generate server auto-test source code </td></tr>
<tr>
<td><a href="#soapcpp2-t"><code>-t</code></a> </td><td>generate source code for fully <code>xsi:type</code> typed SOAP/XML messages </td></tr>
<tr>
<td><a href="#soapcpp2-u"><code>-u</code></a> </td><td>uncomment WSDL/schema output by suppressing XML comments </td></tr>
<tr>
<td><a href="#soapcpp2-V"><code>-V</code></a> </td><td>display the current version and exit </td></tr>
<tr>
<td><a href="#soapcpp2-v"><code>-v</code></a> </td><td>verbose output </td></tr>
<tr>
<td><a href="#soapcpp2-w"><code>-w</code></a> </td><td>don't generate WSDL and schema files </td></tr>
<tr>
<td><a href="#soapcpp2-x"><code>-x</code></a> </td><td>don't generate sample XML message files </td></tr>
<tr>
<td><a href="#soapcpp2-y"><code>-y</code></a> </td><td>include C/C++ type access information in sample XML messages </td></tr>
<tr>
<td><a href="#soapcpp2-z"><code>-z1</code></a> </td><td>compatibility: generate old-style C++ service proxies and objects </td></tr>
<tr>
<td><a href="#soapcpp2-z"><code>-z2</code></a> </td><td>compatibility with 2.7.x: omit XML output for NULL pointers </td></tr>
<tr>
<td><a href="#soapcpp2-z"><code>-z3</code></a> </td><td>compatibility up to 2.8.30: <code>_param_N</code> indexing and nillable pointers </td></tr>
</table>
<p>For example </p><pre class="fragment"> soapcpp2 -L -c -d projects -p my -x file.h
</pre><p>This saves the following source code files:</p>
<ul>
<li><em><code>projects/myH.h</code></em> serialization functions, this file should be included in projects.</li>
<li><em><code>projects/myC.c</code></em> serialization functions</li>
<li><em><code>projects/myClient.c</code></em> client call stub functions</li>
<li><em><code>projects/myServer.c</code></em> server request dispatcher</li>
<li><em><code>projects/myStub.h</code></em> annotated copy of the source interface header file</li>
<li><em><code>projects/ns.nsmap</code></em> namespace table, this file should be included or used in projects.</li>
<li><em><code>projects/ns.wsdl</code></em> WSDL with Web service definitions</li>
<li><em><code>projects/ns.xsd</code></em> XML schema</li>
</ul>
<p>Windows users can use the usual <b><code>/</code></b> for compile-time flags as well as <b><code>-</code></b>, for example: </p><pre class="fragment">soapcpp2 -L -c /d projects /p my /x file.h
</pre><p>Options <b><code>-A</code></b>, <b><code>-a</code></b>, <b><code>-c</code></b>, <b><code>-c++</code></b>, <b><code>-c++11</code></b>, <b><code>-e</code></b>, <b><code>-i</code></b>, <b><code>-j</code></b>, <b><code>-n</code></b>, <b><code>-s</code></b>, <b><code>-t</code></b>, <b><code>-w</code></b>, and <b><code>-x</code></b> can also be specified in the interface header file for soapcpp2 using the <b><code>//gsoapopt</code></b> directive, for example:</p>
<div class="fragment"><div class="line"><span class="comment">// Generate pure C and do not produce WSDL output: </span></div><div class="line"><span class="comment">//gsoapopt cw </span></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keywordtype">char</span> *in, <span class="keywordtype">char</span> **out);</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-0"></a>
soapcpp2 -0</h3>
<p>This option generates XML REST source code by disabling SOAP bindings, essentially disabling the SOAP protocol and replacing it by direct XML REST messaging.</p>
<p>This option uses <code><a class="el" href="group__group__context.html#ga7c0a034b54cd46ee06ce1253e5a40467" title="Set SOAP version (0 = no SOAP, 1 = SOAP 1.1, 2 = SOAP 1.2) ">soap_set_version</a></code> at the client side in the generated source code to enable XML REST messaging, disabling SOAP.</p>
<p>In addition, the soapcpp2 tool nullifies the SOAP namespaces from the the generated namespace table file to force a server application that uses this table to use XML REST only:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = {</div><div class="line">    { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, NULL, NULL, NULL },</div><div class="line">    { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, NULL, NULL, NULL },</div><div class="line">    { <span class="stringliteral">&quot;xsi&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/XMLSchema-instance&quot;</span>, NULL },</div><div class="line">    { <span class="stringliteral">&quot;xsd&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/XMLSchema&quot;</span>, NULL },</div><div class="line">    ...</div><div class="line">    { NULL, NULL, NULL, NULL}</div><div class="line">};</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Web services applications developed with gSOAP support both REST and SOAP messaging automatically when the namespace table is left intact (i.e. generated without option <b><code>-0</code></b>) with the SOAP namespaces present in the table. XML REST request messages are served and REST messages returned. Likewise, SOAP 1.1 request messages are served and SOAP 1.1 messages returned, SOAP 1.2 request messages are served and SOAP 1.2 messages returned.</dd></dl>
<p>For example, the following example calculator service SOAP and XML REST request messages are served by a gSOAP service developed with SOAP 1.1 as the default protocol:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;urn:calc&quot;</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span> <span class="keyword">SOAP-ENV:encodingStyle</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;<span class="keywordtype">ns:add</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &lt;<span class="keywordtype">a</span>&gt;2&lt;/<span class="keywordtype">a</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &lt;<span class="keywordtype">b</span>&gt;3&lt;/<span class="keywordtype">b</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &lt;/<span class="keywordtype">ns:add</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:add</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;urn:calc&quot;</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;<span class="keywordtype">a</span>&gt;2&lt;/<span class="keywordtype">a</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;<span class="keywordtype">b</span>&gt;3&lt;/<span class="keywordtype">b</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/<span class="keywordtype">ns:add</span>&gt;</div></div><!-- fragment --> </div><p>The server returns the following XML SOAP 1.1 and XML REST responses:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;urn:calc&quot;</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span> <span class="keyword">SOAP-ENV:encodingStyle</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;<span class="keywordtype">ns:addResponse</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &lt;<span class="keywordtype">result</span>&gt;5&lt;/<span class="keywordtype">result</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    &lt;/<span class="keywordtype">ns:addResponse</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:addResponse</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;urn:calc&quot;</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;<span class="keywordtype">result</span>&gt;0&lt;/<span class="keywordtype">result</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;/<span class="keywordtype">ns:addResponse</span>&gt;</div></div><!-- fragment --> </div><p>By default all XML namespaces are included with the root element, which improves messaging performance at the sending and receiving sides, because a stack of <em><code>xmlns</code></em> binding scopes does not need to be maintained. Use <code><a class="el" href="group__group__flags.html#ga757fa32433be64f8c228b1ecce727815" title="soap_mode XML output flag value to send XML messages in exclusive canonical format as per W3C XML C14...">SOAP_XML_CANONICAL</a></code> to emit <em><code>xmlns</code></em> binding pairs when the XML namespace prefix is used. This is slower but may or may not reduce the message size.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-1"></a>
soapcpp2 -1</h3>
<p>This option forces SOAP 1.1 bindings globally in the generated source code, thereby overriding the SOAP protocol version used in the interface header file input.</p>
<p>This option uses <code><a class="el" href="group__group__context.html#ga7c0a034b54cd46ee06ce1253e5a40467" title="Set SOAP version (0 = no SOAP, 1 = SOAP 1.1, 2 = SOAP 1.2) ">soap_set_version</a></code> at the client to enable SOAP 1.1 request and response messages, disallowing SOAP 1.2.</p>
<p>In addition, the soapcpp2 tool saves the SOAP 1.1 namespaces in the second column of the generated namespace table file and the SOAP 1.2 in the third column to allow the server to accept SOAP 1.1 and SOAP 1.2 requests:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = {</div><div class="line">    { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/soap-envelope&quot;</span>, NULL },</div><div class="line">    { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/soap-encoding&quot;</span>, NULL },</div><div class="line">    { <span class="stringliteral">&quot;xsi&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/XMLSchema-instance&quot;</span>, NULL },</div><div class="line">    { <span class="stringliteral">&quot;xsd&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/XMLSchema&quot;</span>, NULL },</div><div class="line">    ...</div><div class="line">    { NULL, NULL, NULL, NULL}</div><div class="line">};</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-2"></a>
soapcpp2 -2</h3>
<p>This option forces SOAP 1.2 bindings globally in the generated source code, thereby overriding the SOAP protocol version used in the interface header file input.</p>
<p>This option uses <code><a class="el" href="group__group__context.html#ga7c0a034b54cd46ee06ce1253e5a40467" title="Set SOAP version (0 = no SOAP, 1 = SOAP 1.1, 2 = SOAP 1.2) ">soap_set_version</a></code> at the client to enable SOAP 1.2 request and response messages, disallowing SOAP 1.1.</p>
<p>In addition, the soapcpp2 tool saves the SOAP 1.2 namespaces in the second column of the generated namespace table file and the SOAP 1.1 in the third column to allow the server to accept SOAP 1.1 and SOAP 1.2 requests:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = {</div><div class="line">    { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2003/05/soap-envelope&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>, NULL },</div><div class="line">    { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2003/05/soap-encoding&quot;</span>, <span class="stringliteral">&quot;http://schemas</span></div><div class="line"><span class="stringliteral">    { &quot;</span>xsi<span class="stringliteral">&quot;, &quot;</span>http:<span class="comment">//www.w3.org/2001/XMLSchema-instance&quot;, &quot;http://www.w3.org/*/XMLSchema-instance&quot;, NULL },</span></div><div class="line">    { <span class="stringliteral">&quot;xsd&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/XMLSchema&quot;</span>, NULL },</div><div class="line">    ...</div><div class="line">    { NULL, NULL, NULL, NULL}</div><div class="line">};</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-A"></a>
soapcpp2 -A</h3>
<p>This option generates server-side source code that requires HTTP SOAPAction headers to be present. The server invokes server-side operations based on the SOAPAction header value in request messages, instead of the SOAP/XML request message name which is ignored. This option is used with WS-Addressing, WS-ReliableMessaging, and WS-Discovery servers to relay messages based on HTTP SOAPAction headers and/or the SOAP Header <em><code>wsa:Action</code></em> when present (the latter requires the [WS-Addressing plugin](wsaplugin)).</p>
<p>Alternatively, use <a href="#soapcpp2-a"><b><code>soapcpp2 -a</code></b> option <b><code>-a</code></b></a> to let the server invoke server-side operations based on the SOAPAction header value in request messages when present, otherwise when not present this lets the server invoke server-side operations based on the SOAP/XML request message name as usual.</p>
<p>This option can also be specified by the <code>//gsoapopt A</code> directive in the interface header file.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-a"></a>
soapcpp2 -a</h3>
<p>This option generates server-side source code that uses HTTP SOAPAction headers when present to invoke server-side operations based on the SOAPAction header value in request messages, otherwise when not present lets the server invoke server-side operations based on the SOAP/XML request message name as usual. This option is used with WS-Addressing, WS-ReliableMessaging, and WS-Discovery servers to relay messages based on HTTP SOAPAction headers and/or the SOAP Header <em><code>wsa:Action</code></em> when present (the latter requires the [WS-Addressing plugin](wsaplugin)).</p>
<p>Alternatively, use <a href="#soapcpp2-A"><b><code>soapcpp2 -A</code></b> option <b><code>-A</code></b></a> to require HTTP SOAPAction headers to be present in SOAP request messages to invoke server-side operations.</p>
<p>This option can also be specified by the <code>//gsoapopt a</code> directive in the interface header file.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-b"></a>
soapcpp2 -b</h3>
<p>This option serializes byte arrays specified as <code>char[N]</code> as strings. Without this option <code>char[N]</code> is serialized as an array of bytes. Fixed-size arrays specified in the interface header file input are generally serialized as arrays in XML using <em><code>item</code></em> elements.</p>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__record</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> bytes[3];</div><div class="line">    <span class="keywordtype">int</span> ints[2];</div><div class="line">};</div></div><!-- fragment --><p>By default without this option the <code>ns__record</code> struct is serialized as:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:record</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">bytes</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">item</span>&gt;65&lt;/<span class="keywordtype">item</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">item</span>&gt;66&lt;/<span class="keywordtype">item</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;<span class="keywordtype">item</span>&gt;0&lt;/<span class="keywordtype">item</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">bytes</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;<span class="keywordtype">ints</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;<span class="keywordtype">item</span>&gt;1&lt;/<span class="keywordtype">item</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">item</span>&gt;2&lt;/<span class="keywordtype">item</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &lt;/<span class="keywordtype">ints</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&lt;/<span class="keywordtype">ns:record</span>&gt;</div></div><!-- fragment --> </div><p>With this option, the <code>ns__record</code> struct is serialized as:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:record</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">bytes</span>&gt;<span class="keyword">AB</span>&lt;/<span class="keywordtype">bytes</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">ints</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">item</span>&gt;1&lt;/<span class="keywordtype">item</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;<span class="keywordtype">item</span>&gt;2&lt;/<span class="keywordtype">item</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">ints</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/<span class="keywordtype">ns:record</span>&gt;</div></div><!-- fragment --> </div><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-C"></a>
soapcpp2 -C</h3>
<p>This option restricts soapcpp2 to generate client-side source code only. When this option is combined with <a href="#soapcpp2-S"><b><code>soapcpp2 -CS</code></b> option <b><code>-S</code></b></a>, no client and server source code is generated.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-c"></a>
soapcpp2 -c -c++ -c++11</h3>
<p>Option <b><code>-c</code></b> generates C source code, <b><code>-c++</code></b> generates C++ source code, and <b><code>-c++11</code></b> generates C++11 source code.</p>
<dl class="section note"><dt>Note</dt><dd>The <code>//gsoapopt</code> directive in the interface header file takes priority over this option, when <code>c</code>, <code>c++</code>, or <code>c++11</code> is declared with this directive in the interface header file.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-d"></a>
soapcpp2 -d</h3>
<p>This option specifies a path to save the generated files. For example: </p><pre class="fragment">soapcpp2 -d source file.h
</pre><p>This saves files to the <em><code>source/</code></em> directory located within the current directory, which should exist and should be writable.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-E"></a>
soapcpp2 -Ec -Ed -Et</h3>
<p>These options generate extra functions for deep copying of serializable C/C++ data, deep deletion of serializable C/C++ data, and deep data traversals with user-defined callback functions over serializable C/C++ data.</p>
<p>For a serializable type <code>T</code> declared in the interface header file for soapcpp2, option <b><code>-Ec</code></b> generates:</p>
<ul>
<li><code>virtual T * T::soap_dup(struct soap*) const</code> where <code>T</code> is a class, returns a duplicate of this object by deep copying, replicating all deep cycles and shared pointers when a managing <code>soap</code> context is provided as argument. Deep copy is a tree when argument is NULL, but the presence of deep cycles will lead to non-termination. Use flag <code>SOAP_XML_TREE</code> with the managing context to copy into a tree without cycles and pointers to shared objects.</li>
<li><code>T * soap_dup_T(struct soap*, T *dst, const T *src)</code> where <code>T</code> is not a class, deep copy <code>src</code> into <code>dst</code>, replicating all deep cycles and shared pointers when a managing <code>soap</code> context is provided as argument. When <code>dst</code> is NULL, allocates space for <code>dst</code> and returns a pointer to the allocated copy. Deep copy results in a tree when the <code>soap</code> context is NULL, but the presence of deep cycles will lead to non-termination. Use flag <code>SOAP_XML_TREE</code> with managing context to copy into a tree without cycles and pointers to shared objects. Returns <code>dst</code> or allocated copy when <code>dst</code> is NULL.</li>
</ul>
<p>For a serializable type <code>T</code> declared in the interface header file for soapcpp2, option <b><code>-Ed</code></b> generates:</p>
<ul>
<li><code>virtual void T::soap_del() const</code> where <code>T</code> is a class, deletes all heap-allocated members of this object by deep deletion ONLY IF this object and all of its (deep) members are not managed by a <code>soap</code> context AND the deep structure is a tree (no cycles and co-referenced objects by way of multiple (non-smart) pointers pointing to the same data). Can be safely used after <code>T::soap_dup(NULL)</code> to delete the deep copy. Does not delete the object itself.</li>
<li><code>void soap_del_T(const T*)</code> where <code>T</code> is not a class, deletes all heap-allocated members of this object by deep deletion ONLY IF this object and all of its (deep) members are not managed by a <code>soap</code> context AND the deep structure is a tree (no cycles and co-referenced objects by way of multiple (non-smart) pointers pointing to the same data). Can be safely used after <code>soap_dup_T(NULL, NULL, const T*)</code> to delete the deep copy returned. Does not delete the object itself.</li>
</ul>
<p>For a serializable type <code>T</code> declared in the interface header file for soapcpp2, option <b><code>-Et</code></b> generates:</p>
<ul>
<li><code>virtual void T::soap_traverse(struct soap *soap, const char *tag, soap_walker p, soap_walker q)</code> where <code>T</code> is a class, uses function callbacks <code>p</code> and <code>q</code> to traverse this object by deep ordered tree traversals over its members when non-NULL. Function <code>p</code> is a pre-order function that is called before objects and data are visited recursively and function <code>q</code> is a post-order function that is called after objects and data are visited recursively. Either <code>p</code> or <code>q</code> may be NULL. The <code>tag</code> string is passed to <code>p</code> and <code>q</code> and should not be NULL. Cyclic graphs are treated as trees by pruning pointer back-edges, though this method does not always prevent a data node from being visited twice.</li>
<li><code>void soap_traverse_T(struct soap *soap, T *data, const char *tag, soap_walker p, soap_walker q)</code> where <code>T</code> is not a class, uses function callbacks <code>p</code> and <code>q</code> to traverse this data by deep ordered tree traversals over its members when present and non-NULL. Function <code>p</code> is a pre-order function that is called before objects and data are visited recursively and function <code>q</code> is a post-order function that is called after objects and data are visited recursively. Either <code>p</code> or <code>q</code> may be NULL. The <code>tag</code> string is passed to <code>p</code> and <code>q</code> and should not be NULL. Cyclic graphs are treated as trees by pruning pointer back-edges. though this method does not always prevent a data node from being visited twice.</li>
</ul>
<p>The pre-order <code>p</code> and post-order <code>q</code> callback functions should be declared as a <code>soap_walker</code> function, which has the following function signature:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> soap_walker(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> soap_type, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag, <span class="keyword">const</span> <span class="keywordtype">char</span> *type)</div></div><!-- fragment --><p>where <code>data</code> points to the data node visited which is of type <code>soap_type</code> (a <code>SOAP_TYPE_T</code> constant), <code>tag</code> is the non-NULL element or attribute tag name (qualified or unqualified), and <code>type</code> is the non-NULL C/C++ type of the data. The <code>void* <a class="el" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b" title="User-definable variable that may point to user-specified data of any type to pass the data through to...">soap::user</a></code> member can be used to pass user-defined data to the callbacks.</p>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="comment">// file: record.h</span></div><div class="line"><span class="comment">//gsoap ns schema namespace: urn:example</span></div><div class="line"><span class="keyword">struct </span>ns__record</div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> *name;</div><div class="line">    <span class="keywordtype">int</span> value;</div><div class="line">    <span class="keyword">struct </span>ns__record *subrecord;</div><div class="line">};</div></div><!-- fragment --> <pre class="fragment">soapcpp2 -Ecdt record.h
</pre><p>The main program:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">  ns__record record;                            <span class="comment">// a serializable type</span></div><div class="line">  ns__record rec_dup;</div><div class="line">  <span class="keywordtype">int</span> indent = 0;</div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a> = open(file, O_RDONLY); </div><div class="line">  <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a> &lt; 0)</div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  <span class="keywordflow">if</span> (soap_read_ns__record(soap, &amp;record))      <span class="comment">// deserialize from file into managed memory</span></div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  close(soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a>);</div><div class="line">  <span class="keywordflow">if</span> (soap_write_ns__record(soap, &amp;record))     <span class="comment">// serialize to standard output</span></div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b">user</a> = (<span class="keywordtype">void</span>*)&amp;indent;</div><div class="line">  soap_traverse_ns__record(soap, record, <span class="stringliteral">&quot;record&quot;</span>, pre, post);</div><div class="line">  soap_dup_ns__record(NULL, &amp;rec_dup, &amp;record); <span class="comment">// deep copy the record to unmanaged memory</span></div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);                           <span class="comment">// delete managed objects</span></div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);                               <span class="comment">// delete managed data and temporaries</span></div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);                              <span class="comment">// free the context</span></div><div class="line">  soap_del_ns__record(&amp;rec_dup)                 <span class="comment">// deep delete unmanaged record</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> pre(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *a, <span class="keywordtype">int</span> n, <span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keyword">const</span> <span class="keywordtype">char</span> *t)</div><div class="line">{</div><div class="line">  printf(<span class="stringliteral">&quot;\n%*s%s %s = {&quot;</span>, (*(<span class="keywordtype">int</span>*)soap-&gt;<a class="code" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b">user</a>)++, <span class="stringliteral">&quot;&quot;</span>, t, s);</div><div class="line">  <span class="keywordflow">if</span> (n == SOAP_TYPE_int)</div><div class="line">    printf(<span class="stringliteral">&quot; %d&quot;</span>, *(<span class="keywordtype">int</span>*)a);</div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n == SOAP_TYPE_string)</div><div class="line">    printf(<span class="stringliteral">&quot; %s&quot;</span>, *(<span class="keywordtype">char</span>**)a ? *(<span class="keywordtype">char</span>**)a : <span class="stringliteral">&quot;(n/a)&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> post(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *a, <span class="keywordtype">int</span> n, <span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keyword">const</span> <span class="keywordtype">char</span> *t)</div><div class="line">{</div><div class="line">  printf(<span class="stringliteral">&quot; }&quot;</span>);</div><div class="line">  (*(<span class="keywordtype">int</span>*)soap-&gt;<a class="code" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b">user</a>)--;</div><div class="line">}</div></div><!-- fragment --><p>The <code>soap_read_ns__record</code> deserializes the following XML:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:record</span> <span class="keyword">xmlns:ns</span>=<span class="stringliteral">&quot;urn:example&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;foo&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">value</span>&gt;123&lt;/<span class="keywordtype">value</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">subrecord</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;bar&quot;</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">value</span>&gt;456&lt;/<span class="keywordtype">name</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;/<span class="keywordtype">subrecord</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;/<span class="keywordtype">ns:record</span>&gt;</div></div><!-- fragment --> </div><p>Then <code>soap_traverse_ns__record</code> call displays the contenst of <code>record</code> using the <code>pre</code> and <code>post</code> walker functions: </p><pre class="fragment">struct ns__record record = {
 char * name = { foo }
 int value = { 123 }
 struct ns__record subrecord = {
  char * name = { bar }
  int value = { 456 } } }
</pre><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-e"></a>
soapcpp2 -e</h3>
<p>This option forces SOAP RPC encoding bindings globally in the generated source code, when the SOAP messaging style is not declared in the interface header file with directives.</p>
<p>SOAP document/literal style messaging it the default messaging style. The messaging style can be specified with the <code>//gsoap &lt;prefix&gt; service style:</code> and <code>//gsoap &lt;prefix&gt; service encoding:</code> <a href="#directives">directives</a>. See also <a href="#literal">SOAP RPC encoded versus document/literal style</a>.</p>
<p>This option can also be specified by the <code>//gsoapopt e</code> directive in the interface header file.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-f"></a>
soapcpp2 -f</h3>
<p>This option splits the serialization source code saved to <em><code>soapC.c</code></em> and <em><code>soapC.cpp</code></em> files into multiple <em><code>soapC_NNN</code></em> files as specified by the numeric parameter. This option alleviates compilation issues with very large source code files.</p>
<p>For example: </p><pre class="fragment">soapcpp2 -f40 file.h
</pre><p>This generates multiple <em><code>soapC_NNN.cpp</code></em> files each with 40 serializers, with <em><code>NNN</code></em> counting from <em><code>001</code></em> onward.</p>
<p>The value of this option must be larger or equal to 10.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-g"></a>
soapcpp2 -g</h3>
<p>This option generates XML sample messages in template format for the gSOAP Test Messenger <a href="../../testmsgr/html/index.html">testmsgr</a> tool to test SOAP and REST XML clients and servers.</p>
<p>By default without this option, soapcpp2 generates sample XML messages with the proper XML structure but without useful data. The Test Messenger tool generates random messages directed by the template parameters included by <b><code>soapcpp2 -g</code></b> option <b><code>-g</code></b>.</p>
<p>This option only has effect when <a href="#soapcpp2-x"><b><code>soapcpp2 -x</code></b> option <b><code>-x</code></b></a> is not used, which skips the generation of sample messages.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-h"></a>
soapcpp2 -h</h3>
<p>This option displays help info and then exits.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-I"></a>
soapcpp2 -I</h3>
<p>This option specifies one or more directory paths to search for imported interface header files. Multiple paths are separated by a colon.</p>
<p>For example: </p><pre class="fragment">soapcpp2 -I path1:path2 file.h
</pre><p>This searches <em><code>path1</code></em> and then <em><code>path2</code></em> for files that are imported with <code>#import</code> in <em><code>file.h</code></em>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-i"></a>
soapcpp2 -i</h3>
<p>This option generates C++ client-side proxy classes and server-side service classes, where the classes inherit the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context struct with the engine state to handle communications and manage memory independently of other class instances.</p>
<p>By contrast, <a href="#soapcpp2-j"><b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b></a> allows a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context to be used and reused for multiple proxy and server instances.</p>
<p>This option can also be specified by the <code>//gsoapopt i</code> directive in the interface header file.</p>
<p>This option has no effect for C source code output.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-j"></a>
soapcpp2 -j</h3>
<p>This option generates C++ client-side proxy classes and server-side service classes, where the classes have a pointer member <code>soap</code> to a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context struct that handles communications and manages memory.</p>
<p>By contrast to <a href="#soapcpp2-i"><b><code>soapcpp2 -i</code></b> option <b><code>-i</code></b></a>, this option allows a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context to be used and reused for multiple proxy and server instances.</p>
<p>This option can also be specified by the <code>//gsoapopt j</code> directive in the interface header file.</p>
<p>This option has no effect for C source code output.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-L"></a>
soapcpp2 -L</h3>
<p>This option skips the generation of the <em><code>soapClientLib</code></em> and <em><code>soapServerLib</code></em> files. These files are generally not needed to build client and server applications.</p>
<p>These files are useful to compile multiple "libraries" of client and server applications, such that all serialization source code is declared static and kept hidden from the global scope, which makes the serialization functions inaccessible to the global scope to prevent global name clashes.</p>
<p>Alternatively, use <b><code>soapcpp2 -q name</code></b> option <b><code>-q name</code></b> to develop C++ applications with C++ namespaces to prevent global name clashes.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-l"></a>
soapcpp2 -l</h3>
<p>This option is experimental and should only be used to generate source code for modules. This option is auto-enabled when a <code>#module</code> directive is found in an interface header file for soapcpp2, see <a href="#module">how to build modules and libraries with the #module directive</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-m"></a>
soapcpp2 -m</h3>
<p>This option to generate source code for the Matlab(tm) MEX compiler is deprecated.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-n"></a>
soapcpp2 -n</h3>
<p>This option renames the generated service functions <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> to <code>name_serve</code> and the generated namespace table <code><a class="el" href="group__group__namespace.html#gaabfac0a3b8d38498bc5e1e3bc465ead6" title="The global XML namespaces table with entries defined by the Namespace structure and populated in an ...">namespaces</a></code> to <code>name_namespaces</code> to the <b><code>name</code></b> specified with the <a href="#soapcpp2-p"><b><code>soapcpp2 -n -p name</code></b> option <b><code>-p name</code></b></a>.</p>
<p>This option is useful to prevent name clashes when soapcpp2 is invoked multiple times to generate source code for different parts of an application. See also <a href="#dylibs">how to create client/server libraries</a>.</p>
<p>This option can also be specified by the <code>//gsoapopt n</code> directive in the interface header file.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-p"></a>
soapcpp2 -p</h3>
<p>This option saves source code files with the specified file name prefix <em><code>name</code></em> with <b><code>soapcpp2 -p name</code></b> instead of <em><code>soap</code></em> as the file name prefix.</p>
<p>This option is useful to prevent name clashes when soapcpp2 is invoked multiple times to generate source code for different parts of an application. See also <a href="#dylibs">how to create client/server libraries</a>.</p>
<p>For example: </p><pre class="fragment">soapcpp2 -p foo file.h
</pre><p>This saves <code>fooStub.h</code>, <code>fooH.h</code>, <code>fooC.cpp</code>, and so on.</p>
<p>When the main application is build from the renamed <em><code>name</code></em>-prefixed source code files, plugins and custom serializers that are compiled and linked with the application should include <em><code>nameH.h</code></em> instead of <em><code>soapH.h</code></em>. This can be done with the <b><code>-D SOAP_H_FILE=nameH.h</code></b> option to the C/C++ compiler to rename this file to include instead of <em><code>soapH.h</code></em>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-Q"></a>
soapcpp2 -Q</h3>
<p>This option specifies a C++ namespace name for the generated source code, including for the custom serializers when used. See also <a href="#soapcpp2-q"><b><code>soapcpp2 -q name</code></b> option <b><code>-q name</code></b></a> for details on specifying C++ namespaces.</p>
<p>The source code files are saved with <em><code>name</code></em> as prefix instead of <em><code>soap</code></em>. This means that all plugins and custom serializers that are compiled and linked with the application should include <em><code>nameH.h</code></em> instead of <em><code>soapH.h</code></em>. This can be done with the <b><code>-D SOAP_H_FILE=nameH.h</code></b> option to the C/C++ compiler to rename this file to include instead of <em><code>soapH.h</code></em>.</p>
<p>This option has no effect for C source code output.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-q"></a>
soapcpp2 -q</h3>
<p>This option specifies a C++ namespace name for the generated source code, excluding the custom serializers when used. See also <a href="#soapcpp2-Q"><b><code>soapcpp2 -Q name</code></b> option <b><code>-Q name</code></b></a>.</p>
<p>This option is the same as specifying a C++ namespace in the interface header file that encapsulates all declarations:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>name {</div><div class="line"></div><div class="line">  ... <span class="comment">// all of the interface header file content goes here</span></div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p>This interface header file format is generated with <a href="#wsdl2h-q"><b><code>wsdl2h -q name</code></b> option <b><code>-q name</code></b></a>.</p>
<p>The source code files are saved with <em><code>name</code></em> as prefix instead of <em><code>soap</code></em>. This means that all plugins and custom serializers that are compiled and linked with the application should include <em><code>nameH.h</code></em> instead of <em><code>soapH.h</code></em>. This can be done with the <b><code>-D SOAP_H_FILE=nameH.h</code></b> option to the C/C++ compiler to rename this file to include instead of <em><code>soapH.h</code></em>.</p>
<p>See <a class="el" href="index.html#codenamespace">How to build a client or server in a C++ code namespace</a> for details on using C++ namespaces to build client and server applications, which requires a <em><code>env.h</code></em> file with SOAP Header and Fault definitions to be compiled with: </p><pre class="fragment"> soapcpp2 -penv env.h
</pre><p>The generated <em><code>envC.cpp</code></em> file holds the SOAP Header and Fault serializers and you can link this file with your client and server applications.</p>
<p>This option has no effect for C source code output.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-r"></a>
soapcpp2 -r</h3>
<p>This option generates a <em><code>soapReadme.md</code></em> markdown report. This report includes details pertaining the serializable data types and Web client and service operations, covering XML type details, serialization functions, and SOAP/REST API programming details.</p>
<p>The markdown report is readable as it is, but can be converted to HTML for improved readability with Doxygen or with pandoc, or can be browsed in Firefox with <a href="readmeviewer.html">https://www.genivia.com/files/readmeviewer.html.zip</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-S"></a>
soapcpp2 -S</h3>
<p>This option restricts soapcpp2 to generate server-side source code only. When this option is combined with <a href="#soapcpp2-C"><b><code>soapcpp2 -CS</code></b> option <b><code>-C</code></b></a>, no client and server source code is generated.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-s"></a>
soapcpp2 -s</h3>
<p>This option generates client-side stub functions and proxy classes, server-side skeleton functions and service classes with strict XML validation checks enabled. This option effectively hard-codes the <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> run time mode flag.</p>
<p>This option can also be specified by the <code>//gsoapopt s</code> directive in the interface header file.</p>
<dl class="section warning"><dt>Warning</dt><dd>This option is not recommended for SOAP RPC encoding style messaging, but XML REST and SOAP/XML document/literal style messages can be validated.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-T"></a>
soapcpp2 -T</h3>
<p>This option generates server auto-test source code. The generated source code implements a test server <em><code>soapTester.c</code></em> (for C) or <em><code>soapTester.cpp</code></em> (for C++) that can be deployed to echo client requests, for example for testing purposes.</p>
<p>For example: </p><pre class="fragment">soapcpp2 -T file.h
c++ -o tester soapTester.cpp soapServer.cpp soapC.cpp stdsoap2.cpp
./tester 8192 8080
</pre><p>This runs the <em><code>tester</code></em> server on port 8080 with <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context initialization mode flag 8192 = 0x2000 = <code><a class="el" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69" title="soap_mode XML output flag value to enable XML (and JSON) message indentation in messages sent ...">SOAP_XML_INDENT</a></code>.</p>
<p>See <a href="#autotest">generating an auto test server for client testing</a> for more details. More advanced servers for testing are available with the gSOAP Test Messenger <a href="../../testmsgr/html/index.html">testmsgr</a> tool to test SOAP and REST XML clients and servers.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-t"></a>
soapcpp2 -t</h3>
<p>This option generates source code to fully annotate SOAP/XML messages with <em><code>xsi:type</code></em> attribute values. This option is useful for SOAP RPC encoded messaging with SOAP applications that require <em><code>xsi:type</code></em> attributes for all XML elements in SOAP messages.</p>
<p>This option can also be specified by the <code>//gsoapopt t</code> directive in the interface header file.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-u"></a>
soapcpp2 -u</h3>
<p>This option uncomments WSDL and XSD files generated by soapcpp2 by supressing the inclusion of `` comments to annotate WSDL and XSD files.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-V"></a>
soapcpp2 -V</h3>
<p>This option displays the current soapcpp2 tool version and then exits.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-v"></a>
soapcpp2 -v</h3>
<p>This option enables verbose output to assist in debugging the soapcpp2 tool.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-w"></a>
soapcpp2 -w</h3>
<p>This option skips the generation of WSDL and XSD files.</p>
<p>This option can also be specified by the <code>//gsoapopt w</code> directive in the interface header file.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-x"></a>
soapcpp2 -x</h3>
<p>This option skips the generation of sample XML message files.</p>
<p>This option can also be specified by the <code>//gsoapopt x</code> directive in the interface header file.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-y"></a>
soapcpp2 -y</h3>
<p>This option adds C/C++ type information to the sample XML message files generated by soapcpp2.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapcpp2-z"></a>
soapcpp2 -z</h3>
<p>These options are for backward compatiility with older gSOAP releases:</p>
<ul>
<li><b><code>-z1</code></b> compatibility: generate old-style C++ service proxies and objects</li>
<li><b><code>-z2</code></b> compatibility with 2.7.x: omit XML output for NULL pointers</li>
<li><b><code>-z3</code></b> compatibility up to 2.8.30: <code>_param_N</code> indexing; nillable pointers</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="import"></a>
The #import directive</h2>
<p>The <code>#import</code> directive is used to include interface header files into other interface header files for soapcpp2. By contrast, the <code>#include</code> directive (and <code>#define</code> directive for that matter) is moved by the soapcpp2 tool into the generated source code file <em><code>soapStub</code></em>, see Section <a class="el" href="index.html#pragmas">The #include and #define directives</a> .</p>
<p>The <code>#import</code> directive is used for two purposes: we use it to include the contents of one interface header file into another interface header file and to import a module, see Section <a class="el" href="index.html#module">How to build modules and libraries with the #module directive</a> .</p>
<p>An example of the <code>#import</code> directive:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;mydefs.h&quot;</span> </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(ns__record *in, <span class="keyword">struct</span> ns__webmethodResponse { ns__record out; } *out);</div></div><!-- fragment --><p>where <code>"mydefs.h"</code> is an interface header file that defines <code>ns__record</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__record</div><div class="line">{</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *name;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *address;</div><div class="line">};</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>ns__record ns__record;</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="pragmas"></a>
The #include and #define directives</h2>
<p>The <code>#include</code> and <code>#define</code> directives are copied by the soapcpp2 tool into the generated source code. These directives are added to the top of the generated <em><code>soapStub.h</code></em> before any other header file is included. Therefore, <code>#include</code> and <code>#define</code> directives can be used to influence the generated source code files.</p>
<p>The following example interface header file for soapcpp2 refers to <code>std::ostream</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ostream&gt;</span> </div><div class="line"><span class="preprocessor">#define SOME_VALUE 123</span></div><div class="line"></div><div class="line"><span class="comment">// std::ostream can&#39;t be serialized, but need to be declared to make it visible:</span></div><div class="line"><span class="keyword">extern</span> <span class="keyword">class </span>std::ostream;</div><div class="line"></div><div class="line"><span class="keyword">class </span>ns__myClass </div><div class="line">{</div><div class="line"> <span class="keyword">public</span>:</div><div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> print(std::ostream &amp;s) <span class="keyword">const</span>; <span class="comment">// we need std::ostream here </span></div><div class="line">  ... <span class="comment">//</span></div><div class="line">};</div></div><!-- fragment --><p>This example also uses an <code>#include</code> and a <code>#define</code> directive that will be added to the top of <em><code>soapStub.h</code></em> before <em><code>gsoap/stdsoap2.h</code></em> is included.</p>
<dl class="section warning"><dt>Warning</dt><dd>Using <code>#define</code> to override <code>WITH_MACRO</code> and <code>SOAP_MACRO</code> compile-time flags is not recommended because the <em><code>gsoap/stdsoap2.cpp</code></em> (<em><code>gsoap/stdsoap2.c</code></em> for C) is used to build the <b><code>-lgsoap++</code></b> (and <b><code>-lgsoap</code></b> for C) library, which is not affected by these macros whereas the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context is, as used by the application, leading to predictable crashes. Use <code><a class="el" href="group__group__with.html#ga176c2f40b17a2952361c37c4602a4c37" title="When this macro is defined at compile time (undefined by default) then the header file specified by t...">SOAPDEFS_H</a></code> or <code><a class="el" href="group__group__with.html#ga24620333a812a36ed84902ff3d897ff6" title="When this macro is defined at compile time (undefined by default), a user-supplied file named soapdef...">WITH_SOAPDEFS_H</a></code> to define macros that are visible to all source code compiled.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="specformat"></a>
Service operation specification format</h2>
<p>A service operation is specified as a function prototype in an interface header file for soapcpp2. For the function prototypes specified, the soapcpp2 tool generates client stub functions to invoke remote services and generates server skeleton functions to implement services.</p>
<p>The service operation specified by a function prototype should return <code>int</code>, which is either <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> for success and a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code for failure, see Section <a class="el" href="index.html#errcodes">Run-time error codes</a> .</p>
<p>The general format of a service operation specification is:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> prefix__method_name(inparam1, inparam2, ..., inparamn, outparam);</div></div><!-- fragment --><p>where</p>
<ul>
<li><code>prefix__</code> is the XML namespace prefix of the method</li>
<li><code>method_name</code> is the service operation name</li>
<li><code>inparam1</code>, ..., <code>inparamn</code> are the input parameters to the service operation, which are either values or pointer types, but not references</li>
<li><code>outparam</code> is the single output parameter of the service operation, which must be a pointer or a reference type.</li>
</ul>
<p>A single output parameter is specified and multiple output parameters should be wrapped in a struct or class, see Section <a class="el" href="index.html#param">Service operation parameter passing</a> . The fully qualified name of the function <code>namespace_prefix__method_name</code> must be unique and cannot match the name of a <code>struct</code>, <code>class</code>, or <code>enum</code> declared in the same header file.</p>
<p>The method request is send as an XML message using the qualified function name with the input parameters in XML:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">prefix:method-name</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">inparam1</span>&gt;...&lt;/<span class="keywordtype">inparam1</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">inparam2</span>&gt;...&lt;/<span class="keywordtype">inparam2</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  ... </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;<span class="keywordtype">inparamn</span>&gt;...&lt;/<span class="keywordtype">inparamn</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;/<span class="keywordtype">prefix:method-name</span>&gt;</div></div><!-- fragment --> </div><p>where the <em><code>inparam1</code></em>, ..., <em><code>inparamn</code></em> elements are the XML element representations of the <code>inparam</code> parameter name declarations.</p>
<p>The XML response by the Web service is of the form:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">prefix:method-nameResponse</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">outparam</span>&gt;...&lt;/<span class="keywordtype">outparam</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">prefix:method-nameResponse</span>&gt;</div></div><!-- fragment --> </div><p>where the <em><code>outparam</code></em> element is the XML element representation of the <code>outparam</code> parameter name declaration, see Section <a class="el" href="index.html#idtrans">C/C++ identifier name to XML tag name translation</a> . By convention, the response element name is the method name ending in <em><code>Response</code></em>. See Section <a class="el" href="index.html#param">Service operation parameter passing</a> on how to change the declaration if the service response element name is different.</p>
<p>With SOAP messaging the request and response XML messages are placed in the <em><code>SOAP-ENV:Envelope</code></em> and <em><code>SOAP-ENV:Body</code></em> elements. SOAP 1.1 document/literal messaging is the default messaging mode in gSOAP, which are modified to SOAP or REST with <em><code>//gsoap &lt;prefix&gt; service method-protocol:</code></em> directives, see Section <a class="el" href="index.html#directives">Directives</a>.</p>
<p>The soapcpp2 tool generates a client stub function for the service operation. This stub is of the form:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> soap_call_prefix__method_name(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *endpoint, <span class="keywordtype">char</span> *action, inparam1, inparam2, ..., outparam);</div></div><!-- fragment --><p>This stub is called by a client application to perform the service operation call.</p>
<p>The soapcpp2 tool generates a skeleton functions for the service operation. The skeleton function called by <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> is:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> soap_serve_prefix__method_name(<span class="keyword">struct</span> soap *soap);</div></div><!-- fragment --><p>which after deserializing the XML request message calls the <code>prefix__method_name</code> service operation defined by the service application and serializes the XML response message when the service operation returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code>.</p>
<p>Alternatively, <b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b> or option <b><code>-i</code></b> generates a C++ client proxy class and a service class. These classes have methods corresponding to the service operations, which on the client side can be invoked to invoke remote service operations and on the server side are implemented by the service application to execute the service operations.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="param"></a>
Service operation parameter passing</h3>
<p>The input parameters of a service operation must be passed by value or by pointer. Input parameters cannot be passed by reference. Passing a pointer to the data is preferred when the size of the data of the parameter is non trivial such as values of primitive type.</p>
<p>The output parameter must be passed by pointer or by reference.</p>
<p>The input and output parameter types must be serializable, which means that there are some limitations on the types of data that can be passed, see Section <a class="el" href="index.html#limitations">Limitations</a> .</p>
<p>If the output parameter is a pointer or reference to a <code>struct</code> or <code>class</code> type, it is considered a service operation response element instead of a simple output parameter value. That is, the name of the <code>struct</code> or <code>class</code> is the name of the response element and the <code>struct</code> or <code>class</code> members are the output parameters of the service operation, see also Section <a class="el" href="index.html#response">How to change the response element name</a> . Therefore, if the output parameter has to be a <code>struct</code> or <code>class</code>, a response <code>struct</code> or <code>class</code> must be declared to wrap that <code>struct</code> or <code>class</code> type parameter. Likewise, if a service operation returns multiple output parameters then a response <code>struct</code> or <code>class</code> should be used to wrap the output parameters. By SOAP conventions, the response element is the service operation name ending with "&lt;i&gt;`Response`&lt;/i&gt;".</p>
<p>The general form of a response struct or class wrapper is:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>prefix__method_nameResponse </div><div class="line">{</div><div class="line">  outparam1; </div><div class="line">  outparam2; </div><div class="line">  ... <span class="comment">//</span></div><div class="line">  outparamn; </div><div class="line">};</div></div><!-- fragment --><p>where</p>
<ul>
<li><code>prefix__</code> is the optional namespace prefix of the response element.</li>
<li><code>response_element_name</code> it the name of the response element.</li>
<li><code>outparam1</code>, ..., <code>outparamn</code> are the output parameters of the service operation.</li>
</ul>
<p>The general form of a service operation specification with a response element declaration is:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> prefix__method_name(inparam1, inparam2, ..., inparamn, <span class="keyword">struct</span> prefix__method_nameResponse { outparam1; outparam2; ...; outparamn; } *anyname);</div></div><!-- fragment --><p>The choice of name for <code>anyname</code> has no effect on the SOAP encoding and decoding and is only used as a place holder for the response. In C++ this parameter can be passed by reference instead of by pointer.</p>
<p>The request message is:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">prefix:method-name</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">inparam1</span>&gt;...&lt;/<span class="keywordtype">inparam1</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">inparam2</span>&gt;...&lt;/<span class="keywordtype">inparam2</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  ... </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;<span class="keywordtype">inparamn</span>&gt;...&lt;/<span class="keywordtype">inparamn</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;/<span class="keywordtype">prefix:method-name</span>&gt;</div></div><!-- fragment --> </div><p>where the <em><code>inparam1</code></em>, ..., <em><code>inparamn</code></em> elements are the XML element representations of the <code>inparam</code> parameters.</p>
<p>The response message is of the form:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">prefix:method-nameResponse</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">outparam1</span>&gt;...&lt;/<span class="keywordtype">outparam1</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">outparam2</span>&gt;...&lt;/<span class="keywordtype">outparam2</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  ... </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;<span class="keywordtype">outparamn</span>&gt;...&lt;/<span class="keywordtype">outparamn</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;/<span class="keywordtype">prefix:method-nameResponse</span>&gt;</div></div><!-- fragment --> </div><p>where the <em><code>outparam1</code></em>, ..., <em><code>outparamn</code></em> elements are the XML element representations of the <code>outparam</code> parameters.</p>
<p>The input and output parameters can be made anonymous, which allows the deserialization of requests/responses with different parameter names as is endorsed by the SOAP 1.1 specification, see Section <a class="el" href="index.html#anonymous">How to specify anonymous parameter names</a> .</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="idtrans"></a>
C/C++ identifier name to XML tag name translation</h2>
<p>One of the nice aspects of gSOAP is its powerful C/C++ XML data binding and the flexibility to specify names for XML, such as service operation names, class names, type identifiers, and struct or class members. The first aspect is the use of namespace prefixes with C/C++ names to qualify the names with XML namespaces, which is specified with a <code>prefix__</code> or as we will see later can be specified with a colon <code>prefix:</code> in the C/C++ name. A C/C++ identifier name of the form</p>
<div class="fragment"><div class="line">prefix__element_name</div></div><!-- fragment --><p>is be encoded in XML as</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">prefix:element-name</span></div></div><!-- fragment --> </div><p>The underscore pair (<code>__</code>) separates the namespace prefix from the element name. Each namespace prefix has a namespace URI specified by a <code>//gsoap &lt;prefix&gt; schema namespace: &lt;URI&gt;</code> directive that is saved to the soapcpp2-generated namespace mapping table, see Sections <a class="el" href="index.html#nstable">XML namespaces and the namespace mapping table</a> and <a class="el" href="index.html#namespace">XML namespace considerations</a> . The namespace URI is a unique identification that can be associated with the service operations and data types. The namespace URI disambiguates potentially identical service operation names and data type names used by disparate organizations.</p>
<p>XML element names are XSD NCNames (non-colon names) that may contain letters, digits, underscores, hyphens, dots, and other special characters except reserved characters and colon. To add non-element names of service operations, structs, classes, typedefs, and members can be A single underscore <code>_</code> in a C/C++ prefix or identifier name is replaced by a hyphen <em><code>-</code></em> in the XML encoding. For example, the identifier name <code>SOAP_ENC__ur_type</code> is represented in XML as <em><code>SOAP-ENC:ur-type</code></em>. A <code>_DOT</code> is replaced by a dot <em><code>.</code></em> in XML, and <code>_USCORE</code> is replaced by an underscore <em><code>_</code></em> in XML. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>n_s__biz_DOTcom </div><div class="line">{</div><div class="line">  <span class="keywordtype">char</span> * n_s__biz_USCOREname; </div><div class="line">};</div></div><!-- fragment --><p>is serialized in XML as:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">n-s:biz.com</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">n-s:biz_name</span>&gt;<span class="keyword">Bizybiz</span>&lt;/<span class="keywordtype">n-s:biz_name</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">n-s:biz.com</span>&gt;</div></div><!-- fragment --> </div><p>Other special characters are added to C/C++ names as <code>_xHHHH</code> where <code>HHHH</code> is the hexadecimal code of a Unicode character code point.</p>
<p>Trailing underscores in an identifier name are stripped from the XML encoding. This is useful when an identifier name clashes with a C++ keyword. For example, <em><code>return</code></em> may be used as an XML element. This <em><code>return</code></em> element can be specified as <code>return_</code>, for example as a struct or class member or function parameter.</p>
<p>By default the soapcpp2 tool generates data binding source code in which all local XML elements are and attributes are unqualified:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap x schema namespace: urn:x </span></div><div class="line"><span class="keyword">struct </span>x__record</div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> * type; <span class="comment">// maps to unqualified type attribute</span></div><div class="line">    <span class="keywordtype">char</span> * name; <span class="comment">// maps to unqualified name element</span></div><div class="line">};</div></div><!-- fragment --><p>where the <code>name</code> element and the <code>type</code> attribute are unqualified in the XML content (for example to facilitate SOAP RPC encoding).</p>
<p>To force qualification of elements and attributes, use the "form" directive:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap x schema namespace: urn:x </span></div><div class="line"><span class="comment">//gsoap x schema form: qualified </span></div><div class="line"><span class="keyword">struct </span>x__record </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> * type; <span class="comment">// maps to qualified x:type attribute</span></div><div class="line">    <span class="keywordtype">char</span> * name; <span class="comment">// maps to qualified x:name element</span></div><div class="line">};</div></div><!-- fragment --><p>You can also use "elementForm" and "attributeForm" directives to (un)qualify local element and attributes, respectively.</p>
<p>Because the soapcpp2-generated serializers follow the qualified/unqualified forms of the schemas, there is normally no need to explicitly qualify struct/class members because automatic encoding rules will be used.</p>
<p>If explicit qualification is needed, this can be done using the prefix convention:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap x schema namespace: urn:x </span></div><div class="line"><span class="comment">//gsoap y schema namespace: urn:y </span></div><div class="line"><span class="keyword">struct </span>x__record </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> * xsi__type; <span class="comment">// maps to qualified xsi:type attribute</span></div><div class="line">    <span class="keywordtype">char</span> * y__name;   <span class="comment">// maps to qualified y:name element</span></div><div class="line">};</div></div><!-- fragment --><p>which ensures that there cannot be any name clashes between members of the same name defined in different schemas (consider for example <code>name</code> and <code>y__name</code>), but this can clutter the representation when clashes do not occur.</p>
<p>An alternative to the prefix convention is the use of "colon notation" in the interface header file for soapcpp2. This extra addition to the the C/C++ syntax allows you to bind type names and struct and class members to qualified and unqualified XML tag names explicitly, thus bypassing the default mechanism that automatically qualifies or unqualifies element and attribute tag names based on the schema element or attribute forms.</p>
<p>The colon notation for type names, struct and class names, and members overrides the prefix qualification rules explicitly:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap x schema namespace: urn:x </span></div><div class="line"><span class="comment">//gsoap y schema namespace: urn:y </span></div><div class="line"><span class="keyword">struct </span>x:record </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> * xsi:type; <span class="comment">// maps to qualified xsi:type attribute</span></div><div class="line">    <span class="keywordtype">char</span> * y:name;   <span class="comment">// maps to qualified y:name element</span></div><div class="line">};</div></div><!-- fragment --><p>where <code>x</code> and <code>y</code> are namespace prefixes that are declared with a directive. The <code>xsi:type</code> member is an XML attribute in the <code>xsi</code> namespace. The soapcpp2 tool generates data binding implementation source code with the following cleaned-up struct without the annotations:</p>
<div class="fragment"><div class="line"><span class="comment">// This code is generated in soapStub.h: </span></div><div class="line"><span class="keyword">struct </span>record </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> * type; <span class="comment">/* optional attribute of type xsd:string */</span> </div><div class="line">    <span class="keywordtype">char</span> * name; <span class="comment">/* optional element of type xsd:string */</span> </div><div class="line">};</div></div><!-- fragment --><p>The soapcpp2 tool also generates XML schemas with element and attribute references. That is, <code>y:name</code> is referenced from the <code>y</code> schema by the <em><code>x:record</code></em> complexType defined in the <code>x</code> schema.</p>
<p>The colon notation also allows you to override the element and attribute forms to unqualified for qualified schemas:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap x schema namespace: urn:x </span></div><div class="line"><span class="comment">//gsoap x schema form: qualified </span></div><div class="line"><span class="keyword">struct </span>x:record </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> * :type; <span class="comment">// maps to unqualified type attribute</span></div><div class="line">    <span class="keywordtype">char</span> * :name; <span class="comment">// maps to unqualified name element</span></div><div class="line">};</div></div><!-- fragment --><p>where the colon notation ensures that both <code>type</code> and <code>name</code> are unqualified in the XML content, which overrides the default qualified forms of the <code>x</code> schema.</p>
<p>Note that the use of colon notation to bind namespace prefixes to type names (typedef, enum, struct, and class names) translates to code without the prefixes. This means that name clashes can occur between types with identical unqualified names:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> x:color { RED, WHITE, BLUE }; </div><div class="line"><span class="keyword">enum</span> y:color { YELLOW, ORANGE }; <span class="comment">// illegal enum name: name clash with x:color</span></div></div><!-- fragment --><p>while prefixing with double underscores never lead to clashes:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> x__color { RED, WHITE, BLUE }; </div><div class="line"><span class="keyword">enum</span> y__color { YELLOW, ORANGE }; <span class="comment">// no name clash</span></div></div><!-- fragment --><p>Also note that colon notation has a very different role than the C++ scope operator <code>::</code>. The scope operator cannot be used in places where we need colon notation, such as struct and class member members.</p>
<p>The default mechanism that associates XML tag names with the names of struct and class member members can be overridden by "re-tagging" names with the annotation of a tag placed next to the member member name. This is particularly useful to support legacy code for which the fixed naming of member members cannot be easily changed. For example:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap x schema namespace: urn:x </span></div><div class="line"><span class="comment">//gsoap x schema form: qualified </span></div><div class="line"><span class="keyword">struct </span>x:record </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> * t `:type`; <span class="comment">// maps to unqualified type attribute</span></div><div class="line">    <span class="keywordtype">char</span> * s `name`;  <span class="comment">// maps to qualified x:name element</span></div><div class="line">};</div></div><!-- fragment --><p>This maps the <code>t</code> member to the <em><code>type</code></em> XML attribute tag and <code>s</code> member to the <em><code>x:name</code></em> XML element tag. Tags will be namespace qualified as per schema element and attribute forms, unless preceded by a colon.</p>
<p>As of gSOAP 2.8.23 and greater, Unicode characters in C/C++ identifiers are accepted by soapcpp2 when the source file is encoded in UTF-8. C/C++ Unicode names are mapped to Unicode XML tags. For C/C++ source code portability reasons, the wsdl2h tool still converts Unicode XML tag names to ASCII C/C++ identifiers using the <code>_xHHHH</code> naming convention for <code>HHHH</code> character code points. Use <a href="#wsdl2h-U"><b><code>wsdl2h -U</code></b> option <b><code>-U</code></b></a> to map Unicode letters in XML tag names to UTF-8-encoded Unicode letters in C/C++ identifiers.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="compilingclient"></a>
Generating a SOAP/XML client application with soapcpp2</h2>
<p>After invoking the soapcpp2 tool on an interface header file description of a service to generate <em><code>soapStub</code></em>, <em><code>soapH.h</code></em>, and <em><code>soapC.cpp</code></em> for the XML serializers, and <em><code>soapClient.cpp</code></em> for the client stub functions, the client application is compiled in C++ as follows: </p><pre class="fragment"> c++ -o myclient myclient.cpp stdsoap2.cpp soapC.cpp soapClient.cpp
</pre><p>For C we use <b><code>soapcpp2 -c</code></b> option <b><code>-c</code></b> to generate C source code that is compiled with: </p><pre class="fragment"> cc -o myclient myclient.c stdsoap2.c soapC.c soapClient.c
</pre><p>Depending on your system configuration, such as with Unix, linking with <b><code>-lsocket</code></b>, <b><code>-lxnet</code></b>, and <b><code>-lnsl</code></b> may be required.</p>
<p>The <em><code>myclient.cpp</code></em> file should include <em><code>soapH.h</code></em> and must include or define a global namespace mapping table, unless <code><a class="el" href="group__group__with.html#gac22000b4058bb41a88750d10785baaf1" title="When this macro is defined at compile time (undefined by default), removes dependence on the global n...">WITH_NONAMESPACES</a></code> is used.</p>
<p>For examples of SOAP and REST client applications, see <em><code>gsoap/samples</code></em> in the gSOAP source code package. The online getting-started guide covers example client and server applications in C and C++, visit <a href="https://www.genivia.com/dev.html">https://www.genivia.com/dev.html</a> to read more. Various examples ranging from simple calculator service APIs to very large protocols spanning dozens of WSDLs can be found at <a href="https://www.genivia.com/examples.html">https://www.genivia.com/examples.html</a></p>
<p>To test client applications using an auto-generated echo test server, use <b><code>soapcpp2 -T</code></b> option <b><code>-T</code></b>, see the next section. You can also test a client application with the gSOAP <a href="../../testmsgr/html/index.html">Test Messenger</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="compilingservice"></a>
Generating a SOAP/XML Web service application with soapcpp2</h2>
<p>After invoking the soapcpp2 tool on an interface header file description of a service to generate <em><code>soapStub</code></em>, <em><code>soapH.h</code></em>, and <em><code>soapC.cpp</code></em> for the XML serializers, and <em><code>soapServer.cpp</code></em> for the server skeleton functions, the service application is compiled in C++ as follows: </p><pre class="fragment"> c++ -o myserver myserver.cpp stdsoap2.cpp soapC.cpp soapServer.cpp
</pre><p>For C we use <b><code>soapcpp2 -c</code></b> option <b><code>-c</code></b> to generate C source code that is compiled with: </p><pre class="fragment"> cc -o myserver myserver.c stdsoap2.c soapC.c soapServer.c
</pre><p>Depending on your system configuration, such as with Unix, linking with <b><code>-lsocket</code></b>, <b><code>-lxnet</code></b>, and <b><code>-lnsl</code></b> may be required.</p>
<p>The <em><code>myserver.cpp</code></em> file should include <em><code>soapH.h</code></em> and should include or define a global namespace mapping table, unless <code><a class="el" href="group__group__with.html#gac22000b4058bb41a88750d10785baaf1" title="When this macro is defined at compile time (undefined by default), removes dependence on the global n...">WITH_NONAMESPACES</a></code> is used.</p>
<p>A gSOAP service can be installed as:</p>
<ul>
<li>A simple stateless CGI application where the application just calls <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> to serve requests on standard input and output.</li>
<li>A FastCGI application, see Section <a class="el" href="index.html#fastcgi">FastCGI</a>.</li>
<li>A stand-alone server, see Section <a class="el" href="index.html#stand-alone">How to create a stand-alone server</a>.</li>
<li>A stand-alone multi-threaded server, see Section <a class="el" href="index.html#mt">How to create a multi-threaded stand-alone service</a>.</li>
<li>An Apache module, see the gSOAP <a href="../../apache/html/index.html">Apache module</a> documentation.</li>
<li>An ISAPI extension running in IIS, see the gSOAP <a href="../../isapi/html/index.html">ISAPI extension</a> documentation.</li>
</ul>
<p>To test a service, see the gSOAP <a href="../../testmsgr/html/index.html">Test Messenger</a>.</p>
<p>Furthermore, an echo test server application <em><code>soapTester.cpp</code></em> is generated with <b><code>soapcpp2 -T</code></b> option <b><code>-T</code></b>, which is a stand-alone iterative test server that echos SOAP/XML requests and runs on the specified port. Compile this with: </p><pre class="fragment"> c++ -o testserver soapTester.cpp stdsoap2.cpp soapC.cpp soapServer.cpp
</pre><p>Then run on a port, say 8080: </p><pre class="fragment"> ./testServer 12288 8080
</pre><p>The 12288 value is a combination of the <code><a class="el" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69" title="soap_mode XML output flag value to enable XML (and JSON) message indentation in messages sent ...">SOAP_XML_INDENT</a></code> (0x2000) and <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> (0x1000) integer flag values (8192 + 4096 = 12288).</p>
<p>For examples of SOAP and REST Web service applications, see <em><code>gsoap/samples</code></em> in the gSOAP source code package. The online getting-started guide covers example client and server applications in C and C++, visit <a href="https://www.genivia.com/dev.html">https://www.genivia.com/dev.html</a> to read more. Various examples ranging from simple calculator service APIs to very large protocols spanning dozens of WSDLs can be found at <a href="https://www.genivia.com/examples.html">https://www.genivia.com/examples.html</a></p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="autotest"></a>
Generating an auto test server for client testing</h2>
<p>The <b><code>soapcpp2 -T</code></b> option <b><code>-T</code></b> generates an echo test server application source code <em><code>soapTester.cpp</code></em>, which is to be compiled and linked with the code generated for a server implementation <em><code>soapServer.cpp</code></em> (or with the generated service class file) and <em><code>soapC.cpp</code></em>. The feature also supports C source code, use the <b><code>soapcpp2 -c -T</code></b> options <b><code>-c</code></b> and <b><code>-T</code></b> to generate a C test server.</p>
<p>The echo test server can be used to test a client application, by the client sending messages to the echo test server that echos responses back to the client. These responses are structurally valid but may lack sufficient details to consider the response messages useful.</p>
<p>The generated source code is compiled with: </p><pre class="fragment">c++ -o tester soapTester.cpp soapServer.cpp soapC.cpp stdsoap2.cpp
</pre><p>To run the <b><code>tester</code></b> auto-test service on a port to test a client against, use two command-line arguments: the first argument is a combined integer of OR-ed values of the context flags such as 12288 which is a combination of <code><a class="el" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69" title="soap_mode XML output flag value to enable XML (and JSON) message indentation in messages sent ...">SOAP_XML_INDENT</a></code> (0x1000 = 4096) and <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> (0x1000 = 8196) and the second argument is the port number: </p><pre class="fragment"> ./tester 12288 8080
</pre><p>This starts an iterative stand-alone server on port 8080. Messages can be sent to <em><code><a href="http://localhost:8080">http://localhost:8080</a></code></em> to test a client application against the echo test server. The data in the response messages are copied from the request messages when possible, or XML default values, or empty otherwise.</p>
<p>More advanced servers for testing are available with the gSOAP Test Messenger <a href="../../testmsgr/html/index.html">testmsgr</a> tool to test SOAP and REST XML clients and servers.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="deep"></a>
Generating deep copy and deletion functions</h2>
<p>The <a href="#soapcpp2-E"><b><code>soapcpp2 -Ec</code></b> option <b><code>-Ec</code></b></a> generates deep copy code for each serializable type <code>T</code> declared in an interface header file for soapcpp2. The <a href="#soapcpp2-E"><b><code>soapcpp2 -Ed</code></b> option <b><code>-Ed</code></b></a> generates deep deletion code.</p>
<p>For a serializable type <code>T</code> declared in the interface header file for soapcpp2, option <b><code>-Ec</code></b> generates:</p>
<ul>
<li><code>virtual T * T::soap_dup(struct soap*) const</code> where <code>T</code> is a class, returns a duplicate of this object by deep copying, replicating all deep cycles and shared pointers when a managing <code>soap</code> context is provided as argument. Deep copy is a tree when argument is NULL, but the presence of deep cycles will lead to non-termination. Use flag <code>SOAP_XML_TREE</code> with the managing context to copy into a tree without cycles and pointers to shared objects.</li>
<li><code>T * soap_dup_T(struct soap*, T *dst, const T *src)</code> where <code>T</code> is not a class, deep copy <code>src</code> into <code>dst</code>, replicating all deep cycles and shared pointers when a managing <code>soap</code> context is provided as argument. When <code>dst</code> is NULL, allocates space for <code>dst</code> and returns a pointer to the allocated copy. Deep copy results in a tree when the <code>soap</code> context is NULL, but the presence of deep cycles will lead to non-termination. Use flag <code>SOAP_XML_TREE</code> with managing context to copy into a tree without cycles and pointers to shared objects. Returns <code>dst</code> or allocated copy when <code>dst</code> is NULL.</li>
</ul>
<p>For a serializable type <code>T</code> declared in the interface header file for soapcpp2, option <b><code>-Ed</code></b> generates:</p>
<ul>
<li><code>virtual void T::soap_del() const</code> where <code>T</code> is a class, deletes all heap-allocated members of this object by deep deletion ONLY IF this object and all of its (deep) members are not managed by a <code>soap</code> context AND the deep structure is a tree (no cycles and co-referenced objects by way of multiple (non-smart) pointers pointing to the same data). Can be safely used after <code>T::soap_dup(NULL)</code> to delete the deep copy. Does not delete the object itself.</li>
<li><code>void soap_del_T(const T*)</code> where <code>T</code> is not a class, deletes all heap-allocated members of this object by deep deletion ONLY IF this object and all of its (deep) members are not managed by a <code>soap</code> context AND the deep structure is a tree (no cycles and co-referenced objects by way of multiple (non-smart) pointers pointing to the same data). Can be safely used after <code>soap_dup_T(NULL, NULL, const T*)</code> to delete the deep copy returned. Does not delete the object itself.</li>
</ul>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">  ns__record record;                            <span class="comment">// a serializable type</span></div><div class="line">  ns__record rec_dup;</div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a> = open(file, O_RDONLY); </div><div class="line">  <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a> &lt; 0)</div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  <span class="keywordflow">if</span> (soap_read_ns__record(soap, &amp;record))      <span class="comment">// deserialize from file into managed memory</span></div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  close(soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a>);</div><div class="line">  soap_dup_ns__record(NULL, &amp;rec_dup, &amp;record); <span class="comment">// deep copy the record to unmanaged memory</span></div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);                           <span class="comment">// delete managed objects</span></div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);                               <span class="comment">// delete managed data and temporaries</span></div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);                              <span class="comment">// free the context</span></div><div class="line">  soap_del_ns__record(&amp;rec_dup)                 <span class="comment">// deep delete unmanaged record</span></div><div class="line">}</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="rules"></a>
Serialization and deserialization rules</h1>
<p>This section describes the serialization and deserialization of C and C++ data types in XML, and therefore by implication in SOAP 1.1 and 1.2. First, the difference between SOAP RPC encoding and document/literal style is explained and how to switch between SOAP 1.1 and 1.2 or support both in applications. Then the general XML representations of C/C++ data in XML and XML schema is explained.</p>
<p>To obtain more information about the code generated by soapcpp2 for the data types specified in an interface header file for soapcpp2, use <b><code>soapcpp2 -r</code></b> option <b><code>-r</code></b> to generate a <em><code>soapReadme.md</code></em> report with all the details.</p>
<p>For additional details on serialization of data types in XML, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="rpcversusdoclit"></a>
SOAP RPC encoding versus document/literal style messaging</h2>
<p>The serialization and deserialization rules is almost identical for these two different styles, except for the following:</p>
<ul>
<li>With SOAP RPC encoding, generic <em><code>complexTypes</code></em> with <em><code>maxOccurs="unbounded"</code></em> are not allowed and SOAP-encoded arrays must be used instead.</li>
<li>XML attributes and unions (XML schema <em><code>choice</code></em>) are not allowed with SOAP RPC encoding.</li>
<li>In XML messages conforming to SOAP RPC encoding we often see <em><code>xsi:type</code></em> attributed messages although the <em><code>xsi:type</code></em> attribute is not required and the gSOAP engine does not produce <em><code>xsi:type</code></em> attributes unless required, e.g. to identify derived classes from base classes serialized. Use <b><code>soapcpp2 -t</code></b> option <b><code>-t</code></b> to force <em><code>xsi:type</code></em> attributes in the XML output.</li>
<li>In XML messages conforming to SOAP RPC encoding, multi-reference accessors using id-href/ref attributes are common to encode co-referenced data. By contrast, multi-referenced data is not accurately represented in document/literal style, which means that data structure graphs cannot be accurately serialized. Document/literal is strictly "tree shaped".</li>
</ul>
<p>The soapcpp2 tool uses SOAP 1.1 document/literal style by default. Use the <code>//gsoap</code> directives to control the SOAP protocol version and messaging style, see Section <a class="el" href="index.html#directives">Directives</a>, or use <b><code>soapcpp2</code></b> options <b><code>-2</code></b> (SOAP 1.2), <b><code>-e</code></b> (encoding style), and <b><code>-t</code></b> (add <em><code>xsi:type</code></em> attributes).</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="switching"></a>
SOAP 1.1 versus SOAP 1.2 and dynamic switching</h2>
<p>SOAP 1.1 is the default protocol. SOAP 1.2 support is automatically turned on when the appropriate SOAP 1.2 namespace is used in the WSDL input to wsdl2h, which then generates <code>#import "soap12.h"</code> in the interface header file:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;soap12.h&quot;</span></div></div><!-- fragment --><p>This interface header file when input to soapcpp2 results in a XML namespace mapping table with SOAP 1.2 namespaces:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2003/05/soap-envelope&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/2003/05/soap-encoding&quot;</span> }, </div><div class="line">  ... <span class="comment">//</span></div><div class="line">  { NULL, NULL }</div><div class="line">}</div></div><!-- fragment --><p>The soapcpp2-generated default SOAP 1.1 namespace table allow for dynamic switching between SOAP 1.1 to SOAP 1.2 by providing the SOAP 1.2 namespace as a pattern in the third column of a namespace table:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/soap-encoding&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/soap-envelope&quot;</span> }, </div><div class="line">  ... <span class="comment">//</span></div><div class="line">  { NULL, NULL }</div><div class="line">}</div></div><!-- fragment --><p>where the <code>*</code> in the third column of the namespace URI pattern is a wildcard for any sequence of character. This is used to match inbound <em><code>xmlns</code></em> XML namespace bindings that are then associated with the prefix in the table. For example, when the inbound XML contains a <em><code>xmlsn:soap="http://www.w3.org/2003/05/soap-envelope"</code></em> binding then the <em><code>soap</code></em> prefix used in the inbound XML is actually equivalent to <em><code>SOAP-ENV</code></em> used in gSOAP as determined by the matching pattern in the third column of the XML namespace table shown above.</p>
<p>In this way, gSOAP Web services can respond to both SOAP 1.1 or SOAP 1.2 requests. Moreover, the gSOAP engine will automatically return a SOAP 1.2 message response to a SOAP 1.2 message request when the XML namespace table shown above is used. This works by using the specified pattern in the third column, when it matches the namespace URI of the inbound XML request message of course. However, the use of SOAP 1.1 or 1.2 is overridden for one or more service operations with the <code>//gsoap &lt;prefix&gt; service method-protocol:</code> directive.</p>
<p>A gSOAP client that sends a request message will always send it using the SOAP protocol specified by the namespace in the second column, unless this is overridden with a <code>//gsoap &lt;prefix&gt; service method-protocol:</code> directive.</p>
<p>To make the XML namespace table available to the developer, the soapcpp2 tool generates a <em><code>.nsmap</code></em> file with the <code>SOAP-ENV</code> and <code>SOAP-ENC</code> namespaces and patterns as shown in the example above.</p>
<p>To use SOAP 1.2 by default and accept SOAP 1.1 messages to be received, use the <b><code>soapcpp2 -2</code></b> option <b><code>-2</code></b> to generate SOAP 1.2 <em><code>.nsmap</code></em> and <em><code>.wsdl</code></em> files. Alternatively, add the following line to your interface header file (generated by wsdl2h) for soapcpp2:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;soap12.h&quot;</span></div></div><!-- fragment --><p>The <em><code>soap12.h</code></em> file is located in <em><code>gsoap/import</code></em>.</p>
<dl class="section warning"><dt>Warning</dt><dd>SOAP 1.2 does not support SOAP "partially transmitted arrays". So the <code>__offset</code> member of a dynamic array is meaningless in SOAP 1.2.</dd>
<dd>
SOAP 1.2 uses <code><a class="el" href="struct_s_o_a_p___e_n_v_____code.html" title="SOAP Fault Code structure. ">SOAP_ENV__Code</a></code>, <code><a class="el" href="struct_s_o_a_p___e_n_v_____reason.html" title="SOAP Fault Reason structure generated by soapcpp2. ">SOAP_ENV__Reason</a></code>, and <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code> members of a <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html" title="SOAP Fault structure. ">SOAP_ENV__Fault</a></code> fault struct, while SOAP 1.1 uses <code>faultcode</code>, <code>faultstring</code>, and <code>detail</code> members.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="primtype"></a>
Primitive type serialization</h2>
<p>The default encoding rules for primitive C and C++ data types in XML are given in the table below:</p>
<table class="doxtable">
<tr>
<th>C/C++ type </th><th>XSD type  </th></tr>
<tr>
<td><code>bool</code> </td><td><code>xsd:boolean</code> </td></tr>
<tr>
<td><code>char</code> and <code>int8_t</code> </td><td><code>xsd:byte</code> </td></tr>
<tr>
<td><code>short</code> and <code>int16_t</code> </td><td><code>xsd:short</code> </td></tr>
<tr>
<td><code>int</code>, <code>long</code>, and <code>int32_t</code> </td><td><code>xsd:int</code> </td></tr>
<tr>
<td><code>LONG64</code>, <code>long long</code> and <code>int64_t</code> </td><td><code>xsd:long</code> </td></tr>
<tr>
<td><code>unsigned char</code> and <code>uint8_t</code> </td><td><code>xsd:unsignedByte</code> </td></tr>
<tr>
<td><code>unsigned short</code> and <code>uint16_t</code> </td><td><code>xsd:unsignedShort</code> </td></tr>
<tr>
<td><code>unsigned int</code>, <code>unsigned long</code> and <code>uint32_t</code> </td><td><code>xsd:unsignedInt</code> </td></tr>
<tr>
<td><code>ULONG64</code>, <code>long long</code>, and <code>uint64_t</code> </td><td><code>xsd:unsignedLong</code> </td></tr>
<tr>
<td><code>float</code> </td><td><code>xsd:float</code> </td></tr>
<tr>
<td><code>double</code> </td><td><code>xsd:double</code> </td></tr>
<tr>
<td><code>long double</code> </td><td><code>xsd:decimal</code> with <code>#import "custom/long_double.h"</code> </td></tr>
<tr>
<td><code>time_t</code> </td><td><code>xsd:dateTime</code> </td></tr>
<tr>
<td><code>struct tm</code> </td><td><code>xsd:dateTime</code> with <code>#import "custom/struct_tm.h"</code> </td></tr>
<tr>
<td><code>struct timeval</code> </td><td><code>xsd:dateTime</code> with <code>#import "custom/struct_timeval.h"</code> </td></tr>
<tr>
<td><code>char*</code>, <code>const char*</code>, and <code>std::string</code> </td><td><code>xsd:string</code> </td></tr>
<tr>
<td><code>wchar_t*</code>, <code>const wchar_t*</code>, and <code>std::wstring</code> </td><td><code>xsd:string</code> </td></tr>
</table>
<p>Enumerations and bit masks are also supported, see Section <a class="el" href="index.html#enum">Enumeration serialization</a> .</p>
<p>Custom serializers for <code>long double</code>, <code>struct tm</code>, and <code>struct timeval</code> and many other specialized C and C++ types are available, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation for details.</p>
<p>The previous table shows how C/C++ primitive types are mapped to XSD types. To define and use the full range of XSD types is done with typedefs to define namespace-qualified types in C/C++ corresponding to the XSD types (or to any schema type for that matter).</p>
<p>XSD types such as <em><code>xsd:positiveInteger</code></em>, <em><code>xsd:anyURI</code></em>, and <em><code>xsd:date</code></em> for which no built-in data structures in C and C++ exist can always be represented by strings and some can be represented by integers or floats. Validation constraints can be added to validate the XSD type values as explained further below.</p>
<p>A <code>typedef</code> in an interface header file for soapcpp2 declares a schema type name. The soapcpp2 tool interprets <code>typedef</code> declarations the same way as a regular C compiler interprets them. However, the soapcpp2 tool also uses the type name when generating WSDLs and XSD files and in <em><code>xsi:type</code></em> attributes when present.</p>
<p>For example, the declaration:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> uint64_t xsd__positiveInteger;</div></div><!-- fragment --><p>creates a named type <code>xsd__positiveInteger</code> represented by <code>ulong64_t</code> and serialized as XSD type <em><code>xsd:positiveInteger</code></em>.</p>
<p>The built-in primitive and derived numerical XSD types are listed below together with their recommended <code>typedef</code> declarations. Note that the SOAP encoding schemas for primitive types are derived from the built-in XML Schema types, so <code>SOAP_ENC__</code> can be used as a namespace prefix instead of <code>xsd__</code>. However, the use of <em><code>SOAP_ENC</code></em> XML types is obsolete and redundant because XSD primitive types can be used instead.</p>
<p>Other XSD types not mentioned in this section, such as <em><code>gYearMonth</code></em>, <em><code>gYear</code></em>, <em><code>gMonthDay</code></em>, <em><code>gDay</code></em>, <em><code>xsd:gMonth</code></em>, <em><code>QName</code></em>, <em><code>NOTATION</code></em>, etc., can be encoded similarly using a <code>typedef</code> declaration with a string type.</p>
<p>For additional in-depth details, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<h3><em><code>xsd:anyURI</code></em></h3>
<p>Represents a Uniform Resource Identifier Reference (URI). Each URI scheme imposes specialized syntax rules for URIs in that scheme, including restrictions on the syntax of allowed fragment identifiers. It is recommended to use strings to store <em><code>xsd:anyURI</code></em> XML Schema types. The recommended type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__anyURI;</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> std::string xsd__anyURI;</div></div><!-- fragment --><h3><em><code>xsd:base64Binary</code></em></h3>
<p>Represents Base64-encoded arbitrary binary data. For using the <em><code>xsd:base64Binary</code></em> XSD type, the use of the base64Binary representation of a dynamic array is strongly recommended, see Section <a class="el" href="index.html#base64binary">base64Binary serialization</a> . However, the type can also be declared as a string and the encoding will be string-based: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html">xsd__base64Binary</a>;</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> std::string xsd__base64Binary;</div></div><!-- fragment --><p> However, it is the responsibility of the application to make sure the string content is according to the Base64 Content-Transfer-Encoding defined in Section 6.8 of RFC 2045. Better is to use the base64 serializer that serializes binary data as <em><code>xsd:base64Binary</code></em>: </p><div class="fragment"><div class="line"><span class="keyword">struct </span>xsd__base64Binary</div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6ba9f9e291b2b26e0696bd48f4e983be">__ptr</a>; <span class="comment">// point to data to serialize</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structxsd____base64_binary.html#aa2dfd4d99f8280c413b9ff25a69a8729">__size</a>;           <span class="comment">// length of the data to serialize</span></div><div class="line">};</div></div><!-- fragment --><h3><em><code>xsd:boolean</code></em></h3>
<p>For declaring an <em><code>xsd:boolean</code></em> XSD type, the use of a bool is recommended in C++. For C, see Section <a class="el" href="index.html#boolean">Boolean enumeration serialization for C</a> . The corresponding type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">bool</span> xsd__boolean;</div></div><!-- fragment --><h3><em><code>xsd:byte</code></em></h3>
<p>Represents a byte (-128...127). The corresponding type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> xsd__byte;</div></div><!-- fragment --><h3><em><code>xsd:dateTime</code></em></h3>
<p>Represents a date and time. The lexical representation is according to the ISO 8601 extended format CCYY-MM-DDThh:mm:ss where "CC" represents the century, "YY" the year, "MM" the month and "DD" the day, preceded by an optional leading "-" sign to indicate a negative number. If the sign is omitted, "+" is assumed. The letter "T" is the date/time separator and "hh", "mm", "ss" represent hour, minute and second respectively. It is recommended to use the <code>time_t</code> type to store <em><code>xsd:dateTime</code></em> XSD types and the type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> time_t xsd__dateTime;</div></div><!-- fragment --><p> However, note that calendar times before the year 1902 or after the year 2037 cannot be represented. Upon receiving a date outside this range, the <code>time_t</code> value will be set to -1. Also strings can be used to store <em><code>xsd:dateTime</code></em> types: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__dateTime;</div></div><!-- fragment --><p> Best is to use a custom serializer <code>struct tm</code>, <code>struct timeval</code>, or <code>std::chrono::system_clock::time_point</code> defined by <em><code>gsoap/custom/struct_tm.h</code></em>, <em><code>gsoap/custom/struct_timeval.h</code></em>, and <em><code>gsoap/custom/chrono_timepoint.h</code></em> to represent <em><code>xsd:dateTime</code></em> accurately.</p>
<h3><em><code>xsd:date</code></em></h3>
<p>Represents a date. The lexical representation for date is the reduced (right truncated) lexical representation for dateTime: CCYY-MM-DD. It is recommended to use strings (<code>char*</code>) to store <em><code>xsd:date</code></em> XSD types. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__date;</div></div><!-- fragment --><p> Best is to use a custom serializer <code>struct tm</code> defined by <em><code>gsoap/custom/struct_tm_date.h</code></em> to represent <em><code>xsd:date</code></em> accurately.</p>
<h3><em><code>xsd:decimal</code></em></h3>
<p>Represents arbitrary precision decimal numbers. It is recommended to use the {double} type to store <em><code>xsd:decimal</code></em> XSD types and the type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">double</span> xsd__decimal;</div></div><!-- fragment --><p> Better is to use a custom serializer <em><code>gsoap/custom/long_double.h</code></em> to represent <em><code>xsd:decimal</code></em> or a string to avoid losing accuracy of very large numbers.</p>
<h3><em><code>xsd:double</code></em></h3>
<p>Corresponds to the IEEE double-precision 64-bit floating point type. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">double</span> xsd__double;</div></div><!-- fragment --><h3><em><code>xsd:duration</code></em></h3>
<p>Represents a duration of time. The lexical representation for duration is the ISO 8601 extended format PnYn MnDTnH nMnS, where nY represents the number of years, nM the number of months, nD the number of days, T is the date/time separator, nH the number of hours, nM the number of minutes and nS the number of seconds. The number of seconds can include decimal digits to arbitrary precision. It is recommended to use strings (<code>char*</code>) to store <em><code>xsd:duration</code></em> XSD types. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__duration;</div></div><!-- fragment --><p> Better is to use a custom serializer <em><code>gsoap/custom/duration.h</code></em> or <em><code>gsoap/custom/chrono_duration.h</code></em> to represent <em><code>xsd:duration</code></em> or a string to avoid losing accuracy of very large numbers.</p>
<h3><em><code>xsd:float</code></em></h3>
<p>Corresponds to the IEEE single-precision 32-bit floating point type. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">float</span> xsd__float;</div></div><!-- fragment --><h3><em><code>xsd:hexBinary</code></em></h3>
<p>Represents arbitrary hex-encoded binary data. It has a lexical representation where each binary octet is encoded as a character tuple, consisting of two hexadecimal digits ([0-9a-fA-F]) representing the octet code. For example, "0FB7" is a hex encoding for the 16-bit integer 4023 (binary representation is 111110110111. For using the <em><code>xsd:hexBinary</code></em> XSD type, the use of the hexBinary representation of a dynamic array is strongly recommended, see Section <a class="el" href="index.html#hexbinary">hexBinary serialization</a> . However, the type can also be declared as a string and the encoding will be string-based: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____hex_binary.html">xsd__hexBinary</a>;</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> std::string xsd__hexBinary;</div></div><!-- fragment --><p> However, it is the responsibility of the application to make sure the string content is hex formatted. Better is to use the hex serializer that serializes binary data as <em><code>xsd:hexBinary</code></em>: </p><div class="fragment"><div class="line"><span class="keyword">struct </span>xsd__hexBinary</div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____hex_binary.html#adade1cbcc8c6ff25037794f38944f999">__ptr</a>; <span class="comment">// point to data to serialize</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structxsd____hex_binary.html#a4c213d448af3955f37dded4f238301e6">__size</a>;           <span class="comment">// length of the data to serialize</span></div><div class="line">};</div></div><!-- fragment --><h3><em><code>xsd:int</code></em></h3>
<p>Corresponds to a 32-bit integer in the range -2147483648 to 2147483647. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">int</span> xsd__int;</div></div><!-- fragment --><h3><em><code>xsd:integer</code></em></h3>
<p>Corresponds to an unbounded integer. C/C++ does not support unbounded integers as a standard feature. The recommended type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> int64_t xsd__integer;</div></div><!-- fragment --><p> Another possibility is to use strings to represent unbounded integers and do the translation in the application itself.</p>
<h3><em><code>xsd:long</code></em></h3>
<p>Corresponds to a 64-bit integer in the range -9223372036854775808 to 9223372036854775807. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> int64_t xsd__long;</div></div><!-- fragment --><h3><em><code>xsd:negativeInteger</code></em></h3>
<p>Corresponds to a negative unbounded integer. C/C++ does not support unbounded integers as a standard feature. The recommended type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> int64_t xsd__negativeInteger : -1 ;</div></div><!-- fragment --><p> Another possibility is to use strings to represent unbounded integers and do the translation in the application itself.</p>
<h3><em><code>xsd:nonNegativeInteger</code></em></h3>
<p>Corresponds to a non-negative unbounded integer. Since C++ does not support unbounded integers as a standard feature, the recommended type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> uint64_t xsd__nonNegativeInteger 0 : ;</div></div><!-- fragment --><p> Another possibility is to use strings to represent unbounded integers and do the translation in the application itself.</p>
<h3><em><code>xsd:nonPositiveInteger</code></em></h3>
<p>Corresponds to a non-positive unbounded integer. Since C++ does not support unbounded integers as a standard feature, the recommended type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> int64_t xsd__nonPositiveInteger : 0 ;</div></div><!-- fragment --><p> Another possibility is to use strings to represent unbounded integers and do the translation in code.</p>
<h3><em><code>xsd:normalizedString</code></em></h3>
<p>Represents normalized character strings. Normalized character strings do not contain the carriage return (#xD), line feed (#xA) nor tab (#x9) characters. It is recommended to use strings to store <em><code>xsd:normalizedString</code></em> XSD types. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__normalizedString;</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> std::string xsd__normalizedString;</div></div><!-- fragment --><h3><em><code>xsd:positiveInteger</code></em></h3>
<p>Corresponds to a positive unbounded integer. C/C++ does not support unbounded integers as a standard feature. The recommended type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> uint64_t xsd__positiveInteger 1 : ;</div></div><!-- fragment --><p> Another possibility is to use strings to represent unbounded integers and do the translation in the application itself.</p>
<h3><em><code>xsd:short</code></em></h3>
<p>Corresponds to a 16-bit integer in the range -32768 to 32767. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">short</span> xsd__short;</div></div><!-- fragment --><h3><em><code>xsd:string</code></em></h3>
<p>Represents character strings. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__string;</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> std::string xsd__string;</div></div><!-- fragment --><p> The type declaration for wide character strings is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">wchar_t</span> *xsd__string;</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> std::wstring xsd__string;</div></div><!-- fragment --><p> Both types of regular and wide strings can be used at the same time, by using a typedef name with a trailing underscore as follows: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">wchar_t</span> *xsd__string_;</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> std::wstring xsd__string_;</div></div><!-- fragment --><h3><em><code>xsd:time</code></em></h3>
<p>Represents a time. The lexical representation for time is the left truncated lexical representation for dateTime: hh:mm:ss.sss with optional following time zone indicator. It is recommended to use strings (<code>char*</code>) to store <em><code>xsd:time</code></em> XSD types. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__time;</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> std::string xsd__time;</div></div><!-- fragment --><p> Better is to use a custom serializer <em><code>gsoap/custom/long_time.h</code></em> to represent <em><code>xsd:time</code></em> or a string to avoid losing accuracy.</p>
<h3><em><code>xsd:token</code></em></h3>
<p>Represents tokenized strings. Tokens are strings that do not contain the line feed (#xA) nor tab (#x9) characters, that have no leading or trailing spaces (#x20) and that have no internal sequences of two or more spaces. It is recommended to use strings to store <em><code>xsd:token</code></em> XSD types. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__token;</div></div><!-- fragment --><h3><em><code>xsd:unsignedByte</code></em></h3>
<p>Corresponds to an 8-bit unsigned integer in the range 0 to 255. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> uint8_t xsd__unsignedByte;</div></div><!-- fragment --><h3><em><code>xsd:unsignedInt</code></em></h3>
<p>Corresponds to a 32-bit unsigned integer in the range 0 to 4294967295. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> uint32_t xsd__unsignedInt;</div></div><!-- fragment --><h3><em><code>xsd:unsignedLong</code></em></h3>
<p>Corresponds to a 64-bit unsigned integer in the range 0 to 18446744073709551615. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> uint64_t xsd__unsignedLong;</div></div><!-- fragment --><h3><em><code>xsd:unsignedShort</code></em></h3>
<p>Corresponds to a 16-bit unsigned integer in the range 0 to 65535. The type declaration is: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> uint16_t xsd__unsignedShort;</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="multiprim"></a>
How to use multiple C/C++ types for a single primitive XSD type</h3>
<p>As explained in Section <a class="el" href="index.html#idtrans">C/C++ identifier name to XML tag name translation</a>, trailing underscores in a type name are not relevant in XML and in the XML schemas generated by soapcpp2. Therefore, we can map multiple C/C++ types to XSD types (or any XML schema type). For example, the following declaration in the interface header file for soapcpp2 permits us to use regular strings and wide strings while mapping these both to the XSD <em><code>xsd:string</code></em> type:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__string; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">wchar_t</span> *xsd__string_;</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="primclass"></a>
How to use C++ wrapper classes to specify polymorphic primitive types</h3>
<p>XSD schema types form a hierarchy of types, with <em><code>xsd:anyType</code></em> at the root. A container or array of <em><code>xsd:anyType</code></em> may actually contain any mix of types, i.e. this container or array is polymorphic.</p>
<p>On the one hand, the <code>typedef</code> construct provides a convenient way to associate existing C/C++ types with XML schema types and makes it easy to incorporate these types in a (legacy) C/C++ application without having to replace application types in the source code. On the other hand the <code>typedef</code> declarations cannot be used to support polymorphic types.</p>
<p>To create a derivable primitive type <code>T</code>, a wrapper class is declared as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>prefix__type_name : <span class="keyword">public</span> xsd__super_type_name</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    T __item; </div><div class="line">    ... <span class="comment">// other members, see note below</span></div><div class="line">};</div></div><!-- fragment --><p>where <code>T</code> is a primitive C/C++ type. The <code>__item</code> member must be the first member of the wrapper class and all other members are not serialized.</p>
<p>For example, the a large portion of the XML type hierarchy can be implemented in C++ as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>xsd__anyType                                            { }; </div><div class="line"><span class="keyword">class </span>xsd__anySimpleType : <span class="keyword">public</span> xsd__anyType                { }; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__string; </div><div class="line"><span class="keyword">class </span>xsd__string_ : <span class="keyword">public</span> xsd__anySimpleType                { <span class="keyword">public</span>: xsd__string __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__anyURI; </div><div class="line"><span class="keyword">class </span>xsd__anyURI_ : <span class="keyword">public</span> xsd__anySimpleType                { <span class="keyword">public</span>: xsd__anyURI __item; }; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">bool</span> xsd__boolean; </div><div class="line"><span class="keyword">class </span>xsd__boolean_ : <span class="keyword">public</span> xsd__anySimpleType               { <span class="keyword">public</span>: xsd__boolean __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__date; </div><div class="line"><span class="keyword">class </span>xsd__date_ : <span class="keyword">public</span> xsd__anySimpleType                  { <span class="keyword">public</span>: xsd__date __item; }; </div><div class="line"><span class="keyword">typedef</span> time_t xsd__dateTime; </div><div class="line"><span class="keyword">class </span>xsd__dateTime_ : <span class="keyword">public</span> xsd__anySimpleType              { <span class="keyword">public</span>: xsd__dateTime __item; }; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">double</span> xsd__double; </div><div class="line"><span class="keyword">class </span>xsd__double_ : <span class="keyword">public</span> xsd__anySimpleType                { <span class="keyword">public</span>: xsd__double __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__duration; </div><div class="line"><span class="keyword">class </span>xsd__duration_ : <span class="keyword">public</span> xsd__anySimpleType              { <span class="keyword">public</span>: xsd__duration __item; }; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">float</span> xsd__float; </div><div class="line"><span class="keyword">class </span>xsd__float_ : <span class="keyword">public</span> xsd__anySimpleType                 { <span class="keyword">public</span>: xsd__float __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__time; </div><div class="line"><span class="keyword">class </span>xsd__time_ : <span class="keyword">public</span> xsd__anySimpleType                  { <span class="keyword">public</span>: xsd__time __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__decimal; </div><div class="line"><span class="keyword">class </span>xsd__decimal_ : <span class="keyword">public</span> xsd__anySimpleType               { <span class="keyword">public</span>: xsd__decimal __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__integer; </div><div class="line"><span class="keyword">class </span>xsd__integer_ : <span class="keyword">public</span> xsd__decimal_                    { <span class="keyword">public</span>: xsd__integer __item; }; </div><div class="line"><span class="keyword">typedef</span> <a class="code" href="group__group__soap.html#ga78b36c5636eb5283d651b69d8684c6ae">LONG64</a> xsd__long; </div><div class="line"><span class="keyword">class </span>xsd__long_ : <span class="keyword">public</span> xsd__integer_                       { <span class="keyword">public</span>: xsd__long __item; }; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">long</span> xsd__int; </div><div class="line"><span class="keyword">class </span>xsd__int_ : <span class="keyword">public</span> xsd__long_                           { <span class="keyword">public</span>: xsd__int __item; }; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">short</span> xsd__short; </div><div class="line"><span class="keyword">class </span>xsd__short_ : <span class="keyword">public</span> xsd__int_                          { <span class="keyword">public</span>: xsd__short __item; }; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> xsd__byte; </div><div class="line"><span class="keyword">class </span>xsd__byte_ : <span class="keyword">public</span> xsd__short_                         { <span class="keyword">public</span>: xsd__byte __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__nonPositiveInteger; </div><div class="line"><span class="keyword">class </span>xsd__nonPositiveInteger_ : <span class="keyword">public</span> xsd__integer_         { <span class="keyword">public</span>: xsd__nonPositiveInteger __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__negativeInteger; </div><div class="line"><span class="keyword">class </span>xsd__negativeInteger_ : <span class="keyword">public</span> xsd__nonPositiveInteger_ { <span class="keyword">public</span>: xsd__negativeInteger __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__nonNegativeInteger; </div><div class="line"><span class="keyword">class </span>xsd__nonNegativeInteger_ : <span class="keyword">public</span> xsd__integer_         { <span class="keyword">public</span>: xsd__nonNegativeInteger __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__positiveInteger; </div><div class="line"><span class="keyword">class </span>xsd__positiveInteger_ : <span class="keyword">public</span> xsd__nonNegativeInteger_ { <span class="keyword">public</span>: xsd__positiveInteger __item; }; </div><div class="line"><span class="keyword">typedef</span> <a class="code" href="group__group__soap.html#ga7c6e38d209f60a18e362172dca1a3b6e">ULONG64</a> xsd__unsignedLong; </div><div class="line"><span class="keyword">class </span>xsd__unsignedLong_ : <span class="keyword">public</span> xsd__nonNegativeInteger_    { <span class="keyword">public</span>: xsd__unsignedLong __item; }; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> xsd__unsignedInt; </div><div class="line"><span class="keyword">class </span>xsd__unsignedInt_ : <span class="keyword">public</span> xsd__unsignedLong_           { <span class="keyword">public</span>: xsd__unsignedInt __item; }; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xsd__unsignedShort; </div><div class="line"><span class="keyword">class </span>xsd__unsignedShort_ : <span class="keyword">public</span> xsd__unsignedInt_          { <span class="keyword">public</span>: xsd__unsignedShort __item; }; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> xsd__unsignedByte; </div><div class="line"><span class="keyword">class </span>xsd__unsignedByte_ : <span class="keyword">public</span> xsd__unsignedShort_         { <span class="keyword">public</span>: xsd__unsignedByte __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__normalizedString; </div><div class="line"><span class="keyword">class </span>xsd__normalizedString_ : <span class="keyword">public</span> xsd__string_            { <span class="keyword">public</span>: xsd__normalizedString __item; }; </div><div class="line"><span class="keyword">typedef</span> xsd__string xsd__token; </div><div class="line"><span class="keyword">class </span>xsd__token_ : <span class="keyword">public</span> xsd__normalizedString_             { <span class="keyword">public</span>: xsd__token __item; }; </div></div><!-- fragment --><p>Note the use of the trailing underscores for the <code>class</code> names to distinguish the <code>typedef</code> type names from the <code>class</code> names. The <code>char*</code> type of <code>xsd__string</code> can be replaced with <code>std::string</code> or a wide string type. We can also add the <em><code>xsd:base64Binary</code></em> and <em><code>xsd:hexBinary</code></em> types that serialize raw binary data in the hierarchy as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>xsd__base64Binary : <span class="keyword">public</span> xsd__anySimpleType           { <span class="keyword">public</span>: <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6ba9f9e291b2b26e0696bd48f4e983be">__ptr</a>; <span class="keywordtype">int</span> <a class="code" href="structxsd____base64_binary.html#aa2dfd4d99f8280c413b9ff25a69a8729">__size</a>; }; </div><div class="line"><span class="keyword">class </span>xsd__hexBinary : <span class="keyword">public</span> xsd__anySimpleType              { <span class="keyword">public</span>: <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6ba9f9e291b2b26e0696bd48f4e983be">__ptr</a>; <span class="keywordtype">int</span> <a class="code" href="structxsd____base64_binary.html#aa2dfd4d99f8280c413b9ff25a69a8729">__size</a>; };</div></div><!-- fragment --><p>See Sections <a class="el" href="index.html#base64binary">base64Binary serialization</a> and <a class="el" href="index.html#hexbinary">hexBinary serialization</a> .</p>
<p>Methods can be added to these classes, such as constructors and getter/setter methods, see Section <a class="el" href="index.html#gettersetter">Get and set methods</a> .</p>
<p>Wrapper structs are supported as well, similar to wrapper classes. But they cannot be used to implement polymorphism. Rather, the wrapper structs are used to represent a <em><code>xsd:sequence</code></em> of elements or to add attributes to primitive types as explained in Section <a class="el" href="index.html#attributes">How to declare XML attributes</a> .</p>
<p>For additional details, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="multirefstrings"></a>
Multi-reference strings</h3>
<p>If more than one <code>char</code> pointer points to the same string, the string is encoded as a multi-reference value, unless <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> is used or the <code><a class="el" href="group__group__with.html#gaea95327865324f1aba294f3ae5d13dd4" title="When this macro is defined at compile time (undefined by default), permanently disables XML ID (id at...">WITH_NOIDREF</a></code> compile-time flag.</p>
<p>Consider for example:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ns__record</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *s;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *t;</div><div class="line">};</div></div><!-- fragment --><p>A record instance is populated as follows and then serialized:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645">SOAP_XML_GRAPH</a>);</div><div class="line">ns__record record;</div><div class="line">record.s = <span class="stringliteral">&quot;hello&quot;</span>;</div><div class="line">record.t = s;</div><div class="line">soap_write_ns__record(soap, &amp;record);</div></div><!-- fragment --><p>The <code>s</code> and <code>t</code> variables are assigned the same string. When serialized, <code>t</code> refers to the content of <code>s</code>:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:record</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">s</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;_1&quot;</span>&gt;<span class="keyword">hello</span>&lt;/<span class="keywordtype">s</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">t</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;_1&quot;</span>/&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;/<span class="keywordtype">ns:record</span>&gt;</div></div><!-- fragment --> </div><p>However, strings declared with different typedef names will never be considered multi-reference even when they point to the same string. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__string;</div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *ns__string;</div><div class="line"><span class="keyword">class </span>ns__record</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keyword">const</span> xsd__string s;</div><div class="line">    <span class="keyword">const</span> ns__string t;</div><div class="line">};</div></div><!-- fragment --><p>This avoids type conflicts when a receiver considers these types incompatible.</p>
<p>To enable multi-references in XML use <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code>. To disable multi-references in SOAP 1.1 and 1.2 RPC encoded messages, use <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="smart"></a>
Smart string mixed-content deserialization</h3>
<p>The implementation of string deserialization permits mixed content. When XML contains mixed text and tags when a string is expected, the text with tags are collected into the deserialized string.</p>
<p>For example, suppose the <code>getInfo</code> service operation returns some detailed information. The service operation is declared as:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;getInfo.h&quot;: </span></div><div class="line">getInfo(<span class="keywordtype">char</span> *detail);</div></div><!-- fragment --><p>The proxy of the service is used by a client to request a piece of information and the service responds with: </p><pre class="fragment">HTTP/1.1 200 OK 
Content-Type: text/xml 
Content-Length: nnn 
</pre> <div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    <span class="keyword">xmlns:SOAP-ENV</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keyword">xmlns:SOAP-ENC</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keyword">xmlns:xsd</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;<span class="keywordtype">getInfoResponse</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &lt;<span class="keywordtype">detail</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        &lt;<span class="keywordtype">picture</span>&gt;<span class="keyword">Mona</span> <span class="keyword">Lisa</span> <span class="keyword">by</span> &lt;<span class="keywordtype">i</span>&gt;<span class="keyword">Leonardo</span> <span class="keyword">da</span> <span class="keyword">Vinci</span>&lt;/<span class="keywordtype">i</span>&gt;&lt;/<span class="keywordtype">picture</span>&gt; </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &lt;/<span class="keywordtype">detail</span>&gt; </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &lt;/<span class="keywordtype">getInfoResponse</span>&gt; </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>The <code>detail</code> string will contain <code>"\&lt;picture\&gt;Mona Lisa by \&lt;i\&gt;Leonardo da Vinci\&lt;/i\&gt;\&lt;/picture\&gt;"</code>.</p>
<p>Note that serialization of this string will not produce mixed content but rather the XML output:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">Mona</span> <span class="keyword">Lisa</span> <span class="keyword">by</span> &amp;<span class="keyword">lt</span>;<span class="keyword">i</span>&amp;<span class="keyword">gt</span>;<span class="keyword">Leonardo</span> <span class="keyword">da</span> <span class="keyword">Vinci</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">i</span>&amp;<span class="keyword">gt</span>;</div></div><!-- fragment --> </div><p>To serialize XML stored in strings, use the <code>_XML</code> type (a <code>char*</code>) in the interface header file for soapcpp2. For example:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;getInfo.h&quot;: </span></div><div class="line">getInfo(<a class="code" href="group__group__fault.html#ga5c62d26b4823b76c5b4ef29e7865d3f0">_XML</a> detail);</div></div><!-- fragment --><p>In C++ you can use a <code>std::string</code> instead, as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;getInfo.h&quot;: </span></div><div class="line"><span class="keyword">typedef</span> std::string XML;</div><div class="line">getInfo(XML detail);</div></div><!-- fragment --><p>The <code>_XML</code> and typedef <code>XML</code> are literal XML strings, see also Section <a class="el" href="index.html#literal2">Serializing mixed content with literal XML strings</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="precision"></a>
Changing the precision of float and double types</h3>
<p>The format used to output double precision floating point values in XML is by default set to "`%.17lG`", which means that at most 17 digits of precision are output. The format used by the gSOAP engine to output single precision floating point values is by default "`%.9G`".</p>
<p>The format of a double can be set by assigning a format string to <code><a class="el" href="structsoap.html#ae1647309c9aec4b10cd9036cfabee86b" title="User-definable double floating point format string (%.17lG by default, the printed format should not ...">soap::double_format</a></code>. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap soap; </div><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); <span class="comment">// sets double_format = &quot;%.18G&quot; </span></div><div class="line">soap.<a class="code" href="structsoap.html#ae1647309c9aec4b10cd9036cfabee86b">double_format</a> = <span class="stringliteral">&quot;%e&quot;</span>; <span class="comment">// redefine</span></div></div><!-- fragment --><p>which causes all doubles to be output in XML and JSON in scientific notation. Likewise, the encoding format of a float type can be set by assigning a format string to the <code><a class="el" href="structsoap.html#a7d7e87aec3cb136b6762a6ffb90a922a" title="User-definable floating point format string (%.9G by default, the printed format should not exceed 10...">soap::float_format</a></code> string variable. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap soap; </div><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); <span class="comment">// sets float_format = &quot;%.9G&quot; </span></div><div class="line">soap.<a class="code" href="structsoap.html#a7d7e87aec3cb136b6762a6ffb90a922a">float_format</a> = <span class="stringliteral">&quot;%.4f&quot;</span>; <span class="comment">// redefine</span></div></div><!-- fragment --><p>which causes all floats to be output in XML and JSON with four digits precision.</p>
<p>A new feature to specify format patterns was introduced in gSOAP 2.8.18. A format string can be used as a pattern for a typedef float or double in the interface header file for soapcpp2 to specify the representation in XML. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">float</span> time__ratio <span class="stringliteral">&quot;%5.2f&quot;</span>;</div></div><!-- fragment --><p>This will output the float in XML with 5 digits total and 2 digits after the decimal point.</p>
<p>The soapcpp2 tool also generates an XML schema with <em><code>xsd:totalDigits</code></em> and <em><code>xsd:fractionDigits</code></em> for this type:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ratio&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:float&quot;</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">totalDigits</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;5&quot;</span>/&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">fractionDigits</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;2&quot;</span>/&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;/<span class="keywordtype">restriction</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div></div><!-- fragment --> </div><p>The wsdl2h tool converts WSDLs and XSDs with <em><code>xsd:totalDigits</code></em> and <em><code>xsd:fractionDigits</code></em> to typedefs with format patterns.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="floatinfnan"></a>
INF, -INF, and NaN values of float and double types</h3>
<p>IEEE INF, -INF, and NaN values of floats are output in XML as <em><code>INF</code></em>, <em><code>-INF</code></em>, and <em><code>NaN</code></em>, respectively, as supported by the XML schema standards.</p>
<p>For portability, the following macros can be used containing the float and double values <em><code>INF</code></em>, <em><code>-INF</code></em>, and <em><code>NaN</code></em>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> x = <a class="code" href="group__group__soap.html#ga87f308f9b0c158d6d19add3357b450ea">FLT_PINFTY</a>;</div><div class="line"><span class="keywordtype">float</span> x = <a class="code" href="group__group__soap.html#ga13d15c70cc5c5dccbb88f73b5798376b">FLT_NINFTY</a>;</div><div class="line"><span class="keywordtype">float</span> x = <a class="code" href="group__group__soap.html#ga1aa5d7b738a5a8398d12e0e34923bbec">FLT_NAN</a>;</div><div class="line"><span class="keywordtype">double</span> x = <a class="code" href="group__group__soap.html#ga63f781cfc60ee30969280cb01e2645ac">DBL_PINFTY</a>;</div><div class="line"><span class="keywordtype">double</span> x = DBL_NINFT;</div><div class="line"><span class="keywordtype">double</span> x = <a class="code" href="group__group__soap.html#ga3bdcd998db97ceb34fc50d5ca58bdbc0">DBL_NAN</a>;</div></div><!-- fragment --><p>To check for <em><code>INF</code></em>, <em><code>-INF</code></em>, and <em><code>NaN</code></em> use:</p>
<div class="fragment"><div class="line"><a class="code" href="group__group__soap.html#gac1112471b225a9c97821282016c2c0ab">soap_isinf</a>(x) &amp;&amp; x &gt; 0 <span class="comment">// x is INF</span></div><div class="line"><a class="code" href="group__group__soap.html#gac1112471b225a9c97821282016c2c0ab">soap_isinf</a>(x) &amp;&amp; x &lt; 0 <span class="comment">// x is -INF</span></div><div class="line"><a class="code" href="group__group__soap.html#ga018e8a8a9a792a6edd4f176346fe0a49">soap_isnan</a>(x)          <span class="comment">// x is NaN</span></div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="enum"></a>
Enumeration serialization</h2>
<p>Enumerations are generally useful for the declaration of named integer-valued constants.</p>
<p>For additional details, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="enumserialization"></a>
Serialization of symbolic enumeration constants</h3>
<p>The soapcpp2 tool encodes the constants of enumeration-typed variables in symbolic form using the names of the constants when possible to comply to SOAP's enumeration encoding style. Consider for example the following enumeration of weekdays:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> weekday { Mon, Tue, Wed, Thu, Fri, Sat, Sun };</div></div><!-- fragment --><p>The enumeration-constant <code>Mon</code>, for example, is encoded as</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">weekday</span>&gt;<span class="keyword">Mon</span>&lt;/<span class="keywordtype">weekday</span>&gt;</div></div><!-- fragment --> </div><p>An XML namespace prefix can be specified as part of the enumeration-type identifier's name, with the usual namespace prefix conventions for identifiers. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ns__weekday { Mon, Tue, Wed, Thu, Fri, Sat, Sun };</div></div><!-- fragment --><p>The <code>ns__weekday</code> type with enumeration-constant <code>Sat</code>, for example, is output in XML as:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:weekday</span>&gt;<span class="keyword">Sat</span>&lt;/<span class="keywordtype">ns:weekday</span>&gt;</div></div><!-- fragment --> </div><p>The corresponding XML schema type for this enumeration type is:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;weekday&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">xsd:restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">xsd:enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;Mon&quot;</span>/&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">xsd:enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;Tue&quot;</span>/&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;<span class="keywordtype">xsd:enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;Wed&quot;</span>/&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;<span class="keywordtype">xsd:enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;Thu&quot;</span>/&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;<span class="keywordtype">xsd:enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;Fri&quot;</span>/&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;<span class="keywordtype">xsd:enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;Sat&quot;</span>/&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">xsd:enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;Sun&quot;</span>/&gt; </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &lt;/<span class="keywordtype">xsd:restriction</span>&gt; </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&lt;/<span class="keywordtype">xsd:simpleType</span>&gt;</div></div><!-- fragment --> </div><p>C++11 scoped enumerations are supported by soapcpp2 with option <b><code>-c++11</code></b>:</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> ns__weekday : int { Mon, Tue, Wed, Thu, Fri, Sat, Sun };</div></div><!-- fragment --><p>Enumeration constants can be initialized, for example:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ns__relation { LESS = -1, EQUAL = 0, GREATER = 1 };</div></div><!-- fragment --><p>The symbolic names <em><code>LESS</code></em>, <em><code>EQUAL</code></em>, and <em><code>GREATER</code></em> will appear in the XML output.</p>
<p>If the value of an enumeration-typed variable has no corresponding named constant, the value is encoded as a signed integer literal. For example, the following declaration of a <code>workday</code> enumeration type lacks named constants for Saturday and Sunday:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ns__workday { Mon, Tue, Wed, Thu, Fri };</div></div><!-- fragment --><p>If the constant <code>5</code> (Saturday) or <code>6</code> (Sunday) is assigned to a variable of the <code>workday</code> enumeration type, the variable will be encoded with the integer literals <em><code>5</code></em> and <em><code>6</code></em>, respectively. For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:workday</span>&gt;5&lt;/<span class="keywordtype">ns:workday</span>&gt;</div></div><!-- fragment --> </div><p>Since this is legal in C/C++ and in SOAP RPC encoding, but not XML validators, we cam transmit integer literals as well as enumeration constants with an enumeration type.</p>
<p>When enumeration constants are numeric, we can use the following simple trick:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ns__nums { _1 = 1, _2 = 2, _3 = 3 };</div></div><!-- fragment --><p>The corresponding XML schema type for this enumeration type is:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;nums&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:long&quot;</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;2&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;3&quot;</span>/&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">restriction</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div></div><!-- fragment --> </div><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="enumreuse"></a>
How to reuse symbolic enumeration constants</h3>
<p>A well-known deficiency of C and C++ enumeration types before C++11 scoped enumerations is the lack of a mechanism to reuse symbolic names by multiple enumerations. This issue is largely resolved with scoped enumerations in C++11, which the soapcpp2 tool supports.</p>
<p>In plain C and C++ we can use trailing underscores to avoid name clashes, for example:</p>
<p>Consider for example:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ns__workday { Mon, Tue, Wed, Thu, Fri }; </div><div class="line"><span class="keyword">enum</span> ns__weekday { Mon_, Tue_, Wed_, Thu_, Fri_, Sat_, Sun_ };</div></div><!-- fragment --><p>which will result in the encoding of the constants of <code>enum ns__weekday</code> without the underscore, for example as <em><code>Mon</code></em>.</p>
<p>However, the soapcpp2 tool is a bit smarter than your average C/C++ compiler and also permits the following declarations that reuse enumeration constants, because the enumeration constants have the same enumerating integer values:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ns__workday { Mon, Tue, Wed, Thu, Fri }; </div><div class="line"><span class="keyword">enum</span> ns__weekday { Mon, Tue, Wed, Thu, Fri, Sat, Sun };</div></div><!-- fragment --><p>The soapcpp2 tool generates <em><code>soapStub.h</code></em> with amended enumeration definitions that the C/C++ compiler can handle, so you can still use the shared enumeration constants in your application code.</p>
<p>To avoid name clashes with enumeration constants, you can use the following convention with double underscores to add the enum name to the enum constants:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> prefix__name { prefix__name__enumconst1, prefix__name__enumconst2, ... };</div></div><!-- fragment --><p>where the type name of the enumeration <code>prefix__name</code> is a prefixed name, such as:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ns__workday {</div><div class="line">  ns__workday__Mon,</div><div class="line">  ns__workday__Tue,</div><div class="line">  ns__workday__Wed,</div><div class="line">  ns__workday__Thu,</div><div class="line">  ns__workday__Fri</div><div class="line">}; </div><div class="line"><span class="keyword">enum</span> ns__weekday {</div><div class="line">  ns__workday__Mon,</div><div class="line">  ns__workday__Tue,</div><div class="line">  ns__workday__Wed,</div><div class="line">  ns__workday__Thu,</div><div class="line">  ns__workday__Fri,</div><div class="line">  ns__workday__Sat,</div><div class="line">  ns__workday__Sun</div><div class="line">}; </div></div><!-- fragment --><p>This ensures that the XML schema enumeration values are still simply <em><code>Mon</code></em>, <em><code>Tue</code></em>, <em><code>Wed</code></em>, <em><code>Thu</code></em>, <em><code>Fri</code></em>, <em><code>Sat</code></em>, and <em><code>Sun</code></em>.</p>
<dl class="section warning"><dt>Warning</dt><dd>The following declaration: <div class="fragment"><div class="line"><span class="keyword">enum</span> ns__workday { Mon, Tue, Wed, Thu, Fri }; </div><div class="line"><span class="keyword">enum</span> ns__weekday { Sat = 5, Sun = 6};</div></div><!-- fragment --> will not properly encode the <code>weekday</code> enumeration when you assume that workdays are part of weekdays, because it lacks the named constants for <code>workday</code> in its enumeration list. All enumerations must be self-contained and cannot use enum constants of other enumerations.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="boolean"></a>
Boolean enumeration serialization for C</h3>
<p>The C++ <code>bool</code> type that is serialized as <em><code>xsd:boolean</code></em> XSD type cannot be used in C. Instead, an enumeration type should be used to serialize true and false values as <em><code>xsd:boolean</code></em> XSD type values. The <em><code>xsd:boolean</code></em> XSD type is defined as an enumeration in C as:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> xsd__boolean { false_, true_ };</div></div><!-- fragment --><p>The value <code>false_</code>, for example, is output in XML as:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">xsd:boolean</span>&gt;<span class="keyword">false</span>&lt;/<span class="keywordtype">xsd:boolean</span>&gt; </div></div><!-- fragment --> </div><p>Peculiar of the SOAP encoding boolean type is that it only defines the values <em><code>0</code></em> and <em><code>1</code></em>, while the XSD <em><code>xsd:boolean</code></em> type defines <em><code>false</code></em> and <em><code>true</code></em> as valid values. While SOAP encoding types are rarely used since almost all SOAP/XML Web services rely on XSD types for primitive values, we can still define the following:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">int</span> SOAP_ENC__boolean;</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="bitmask"></a>
Bitmask enumeration serialization</h3>
<p>A bitmask is an enumeration of power-of-two flags. The soapcpp2 tool makes it easy to define bitmasks using an annotated <code>enum</code> with a <code>*</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> * name { <span class="keyword">enum</span>-constant, <span class="keyword">enum</span>-constant, ... };</div></div><!-- fragment --><p>This declares a regular <code>enum</code> but enumerates the enumeration constants as a series of powers of 2 starting with 1. This means that the enumeration constants can be bitwise or-ed with the <code>|</code> operator to form a bitvector (bitmask) which is serialized in XML as a list of symbolic values. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> * ns__machineStatus { ON, BELT, VALVE, HATCH}; </div><div class="line"><span class="keywordtype">int</span> ns__setMachineStatus(<span class="keyword">enum</span> ns__machineStatus status, <span class="keyword">enum</span> ns__machineStatus *result);</div></div><!-- fragment --><p>Note that the use of the <code>enum</code> name as a parameter does not require the asterisk, only the definition does. The soapcpp2 tool generates a proper C/C++ enumeration in <em><code>soapStub.h</code></em> that is included by <em><code>soapH.h</code></em> by your application:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ns__machineStatus { ON=1, BELT=2, VALVE=4, HATCH=8 };</div></div><!-- fragment --><p>The corresponding XML schema type for this enumeration type is:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;machineStatus&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">list</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;ON&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;BELT&quot;</span>/&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;      &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;VALVE&quot;</span>/&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;HATCH&quot;</span>/&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;/<span class="keywordtype">restriction</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &lt;/<span class="keywordtype">list</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div></div><!-- fragment --> </div><p>The values of <code>enum ns__machineStatus</code> can be or-ed, for example <code>ON|VALVE</code> is output in XML as:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:machineStatus</span>&gt;<span class="keyword">ON</span> <span class="keyword">VALVE</span>&lt;/<span class="keywordtype">ns:machineStatus</span>&gt; </div></div><!-- fragment --> </div><p>C++11 scoped enumerations for bitmasks are supported by soapcpp2, for example:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> * <span class="keyword">class </span>ns__machineStatus { ON, BELT, VALVE, HATCH}; </div><div class="line"><span class="keywordtype">int</span> ns__setMachineStatus(ns__machineStatus status, ns__machineStatus *result);</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="struct"></a>
Struct and class serialization</h2>
<p>This section gives a brief overview of struct and class serialization.</p>
<p>Structs do not support inheritance when declared in an interface header file for soapcpp2. This makes serialization of structs is more efficient compared to classes. Serialization functions for structs are global functions. By contrast, soapcpp2 augments classes with serialization methods and <code>soap_type()</code> method that returns the type of the class instance, which is necessary to distinguish base class instances from derived class instances for (smart) pointers to base class instances.</p>
<p>For additional details not covered here, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<p>A class and struct instance is serialized as an XML element with attributes and sub-elements, which is represented in XML schema as a <em><code>complexType</code></em>. The class name is the XML schema type name and the member variables of the class are the type's accessors.</p>
<p>Consider the general declaration of an inherited class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>prefix__class_name1 : <span class="keyword">public</span> prefix__class_name2</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    field1; </div><div class="line">    field2; </div><div class="line">    ... <span class="comment">// more fields</span></div><div class="line">    method1; </div><div class="line">    method2; </div><div class="line">    ... <span class="comment">// more methods</span></div><div class="line">}; </div></div><!-- fragment --><p>then</p>
<ul>
<li><code>prefix__</code> is the optional namespace prefix associated with the class.</li>
<li><code>class_name1</code> is the name of the <em><code>complexType</code></em> for this class.</li>
<li><code>class_name2</code> is an optional base class.</li>
<li><code>field</code> is a member variable that is serialized when public and non-const.</li>
<li><code>method</code> is a method declaration. Abstract methods are not allowed for serializable classes.</li>
</ul>
<p>A class name is required to be unique and cannot have the same name as a <code>struct</code>, <code>enum</code>, or a service operation name specified in the interface header file for soapcpp2.</p>
<p>Only single inheritance is supported by the soapcpp2 tool. Multiple inheritance is not supported because of the limitations of the XML schema extensibility.</p>
<p>If a constructor is present, there must also be a constructor declaration with an empty parameter list. If no constructors are present, then soapcpp2 generates constructors to initialize the members with the generated <code>soap_default</code> method of this class.</p>
<p>To obtain more information about the code generated by soapcpp2 for a struct or class, use <b><code>soapcpp2 -r</code></b> option <b><code>-r</code></b> to generate a <em><code>soapReadme.md</code></em> report with all the details.</p>
<p>Classes and structs may be declared <code>volatile</code> if you don't want soapcpp2 to generate the class definition, see Section <a class="el" href="index.html#volatile">Serialization "as is" of volatile data types</a> for more details.</p>
<p>Class templates are supported with only one template argument, see Section <a class="el" href="index.html#templates">STL containers</a> .</p>
<p>Member variables of a class can be serialized as XML attributes using the <code>@</code> type qualifier, if the member is a primitive type or pointer to a primitive type. See Section <a class="el" href="index.html#attributes">How to declare XML attributes</a> for more details.</p>
<p>See Section <a class="el" href="index.html#idtrans">C/C++ identifier name to XML tag name translation</a> for more details on the struct/class member serialization and the resulting element and attribute qualified forms.</p>
<p>Arrays may be embedded within a class and a struct using a pointer member and size information, see Section <a class="el" href="index.html#list">Non-SOAP dynamic arrays</a> .</p>
<p>Void pointers may be used in a class or a struct, but you have to add a type field so the engine can determine the type of object pointed to, see Section <a class="el" href="index.html#void">Void pointer serialization</a> .</p>
<p>A class instance is output in XML as:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">prefix:class-name</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">basefield1</span>&gt;...&lt;/<span class="keywordtype">basefield1</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">basefield2</span>&gt;...&lt;/<span class="keywordtype">basefield2</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  ... </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;<span class="keywordtype">field1</span>&gt;...&lt;/<span class="keywordtype">field1</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;<span class="keywordtype">field2</span>&gt;...&lt;/<span class="keywordtype">field2</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  ... </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;/<span class="keywordtype">prefix:class-name</span>&gt;</div></div><!-- fragment --> </div><p>where the <em><code>field</code></em> accessors have element-name representations of the class members and the <em><code>basefield</code></em> accessors have element-name representations of the base class members.</p>
<p>If a derived class instance is used in place of a base class instance, then the serialized XML form carries a <em><code>xsi:type</code></em> attribute with the derived class type to distinguish it from the base class type:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">prefix:class-name</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;prefix:class-name&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">basefield1</span>&gt;...&lt;/<span class="keywordtype">basefield1</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">basefield2</span>&gt;...&lt;/<span class="keywordtype">basefield2</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  ... </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;<span class="keywordtype">field1</span>&gt;...&lt;/<span class="keywordtype">field1</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;<span class="keywordtype">field2</span>&gt;...&lt;/<span class="keywordtype">field2</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  ... </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;/<span class="keywordtype">prefix:class-name</span>&gt;</div></div><!-- fragment --> </div><p>The deserialization of a class instance allows any ordering of the accessors in the XML message. However, if a base class member name is identical to a derived class member name, because the member is overloaded, the base class member name must precede the derived class member name in the XML message.</p>
<p>For additional details, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example10"></a>
Example</h3>
<p>The following example declares a base class <code>ns__Object</code> and a derived class <code>ns__Shape</code>:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;shape.h&quot;: </span></div><div class="line"><span class="keyword">class </span>ns__Object </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">  @ <span class="keywordtype">char</span> *name; </div><div class="line">}; </div><div class="line"><span class="keyword">class </span>ns__Shape : <span class="keyword">public</span> ns__Object </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">  @ <span class="keywordtype">int</span> sides; </div><div class="line">  @ <span class="keyword">enum</span> ns__Color { Red, Green, Blue } color; </div><div class="line">    std::string description;</div><div class="line">    ns__Shape(); </div><div class="line">    ns__Shape(<span class="keywordtype">int</span> sides, <span class="keyword">enum</span> ns__Color color, std::string&amp; description); </div><div class="line">    ~ns__Shape(); </div><div class="line">};</div></div><!-- fragment --><p>The implementation of the <code>class ns__Shape</code> methods cannot be part of the interface header file for soapcpp2 and are defined in a separate <em><code>shape.cpp</code></em> C++ source code file.</p>
<p>An instance of <code>class ns__Shape</code> with name Triangle, 3 sides, and color Green is output in XML as:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:Shape</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Triangle&quot;</span> <span class="keyword">sides</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">color</span>=<span class="stringliteral">&quot;Green&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">description</span>&gt;<span class="keyword">This</span> <span class="keyword">is</span> <span class="keyword">a</span> <span class="keyword">green</span> <span class="keyword">triangle</span>&lt;/<span class="keywordtype">description</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">ns:shape</span>&gt;</div></div><!-- fragment --> </div><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="methods"></a>
Class methods</h3>
<p>A class declaration in the interface header file for soapcpp2 may include method declarations. The method implementations must not be part of the header file but should be defined in another C++ source file, because soapcpp2 parses C/C++ type declarations but does not parse C/C++ code statements and constructor initializer lists.</p>
<p>If constructors are not defined, then soapcpp2 generates constructors for the class to initialize the class with default values for member variables or the initialization values for member variables given in the class declaration.</p>
<p>If destructors are not defined, then soapcpp2 generates destructors for the class.</p>
<p>To obtain more information about the code generated by soapcpp2 for a class, use <b><code>soapcpp2 -r</code></b> option <b><code>-r</code></b> to generate a <em><code>soapReadme.md</code></em> report with all the details.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="gettersetter"></a>
Get and set methods</h3>
<p>Setter and getter methods are invoked at run time upon serialization and deserialization of class instances, respectively. The use of setter and getter methods adds more flexibility to the serialization and deserialization process.</p>
<p>A setter method is called by the serializer. You can use setter methods to update a class instance just before it is serialized. For example, you can use setter methods to update a class instance right before serialization. Setters are methods for "set to serialize" operations.</p>
<p>Getter methods are immediately invoked after deserialization of a class instance. You can use them to adjust the contents of class instances right after the instance was populated by the deserializer</p>
<p>Getter and setter methods have the following class method signature:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <span class="keyword">get</span>(<span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>);</div><div class="line"><span class="keywordtype">int</span> <span class="keyword">set</span>(<span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>);</div></div><!-- fragment --><p>These methods may be declared <code>virtual</code> and may be declared <code>const</code>.</p>
<p>The active <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context will be passed to the <code>get</code> and <code>set</code> methods. The methods should return <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> when successful. A setter method should prepare the contents of the class instance for serialization. A getter method should process the instance after deserialization.</p>
<p>Here is an example of a base64 binary class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>xsd__base64Binary </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6ba9f9e291b2b26e0696bd48f4e983be">__ptr</a>; </div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structxsd____base64_binary.html#aa2dfd4d99f8280c413b9ff25a69a8729">__size</a>; </div><div class="line">    <span class="keywordtype">int</span> <span class="keyword">get</span>(<span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>); </div><div class="line">    <span class="keywordtype">int</span> <span class="keyword">set</span>(<span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>); </div><div class="line">};</div></div><!-- fragment --><p>Suppose that the type and options members of the attachment should be set when the class is about to be serialized. This can be accomplished with the <code>set</code> method from the information provided by the <code>__ptr</code> to the data and the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context passed to the <code>set</code> method (you can pass data via the <code>void* <a class="el" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b" title="User-definable variable that may point to user-specified data of any type to pass the data through to...">soap::user</a></code> member).</p>
<p>The <code>get</code> method is invoked after the base64 data has been processed. You can use it for post-processing purposes.</p>
<p>Here is another example. It defines a primitive <code>update</code> type. The class is a wrapper for the <code>time_t</code> type, see Section <a class="el" href="index.html#primclass">How to use C++ wrapper classes to specify polymorphic primitive types</a> . Therefore, elements of this type contain <em><code>xsd:dateType</code></em> data.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>update </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    time_t __item; </div><div class="line">    <span class="keywordtype">int</span> <span class="keyword">set</span>(<span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>); </div><div class="line">};</div></div><!-- fragment --><p>The setter method assigns the current time just before the instance is serialized:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> update::set(<span class="keyword">struct</span> soap *soap) </div><div class="line">{</div><div class="line">  this-&gt;__item = time(NULL); </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>This means that serialization in XML results in the inclusion of an up-to-date time stamp.</p>
<p>A <code>get</code> method is invoked immediately after the instance is populated by the deserializer. The method is not invoked when the element is an <em><code>xsi:nil</code></em> element or has a SOAP <em><code>href</code></em> or <em><code>ref</code></em> attribute referencing a value located elsewhere in the XML message or document.</p>
<dl class="section note"><dt>Note</dt><dd>The <code>soap_out</code> method of a class calls the setter method However, the <code>soap_out</code> method is declared <code>const</code> while the setter should be allowed to modify the contents of the class instance. Therefore, the soapcpp2-generated code recasts the instance and the <code>const</code> is removed when invoking the setter.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="streaming"></a>
Updating and checking instances with get and set methods</h3>
<p>Getter methods enable streaming XML operations. A getter method is invoked when the object is deserialized and the rest of the XML message has not been parsed yet. For example, you can add a getter method to the SOAP Header class to implement header processing logic that is activated as soon as the SOAP Header is received. An example is shown below:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>h__Authentication </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    <span class="keywordtype">char</span> *id; </div><div class="line">    <span class="keywordtype">int</span> <span class="keyword">get</span>(<span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>); </div><div class="line">}; </div><div class="line"><span class="keyword">class </span><a class="code" href="struct_s_o_a_p___e_n_v_____header.html">SOAP_ENV__Header</a> </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    h__Authentication *h__authentication; </div><div class="line">};</div></div><!-- fragment --><p>The <code>Authentication</code> SOAP Header member is instantiated and decoded. After decoding, the getter method is invoked, which can be used to check the <code>id</code> before the rest of the SOAP message is parsed.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="polymorph"></a>
Polymorphism, derived types, and dynamic binding in C++</h3>
<p>Polymorphism through C++ inheritance is supported by the gSOAP tools, which means that derived XML schema types are (de)serialized when an <em><code>xsi:type</code></em> attribute is present.</p>
<p>Because C does not support inheritance, a different approach is use for C code, see Section <a class="el" href="index.html#polymorphC">Polymorphism, derived types, and dynamic binding in C</a> for details.</p>
<p>Base and derived C++ classes can be used anywhere, including service operation parameters and in struct and class members, provided that parameters and members are pointers to classes to allow dynamic binding at run time. Base and derived classes can also be used with containers such as <code>std::vector</code> and smart pointers such as <code>std::shared_ptr</code>.</p>
<p>The following example interface header file for soapcpp2 declares <code>ns__Base</code> and <code>ns__Derived</code> classes and a service operation that takes a pointer to a <code>ns__Base</code> class instance and returns a <code>ns__Base</code> class instance:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;derived.h&quot; </span></div><div class="line"><span class="keyword">class </span>ns__Base </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">    ns__Base(); </div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> print(); </div><div class="line">}; </div><div class="line"><span class="keyword">class </span>ns__Derived : <span class="keyword">public</span> ns__Base </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    <span class="keywordtype">int</span> num; </div><div class="line">    ns__Derived(); </div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> print(); </div><div class="line">}; </div><div class="line"><span class="keywordtype">int</span> ns__webmethod(ns__Base *in, <span class="keyword">struct</span> ns__webmethodResponse { ns__Base *out; } &amp; result);</div></div><!-- fragment --><p>The service operation input parameter may point to a <code>ns__Derived</code> class instance that will be serialized as <code>ns__Derived</code> class instance instead of a <code>ns__Base</code> class instance. Likewise, the service operation output parameter that is placed in a wrapper struct (because structs and classes are always considered wrappers to define the response message with output parameters) may point to a <code>ns__Derived</code> class instance.</p>
<p>The <code>ns__Base</code> and <code>ns__Derived</code> class method implementations are:</p>
<div class="fragment"><div class="line"><span class="comment">// Method implementations of the ns__Base and ns__Derived classes: </span></div><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"></div><div class="line">ns__Base::ns__Base() </div><div class="line">{</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;created a Base class instance&quot;</span> &lt;&lt; std::endl; </div><div class="line">} </div><div class="line"></div><div class="line">ns__Derived::ns__Derived() </div><div class="line">{</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;created a Derived class instance&quot;</span> &lt;&lt; std::endl; </div><div class="line">} </div><div class="line"></div><div class="line">ns__Base::print() </div><div class="line">{</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;print(): Base class instance &quot;</span> &lt;&lt; name &lt;&lt; std::endl; </div><div class="line">} </div><div class="line"></div><div class="line">ns__Derived::print() </div><div class="line">{</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;print(): Derived class instance &quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; num &lt;&lt; std::endl; </div><div class="line">}</div></div><!-- fragment --><p>Below is an example client application that creates a <code>ns__Derived</code> class instance that is passed as the input parameter of the <code>ns__webmethod</code> service operation:</p>
<div class="fragment"><div class="line"><span class="comment">// CLIENT </span></div><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  ns__Derived obj; </div><div class="line">  <span class="keyword">struct </span>ns__webmethodResponse r; </div><div class="line">  soap_default_ns__Derived(&amp;soap, &amp;obj);</div><div class="line">  obj.name = <span class="stringliteral">&quot;X&quot;</span>; </div><div class="line">  obj.num = 3; </div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns__webmethod(&amp;soap, endpoint, NULL, &amp;obj, r) == <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>)</div><div class="line">    <span class="keywordflow">if</span> (r.out)</div><div class="line">      r.out-&gt;print(); </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">} </div></div><!-- fragment --><p>The following example server application copies a class instance (<code>ns__Base</code> or <code>ns__Derived</code>) from the input to the output parameter:</p>
<div class="fragment"><div class="line"><span class="comment">// SERVER</span></div><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keyword">struct</span> soap *soap, ns__Base *in, <span class="keyword">struct</span> ns__webmethodResponse &amp;result) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (in)</div><div class="line">    in-&gt;print(); </div><div class="line">  result.out = in; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div></div><!-- fragment --><p>The following messages are produced by the client and server applications: </p><pre class="fragment">CLIENT: created a Derived class instance 
SERVER: print(): Derived class instance X 3 
CLIENT: created a Derived class instance 
CLIENT: print(): Derived class instance X 3
</pre><p>This shows that the <code>Derived</code> class instance kept its identity as it passed through the server.</p>
<p>Another way to serialize polymorphic values in XML that are indicated with <em><code>xsi:type</code></em> attributes is with <code>void*</code> members that point to a serializable value. See Section <a class="el" href="index.html#void">Void pointer serialization</a> for details.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="polymorphC"></a>
Polymorphism, derived types, and dynamic binding in C</h3>
<p>Because C does not support object-oriented inheritance, derived types are obviously not declared as base structs or classes as in C++. Instead, we add the derived type structs to the base structs as members that point to the derived type value when the base type is dynamically overridden by one of the derived types. In this way we can (de)serialize a base type struct as usual or one of the derived structs when the base type is overridden. To serialize a derived type struct in place of the base struct, we set its corresponding member point to the derived struct value, which is serialized with the <em><code>xsi:type</code></em> attribute to indicate a derived type is used in XML. Deserialization of a derived type struct is done automatically when the <em><code>xsi:type</code></em> attribute is present.</p>
<p>This approach with additional members pointing to derived types was introduced with gSOAP 2.8.75. This approach has the benefit of type safety compared to attempts to replicate C++ inheritance by trying to overlay derived types with base types in memory, which would be fragile.</p>
<p>This method is fully automated for the wsdl2h tool to generate an interface header file for soapcpp2 with the type derivations in C. To use this method to generate code from WSDLs and XSDs, use <a href="#wsdl2h-F"><b><code>wsdl2h -F</code></b> option <b><code>-F</code></b></a>. This also works in C++, but C++ inheritance works fine without this method.</p>
<p>Using this method with soapcpp2 alone using a manually-specified interface header file produces the specified type inheritance in the soapcpp2-generated WSDL and XML schema files as complexType extensions.</p>
<p>The soapcpp2 tool warns if a derived type has multiple base types. At most one base type for a derived type may be specified.</p>
<p>To illustrate this method, consider the following interface header file example for soapcpp2 based on <a class="el" href="index.html#polymorph">Polymorphism, derived types, and dynamic binding in C++</a>. This example declares <code>ns__Base</code> and <code>ns__Derived</code> structs and a service operation that takes a pointer to a <code>ns__Base</code> value and returns a <code>ns__Base</code> value:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;derived.h&quot; </span></div><div class="line"><span class="keyword">struct </span>ns__Base </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">  [ <span class="keyword">struct </span>ns__Derived *ns__Derived; ] <span class="comment">// points to derived type when non-NULL</span></div><div class="line">}; </div><div class="line"><span class="keyword">struct </span>ns__Derived</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">    <span class="keywordtype">int</span> num; </div><div class="line">}; </div><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keyword">struct</span> ns__Base *in, <span class="keyword">struct</span> ns__webmethodResponse { <span class="keyword">struct </span>ns__Base *out; } *result);</div></div><!-- fragment --><p>The <code>ns__Base</code> struct includes the special member <code>ns__Derived</code> that points to a <code>ns__Derived</code> value. This special member must be:</p>
<ul>
<li>a transient member (i.e. non-serializable) by placing the declaration within <code>[</code> and <code>]</code>, and</li>
<li>the member name must match the type name (to be more precise, at least the initial part of the member name must match the type name as in the example <code>ns__Derived_</code> works too).</li>
</ul>
<p>To serialize the <code>ns__Base</code> value make sure to set the <code>ns__Derived</code> member to NULL. The soapcpp2-generated <code>soap_default_ns__Base()</code> function default initializes a given <code>ns__Base</code> value for you. To serialize the <code>ns__Derived</code> value make sure to set the <code>ns__Derived</code> member to point to the address of a <code>ns__Derived</code> value. This is easy by calling <code>soap_new_ns__Derived()</code> that allocates and default initializes a <code>ns__Derived</code> value, whose address is returned by this function.</p>
<p>When multiple derived types are declared for a base type, all immediately derived struct types are added as transient pointer members to the base type. Indirectly derived types do not need to be added to the base type as members, but it is perfectly fine to do so.</p>
<p>To properly declare derived types, make sure to include all base type members in the derived type. In our example the <code>ns__Derived</code> struct contains the <code>ns__Base</code> struct members (except for the <code>ns__Derived</code> member) and adds additional members as extensions.</p>
<p>Below is an example client application based on the example in Section <a class="el" href="index.html#polymorph">Polymorphism, derived types, and dynamic binding in C++</a> that creates a <code>ns__Derived</code> value that is passed as the input parameter of the <code>ns__webmethod</code> service operation:</p>
<div class="fragment"><div class="line"><span class="comment">// CLIENT </span></div><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  <span class="keyword">struct </span>ns__Base obj; </div><div class="line">  <span class="keyword">struct </span>ns__Derived der; </div><div class="line">  <span class="keyword">struct </span>ns__webmethodResponse r; </div><div class="line">  soap_default_ns__Base(&amp;soap, &amp;obj);</div><div class="line">  soap_default_ns__Derived(&amp;soap, &amp;der);</div><div class="line">  obj.ns__Derived = &amp;der;</div><div class="line">  der.name = <span class="stringliteral">&quot;X&quot;</span>; </div><div class="line">  der.num = 3; </div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns__webmethod(&amp;soap, endpoint, NULL, &amp;obj, &amp;r) == <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (r-&gt;out &amp;&amp; r.out-&gt;ns__Derived)</div><div class="line">      printf(<span class="stringliteral">&quot;print(): Derived class instance %s %d\n&quot;</span>,</div><div class="line">          r.out-&gt;ns__Derived-&gt;name,</div><div class="line">          r.out-&gt;ns__Derived-&gt;num);</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r-&gt;out)</div><div class="line">      printf(<span class="stringliteral">&quot;print(): Base class instance %s\n&quot;</span>,</div><div class="line">          r.out-&gt;name);</div><div class="line">  }</div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">} </div></div><!-- fragment --><p>The following example server application copies a class instance (<code>ns__Base</code> or <code>ns__Derived</code> class) from the input to the output parameter:</p>
<div class="fragment"><div class="line"><span class="comment">// SERVER</span></div><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> ns__Base *in, <span class="keyword">struct</span> ns__webmethodResponse *result) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (in &amp;&amp; in-&gt;ns__Derived)</div><div class="line">    printf(<span class="stringliteral">&quot;print(): Derived class instance %s %d\n&quot;</span>,</div><div class="line">        in-&gt;ns__Derived-&gt;name,</div><div class="line">        in-&gt;ns__Derived-&gt;num);</div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in)</div><div class="line">    printf(<span class="stringliteral">&quot;print(): ns__Base class instance %s\n&quot;</span>,</div><div class="line">        in-&gt;name);</div><div class="line">  result.out = in; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div></div><!-- fragment --><p>The following messages are produced by the client and server applications: </p><pre class="fragment">SERVER: print(): Derived class instance X 3 
CLIENT: print(): Derived class instance X 3
</pre><p>This shows that the <code>Derived</code> class instance kept its identity as it passed through the server.</p>
<p>Another way to serialize polymorphic values in XML that are indicated with <em><code>xsi:type</code></em> attributes is with <code>void*</code> members that point to a serializable value. See <a class="el" href="index.html#void">Void pointer serialization</a> for details.</p>
<p>Deeper levels of simulated inheritance are possible, for example:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;derived.h&quot; </span></div><div class="line"><span class="keyword">struct </span>ns__Base </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">  [ <span class="keyword">struct </span>ns__Derived *ns__Derived; ] <span class="comment">// points to derived type when non-NULL</span></div><div class="line">}; </div><div class="line"><span class="keyword">struct </span>ns__Derived</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">    <span class="keywordtype">int</span>   num; </div><div class="line">  [ <span class="keyword">struct </span>ns__Derived2 *ns__Derived2; ] <span class="comment">// points to derived type when non-NULL</span></div><div class="line">}; </div><div class="line"><span class="keyword">struct </span>ns__Derived2</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">    <span class="keywordtype">int</span>   num; </div><div class="line">    <span class="keywordtype">char</span> *value;</div><div class="line">}; </div><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keyword">struct</span> ns__Base *in, <span class="keyword">struct</span> ns__webmethodResponse { <span class="keyword">struct </span>ns__Base *out; } *result);</div></div><!-- fragment --><p>This requires two pointer traversals from the base type <code>ns__Base</code> via <code>ns__Derived</code> to reach <code>ns__Derived2</code>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> ns__Base *in, <span class="keyword">struct</span> ns__webmethodResponse *result) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (in &amp;&amp; in-&gt;ns__Derived &amp;&amp; in-&gt;ns__Derived-&gt;ns__Derived2)</div><div class="line">    printf(<span class="stringliteral">&quot;print(): Derived2 class instance %s %d %s\n&quot;</span>,</div><div class="line">        in-&gt;ns__Derived-&gt;ns__Derived2-&gt;name,</div><div class="line">        in-&gt;ns__Derived-&gt;ns__Derived2-&gt;num,</div><div class="line">        in-&gt;ns__Derived-&gt;ns__Derived2-&gt;value);</div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in &amp;&amp; in-&gt;ns__Derived)</div><div class="line">    printf(<span class="stringliteral">&quot;print(): Derived class instance %s %d\n&quot;</span>,</div><div class="line">        in-&gt;ns__Derived-&gt;name,</div><div class="line">        in-&gt;ns__Derived-&gt;num);</div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in)</div><div class="line">    printf(<span class="stringliteral">&quot;print(): ns__Base class instance %s\n&quot;</span>,</div><div class="line">        in-&gt;name);</div><div class="line">  result.out = in; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="attributes"></a>
How to declare XML attributes</h3>
<p>The gSOAP tools support the full XML schema standards, so XML attributes are nothing special. However, with respect to SOAP standards it is important to note that SOAP RPC/literal and SOAP document/literal styles support XML attributes in SOAP messages, but SOAP RPC with "Section 5" encoding does not support XML attributes other than some built-in attributes.</p>
<p>The idea behind SOAP RPC Section 5 encoding was to keep SOAP as simple as possible as a limited subset of XML, while offering advantages for cross-language interoperability of data types, including data structure graph serialization with multi-referenced data.</p>
<p>Attributes are primitive XSD types, such as strings, enumerations, boolean, and numeric types. To declare an XML attribute in a struct or class, the qualifier <code>@</code> is used with the type of the attribute. The type must be primitive type or a pointer to a primitive type, including enumerations and <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> and <code><a class="el" href="structxsd____hex_binary.html" title="XSD hexBinary structure with attachment data. ">xsd__hexBinary</a></code> structures. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__string; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">bool</span> *xsd__boolean; </div><div class="line"><span class="keyword">enum</span> ns__state { _0, _1, _2 }; </div><div class="line"><span class="keyword">struct </span>ns__myStruct </div><div class="line">{</div><div class="line">  @ std::string         *type;</div><div class="line">  @ <span class="keywordtype">bool</span>                 flag = <span class="keyword">false</span>;</div><div class="line">  @ <span class="keyword">enum</span> ns__state       state = _2;</div><div class="line">    <span class="keyword">struct </span>ns__myStruct *next; </div><div class="line">};</div></div><!-- fragment --><p>The <code>@</code> qualifier declares an XML attribute for the <code>type</code>, <code>flag</code>, and <code>state</code> members.</p>
<p>Default values can be associated with any member that has a primitive type in a struct or class, as is illustrated in this example. The default values are used when the receiving message does not contain the corresponding values.</p>
<p>Pointers make the members optional. So <code>type</code> is an optional attribute.</p>
<p>Because a service operation request and response message is essentially a struct, XML attributes can also be associated with method requests and responses. For example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__webmethod(@ <span class="keywordtype">char</span> *ns__name, ...);</div></div><!-- fragment --><p>Attributes can also be attached to the dynamic arrays, binary types, and wrapper classes and structs of primitive types. Wrapper classes are described in Section <a class="el" href="index.html#primclass">How to use C++ wrapper classes to specify polymorphic primitive types</a> . For example:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>xsd__string </div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">char</span> * __item; </div><div class="line">  @ <span class="keywordtype">bool</span> flag; </div><div class="line">};</div></div><!-- fragment --><p>and</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>xsd__base64Binary </div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6ba9f9e291b2b26e0696bd48f4e983be">__ptr</a>; </div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structxsd____base64_binary.html#aa2dfd4d99f8280c413b9ff25a69a8729">__size</a>; </div><div class="line">  @ <span class="keywordtype">bool</span> flag; </div><div class="line">};</div></div><!-- fragment --><p>The attribute declarations must be placed after the special <code>__item</code>, <code>__ptr</code>, and <code>__size</code> members.</p>
<p>For additional details, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="qname"></a>
How to use QName attributes and elements</h3>
<p>An element or attribute with type QName (Qualified Name) contains a namespace prefix and a local name. We can explicitly declare a QName as a string type with <code>typedef char *xsd__QName</code> and the serializer recognizes the <code>QName</code> type as a special type that requires QName normalization. A built-in QName type <code>_QName</code> is recognized by soapcpp2, which is a <code>char*</code> type with QName content.</p>
<p>QName normalization by the deserializer is applied to convert the prefix in the inbound XML message to the corresponding prefix defined in the XML namespace table, which means that the QName string is always received in normalized form.</p>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns schema namespace: urn:example</span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__QName; </div><div class="line"><span class="keyword">struct </span>ns__myStruct </div><div class="line">{</div><div class="line">    xsd__QName elt = <span class="stringliteral">&quot;ns:xyz&quot;</span>; <span class="comment">// QName element with default value &quot;ns:xyz&quot; </span></div><div class="line">  @ xsd__QName att = <span class="stringliteral">&quot;ns:abc&quot;</span>; <span class="comment">// QName attribute with default value &quot;ns:abc&quot; </span></div><div class="line">};</div></div><!-- fragment --><p>When the <code>elt</code> and <code>att</code> members are serialized, their string contents are just output. When the members are deserialized however, the deserializer converts the prefix in the parsed QName to the prefix defined in the namespace table that corresponds to the same namespace URI. For example, suppose that the inbound XML message contains <em><code>&lt;elt xmlns:x="urn:example"&gt;x:def&lt;/elt&gt;</code></em>. The prefix <em><code>x</code></em> matches the namespace URI <em><code>urn:example</code></em> of prefix <code>ns</code> as declared by the <code>//gsoap ns schema namespace: urn:example</code> directive, which populates the namespace table <em><code>ns.nsmap</code></em> generated by soapcpp2. Therefore, the <em><code>x:def</code></em> QName value is converted to <em><code>ns:def</code></em> and saved in the <code>elt</code> member of <code>ns__myStruct</code>.</p>
<p>If the namespace URI used in the inbound XML message is not in the namespace table, for example when <em><code>&lt;elt xmlns:x="urn:x"&gt;x:def&lt;/elt&gt;</code></em> is parsed, then <em><code>x:def</code></em> is converted to <code>"URI":def</code> where <code>"URI"</code> is the namespace URI bound to <em><code>x</code></em>, which is <code>"urn:x"</code> in this case. This value <code>"urn:x":def</code>is saved in the <code>elt</code> member of <code>ns__myStruct</code>.</p>
<p>For additional details, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="union"></a>
Union serialization</h2>
<p>A union is only serialized if the union is used within a struct or class declaration that includes an <code>int __union</code> member that acts as a selector (also called discriminant) for the union members. The selector stores run-time usage information about the union member that is activated.</p>
<p>A union within a struct or class with a selector member represents <em><code>xsd:choice</code></em> XML schema component. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__PO </div><div class="line">{</div><div class="line">    ... <span class="comment">// members of ns__PO</span></div><div class="line">}; </div><div class="line"><span class="keyword">struct </span>ns__Invoice </div><div class="line">{</div><div class="line">    ... <span class="comment">// members of ns__Invoice</span></div><div class="line">}; </div><div class="line"><span class="keyword">union </span>ns__PO_or_Invoice </div><div class="line">{</div><div class="line">    <span class="keyword">struct </span>ns__PO po; </div><div class="line">    <span class="keyword">struct </span>ns__Invoice invoice; </div><div class="line">}; </div><div class="line"><span class="keyword">struct </span>ns__composite </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">    <span class="keywordtype">int</span> __union; </div><div class="line">    <span class="keyword">union </span>ns__PO_or_Invoice value; </div><div class="line">};</div></div><!-- fragment --><p>The <code>union ns__PO_or_Invoice</code> appears as a <em><code>xsd:choice</code></em> in the generated XML schema:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;composite&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">sequence</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;name&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">choice</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;po&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ns:PO&quot;</span>/&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;      &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;invoice&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ns:Invoice&quot;</span>/&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;/<span class="keywordtype">choice</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;/<span class="keywordtype">sequence</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;/<span class="keywordtype">complexType</span>&gt;</div></div><!-- fragment --> </div><p>The union name should be qualified, as shown in the example, to ensure correct serialization when the XML schemas is declared with <em><code>elementFormDefault="qualified"</code></em>, with <code>//gsoap ns schema elementForm: qualified</code>.</p>
<p>The <code>int __union</code> member selector's values are generated by the soapcpp2 tool. Each union member name has a selector value defined by:</p>
<div class="fragment"><div class="line">SOAP_UNION_unionname_fieldname</div></div><!-- fragment --><p>These selector values enumerate the union members. The special value 0 (or any negative value) can be assigned to omit the serialization of the union altogether, but only if explicitly allowed by validation rules, which requires <em><code>minOccurs="0"</code></em> for the <em><code>xsd:choice</code></em>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__composite </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">    <span class="keywordtype">int</span> __union 0; <span class="comment">// declares &lt;choice minOccurs=&quot;0&quot;&gt;</span></div><div class="line">    <span class="keyword">union </span>ns__PO_or_Invoice value; </div><div class="line">};</div></div><!-- fragment --><p>This way we can treat the union as an optional data item by setting <code>__union = 0</code>.</p>
<p>Since 2.7.16 it is also possible to use a '<code>$</code>' as a special marker to annotate a selector member that must be of type <code>int</code> and the member name can be chosen arbitrarily:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__composite </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">  $ <span class="keywordtype">int</span> select 0; <span class="comment">// declares &lt;choice minOccurs=&quot;0&quot;&gt;</span></div><div class="line">    <span class="keyword">union </span>ns__PO_or_Invoice value; </div><div class="line">};</div></div><!-- fragment --><p>The following example shows how the <code>struct ns__composite</code> instance is initialized for serialization using the above declaration:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__composite data; </div><div class="line">data.name = <span class="stringliteral">&quot;...&quot;</span>; </div><div class="line">data.select = SOAP_UNION_ns__PO_or_Invoice_po; <span class="comment">// select ns__PO_or_Invoice::po union member</span></div><div class="line">data.value.po.number = ...; <span class="comment">// populate the PO</span></div></div><!-- fragment --><p>While the gSOAP serializers are designed to be robust, failing to set the selector to a valid union member can lead to a crash of the serializer, because it will attempt to serialize an invalid union member.</p>
<p>The deserializer of a union type sets the selector value to the currently active union member that was deserialized. The selector will be set to a non-positive value (0 or -1) when no union member was deserialized, if permitted by the validator, where -1 indicates that a member was required by validation rules, if the validator was non-strict. Strict validation enabled with <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> results in a validation fault in this case.</p>
<p>When more than one union is used in a struct or class, the <code>__union</code> selectors should use <code>$</code> to identify them and named to avoid name clashes, for example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__composite </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">  $ <span class="keywordtype">int</span> sel_value; <span class="comment">// = SOAP_UNION_ns__PO_or_Invoice_[po|invoice] </span></div><div class="line">    <span class="keyword">union </span>ns__PO_or_Invoice value; </div><div class="line">  $ <span class="keywordtype">int</span> sel_data; <span class="comment">// = SOAP_UNION_ns__Email_or_Fax_[email|fax] </span></div><div class="line">    <span class="keyword">union </span>ns__Email_or_Fax data; </div><div class="line">};</div></div><!-- fragment --><p>For additional details, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="pointer"></a>
Pointer type serialization</h2>
<p>Basically, the serialization of a pointer amounts to the serialization of the data pointed to. However, if more than one pointer points to a node in a data structure to serialize, the node is either duplicated in the serialized output meaning the data is serialized as a tree, or the node is output only once in the serialized output meaning that the data is serialized as a graph. The latter is referred to as multi-reference encoding in SOAP 1.1/1.2 RPC encoding style. This style ensures that data structures maintain their structural integrity when transmitted, as intended by the true meaning of serialization. The <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> runtime flag can be used with plain non-SOAP XML to achieve the same.</p>
<p>To achieve this, the gSOAP serializers for SOAP RPC encoding and the <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> flag check for multi-referenced data in the data structure to serialize, i.e. the data nodes that are co-referenced by other nodes, by adding id-ref/href attributes to the XML output that refer to the co-referenced data. The soapcpp2 tool generates serializers that perform this check automatically on C/C++ pointers and smart pointers, such as <code>std::shared_ptr</code>. Furthermore, the soapcpp2 tool generates serializers that prevent infinite serialization when a cyclic data structure is serialized as a tree, by breaking the cycles, when using the SOAP document/literal style or when <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> is enabled with the SOAP RPC encoding style.</p>
<p>For additional details on the use of C/C++ pointers and smart pointers, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="multiref"></a>
Multi-referenced data serialization</h3>
<p>A node in the data structure that is pointed to by more than one pointer is serialized as multi-reference data when the SOAP RPC encoding style is used or when <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> is enabled. This means that co-referenced data is identified in XML with a unique <em><code>id</code></em> attribute. References in XML are made with <em><code>href</code></em> (SOAP 1.1 RPC encoding), <em><code>SOAP-ENC:ref</code></em> (SOAP 1.2 RPC encoding), or <em><code>ref</code></em> (<code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code>) attributes to refer to the co-referenced data. See Section <a class="el" href="index.html#flags">Run-time flags</a> on options to control the serialization of multi-reference data. To turn multi-ref off, use <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> to process plain tree-based XML. To completely eliminate multi-ref serialization use the <code><a class="el" href="group__group__with.html#gaea95327865324f1aba294f3ae5d13dd4" title="When this macro is defined at compile time (undefined by default), permanently disables XML ID (id at...">WITH_NOIDREF</a></code> compile-time flag with all source code (including <em><code>gsoap/stdsoap2.c</code></em> and <em><code>gsoap/stdsoap2.cpp</code></em>) to permanently disable id-href processing.</p>
<p>Consider for example the following a linked list data structure:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__string; </div><div class="line"><span class="keyword">struct </span>ns__list</div><div class="line">{</div><div class="line">    xsd__string value; </div><div class="line">    <span class="keyword">struct </span>ns__list *next; </div><div class="line">};</div></div><!-- fragment --><p>Suppose a cyclic linked list is created. The first node contains the value "abc" and points to a node with value "def" which in turn points to the first node. This is encoded as:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:list</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span><span class="stringliteral">&quot;&gt; </span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="stringliteral">  &lt;value&gt;abc&lt;/value&gt; </span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="stringliteral">  &lt;next&gt; </span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="stringliteral">    &lt;value&gt;def&lt;/value&gt; </span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="stringliteral">    &lt;next href=&quot;</span>#1&quot;/&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;/<span class="keywordtype">next</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/<span class="keywordtype">ns:list</span>&gt;</div></div><!-- fragment --> </div><p>In case multi-referenced data is received that "does not fit in a pointer-based structure", the data is copied. For example, the following two structs are similar, except that the first uses pointer-based members while the other uses non-pointer-based members:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">long</span> xsd__int; </div><div class="line"></div><div class="line"><span class="keyword">struct </span>ns__record </div><div class="line">{</div><div class="line">    xsd__int *a; </div><div class="line">    xsd__int *b; </div><div class="line">} P; </div><div class="line"></div><div class="line"><span class="keyword">struct </span>ns__record</div><div class="line">{</div><div class="line">    xsd__int a; </div><div class="line">    xsd__int b; </div><div class="line">} R; </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  P.a = &amp;n; </div><div class="line">  P.b = &amp;n; </div><div class="line">  ... <span class="comment">//</span></div><div class="line">}</div></div><!-- fragment --><p>Since both <code>a</code> and <code>b</code> members of <code>P</code> point to the same integer, the serialization of <code>P</code> produces a multi-reference in SOAP 1.1 RPC encoding:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:record</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">a</span> <span class="keyword">href</span>=<span class="stringliteral">&quot;#1&quot;</span>/&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">b</span> <span class="keyword">href</span>=<span class="stringliteral">&quot;#1&quot;</span>/&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;/<span class="keywordtype">ns:record</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;<span class="keywordtype">id</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;123&lt;/<span class="keywordtype">id</span>&gt;</div></div><!-- fragment --> </div><p>The deserialization of the content in the <code>R</code> data structure that does not use pointers to integers results in a copy of each multi-reference integer. Note that the two structs resemble the same XML data type because the trailing underscore will be ignored in XML encoding and decoding.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="null"></a>
NULL pointers and nil elements</h3>
<p>A NULL pointer is not serialized, unless the pointer member of a struct or class is declared in the interface header file as nillable with <code>nullptr</code> or in the unlikely case the pointer itself is pointed to by another pointer (but see Section <a class="el" href="index.html#flags">Run-time flags</a> to control the serialization of NULLs), for example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>X </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *p; </div><div class="line">    <span class="keywordtype">int</span> **q; </div><div class="line">    <span class="keywordtype">int</span> *r <span class="keyword">nullptr</span> 1;</div><div class="line">}</div></div><!-- fragment --><p>The types section of a WSDL description contains information on the "nillability" of data, which is declared as <code>nullptr</code> members where the <code>1</code> indicates that the member is required (<em><code>minOccurs</code></em> and <em><code>maxOccurs</code></em> are 1 set with <code>1:1</code> or simply <code>1</code>).</p>
<p>Suppose pointer <code>q</code> points to pointer <code>p</code> and suppose <code>p</code> and <code>r</code> are NULL. In that case the <code>X</code> struct is serialized with <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> as:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">X</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">p</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">xsi:nil</span>=<span class="stringliteral">&quot;true&quot;</span>/&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">q</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;1/&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="stringliteral">  &lt;r id=&quot;</span>1<span class="stringliteral">&quot; xsi:nil=&quot;</span><span class="keyword">true</span>&quot;/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">X</span>&gt;</div></div><!-- fragment --> </div><p>The deserializer reconstructs the struct <code>X</code> from this form of XML, thereby preserving the integrity of the data structure serialized.</p>
<p>When the deserializer encounters an XML element that has a <em><code>xsi:nil="true"</code></em> attribute but the corresponding C/C++ data is not a pointer or reference, the deserializer will terminate with a <code><a class="el" href="group__group__errors.html#ga76179757f85e61d0dfe0be58ab4be99a" title="A soap_status error code: XML element has an xsi:nil attribute when the element is not nillable...">SOAP_NULL</a></code> fault when the <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> flag is set.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="void"></a>
Void pointer serialization</h2>
<p>Void pointers (<code>void*</code>) cannot be serialized in XML because the type of data referred to is untyped. To enable the serialization of void pointers that are members of structs and classes, you can insert a <code>int __type</code> member right before the void pointer member. The <code>int __type</code> member contains run time information on the type of the data pointed to by <code>void*</code> member in a struct/class to enable the serialization of this data. The <code>int __type</code> member is set to a <code>SOAP_TYPE_T</code> value, where <code>T</code> is the name of a type. The soapcpp2 tool generates the <code>SOAP_TYPE_T</code> definitions in <em><code>soapH.h</code></em> and uses them internally to uniquely identify the type of each object. The type naming conventions outlined in Section <a class="el" href="index.html#serialize">Serializing C/C++ data to XML</a> are used to determine the type name for <code>T</code>. Values serialized in XML with this approach always carry the <em><code>xsi:type</code></em> attribute in XML to indicate the type of content serialized.</p>
<p>Here is an example to illustrate the serialization of a <code>void*</code> member in a struct/class:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__record </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> __type; <span class="comment">// the SOAP_TYPE_T pointed to by val</span></div><div class="line">    <span class="keywordtype">void</span> *val;  <span class="comment">// serialize any type in element &lt;val&gt;</span></div><div class="line">};</div></div><!-- fragment --><p>The <code>__type</code> integer can be set to 0 at run time to omit the serialization of the void pointer member.</p>
<p>The following example illustrates the initialization of <code>myStruct</code> with a void pointer to an int:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__record S; </div><div class="line"><span class="keywordtype">int</span> n = 123; </div><div class="line">S.val = (<span class="keywordtype">void</span>*)&amp;n; </div><div class="line">S.__type = SOAP_TYPE_int; </div></div><!-- fragment --><p>The serialized output of <code>S</code> contains the integer in its <em><code>val</code></em> element:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:record</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">val</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;xsd:int&quot;</span>&gt;123&lt;/<span class="keywordtype">val</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">ns:record</span>&gt;</div></div><!-- fragment --> </div><p>The deserializer for <code>ns__record</code> will automatically set the <code>__type</code> field and void pointer when deserializing the data, provided that the XML element <em><code>val</code></em> carries the <em><code>xsi:type</code></em> attribute from which it can determine the type.</p>
<dl class="section note"><dt>Note</dt><dd>when serializing strings via a <code>void*</code> member, the <code>void*</code> pointer must directly point to the string value rather than indirectly as with all other types. For example:</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__record S; </div><div class="line">S.val = (<span class="keywordtype">void</span>*)<span class="stringliteral">&quot;Hello&quot;</span>; </div><div class="line">S.__type = SOAP_TYPE_string; </div></div><!-- fragment --><p>This is the case for all string-based types, including types defined with <code>typedef char*</code>.</p>
<p>You may use an arbitrary suffix with the <code>__type</code> members to handle multiple void pointers in structs/classes. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__record </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> __typeOfp; <span class="comment">// the SOAP_TYPE_T pointed to by p </span></div><div class="line">    <span class="keywordtype">void</span> *p;       <span class="comment">// element &lt;p&gt;</span></div><div class="line">    <span class="keywordtype">int</span> __typeOfq; <span class="comment">// the SOAP_TYPE_T pointed to by q </span></div><div class="line">    <span class="keywordtype">void</span> *q;       <span class="comment">// element &lt;q&gt;</span></div><div class="line">};</div></div><!-- fragment --><p>Because service method parameters are stored within structs, you can use <code>__type</code> and <code>void*</code> parameters to pass polymorphic arguments without having to define a C++ class hierarchy (Section <a class="el" href="index.html#polymorph">Polymorphism, derived types, and dynamic binding in C++</a> ), provided that <em><code>xsi:type</code></em> attributes are present in the XML elements. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__string; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">int</span> xsd__int; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">float</span> xsd__float; </div><div class="line"><span class="keyword">enum</span> ns__status { on, off }; </div><div class="line"><span class="keyword">struct </span>ns__widget</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name;</div><div class="line">    <span class="keywordtype">int</span> part;</div><div class="line">};</div><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keywordtype">int</span> __type, <span class="keywordtype">void</span> *data, <span class="keyword">struct</span> ns__webmethodResponse { <span class="keywordtype">int</span> __type; <span class="keywordtype">void</span> *return_; } *out);</div></div><!-- fragment --><p>This method has a polymorphic input parameter <code>data</code> and a polymorphic output parameter <code>return_</code>. The <code>__type</code> parameters can be one of <code>SOAP_TYPE_xsd__string</code>, <code>SOAP_TYPE_xsd__int</code>, <code>SOAP_TYPE_xsd__float</code>, <code>SOAP_TYPE_ns__status</code>, or <code>SOAP_TYPE_ns__widget</code>. The WSDL and XSD files produced by the soapcpp2 tool declare the <code>void*</code> polymorphic members as <em><code>xsd:anyType</code></em> elements.</p>
<p>To declare a wrapper struct/class for <code>void*</code> pointers allows us to reuse this mechanism when we use <code>__self</code> as a member name that refers to the current XML element tag name:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>__any </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> __type;   <span class="comment">// the SOAP_TYPE_T pointed to by __self</span></div><div class="line">    <span class="keywordtype">void</span> *__self; <span class="comment">// serialize any type of content of the current element</span></div><div class="line">};</div><div class="line"><span class="keyword">struct </span>ns__record</div><div class="line">{</div><div class="line">    __any val;</div><div class="line">};</div></div><!-- fragment --><p>The following example illustrates the initialization of <code>__ns__record</code> with a void pointer to an int:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__record S; </div><div class="line"><span class="keywordtype">int</span> n = 123; </div><div class="line">S.val.__item = (<span class="keywordtype">void</span>*)&amp;n; </div><div class="line">S.val.__type = SOAP_TYPE_int; </div></div><!-- fragment --><p>The serialized output of <code>S</code> contains the integer:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:record</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">val</span> <span class="keyword">xsi:type</span>=<span class="stringliteral">&quot;xsd:int&quot;</span>&gt;123&lt;/<span class="keywordtype">val</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">ns:record</span>&gt;</div></div><!-- fragment --> </div><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="fixedarrays"></a>
Fixed-size array serialization</h2>
<p>Fixed size arrays are serialized as repetitions of <em><code>item</code></em> elements with the array values in XML. Multi-dimensional fixed size arrays are serialized as nested <em><code>item</code></em> elements, where the outer elements are arrays.</p>
<p>The serialization of fixed-size arrays supports the SOAP RPC encoding multi-dimensional array format as well as partially transmitted and sparse array formats standardized in SOAP 1.1 and 1.2.</p>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;fixed.h&quot;: </span></div><div class="line"><span class="keyword">struct </span>Example </div><div class="line">{</div><div class="line">    <span class="keywordtype">float</span> a[3]; </div><div class="line">};</div></div><!-- fragment --><p>This specifies a fixed-size array part of the <code>struct Example</code>. The serialized output of array <code>a</code> is:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">a</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">item</span>&gt;1.0&lt;/<span class="keywordtype">item</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">item</span>&gt;2.0&lt;/<span class="keywordtype">item</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;<span class="keywordtype">item</span>&gt;3.0&lt;/<span class="keywordtype">item</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">a</span>&gt;</div></div><!-- fragment --> </div><p>Any deserialized items of an array that do not fit in the fixed size array, i.e. are out of bounds, are ignored by the deserializer when the <code><a class="el" href="group__group__flags.html#gac613f90d420290bb8ef9207deaa3525e" title="soap_mode C-related input flag value to ignore array items that are out of bounds when deserializing ...">SOAP_C_NOIOB</a></code> flag is set, otherwise <code><a class="el" href="group__group__errors.html#ga4bf925c17a1c81e99de6bfdb7d85c19a" title="A soap_status error code: SOAP array index out of bounds. ">SOAP_IOB</a></code> errors will be generated by the deserializer.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="dynarray"></a>
Dynamic array serialization</h2>
<p>Dynamic arrays are much more flexible than fixed-size arrays. Dynamic arrays declared in the interface header file for soapcpp2 are a special struct or class or are part of a struct or class with a member pointing to an array of elements and a member that stores the size of the array. Dynamic array allocations are easy using the soapcpp-generated <code>soap_new_T</code> functions for type <code>T</code>. This function is used to allocate an array of values which can then be assigned to the pointer member of the struct/class that stores the array pointer with its size.</p>
<p>To facilitate SOAP RPC encoding, SOAP-encoded arrays require special treatment. SOAP-encoded arrays are single- or multi-dimensional arrays with bounds that appear in XML. These arrays may also have offsets that differ from zero. The intent of SOAP-encoded arrays is to replicate multi-dimensional arrays commonly found in programming languages.</p>
<p>However, XML also provides a simple way to represent a sequence of values with a sequence of XML elements. This differs from SOAP-encoded arrays in that SOAP-encoded arrays are elements with nested <em><code>item</code></em> elements with values, though SOAP deserializers may ignore the name of these elements when parsing XML as stated in the SOAP specifications.</p>
<p>Both SOAP-encoded arrays and sequences of XML elements are supported in gSOAP, using dynamic arrays and containers. The basics will be described next. For additional details, see the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="arraybounds"></a>
SOAP-encoded array bounds</h3>
<p>SOAP-encoded arrays use the <em><code>SOAP-ENC:Array</code></em> attribute in XML to identify the array and the <em><code>SOAP-ENC:arrayType</code></em> attribute to identify the array dimensionality and its size.</p>
<p>As a security measure to avoid denial of service attacks based on sending a huge array size value using the <em><code>SOAP-ENC:arrayType</code></em> attribute, requiring the allocation of large chunks of memory, the total number of array elements set by the <em><code>SOAP-ENC:arrayType</code></em> attribute cannot exceed <code><a class="el" href="group__group__soap.html#ga29a7dab5c96c2724b3c234505d52c76e" title="User-definable macro to protect excessive SOAP array allocation requests by defining a maximum alloca...">SOAP_MAXARRAYSIZE</a></code>, which is set to 100000 by default. This limit is not a hard limit on the number of array elements, but rather to avoid pre-allocating large arrays as stated. The hard limit on the number of array elements received is <code><a class="el" href="structsoap.html#a00bc20ad1100f580a173ba651e05bcb9" title="User-definable maximum array and container size (maximum item occurrence constraint) as parsed from X...">soap::maxoccurs</a></code> which is set to <code><a class="el" href="group__group__soap.html#ga3933a58d23a5bf2ad64039725cb23786" title="User-definable maximum number of array or container elements for containers that are not already cons...">SOAP_MAXOCCURS</a></code> by default. By contrast, the <code><a class="el" href="group__group__soap.html#ga29a7dab5c96c2724b3c234505d52c76e" title="User-definable macro to protect excessive SOAP array allocation requests by defining a maximum alloca...">SOAP_MAXARRAYSIZE</a></code> limit only negatively affects multi-dimensional arrays because the dimensionality of the receiving array may be lost when the number of elements exceeds 100000. One-dimensional arrays are not affected and populated after this limit by simply deserializing the array elements received.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="oned"></a>
One-dimensional dynamic SOAP-encoded arrays</h3>
<p>A special form of struct or class is used to define one-dimensional dynamic SOAP-encoded arrays in an interface header file for soapcpp2. Each array has a pointer variable and a member that records the number of elements the pointer points to in memory.</p>
<p>The general form of the struct or class declaration that contains a one-dimensional dynamic SOAP-encoded array is:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>array_name </div><div class="line">{</div><div class="line">    Type *__ptr;  <span class="comment">// pointer to array of elements in memory</span></div><div class="line">    <span class="keywordtype">int</span> __size;   <span class="comment">// number of elements pointed to </span></div><div class="line">    <span class="keywordtype">int</span> __offset; <span class="comment">// optional SOAP 1.1 array offset</span></div><div class="line">    ...           <span class="comment">// anything that follows here will be ignored </span></div><div class="line">};</div></div><!-- fragment --><p>where the <code>array_name</code> must be a non-qualified name and <code>Type</code> is the type for the elements of the array. The <code>__ptr</code> member points to the array values and <code>__size</code> is the array size. The <code>__offset</code> member specifies an optional array offset, when nonzero, see Section <a class="el" href="index.html#onedoffset">One-dimensional dynamic SOAP-encoded arrays with non-zero offsets</a>.</p>
<p>If the <code>array_name</code> is qualified with a namespace prefix then the array is not a SOAP-encoded array but rather represents a sequence of XML elements, see Section <a class="el" href="index.html#list">Non-SOAP dynamic arrays</a>.</p>
<p>The soapcpp2-generated deserializer of a one-dimensional dynamic array can deserialize partially transmitted and/or SOAP-encoded sparse arrays, and even multi-dimensional arrays which will be collapsed into a one-dimensional array with row-major ordering.</p>
<dl class="section warning"><dt>Warning</dt><dd>SOAP 1.2 does not support partially transmitted arrays and the <code>__offset</code> member of a dynamic array is ignored.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="onedoffset"></a>
One-dimensional dynamic SOAP-encoded arrays with non-zero offsets</h3>
<p>The declaration of a dynamic array as described in Section <a class="el" href="index.html#oned">One-dimensional dynamic SOAP-encoded arrays</a> may include an <code>int __offset</code> member. When set to an integer value, the serializer of the dynamic array will use this member as the start index of the array and the SOAP-encoded array offset attribute <em><code>SOAP-ENC:offset</code></em> will appear in the XML message. Note that array offsets is a SOAP 1.1 specific feature which is not supported in SOAP 1.2.</p>
<p>For example, the following header file declares a numeric <code>Vector</code> class, which is a dynamic array of floating point values with an index that starts at 1:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;vector.h&quot;: </span></div><div class="line"><span class="keyword">class </span>Vector </div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">float</span> *__ptr; </div><div class="line">    <span class="keywordtype">int</span> __size; </div><div class="line">    <span class="keywordtype">int</span> __offset; </div><div class="line">    Vector();</div><div class="line">    Vector(<span class="keyword">struct</span> soap *, <span class="keywordtype">int</span> n);</div><div class="line">    <span class="keywordtype">float</span>&amp; operator[](<span class="keywordtype">int</span> i); </div><div class="line">    <span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>;</div><div class="line">};</div></div><!-- fragment --><p>The implementations of the <code>Vector</code> methods are:</p>
<div class="fragment"><div class="line">Vector::Vector()</div><div class="line">{</div><div class="line">  this-&gt;soap_default(NULL);</div><div class="line">}</div><div class="line">Vector::Vector(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">int</span> n) </div><div class="line">{</div><div class="line">  this-&gt;soap = <a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>;</div><div class="line">  __ptr = soap_new_float(soap, n); </div><div class="line">  __size = n; </div><div class="line">  __offset = 1; </div><div class="line">} </div><div class="line"><span class="keywordtype">float</span>&amp; Vector::operator[](<span class="keywordtype">int</span> i) </div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> __ptr[i - __offset]; </div><div class="line">}</div></div><!-- fragment --><p>An example program fragment that serializes a vector of 3 elements:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">Vector v(soap, 3);</div><div class="line">v[1] = 1.0; </div><div class="line">v[2] = 2.0; </div><div class="line">v[3] = 3.0; </div><div class="line">soap_write_Vector(soap, &amp;v);</div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div></div><!-- fragment --><p>The output is a partially transmitted array:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENC:Array</span> <span class="keyword">SOAP-ENC:arrayType</span>=<span class="stringliteral">&quot;xsd:float[4]&quot;</span> <span class="keyword">SOAP-ENC:offset</span>=<span class="stringliteral">&quot;[1]&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">item</span>&gt;1&lt;/<span class="keywordtype">item</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">item</span>&gt;2&lt;/<span class="keywordtype">item</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;<span class="keywordtype">item</span>&gt;3&lt;/<span class="keywordtype">item</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">SOAP-ENC:Array</span>&gt;</div></div><!-- fragment --> </div><p>Note that <em><code>xsd:float[4]</code></em> is the type and shape of the encoded array, which starts at offset 1 and therefore the element at 0 is omitted.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="nested"></a>
Nested one-dimensional dynamic SOAP-encoded arrays</h3>
<p>One-dimensional SOAP-encoded dynamic arrays may be nested. For example, using <code>class Vector</code> declared in the previous section, <code>class Matrix</code> is declared:</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;matrix.h&quot;: </span></div><div class="line"><span class="keyword">class </span>Matrix </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    Vector *__ptr; </div><div class="line">    <span class="keywordtype">int</span> __size; </div><div class="line">    <span class="keywordtype">int</span> __offset; </div><div class="line">    Matrix(); </div><div class="line">    Matrix(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m); </div><div class="line">    Vector&amp; operator[](<span class="keywordtype">int</span> i); </div><div class="line">    <span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>;</div><div class="line">}; </div></div><!-- fragment --><p>The Matrix type is essentially an array of pointers to arrays which make up the rows of a matrix. The serialization of the two-dimensional dynamic array in is nested form in XML.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="multid"></a>
Multi-dimensional dynamic SOAP-encoded arrays</h3>
<p>A special form of <code>struct</code> or <code>class</code> is used to define multi-dimensional dynamic SOAP-encoded arrays. Each array has a pointer variable and a member that records the number of elements per dimension. A <code>K</code>-dimensional array is declared as:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>array_name </div><div class="line">{</div><div class="line">    Type *__ptr;     <span class="comment">// pointer to array of elements in memory</span></div><div class="line">    <span class="keywordtype">int</span> __size[K];   <span class="comment">// number of elements per dimension</span></div><div class="line">    <span class="keywordtype">int</span> __offset[K]; <span class="comment">// optional SOAP 1.1 array offset</span></div><div class="line">    ...              <span class="comment">// anything that follows here will be ignored </span></div><div class="line">};</div></div><!-- fragment --><p>where the <code>array_name</code> must be a non-qualified name and <code>Type</code> is the type for the elements of the array. The <code>__ptr</code> member points to the array values. The <code>__size</code> array specifies the number of array elements per dimension. The <code>__offset</code> array specifies an optional offset per dimension.</p>
<p>For example, the following declaration specifies a matrix class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Matrix </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    <span class="keywordtype">float</span> *__ptr; </div><div class="line">    <span class="keywordtype">int</span> __size[2]; </div><div class="line">    <span class="keywordtype">int</span> __offset[2]; </div><div class="line">}; </div></div><!-- fragment --><p>By contrast to the matrix class of Section <a class="el" href="index.html#nested">Nested one-dimensional dynamic SOAP-encoded arrays</a> that defines a matrix as an array of pointers to matrix rows, this class has one pointer to a matrix stored in row-major order. The size of the matrix is determined by the <code>__size</code> member: <code>__size[0]</code> holds the number of rows and <code>__size[1]</code> holds the number of columns of the matrix. Likewise, <code>__offset[0]</code> is the row offset and <code>__offset[1]</code> is the columns offset.</p>
<dl class="section warning"><dt>Warning</dt><dd>SOAP 1.2 does not support partially transmitted arrays and the <code>__offset</code> member of a dynamic array is ignored.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="list"></a>
Non-SOAP dynamic arrays</h3>
<p>An array is serialized as a sequence of XML elements. By contrast, a SOAP-encoded array is serialized as an element with a sequence of sub-elements, whose tag names are irrelevant to the SOAP processor, see <a class="el" href="index.html#oned">One-dimensional dynamic SOAP-encoded arrays</a>.</p>
<p>An array is declared in an interface header file for soapcpp2 as a struct or class with a name that is qualified with a namespace prefix. There are two forms. The first form is similar to the SOAP-encoded array declaration that wraps the <code>__ptr</code> and <code>__size</code> members:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>prefix__array_name </div><div class="line">{</div><div class="line">    Type *__ptr;  <span class="comment">// pointer to array of elements in memory</span></div><div class="line">    <span class="keywordtype">int</span> __size;   <span class="comment">// number of elements pointed to </span></div><div class="line">    ...           <span class="comment">// anything that follows here will be ignored </span></div><div class="line">};</div></div><!-- fragment --><p>The second form is more generic, because the array can be declared anywhere in the struct or class and multiple arrays can be used as members, each with a <code>__size</code> member (<code>__sizeName</code> is also allowed) that precedes a pointer member:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>prefix__array_name </div><div class="line">{</div><div class="line">    ...                   <span class="comment">// other members that are serialized</span></div><div class="line">    <span class="keywordtype">int</span> __size_of_array1; <span class="comment">// number of elements pointed to </span></div><div class="line">    Type1 *array1;        <span class="comment">// pointer to array of elements in memory</span></div><div class="line">    ...                   <span class="comment">// other members that are serialized</span></div><div class="line">    <span class="keywordtype">int</span> __size_of_array1; <span class="comment">// number of elements pointed to </span></div><div class="line">    Type2 *array2;        <span class="comment">// pointer to array of elements in memory</span></div><div class="line">    ...                   <span class="comment">// other members that are serialized</span></div><div class="line">};</div></div><!-- fragment --><p>The <code>__size</code> member should be an <code>int</code> type and cannot be a <code>size_t</code> type or other integer type.</p>
<p>For example, we define a Map structure that contains a sequence of key-val pairs:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__Map </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> __size; <span class="comment">// number of pairs </span></div><div class="line">    <span class="keyword">struct </span>ns__Pair</div><div class="line">    {</div><div class="line">        <span class="keywordtype">char</span> *key;</div><div class="line">        <span class="keywordtype">char</span> *val;</div><div class="line">    } *pair;    <span class="comment">// array of pairs</span></div><div class="line">};</div></div><!-- fragment --><p>Since 2.7.16 it is also possible to use a '<code>$</code>' as a special marker to annotate a size member instead of requiring these members to start with <code>__size</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__Map </div><div class="line">{</div><div class="line">  $ <span class="keywordtype">int</span> size;  <span class="comment">// number of pairs </span></div><div class="line">    <span class="keyword">struct </span>ns__Pair</div><div class="line">    {</div><div class="line">        <span class="keywordtype">char</span> *key;</div><div class="line">        <span class="keywordtype">char</span> *val;</div><div class="line">    } *pair;    <span class="comment">// array of pairs</span></div><div class="line">};</div></div><!-- fragment --><p>The array will be serialized in XML as a sequence of pairs:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:Map</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">pair</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">key</span>&gt;<span class="keyword">Joe</span>&lt;/<span class="keywordtype">key</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">val</span>&gt;555 77 1234&lt;/<span class="keywordtype">val</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;/<span class="keywordtype">pair</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;<span class="keywordtype">pair</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;<span class="keywordtype">key</span>&gt;<span class="keyword">Susan</span>&lt;/<span class="keywordtype">key</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;<span class="keywordtype">val</span>&gt;555 12 6725&lt;/<span class="keywordtype">val</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &lt;/<span class="keywordtype">pair</span>&gt; </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &lt;<span class="keywordtype">pair</span>&gt; </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &lt;<span class="keywordtype">key</span>&gt;<span class="keyword">Pete</span>&lt;/<span class="keywordtype">key</span>&gt; </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &lt;<span class="keywordtype">val</span>&gt;555 99 4321&lt;/<span class="keywordtype">val</span>&gt; </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  &lt;/<span class="keywordtype">pair</span>&gt; </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&lt;/<span class="keywordtype">ns:Map</span>&gt;</div></div><!-- fragment --> </div><p>Deserialization is less efficient compared to a SOAP-encoded array, because the size of the sequence is not part of the SOAP encoding. Buffering is used by the deserializer to collect the elements in memory. When the end of the list is reached, the buffered elements are copied to a newly allocated managed space on the heap for the dynamic array.</p>
<p>Multiple arrays can be part of a struct or class. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__Contact </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *firstName; </div><div class="line">    <span class="keywordtype">char</span> *lastName; </div><div class="line">  $ <span class="keywordtype">int</span> nPhones;          <span class="comment">// number of Phones</span></div><div class="line">    <a class="code" href="group__group__soap.html#ga7c6e38d209f60a18e362172dca1a3b6e">ULONG64</a> *phoneNumber; <span class="comment">// array of phone numbers </span></div><div class="line">  $ <span class="keywordtype">int</span> nEmails;          <span class="comment">// number of emails </span></div><div class="line">    <span class="keywordtype">char</span> **emailAddress;  <span class="comment">// array of email addresses </span></div><div class="line">};</div></div><!-- fragment --><p>The XML serialization of an example <code>ns__Contact</code> is:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:Contact</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">firstName</span>&gt;<span class="keyword">Joe</span>&lt;/<span class="keywordtype">firstName</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">lastName</span>&gt;<span class="keyword">Smith</span>&lt;/<span class="keywordtype">lastName</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;<span class="keywordtype">phoneNumber</span>&gt;5551112222&lt;/<span class="keywordtype">phoneNumber</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;<span class="keywordtype">phoneNumber</span>&gt;5551234567&lt;/<span class="keywordtype">phoneNumber</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;<span class="keywordtype">phoneNumber</span>&gt;5552348901&lt;/<span class="keywordtype">phoneNumber</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;<span class="keywordtype">emailAddress</span>&gt;<span class="keyword">Joe.Smith</span>@<span class="keyword">mail.com</span>&lt;/<span class="keywordtype">emailAddress</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;<span class="keywordtype">emailAddress</span>&gt;<span class="keyword">Joe</span>@<span class="keyword">Smith.com</span>&lt;/<span class="keywordtype">emailAddress</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;/<span class="keywordtype">ns:Contact</span>&gt;</div></div><!-- fragment --> </div><p>For C++, a better alternative to arrays are containers, which are described next.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="templates"></a>
STL containers</h3>
<p>The STL containers <code>std::deque</code>, <code>std::list</code>, <code>std::set</code>, and <code>std::vector</code> are serializable in XML by the soapcpp2-generated serializers.</p>
<p>In order to use containers in an interface header file for soapcpp2, import <em><code>stldeque.h</code></em>, <em><code>stllist.h</code></em>, <em><code>stlset.h</code></em>, or <em><code>stlvector.h</code></em> to enable <code>std::deque</code>, <code>std::list</code>, <code>std::set</code>, and <code>std::vector</code>, respectively. For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;stlvector.h&quot;</span> </div><div class="line"><span class="keyword">class </span>ns__myClass </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    std::vector&lt;int&gt;          number 1:10; <span class="comment">// 1 to 10 numbers</span></div><div class="line">    std::vector&lt;std::string&gt; *name   2;    <span class="comment">// more than 2 names</span></div><div class="line">};</div></div><!-- fragment --><p>The use of pointer members such as for <code>name</code> shown above is possible, but not required. Also <code>minOccurs : maxOccurs</code> and <code>minOccurs</code> length constraints can be specified as shown in the example above. The XML schema that corresponds to the <code>ns__myClass</code> type is:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;myClass&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">sequence</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;number&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:int&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;10&quot;</span>/&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;name&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;unbounded&quot;</span>/&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;/<span class="keywordtype">sequence</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;/<span class="keywordtype">complexType</span>&gt;</div></div><!-- fragment --> </div><p>You can also implement your own containers. The containers must be class templates and should define a forward iterator type, and provide the following methods:</p>
<ul>
<li><code>void clear()</code> empty the container;</li>
<li><code>iterator begin()</code> return iterator to beginning;</li>
<li><code>const_iterator begin() const</code> return const iterator to beginning;</li>
<li><code>iterator end()</code> return iterator to end;</li>
<li><code>const_iterator end() const</code> return const iterator to end;</li>
<li><code>size_t size()</code> return size;</li>
<li><code>iterator insert(iterator pos, const_reference val)</code> insert element.</li>
</ul>
<p>The <code>iterator</code> should be a forward iterator with a dereference operator to access the container's elements, it must be comparable (equal/unequal), and be pre-incrementable (<code>++it</code>). The const iterator is used by its soapcpp2-generated serializer to send a sequence of XML element values. The <code>insert</code> method is used to populate a container with <code>Container::iterator i = container.insert(container.end(), val)</code>.</p>
<p>Here is in example container template class:</p>
<div class="fragment"><div class="line"><span class="comment">// simple_vector.h </span></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; </div><div class="line"><span class="keyword">class </span>simple_vector </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    <span class="keyword">typedef</span> T                       value_type; </div><div class="line">    <span class="keyword">typedef</span> value_type            * pointer; </div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">const</span> value_type      * const_pointer; </div><div class="line">    <span class="keyword">typedef</span> value_type            &amp; reference; </div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">const</span> value_type      &amp; const_reference; </div><div class="line">    <span class="keyword">typedef</span> pointer                 iterator; </div><div class="line">    <span class="keyword">typedef</span> const_pointer           const_iterator; </div><div class="line">  <span class="keyword">protected</span>: </div><div class="line">    iterator                        head; </div><div class="line">    iterator                        tail; </div><div class="line">    <span class="keywordtype">size_t</span>                          capacity; </div><div class="line">  <span class="keyword">public</span>: </div><div class="line">                                    simple_vector()       { head = tail = NULL; } </div><div class="line">                                    simple_vector(<span class="keyword">const</span> simple_vector&amp; v) </div><div class="line">                                                          { operator=(v); } </div><div class="line">                                    ~simple_vector()      { <span class="keywordflow">if</span> (head) <span class="keyword">delete</span>[] head; } </div><div class="line">    <span class="keywordtype">void</span>                            clear()               { tail = head; } </div><div class="line"><span class="comment">/* the member functions below are required for serialization of templates */</span> </div><div class="line">    iterator                        begin()               { <span class="keywordflow">return</span> head; } </div><div class="line">    const_iterator                  begin()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> head; } </div><div class="line">    iterator                        end()                 { <span class="keywordflow">return</span> tail; } </div><div class="line">    const_iterator                  end()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> tail; } </div><div class="line">    <span class="keywordtype">size_t</span>                          size()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> tail - head; } </div><div class="line">    iterator                        insert(iterator pos, const_reference val) </div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (!head) </div><div class="line">        head = tail = <span class="keyword">new</span> value_type[capacity = 1]; </div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tail &gt;= head + capacity) </div><div class="line">      {</div><div class="line">        iterator i = head; </div><div class="line">        iterator j = <span class="keyword">new</span> value_type[capacity *= 2]; </div><div class="line">        iterator k = j; </div><div class="line">        <span class="keywordflow">while</span> (i &lt; tail) </div><div class="line">          *k++ = *i++; </div><div class="line">        <span class="keywordflow">if</span> (pos) </div><div class="line">          pos = j + (pos - head); </div><div class="line">        tail = j + (tail - head); </div><div class="line">        <span class="keyword">delete</span>[] head; </div><div class="line">        head = j; </div><div class="line">      } </div><div class="line">      <span class="keywordflow">if</span> (pos &amp;&amp; pos &gt;= head &amp;&amp; pos &lt; tail) </div><div class="line">      {</div><div class="line">        iterator i = tail; </div><div class="line">        iterator j = i - 1; </div><div class="line">        <span class="keywordflow">while</span> (j != pos) </div><div class="line">           *i-- = *j--; </div><div class="line">        *pos = val; </div><div class="line">      } </div><div class="line">      <span class="keywordflow">else</span> </div><div class="line">      {</div><div class="line">        pos = tail; </div><div class="line">        *tail++ = val; </div><div class="line">      } </div><div class="line">      <span class="keywordflow">return</span> pos; </div><div class="line">    } </div><div class="line">    simple_vector&amp; operator=(<span class="keyword">const</span> simple_vector&amp; v) </div><div class="line">    {</div><div class="line">      head = tail = NULL; </div><div class="line">      capacity = v.capacity; </div><div class="line">      <span class="keywordflow">if</span> (v.head) </div><div class="line">      {</div><div class="line">        head = tail = <span class="keyword">new</span> value_type[capacity]; </div><div class="line">        iterator i = v.head; </div><div class="line">        <span class="keywordflow">while</span> (i != v.tail) </div><div class="line">          *tail++ = *i++; </div><div class="line">      } </div><div class="line">      <span class="keywordflow">return</span> *<span class="keyword">this</span>; </div><div class="line">    } </div><div class="line">};</div></div><!-- fragment --><p>To enable the container, we add the following two lines to the interface header file for soapcpp2:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;simpleVector.h&quot;</span> </div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span>simpleVector;</div></div><!-- fragment --><p>The container class itself should not be defined in the interface header file, only the template declaration suffices for soapcpp2 to generate serializers. Recall that the <code>#include</code> directives are not executed by soapcpp2 but simply passed on to the generated source code. This include specifies in the generated source code where the container is actually defined.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="polymorphicarrays"></a>
Polymorphic dynamic arrays and lists</h3>
<p>Polymorphic arrays, that is, arrays of values of any type, can be serialized in XML when declared as an array of pointers to a base class. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ns__Object </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    ... <span class="comment">// members of ns__Object</span></div><div class="line">}; </div><div class="line"><span class="keyword">class </span>ns__Data : <span class="keyword">public</span> ns__Object </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    ... <span class="comment">// members of ns__Data</span></div><div class="line">}; </div><div class="line"><span class="keyword">class </span>ArrayOfObject </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    ns__Object **__ptr; <span class="comment">// pointer to array of pointers to base or derived objects </span></div><div class="line">    <span class="keywordtype">int</span> __size;         <span class="comment">// size of the array</span></div><div class="line">}; </div><div class="line"><span class="keyword">class </span>ns__Objects </div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    std::vector&lt;ns__Object&gt; objects; <span class="comment">// vector of base or derived objects </span></div><div class="line">};</div></div><!-- fragment --><p>The pointers in the array can point to the <code>ns__Object</code> base instances or <code>ns__Data</code> derived instances, which will be serialized accordingly in XML. Derived instances are indicated by <em><code>xsi:type</code></em> attribute in XML with the qualified name of the class, to distinguish derived instances from the base instances. Without this attribute the deserializer will not instantiate the derived instance but a base instance since there is no identifying information to distinguish the XML forms except for the <em><code>xsi:type</code></em> attribute.</p>
<p>Since we cannot use dynamic binding to support polymorphism in C, another mechanism we can use is void pointers . Here is an example of a polymorphic SOAP-encoded array <code>ArrayOfObject</code> and a non-SOAP dynamic array <code>ns__Objects</code> that hold values of any serializable type:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>__wrapper </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> __type;   <span class="comment">// identify the type below by SOAP_TYPE_T </span></div><div class="line">    <span class="keywordtype">void</span> *__item; <span class="comment">// pointer to data of type T </span></div><div class="line">}; </div><div class="line"><span class="keyword">struct </span>ArrayOfObject </div><div class="line">{</div><div class="line">    <span class="keyword">struct </span>__wrapper *__ptr; <span class="comment">// pointer to array</span></div><div class="line">    <span class="keywordtype">int</span> __size;              <span class="comment">// size of the array</span></div><div class="line">}; </div><div class="line"><span class="keyword">struct </span>ns__Objects </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> __size;                <span class="comment">// size of the array</span></div><div class="line">    <span class="keyword">struct </span>__wrapper *objects; <span class="comment">// pointer to array</span></div><div class="line">};</div></div><!-- fragment --><p>This example uses an "invisible" type <code>__wrapper</code> and member <code>__array</code>, which start with a double underscore. These names are never visible in serialized XML. The <code>__type</code> member of <code>__wrapper</code> is a <code>SOAP_TYPE_T</code> value that identifies the type <code>T</code> that <code>__item</code> points to, see Section <a class="el" href="index.html#void">Void pointer serialization</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="arrayitems"></a>
How to change the tag names of array item elements</h3>
<p>The default XML element tag name for array elements is <em><code>item</code></em>, which can be changed. The <code>__ptr</code> member in a struct or class of a dynamic array may have an optional suffix part that specifies the name of the element tag in XML. That is, the suffix is part of the <code>__ptr</code> member name:</p>
<div class="fragment"><div class="line">Type *__ptrarray_elt_name</div></div><!-- fragment --><p>Consider for example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ArrayOfstring </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span>* *__ptrstring;</div><div class="line">    <span class="keywordtype">int</span> __size;</div><div class="line">};</div></div><!-- fragment --><p>The array is serialized as:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENC:Array</span> <span class="keyword">SOAP-ENC:arrayType</span>=<span class="stringliteral">&quot;xsd:string[2]&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">string</span>&gt;<span class="keyword">Hello</span>&lt;/<span class="keywordtype">string</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">string</span>&gt;<span class="keyword">World</span>&lt;/<span class="keywordtype">string</span>&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;/<span class="keywordtype">SOAP-ENC:Array</span>&gt;</div></div><!-- fragment --> </div><p>SOAP 1.1/1.2 does not mandate a specific tag name for SOAP-encoded array elements and the soapcpp2-generated serializers will ignore the name used to itemize SOAP-encoded array values.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="base64binary"></a>
base64Binary serialization</h2>
<p>The <em><code>base64Binary</code></em> XSD type is introduced in an interface header file for soapcpp2 using a struct or class that contains an array of <code>unsigned char</code> values:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>xsd__base64Binary </div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6ba9f9e291b2b26e0696bd48f4e983be">__ptr</a>; </div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structxsd____base64_binary.html#aa2dfd4d99f8280c413b9ff25a69a8729">__size</a>; </div><div class="line">};</div></div><!-- fragment --><p>The advantage of this struct or class is the ability to serializer raw binary data from memory, since the soapcpp2-generated serializer converts the binary data to/from base64 in XML.</p>
<p>To introduce a new XML schema type derived from <em><code>base64Binary</code></em> use the same struct or class structure, but with another name. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__binary</div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *__ptr; </div><div class="line">    <span class="keywordtype">int</span> __size; </div><div class="line">};</div></div><!-- fragment --><p>The resulting XML schema type is:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;binary&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:base64Binary&quot;</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;/<span class="keywordtype">restriction</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div></div><!-- fragment --> </div><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="hexbinary"></a>
hexBinary serialization</h2>
<p>The <em><code>base64Binary</code></em> XSD type is introduced in an interface header file for soapcpp2 using a struct or class that contains an array of <code>unsigned char</code> values:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>xsd__hexBinary </div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____hex_binary.html#adade1cbcc8c6ff25037794f38944f999">__ptr</a>; </div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structxsd____hex_binary.html#a4c213d448af3955f37dded4f238301e6">__size</a>; </div><div class="line">};</div></div><!-- fragment --><p>The advantage of this struct or class is the ability to serializer raw binary data from memory, since the soapcpp2-generated serializer converts the binary data to/from hexadecimal in XML.</p>
<p>If a binary type such as <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> is already defined, then we can simply use a <code>typedef</code> to introduce the hex variant:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>xsd__base64Binary</div><div class="line">{ <span class="keyword">public</span>: </div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6ba9f9e291b2b26e0696bd48f4e983be">__ptr</a>; </div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structxsd____base64_binary.html#aa2dfd4d99f8280c413b9ff25a69a8729">__size</a>; </div><div class="line">}; </div><div class="line"><span class="keyword">typedef</span> xsd__base64Binary xsd__hexBinary; <span class="comment">// serializes into hex content</span></div></div><!-- fragment --><p>This lets soapcpp2 generate <em><code>xsd:base64Binary</code></em> and <em><code>xsd:hexBinary</code></em> serializers.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="literal"></a>
SOAP RPC encoded versus document/literal style</h2>
<p>SOAP has several styles:</p>
<ul>
<li>SOAP RPC encoding uses XML that is restricted to SOAP structures to ensure programming-language interoperability. Not allowed are values serialized as XML attributes, arrays should be serialized as SOAP-encoded arrays instead of XML element repetitions (i.e. <em><code>xsd:sequence maxOccurs="unbounded"</code></em> is not allowed), and <em><code>xsd:choice</code></em> components are not allowed. Multi-referenced elements are used to serialize data structure graphs. Because additional SOAP-encoding specific attributes are present that are not defined in the XML schema (of the WSDL), strict XML schema validators may reject SOAP-encoded content. The SOAP Body contains at most one service operation request element or at most one service operation response element and the encoding style is indicated with the <em><code>SOAP-ENV:encodingStyle="..."</code></em> attribute in the SOAP Body or one or more of its sub-elements. This style is specified for the entire service declared under namespace prefix <code>ns</code> with: <div class="fragment"><div class="line"><span class="comment">//gsoap ns service style:    rpc</span></div><div class="line"><span class="comment">//gsoap ns service encoding: encoded</span></div></div><!-- fragment --></li>
<li>SOAP document/literal uses XML constrained to the XML schema that defines the XML content. The serialization of tree-based data structures is accurate in XML. The serialization of digraph-shaped data structures results in the duplication of data nodes that are co-references. Cyclic data structures cannot be accurately serialized, but you can use <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> to force the use of id-ref to accurately serialize digraphs and cyclic data structures. The SOAP Body may contain any number of XML elements, as if the SOAP Body is the root of an XML document. No <em><code>SOAP-ENV:encodingStyle="..."</code></em> attribute should appear in literal content. This style is specified for the entire service declared under namespace prefix <code>ns</code> with: <div class="fragment"><div class="line"><span class="comment">//gsoap ns service style:    document</span></div><div class="line"><span class="comment">//gsoap ns service encoding: literal</span></div></div><!-- fragment --></li>
<li>SOAP RPC literal also uses XML constrained to the XML schema that defines the XML content. The difference with document/literal is that the SOAP Body contains at most one service operation request element or at most one service operation response element. No <em><code>SOAP-ENV:encodingStyle="..."</code></em> attribute should appear in literal content. This style is specified for the entire service declared under namespace prefix <code>ns</code> with: <div class="fragment"><div class="line"><span class="comment">//gsoap ns service style:    rpc</span></div><div class="line"><span class="comment">//gsoap ns service encoding: literal</span></div></div><!-- fragment --></li>
</ul>
<p>Besides <code>//gsoap ns service style</code> and <code>//gsoap ns service encoding</code> there are also the service operation specific versions <code>//gsoap ns service method-style</code>, <code>//gsoap ns service method-response-style</code>, <code>//gsoap ns service method-encoding</code>, and <code>//gsoap ns service method-response-encoding</code> that explicitly specify SOAP RPC encoded, document/literal, or RPC literal style messages for the indicated service operation methods.</p>
<p>To enable SOAP RPC encoding for a particular service operation, use:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service method-style:    webmethod rpc </span></div><div class="line"><span class="comment">//gsoap ns service method-encoding: webmethod encoded </span></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(...)</div></div><!-- fragment --><p>To enable SOAP RPC encoding for a particular service operation response, use:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service method-response-style:    webmethod rpc </span></div><div class="line"><span class="comment">//gsoap ns service method-response-encoding: webmethod encoded </span></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(...)</div></div><!-- fragment --><p>Likewise, you can specify document/literal and RPC literal messages. The default style is document/literal, unless <b><code>soapcpp2 -e</code></b> option <b><code>-e</code></b> is used to set SOAP RPC encoding by default.</p>
<p>For the <code>style</code> directives you can specify <code>rpc</code> or <code>document</code>. For the <code>encoding</code> directives you can specify <code>literal</code>, <code>encoded</code>, or even a custom URI that indicates some custom or proprietary encoding format in XML which will not interoperate with SOAP processors that are not compatible with the specified encoding format. See also Section <a class="el" href="index.html#directives">Directives</a>.</p>
<p>See also <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> documentation for differences in XML serialization when using the SOAP RPC encoded and document/literal messaging styles.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="literal2"></a>
Serializing mixed content with literal XML strings</h3>
<p>XML is stored in "literal" XML strings which are the built-in <code>_XML</code> type that is a regular <code>char*</code> string or you can declare a wide character string in an interface header file for soapcpp2 as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">wchar_t</span> *XML;</div></div><!-- fragment --><p>To declare a C++ <code>std::string</code> literal XML type:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> std::string XML;</div></div><!-- fragment --><p>Or use a wide character string:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> std::wstring XML;</div></div><!-- fragment --><p>To use both at the same time:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> std::string  XML;</div><div class="line"><span class="keyword">typedef</span> std::wstring XML_;</div></div><!-- fragment --><p>The differences between the use of regular 8-bit strings versus wide character strings for XML documents are:</p>
<ul>
<li>XML literal strings must hold UTF-8 XML content.</li>
<li>Wide character XML literal strings are converted to and from UTF-8.</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="validation"></a>
XML validation</h1>
<p>Some XML validation constraints are not automatically verified unless explicitly set using the <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> flag. SOAP RPC encoding is an XML format that does not afford strict XML validation, because of the addition of SOAP-specific attributes and other small deviations that will be detected by an aggressive XML validator, leading the messaging failures. By toning XML validation down, it helps to improve SOAP RPC encoding interoperability.</p>
<p>Strict validation constraints are enabled with the <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> mode flag set, e.g. with <code>soap_set_imode(soap, SOAP_XML_STRICT)</code> or <code>soap_new(SOAP_XML_STRICT)</code>, see Section <a class="el" href="index.html#flags">Run-time flags</a> for the complete list of flags.</p>
<p>The next sections describe the type of constraints validated when <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> is enabled and validation constraints are specified in the interface header file.</p>
<p>Use compiler flag <code><a class="el" href="group__group__with.html#gaa3632d9a171ac29a7cb4a4c4861d8e8d" title="When this macro is defined at compile time (undefined by default), replaces UTF-8 content that is out...">WITH_REPLACE_ILLEGAL_UTF8</a></code> to force strict UTF-8 text conversions, which replaces invalid UTF-8 with U+FFFD.</p>
<p>See also <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> documentation for more details.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="defaultvalues"></a>
Default values</h2>
<p>Default values can be defined for optional elements and attributes, which means that the default value will be used when the element or attribute value is not present in the parsed XML. See also Section <a class="el" href="index.html#default">Default values for omitted XML elements and attributes</a> and examples in subsequent subsections below.</p>
<p>Default values must be primitive types, integer, float, string, etc. or pointers to primitive types. Default values can be specified for struct and class members, as shown in the example below:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__MyRecord </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> n = 5;           <span class="comment">// optional element with default value 5 </span></div><div class="line">    <span class="keywordtype">char</span> *name = <span class="stringliteral">&quot;none&quot;</span>; <span class="comment">// optional element with default value &quot;none&quot; </span></div><div class="line">  @ <span class="keyword">enum</span> ns__color { RED, WHITE, BLUE } color = RED; <span class="comment">// optional attribute with default value RED </span></div><div class="line">};</div></div><!-- fragment --><p>Upon deserialization of absent data, these members will be set accordingly. When classes are instantiated with <code>soap_new_ClassName</code> the instance will be initialized with default values.</p>
<p>See also <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> documentation for more details.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="occurrence"></a>
Occurrence constraints</h2>
<p>Occurrence constraints specify the minimum and/or maximum frequency or optionality of of attributes and elements.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="occurs"></a>
Elements with minOccurs and maxOccurs restrictions</h3>
<p>To force the validation of minOccurs and maxOccurs constraints the <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> input mode flag must be set. The minOccurs and maxOccurs constraints are specified for members of a struct and members of a class in a header file using the following syntax:</p>
<div class="fragment"><div class="line">Type membername <span class="keyword">nullptr</span> minOccurs : maxOccurs = value;</div></div><!-- fragment --><p>The <code>nullptr</code> is optional and indicates that the member is nillable (gSOAP version 2.8.24 or greater), which means that when NULL an empty element with <em><code>xsi:nil="true"</code></em> is added in the serialized XML.</p>
<p>The <code>minOccurs</code> and <code>maxOccurs</code> are optional values that must be integer literals. When <code>maxOccurs</code> is not specified then the colon can be omitted. When <code>minOccurs</code> is not specified it is assumed to be one (1) for non-pointer members that are elements and zero (0) for members that are pointers or are attributes (i.e. have a <code>@</code> qualifier).</p>
<p>A default initialization <code>value</code> may be provided and is optional.</p>
<p>A fixed initialization value can be specified with <code>==</code> (gSOAP version 2.8.48 or greater).</p>
<p>For example</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__MyRecord </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> n 0 = 5;      <span class="comment">// element with default value 5, minOccurs=0, maxOccurs=1</span></div><div class="line">    <span class="keywordtype">int</span> m;            <span class="comment">// element with minOccurs=1 </span></div><div class="line">    <span class="keywordtype">int</span> *k <span class="keyword">nullptr</span> 1; <span class="comment">// element with minOccurs=1 and nillable=true </span></div><div class="line">    <span class="keywordtype">int</span> v == 2;       <span class="comment">// element with minOccurs=1 and fixed value 2 </span></div><div class="line">    <span class="keywordtype">int</span> __size 0:10;  <span class="comment">// sequence &lt;item&gt; with minOccurs=0, maxOccurs=10</span></div><div class="line">    <span class="keywordtype">int</span> *item; </div><div class="line">    std::vector&lt;double&gt; nums 2; <span class="comment">// sequence &lt;nums&gt; with minOccurs=2, maxOccurs=unbounded </span></div><div class="line">}; </div><div class="line"></div><div class="line"><span class="keyword">struct </span>arrayOfint </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *__ptr 1:100; <span class="comment">// minOccurs=1, maxOccurs=100 </span></div><div class="line">    <span class="keywordtype">int</span> size; </div><div class="line">};</div></div><!-- fragment --><p>See also <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> documentation for more details.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="requiredandprohibited"></a>
Required and prohibited attributes</h3>
<p>Similar to the minOccurs and maxOccurs annotations defined in the previous section, attributes in a struct or class can be annotated with occurrence constraints to make them optional (0), required (1), or prohibited (0:0). Default values can be assigned to optional attributes.</p>
<p>For example</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__MyRecord </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">int</span> m 1;   <span class="comment">// required attribute (occurs at least once) </span></div><div class="line">  @ <span class="keywordtype">int</span> n = 5; <span class="comment">// optional attribute with default value 5</span></div><div class="line">  @ <span class="keywordtype">int</span> o 0;   <span class="comment">// optional attribute (may or may not occur) </span></div><div class="line">  @ <span class="keywordtype">int</span> p 0:0; <span class="comment">// prohibited attribute </span></div><div class="line">};</div></div><!-- fragment --><p>Remember to set the <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> input mode flag to enable the validation of attribute occurrence constraints.</p>
<p>See also <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> documentation for more details.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="valueconstraints"></a>
Value constraints</h2>
<p>Value constraints restrict the length of strings and the range of values of numeric types.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="lengthconstraints"></a>
Data length restrictions</h3>
<p>A schema simpleType is defined with a <code>typedef</code> by taking a base primitive to defined a derived simpleType. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">int</span> time__seconds;</div></div><!-- fragment --><p>This defines the following schema type in <em><code>time.xsd</code></em>:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;seconds&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:int&quot;</span>/&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div></div><!-- fragment --> </div><p>A complexType with simpleContent is defined with a wrapper struct/class:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>time__date </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *__item; <span class="comment">// some custom format date (restriction of string) </span></div><div class="line">  @ <span class="keyword">enum</span> time__zone { EST, GMT, ... } zone; </div><div class="line">}</div></div><!-- fragment --><p>This defines the following schema type in <em><code>time.xsd</code></em>:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;date&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">simpleContent</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">extension</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;/<span class="keywordtype">simpleContent</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;<span class="keywordtype">attribute</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;zone&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;time:zone&quot;</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;optional&quot;</span>/&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;/<span class="keywordtype">complexType</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;zone&quot;</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;EST&quot;</span>/&gt; </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;GMT&quot;</span>/&gt; </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    ... </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  &lt;/<span class="keywordtype">restriction</span>&gt; </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div></div><!-- fragment --> </div><p>Data value length constraints of simpleTypes and complexTypes with simpleContent are defined as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *ns__string256 0:256; <span class="comment">// simpleType restriction of string with max length 256 characters </span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *ns__string10 10:10; <span class="comment">// simpleType restriction of string with length of 10 characters </span></div><div class="line"><span class="keyword">typedef</span> std::string *ns__string8 8; <span class="comment">// simpleType restriction of string with at least 8 characters </span></div><div class="line"><span class="keyword">struct </span>ns__data <span class="comment">// simpleContent wrapper </span></div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *__item :256; <span class="comment">// simpleContent with at most 256 characters </span></div><div class="line">  @ <span class="keywordtype">char</span> *name 1;      <span class="comment">// required name attribute </span></div><div class="line">}; </div><div class="line"><span class="keyword">struct </span>time__date <span class="comment">// simpleContent wrapper </span></div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *__item :100; </div><div class="line">  @ <span class="keyword">enum</span> time__zone { EST, GMT, ... } zone = GMT; </div><div class="line">}</div></div><!-- fragment --><p>Set the <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> mode flag to enable the validation of value length constraints.</p>
<p>See also <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> documentation for more details.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="valuerangeconstraints"></a>
Value range restrictions</h3>
<p>Similar to data length constraints for string-based data, integer and floating point value range constraints on numeric simpleTypes and complexTypes with simpleContent are declared with <code>low : high</code>, where <code>low</code> and <code>high</code> are optional.</p>
<p>As of gSOAP 2.8.26, floating point value ranges and integer ranges can be exclusive by adding <code>&lt;</code> on either side of the <code>:</code> range operator:</p>
<table class="doxtable">
<tr>
<th>range </th><th>validation check  </th></tr>
<tr>
<td><code>1</code> </td><td>1 &lt;= x </td></tr>
<tr>
<td><code>1 :</code> </td><td>1 &lt;= x </td></tr>
<tr>
<td><code>: 10</code> </td><td>x &lt;= 10 </td></tr>
<tr>
<td><code>1 : 10</code> </td><td>1 &lt;= x &lt;= 10 </td></tr>
<tr>
<td><code>1 &lt; : &lt; 10</code> </td><td>1 &lt; x &lt; 10 </td></tr>
<tr>
<td><code>1 &lt; 10</code> </td><td>1 &lt; x &lt; 10 </td></tr>
<tr>
<td><code>1 : &lt; 10</code> </td><td>1 &lt;= x &lt; 10 </td></tr>
<tr>
<td><code>: &lt; 10</code> </td><td>x &lt; 10 </td></tr>
<tr>
<td><code>&lt; 10</code> </td><td>x &lt; 10 </td></tr>
<tr>
<td><code>1 &lt; :</code> </td><td>1 &lt; x </td></tr>
<tr>
<td><code>1 &lt;</code> </td><td>1 &lt; x </td></tr>
<tr>
<td><code>1 &lt; : 10</code> </td><td>1 &lt; x &lt;= 10 </td></tr>
</table>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">int</span> ns__int10 0:10; <span class="comment">// simpleType restriction of int 0..10 </span></div><div class="line"><span class="keyword">typedef</span> <a class="code" href="group__group__soap.html#ga78b36c5636eb5283d651b69d8684c6ae">LONG64</a> ns__long -1000000:1000000; <span class="comment">// simpleType restriction of long64 -1000000..1000000 </span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">float</span> ns__float -1.0 &lt;:&lt; 10.5; <span class="comment">// simpleType restriction of float in (-1,10.5) </span></div><div class="line"><span class="keyword">struct </span>ns__data <span class="comment">// simpleContent wrapper </span></div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> __item 0:10; <span class="comment">// simpleContent range 0..10 </span></div><div class="line">  @ <span class="keywordtype">char</span> *name 1;    <span class="comment">// required name attribute </span></div><div class="line">};</div></div><!-- fragment --><p>Set the <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> mode flag to enable the validation of value range constraints.</p>
<p>See also <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> documentation for more details.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="patternconstraints"></a>
Pattern restrictions</h3>
<p>Patterns can be defined for simpleType content. However, pattern validation is not enforced unless the <code><a class="el" href="group__group__callbacks.html#ga6a5e29b860d28f855c8d9a67c096d311" title="Callback to validate strings against XML regex patterns. ">soap::fsvalidate</a></code> and <code><a class="el" href="group__group__callbacks.html#ga1a38366b5b84730713c45ccada84e3ca" title="Callback to validate wide strings against XML regex patterns. ">soap::fwvalidate</a></code> callbacks are set to a regex matcher.</p>
<p>To associate a pattern with a simpleType, you can define a simpleType with a <code>typedef</code> and a pattern string:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">int</span> time__second <span class="stringliteral">&quot;[1-5]?[0-9]|60&quot;</span>;</div></div><!-- fragment --><p>This defines the following schema type in <em><code>time.xsd</code></em>:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;second&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:int&quot;</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">pattern</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;[1-5]?[0-9]|60&quot;</span>/&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;/<span class="keywordtype">restriction</span>&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div></div><!-- fragment --></div><div class="alt"></div><p> The pattern string must contain a valid regular expression.</p>
<p>A special case for C format string patterns is introduced in gSOAP 2.8.18. When <em><code>xsd:totalDigits</code></em> and <em><code>xsd:fractionDigits</code></em> are given in a XSD file, then a C format string is produced to output floating point values with the proper precision and scale. For example:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ratio&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:float&quot;</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">totalDigits</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;5&quot;</span>/&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">fractionDigits</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;2&quot;</span>/&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;/<span class="keywordtype">restriction</span>&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div></div><!-- fragment --> </div><p>produces:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">float</span> time__ratio <span class="stringliteral">&quot;%5.2f&quot;</span>;</div></div><!-- fragment --><p>The format string is used to format the output the floating point value in XML.</p>
<p>See also <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> documentation for more details.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="qualified"></a>
Element and attribute qualified/unqualified forms</h2>
<p>Struct, class, and union members represent elements and attributes that are automatically qualified or unqualified depending on the schema element and attribute default forms specified. The engine always validates the prefixes of elements and attributes. When a namespace mismatch occurs, the element or attribute is not consumed which can lead to a validation error (unless the complexType is extensible or when <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> is turned off).</p>
<p>Consider for example:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns schema elementForm: qualified </span></div><div class="line"><span class="comment">//gsoap ns schema attributeForm: unqualified </span></div><div class="line"><span class="keyword">struct </span>ns__record </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> * type; </div><div class="line">    <span class="keywordtype">char</span> * name; </div><div class="line">};</div></div><!-- fragment --><p>Here, the <code>ns__record</code> struct is serialized with qualified element <code>name</code> and unqualified attribute <code>type</code>:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:record</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;...&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">ns:name</span>&gt;...&lt;/<span class="keywordtype">ns:name</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">ns:record</span>&gt;</div></div><!-- fragment --> </div><p>The "colon notation" for struct/class/union member names is used to override element and attribute qualified or unqualified forms. To override the form for individual members that represent elements and attributes, use a namespace prefix and colon with the member name:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns schema elementForm: qualified </span></div><div class="line"><span class="comment">//gsoap ns schema attributeForm: unqualified </span></div><div class="line"><span class="keyword">struct </span>ns__record </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> * ns:type; </div><div class="line">    <span class="keywordtype">char</span> * :name; </div><div class="line">};</div></div><!-- fragment --><p>where <code>name</code> is unqualified and <code>type</code> is qualified:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">ns:record</span> <span class="keyword">ns:type</span>=<span class="stringliteral">&quot;...&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">name</span>&gt;...&lt;/<span class="keywordtype">name</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">ns:record</span>&gt;</div></div><!-- fragment --> </div><p>The colon notation is a syntactic notation used only in the interface header file syntax, it is not translated to the C/C++ output.</p>
<p>The colon notation does not avoid name clashes between members. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>x__record </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> * name; </div><div class="line">    <span class="keywordtype">char</span> * x:name; </div><div class="line">};</div></div><!-- fragment --><p>results in a redefinition error, since both members have the same name. To avoid name clashes, use a underscore suffix:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>x__record </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> * name; </div><div class="line">    <span class="keywordtype">char</span> * x:name_; </div><div class="line">};</div></div><!-- fragment --><p>Not that the namespace prefix convention can be used instead:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>x__record </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> * name; </div><div class="line">    <span class="keywordtype">char</span> * x__name; </div><div class="line">};</div></div><!-- fragment --><p>which avoids the name clash. However, the resulting schema is different since the last example generates a global <code>name</code> element definition that is referenced by the local element.</p>
<p>More specifically, the difference between the namespace prefix convention with double underscores and colon notation is that the namespace prefix convention generates schema element/attribute references to elements/attributes at the top level, while the colon notation only affects the local element/attribute namespace qualification by form overriding. This is best illustrated by an example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>x__record </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> * :name; </div><div class="line">    <span class="keywordtype">char</span> * x:phone; </div><div class="line">    <span class="keywordtype">char</span> * x__fax; </div><div class="line">    <span class="keywordtype">char</span> * y__zip; </div><div class="line">};</div></div><!-- fragment --><p>which generates the following <em><code>x.xsd</code></em>schema:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;record&quot;</span>&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">sequence</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;name&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">nillable</span>=<span class="stringliteral">&quot;true&quot;</span> <span class="keyword">form</span>=<span class="stringliteral">&quot;unqualified&quot;</span>/&gt; </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;phone&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">nillable</span>=<span class="stringliteral">&quot;true&quot;</span> <span class="keyword">form</span>=<span class="stringliteral">&quot;qualified&quot;</span>/&gt; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;x:fax&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;<span class="keywordtype">element</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;y:zip&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;/<span class="keywordtype">sequence</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;/<span class="keywordtype">complexType</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;fax&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div></div><!-- fragment --> </div><p>and the <em><code>y.xsd</code></em> schema defines contains:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;zip&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div></div><!-- fragment --> </div><p>See also <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> documentation for more details.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="nstable"></a>
XML namespaces and the namespace mapping table</h1>
<p>A namespace mapping table should be included in the source code of client and service applications. The mapping table is used by the serializers and deserializers of the stub and skeleton functions to produce valid XML messages and to parse and validate XML messages. A typical mapping table is shown below:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  <span class="comment">// { &quot;prefix&quot;, &quot;URI&quot;, &quot;URI-pattern&quot; (optional) } </span></div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> }, <span class="comment">// must be first </span></div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> }, <span class="comment">// must be second </span></div><div class="line">  { <span class="stringliteral">&quot;xsi&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> }, <span class="comment">// must be third </span></div><div class="line">  { <span class="stringliteral">&quot;xsd&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> },          <span class="comment">// must be fourth</span></div><div class="line">  { <span class="stringliteral">&quot;ns&quot;</span>,       <span class="stringliteral">&quot;urn:my-service-URI&quot;</span> }, <span class="comment">// binds &quot;ns&quot; namespace prefix to schema URI</span></div><div class="line">  { NULL, NULL } <span class="comment">// end of table </span></div><div class="line">}; </div></div><!-- fragment --><p>Each namespace prefix used by a identifier name in the header file specification, see Section <a class="el" href="index.html#idtrans">C/C++ identifier name to XML tag name translation</a>, must have a binding to a namespace URI in the mapping table. The end of the namespace mapping table must be indicated by the NULL pair. The namespace URI matching is case insensitive. A namespace prefix is distinguished by the occurrence of a pair of underscores (<code>__</code>) in an identifier or by using colon notation, see Section <a class="el" href="index.html#idtrans">C/C++ identifier name to XML tag name translation</a>.</p>
<p>An optional third column in the namespace mapping table may be specified that contains a namespace URI pattern. The patterns provide an alternative namespace for the validation of parsed XML messages. In this pattern, dashes (<code>-</code>) are single-character wildcards and asterisks (<code>*</code>) are multi-character wildcards. For example, to accept alternative versions of XML schemas with different authoring dates, four dashes can be used in place of the specific dates in the namespace mapping table pattern:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  <span class="comment">// { &quot;prefix&quot;, &quot;URI&quot;, &quot;URI-pattern&quot; (optional) } </span></div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> }, <span class="comment">// must be first </span></div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> }, <span class="comment">// must be second </span></div><div class="line">  { <span class="stringliteral">&quot;xsi&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/----/XMLSchema-instance&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsd&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/----/XMLSchema&quot;</span> }, </div><div class="line">  ... <span class="comment">//</span></div><div class="line">  { NULL, NULL } <span class="comment">// end of table </span></div><div class="line">};</div></div><!-- fragment --><p>Or alternatively, asterisks can be used as wildcards for multiple characters:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  <span class="comment">// { &quot;prefix&quot;, &quot;URI&quot;, &quot;URI-pattern&quot; (optional) } </span></div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> }, <span class="comment">// must be first </span></div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> }, <span class="comment">// must be second </span></div><div class="line">  { <span class="stringliteral">&quot;xsi&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>, <span class="stringliteral">&quot;http://www.w3.org/*/XMLSchema-instance&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsd&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>,          <span class="stringliteral">&quot;http://www.w3.org/*/XMLSchema&quot;</span> }, </div><div class="line">  ... <span class="comment">//</span></div><div class="line">  { NULL, NULL} <span class="comment">// end of table </span></div><div class="line">};</div></div><!-- fragment --><p>A namespace mapping table is automatically generated with prefixes and URIs in the table that are declared with <code>//gsoap &lt;prefix&gt; schema namespace:</code> directives in the interface header file, see Section <a class="el" href="index.html#directives">Directives</a>. If directives are not provided in the header file then default URIs of the form <em><code><a href="http://tempuri.org/prefix.xsd">http://tempuri.org/prefix.xsd</a></code></em> for each namespace <em><code>prefix</code></em>. The soapcpp2 tool also generates a WSDL and one or more XSD files, one for each XML namespace.</p>
<p>When parsing XML and deserializing data, namespace URIs in the XML messages are matched against the second and third column of the namespace mapping table, searching from the top to the bottom of the table. The actual prefix used in the XML message is irrelevant as the URI associated with the prefix is relevant to define the XML namespace to which a qualified element or attribute belongs. When a match is found, the namespace prefix in the first column of the table is considered semantically identical to the namespace prefix used by the qualified XML element and attribute parsed, even when the prefix names differ. This normalization of prefixes is invisible to the user of gSOAP and makes coding with XML easier. For example, when XSD QNames are parsed into strings using the built-in soapcpp2 <code>_QName</code> type or a QName declared with <code>typedef std::string xsd__QName</code>, then this QName string will always contain qualified names with normalized prefixes, i.e. prefixes defined in the namespace mapping table, unless the table has no entry, see Section <a class="el" href="index.html#qname">How to use QName attributes and elements</a>.</p>
<p>For example, let's say we have the following structs:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>a__elt { ... }; </div><div class="line"><span class="keyword">struct </span>b__elt { ... }; </div><div class="line"><span class="keyword">struct </span>k__elt { ... }; </div></div><!-- fragment --><p>The namespace mapping table generated by soapcpp2 has the following entries:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  <span class="comment">// { &quot;prefix&quot;, &quot;URI&quot;, &quot;URI-pattern&quot; (optional) } </span></div><div class="line">  ... <span class="comment">// the four SOAP and XSD namespace bindings</span></div><div class="line">  { <span class="stringliteral">&quot;a&quot;</span>, <span class="stringliteral">&quot;http://tempuri.org/a.xsd&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;b&quot;</span>, <span class="stringliteral">&quot;http://tempuri.org/b.xsd&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;c&quot;</span>, <span class="stringliteral">&quot;http://tempuri.org/c.xsd&quot;</span> }, </div><div class="line">  ... <span class="comment">//</span></div><div class="line">  { NULL, NULL }</div><div class="line">};</div></div><!-- fragment --><p>Then, the following XML elements will match these structs:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">x:elt</span> <span class="keyword">xmlns:x</span>=<span class="stringliteral">&quot;http://tempuri.org/a.xsd&quot;</span>&gt;...&lt;/<span class="keywordtype">x:elt</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;<span class="keywordtype">elt</span> <span class="keyword">xmlns</span>=<span class="stringliteral">&quot;http://tempuri.org/b.xsd&quot;</span>&gt;...&lt;/<span class="keywordtype">elt</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;<span class="keywordtype">zzz:elt</span> <span class="keyword">xmlns:zzz</span>=<span class="keyword">http:</span>//<span class="keyword">tempuri.org</span>/<span class="keyword">c.xsd</span>&quot;&gt;...&lt;/<span class="keywordtype">zzz:elt</span>&gt;</div></div><!-- fragment --> </div><p>Instead of one big namespace table that contains all XML namespace prefixes with their URIs, there are cases when it is desirable to use multiple namespace tables, one for each service. This avoids leaking namespace prefixes in XML messages that have nothing to do with the service invoked. In principle there is no harm to leak these namespace prefixes, but the messages are less compact and not as clean. To use multiple namespace tables at the client side is done as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespacesTable1[] = { ... }; </div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespacesTable2[] = { ... }; </div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespacesTable3[] = { ... }; </div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> *<a class="code" href="group__group__namespace.html#gaabfac0a3b8d38498bc5e1e3bc465ead6">namespaces</a>; </div><div class="line">... <span class="comment">//</span></div><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line"><a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, namespaceTable1); <span class="comment">// use the first namespace table</span></div><div class="line"><span class="keywordflow">if</span> (soap_call_remote_method(soap, <a class="code" href="structsoap.html#aed1b86b8a34aea86103751a932c9dce9">endpoint</a>, Action, ...))</div><div class="line">  ... <span class="comment">// error</span></div></div><!-- fragment --><p>Likewise, on the server side call <code><a class="el" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5" title="Activates an XML namespace table to generate and resolve xmlns namespace prefixes in XML messages...">soap_set_namespaces</a></code> before calling <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code>. Changing the namespaces table in service operations has no effect.</p>
<p>The XML messages produced by the gSOAP engine include all <em><code>xmlsn</code></em> namespace bindings in the root element, which is generally more efficient for larger XML documents in which otherwise the <em><code>xmlsn</code></em> namespace bindings will be sprinkled throughout. By contrast, canonical XML requires <em><code>xmlsn</code></em> namespace bindings only to be included when utilized. Therefore, the <code><a class="el" href="group__group__flags.html#ga757fa32433be64f8c228b1ecce727815" title="soap_mode XML output flag value to send XML messages in exclusive canonical format as per W3C XML C14...">SOAP_XML_CANONICAL</a></code> context flag produces C14N exclusive XML messages and documents, which eliminates unused <em><code>xmlsn</code></em> namespace bindings from XML. Unfortunately, the current C14N standard is buggy with respect to XSD QName content, because prefixes used in QName content are not considered utilized. The gSOAP engine considers QName content prefixes utilized and therefore produces corrected canonicalized XML output that prevents the loss of namespace information for QNames.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="header"></a>
SOAP Header processing</h1>
<p>A built-in SOAP Header data structure <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> is generated by the soapcpp2 tool for exchanging SOAP headers in SOAP messages. This structure is empty unless headers are added by plugins and headers specified by WSDL specifications (i.e. wsdl2h adds SOAP Headers).</p>
<p>You can create your own SOAP Header struct simply by declaring it in an interface header file for soapcpp2 and by adding members that must be qualified with namespace prefixes to conform to the SOAP Header processing requirements that SOAP Header elements must be namespace qualified.</p>
<p>For example, assume that transaction data should be piggy-backed with SOAP messages in SOAP Header:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>t__transaction</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> number;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *dscription;</div><div class="line">};</div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____header.html">SOAP_ENV__Header</a> </div><div class="line">{</div><div class="line">    mustUnderstand <span class="keyword">struct </span>t__transaction *t__transaction; </div><div class="line">};</div><div class="line"><span class="comment">//gsoap ns service method-input-header-part: webmethod t__transaction</span></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(...);</div></div><!-- fragment --><p>The <code>mustUnderstand</code> qualifier specifies that the element must be processed by the SOAP processor and cannot be ignored if the processor has no logic in place for this SOAP header, which is done by adding a <em><code>SOAP-ENV:mustUnderstand="true"</code></em> attribute to the <em><code>t:transaction</code></em> element. The soapcpp2-generated serializers obey this safety principle.</p>
<p>This declares a service operation that sends messages with an input SOAP header <code>t__transaction</code>, as can be seen in the generated WSDL binding:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">binding</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Service&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;tns:ServicePortType&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">SOAP:binding</span> <span class="keyword">style</span>=<span class="stringliteral">&quot;document&quot;</span> <span class="keyword">transport</span>=<span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/http&quot;</span>/&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;<span class="keywordtype">operation</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;webmethod&quot;</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">SOAP:operation</span> <span class="keyword">soapAction</span>=<span class="stringliteral">&quot;&quot;</span>/&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;<span class="keywordtype">input</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;          &lt;<span class="keywordtype">SOAP:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span> <span class="keyword">parts</span>=<span class="stringliteral">&quot;Body&quot;</span>/&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;          &lt;<span class="keywordtype">SOAP:header</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span> <span class="keyword">message</span>=<span class="stringliteral">&quot;tns:ServiceHeader&quot;</span> <span class="keyword">part</span>=<span class="stringliteral">&quot;transaction&quot;</span>/&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">output</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;          &lt;<span class="keywordtype">SOAP:body</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;literal&quot;</span> <span class="keyword">parts</span>=<span class="stringliteral">&quot;Body&quot;</span>/&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  &lt;/<span class="keywordtype">operation</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;/<span class="keywordtype">binding</span>&gt;</div></div><!-- fragment --> </div><p>Likewise, you can specify that both input and output messages have the same header with <code>//gsoap ns service method-header-part:</code> or the output message has a header with <code>//gsoap ns service method-output-header-part:</code>. Multiple headers can be specified this way.</p>
<p>To set up a SOAP Header at the client side that contains the <code>t__transaction</code> member:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">... <span class="comment">//</span></div><div class="line">soap.<a class="code" href="structsoap.html#ac091dfe4e01b6a082d916c381e7006ba">header</a> = NULL; <span class="comment">// erase any SOAP Header we have so far</span></div><div class="line"><a class="code" href="group__group__header.html#ga08d35d1900a1982fdde6f78e43fc9635">soap_header</a>(soap);  <span class="comment">// allocate and initialize a new SOAP Header</span></div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac091dfe4e01b6a082d916c381e7006ba">header</a>-&gt;t__transaction = soap_new_t__transaction(soap, -1);</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac091dfe4e01b6a082d916c381e7006ba">header</a>-&gt;t__transaction-&gt;number = num;</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac091dfe4e01b6a082d916c381e7006ba">header</a>-&gt;t__transaction-&gt;description = <span class="stringliteral">&quot;Transactional data&quot;</span>;</div><div class="line"><span class="keywordflow">if</span> (soap_call_webmethod(soap, <a class="code" href="structsoap.html#aed1b86b8a34aea86103751a932c9dce9">endpoint</a>, NULL, ...))</div><div class="line">  ... <span class="comment">// error</span></div></div><!-- fragment --><p>The SOAP Web service request includes the SOAP Header with the transaction data:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Envelope</span> ...&gt; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Header</span>&gt; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">t:transaction</span> <span class="keyword">SOAP-ENV:mustUnderstand</span>=<span class="stringliteral">&quot;true&quot;</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &lt;<span class="keywordtype">number</span>&gt;12345&lt;/<span class="keywordtype">number</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &lt;<span class="keywordtype">description</span>&gt;<span class="keyword">Transactional</span> <span class="keyword">data</span>&lt;/<span class="keywordtype">description</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;/<span class="keywordtype">t:transaction</span>&gt; </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Header</span>&gt; </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">ns:webmethod</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      ...</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &lt;/<span class="keywordtype">ns:webmethod</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Body</span>&gt; </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Envelope</span>&gt;</div></div><!-- fragment --> </div><p>At the receiving side, a SOAP Header can be inspected by checking for a non-NULL <code><a class="el" href="structsoap.html#ac091dfe4e01b6a082d916c381e7006ba" title="The soap::header points to a SOAP_ENV__Header structure with the SOAP Header that was received or tha...">soap::header</a></code>.</p>
<dl class="section warning"><dt>Warning</dt><dd>When SOAP Headers are used, you must make sure to set <code><a class="el" href="structsoap.html#ac091dfe4e01b6a082d916c381e7006ba" title="The soap::header points to a SOAP_ENV__Header structure with the SOAP Header that was received or tha...">soap::header</a></code> to NULL when no SOAP Header should be sent, otherwise any SOAP Headers currently present in the <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> struct pointed to by <code><a class="el" href="structsoap.html#ac091dfe4e01b6a082d916c381e7006ba" title="The soap::header points to a SOAP_ENV__Header structure with the SOAP Header that was received or tha...">soap::header</a></code> will be included in the message.</dd></dl>
<p>At the client side, the <code><a class="el" href="structsoap.html#abda4ccd0d64f76eb57145cc4890c87b2" title="User-definable SOAP-ENV:actor (SOAP 1.1) or SOAP-ENV:role (SOAP 1.2) attribute value of all SOAP-ENV:...">soap::actor</a></code> string variable can be set to set the SOAP <em><code>SOAP-ENV:actor</code></em> attribute. The <em><code>SOAP-ENV:mustUnderstand="true"</code></em> attribute then indicates the requirement that the recipient corresponding to the <em><code>SOAP-ENV:actor</code></em> attribute value is responsible to process the SOAP Header element. The details of which can be found in the SOAP 1.1/1.2 specifications that the gSOAP tools conform to.</p>
<p>The SOAP Header structure <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> is declared <code>mutable</code>, which means that re-declarations of the structures are permitted and additional members are collected into one final structure by the soapcpp2 tool.</p>
<p>For another example, consider:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____header.html">SOAP_ENV__Header</a> </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *h__transaction; </div><div class="line">    <span class="keyword">struct </span>UserAuth *h__authentication; </div><div class="line">};</div></div><!-- fragment --><p>Suppose method <code>ns__login</code> uses both header parts (at most), then this is declared as:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service method-header-part: login h__transaction </span></div><div class="line"><span class="comment">//gsoap ns service method-header-part: login h__authentication </span></div><div class="line"><span class="keywordtype">int</span> ns__login(...);</div></div><!-- fragment --><p>Suppose method <code>ns__search</code> uses only the first header part, then this is declared as:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service method-header-part: search h__transaction </span></div><div class="line"><span class="keywordtype">int</span> ns__search(...);</div></div><!-- fragment --><p>Note that the method name and header part names must be namespace qualified. The headers must be present in all operations that declared the header parts.</p>
<p>To specify the header parts for the method input (method request message), use:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap namespace-prefix service method-input-header-part: method-name header-part</span></div></div><!-- fragment --><p>Similarly, to specify the header parts for the method output (method response message), use:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap namespace-prefix service method-output-header-part: method-name header-part</span></div></div><!-- fragment --><p>The declarations only affect the WSDL. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____header.html">SOAP_ENV__Header</a> </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *h__transaction; </div><div class="line">    <span class="keyword">struct </span>UserAuth *h__authentication; </div><div class="line">}; </div><div class="line"><span class="comment">//gsoap ns service method-input-header-part: login h__authentication </span></div><div class="line"><span class="comment">//gsoap ns service method-input-header-part: login h__transaction </span></div><div class="line"><span class="comment">//gsoap ns service method-output-header-part: login h__transaction </span></div><div class="line"><span class="keywordtype">int</span> ns__login(...);</div></div><!-- fragment --><p>The headers must be present in all operations that declared the header parts.</p>
<p>See also API documentation Module <a class="el" href="group__group__header.html">Header structure and functions</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="fault"></a>
SOAP Fault processing</h1>
<p>A built-in SOAP Fault data structure <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html" title="SOAP Fault structure. ">SOAP_ENV__Fault</a></code> is generated by the soapcpp2 tool for exchanging exception messages. This structure has the general form:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____fault.html">SOAP_ENV__Fault</a> </div><div class="line">{</div><div class="line">    <a class="code" href="group__group__fault.html#gaa178a46d0cf703ff226a5c148483286d">_QName</a> <a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#ad800dbd32b302cc9e096e6c311df29de">faultcode</a>; <span class="comment">// _QName is built-in </span></div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#ac08b3725c7c6b2e9c636995e82876a9a">faultstring</a>; </div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#ae4c53ce0884ec757d48c1f62a516edce">faultactor</a>; </div><div class="line">    <span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____detail.html">SOAP_ENV__Detail</a> *<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#af49c2a1926ebf4c865ddd444960b9adb">detail</a>; </div><div class="line">    <span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____code.html">SOAP_ENV__Code</a> *<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#acec1784f16ffd14a69a92b92f0ddd15f">SOAP_ENV__Code</a>; <span class="comment">// must be a SOAP_ENV__Code struct defined below </span></div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#a921e9d8c41d62f32ab6d4d39a2e71bc9">SOAP_ENV__Reason</a>; </div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#a07e508b520e8a1e2c8ba20acf1c2ddd9">SOAP_ENV__Node</a>; </div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#a9048c64196658de472d57fb42fae5daa">SOAP_ENV__Role</a>; </div><div class="line">    <span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____detail.html">SOAP_ENV__Detail</a> *<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#a560e6fd07a6b2f51cef97aa12282c870">SOAP_ENV__Detail</a>; <span class="comment">// SOAP 1.2 detail member </span></div><div class="line">}; </div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____code.html">SOAP_ENV__Code</a> </div><div class="line">{</div><div class="line">    <a class="code" href="group__group__fault.html#gaa178a46d0cf703ff226a5c148483286d">_QName</a> SOAP_ENV__Value; </div><div class="line">    <span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____code.html">SOAP_ENV__Code</a> *<a class="code" href="struct_s_o_a_p___e_n_v_____code.html#a2d44ac860b79956cff26131fa68b4c5a">SOAP_ENV__Subcode</a>; </div><div class="line">}; </div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____detail.html">SOAP_ENV__Detail</a> </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> __type;  <span class="comment">// The SOAP_TYPE_ of the object serialized as Fault detail </span></div><div class="line">    <span class="keywordtype">void</span> *fault; <span class="comment">// pointer to the fault object, or NULL </span></div><div class="line">    <a class="code" href="group__group__fault.html#ga5c62d26b4823b76c5b4ef29e7865d3f0">_XML</a> __any;  <span class="comment">// any other detail element content (stored in XML format) </span></div><div class="line">};</div></div><!-- fragment --><p>The first four members in <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html" title="SOAP Fault structure. ">SOAP_ENV__Fault</a></code> are SOAP 1.1 specific. The last five members are SOAP 1.2 specific. You can redefine these structures in the interface header file for soapcpp2. For example, you can use a <code>class</code> for the <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html" title="SOAP Fault structure. ">SOAP_ENV__Fault</a></code> and add methods for convenience.</p>
<p>The <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code> structure can be changed to the needs of Web service application to communicate specific fault data structures, but this is generally not necessary because the application-specific SOAP Fault details can be serialized via the <code>__type</code> and <code>fault</code> members in the <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code> member, see Section <a class="el" href="index.html#void">Void pointer serialization</a> on the serialization of data referred to by <code>__type</code> and <code>fault</code>.</p>
<p>When a user-define service operation function returns an error with <code><a class="el" href="group__group__fault.html#gac20c8569833053318196d898fe2566af" title="Set SOAP 1.1 client fault / SOAP 1.2 sender fault string and detail. ">soap_sender_fault</a></code> or <code><a class="el" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6" title="Set SOAP 1.1 server fault / SOAP 1.2 receiver fault string and detail. ">soap_receiver_fault</a></code>, then the SOAP Fault structure is populated and <code><a class="el" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0" title="The soap::fault points to a SOAP_ENV__Fault structure with the SOAP Fault that was received or that c...">soap::fault</a></code> points to this SOAP Fault. The SOAP Fault is sent to the client. The client populates a SOAP Fault structure that contains the SOAP Fault message with details.</p>
<p>Server-side faults are raised with <code><a class="el" href="group__group__fault.html#gac20c8569833053318196d898fe2566af" title="Set SOAP 1.1 client fault / SOAP 1.2 sender fault string and detail. ">soap_sender_fault</a></code> or <code><a class="el" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6" title="Set SOAP 1.1 server fault / SOAP 1.2 receiver fault string and detail. ">soap_receiver_fault</a></code>. The <code><a class="el" href="group__group__fault.html#gac20c8569833053318196d898fe2566af" title="Set SOAP 1.1 client fault / SOAP 1.2 sender fault string and detail. ">soap_sender_fault</a></code> call should be used to inform that the sender is at fault and the sender (client) should not re-send the request. The <code><a class="el" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6" title="Set SOAP 1.1 server fault / SOAP 1.2 receiver fault string and detail. ">soap_receiver_fault</a></code> call should be used to indicate a temporary server-side problem, so a sender (client) can re-send the request later. For example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns1__myMethod(<span class="keyword">struct</span> soap *soap, ...) </div><div class="line">{</div><div class="line">  ... <span class="comment">//</span></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6">soap_receiver_fault</a>(soap, <span class="stringliteral">&quot;Resource temporarily unavailable&quot;</span>, NULL); <span class="comment">// return fault to sender </span></div><div class="line">}</div></div><!-- fragment --><p>In the example, the SOAP Fault details were empty (NULL). You may pass an XML fragment, which will be literally included in the SOAP Fault message. For WS-I Basic Profile compliance, you must pass an XML string with one or more namespace qualified elements, such as:</p>
<div class="fragment"><div class="line"><span class="keywordflow">return</span> <a class="code" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6">soap_receiver_fault</a>(soap, <span class="stringliteral">&quot;Resource temporarily unavailable&quot;</span>, <span class="stringliteral">&quot;&lt;errorcode xmlns=&#39;http://tempuri.org&#39;&gt;123&lt;/errorcode&gt;&lt;errorinfo xmlns=&#39;http://tempuri.org&#39;&gt;abc&lt;/errorinfo&gt;&quot;</span>);</div></div><!-- fragment --><p>When a service operation needs to populate SOAP Fault details with a application-specific data, it does so by assigning the <code><a class="el" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0" title="The soap::fault points to a SOAP_ENV__Fault structure with the SOAP Fault that was received or that c...">soap::fault</a></code> member of the current reference to the context with appropriate data associated with the exception and by returning the error <code><a class="el" href="group__group__errors.html#gaf27d1f10130e4da080975711a7192f07" title="A soap_status error code: the fault code to be returned by a service operation when calling soap_send...">SOAP_FAULT</a></code>. For example:</p>
<div class="fragment"><div class="line"><a class="code" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6">soap_receiver_fault</a>(soap, <span class="stringliteral">&quot;Error message&quot;</span>, NULL); </div><div class="line"><span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a39daa19f039aebc76b8c4b6bf933570a">version</a> == 2) <span class="comment">// SOAP 1.2 is used </span></div><div class="line">{</div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0">fault</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#a560e6fd07a6b2f51cef97aa12282c870">SOAP_ENV__Detail</a> = soap_new_SOAP_ENV__Detail(soap, -1);</div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0">fault</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#a560e6fd07a6b2f51cef97aa12282c870">SOAP_ENV__Detail</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____detail.html#ae21be5af0f3f6dc47f2dbf4e35e22300">__type</a> = SOAP_TYPE_ns1__myStackDataType; <span class="comment">// stack type </span></div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0">fault</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#a560e6fd07a6b2f51cef97aa12282c870">SOAP_ENV__Detail</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____detail.html#a159d344759c06f82eae1949aea10a1cf">fault</a> = sp;                              <span class="comment">// point to stack </span></div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0">fault</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#a560e6fd07a6b2f51cef97aa12282c870">SOAP_ENV__Detail</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____detail.html#a261e42921673a28bd085a47d4ed65ce6">__any</a> = NULL;                            <span class="comment">// no other XML data </span></div><div class="line">} </div><div class="line"><span class="keywordflow">else</span> </div><div class="line">{</div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0">fault</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#af49c2a1926ebf4c865ddd444960b9adb">detail</a> = soap_new_SOAP_ENV__Detail(soap, -1); </div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0">fault</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#af49c2a1926ebf4c865ddd444960b9adb">detail</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____detail.html#ae21be5af0f3f6dc47f2dbf4e35e22300">__type</a> = SOAP_TYPE_ns1__myStackDataType; <span class="comment">// stack type </span></div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0">fault</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#af49c2a1926ebf4c865ddd444960b9adb">detail</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____detail.html#a159d344759c06f82eae1949aea10a1cf">fault</a> = sp;                              <span class="comment">// point to stack </span></div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0">fault</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#af49c2a1926ebf4c865ddd444960b9adb">detail</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____detail.html#a261e42921673a28bd085a47d4ed65ce6">__any</a> = NULL;                            <span class="comment">// no other XML data </span></div><div class="line">} </div><div class="line"><span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#gaf27d1f10130e4da080975711a7192f07">SOAP_FAULT</a>; <span class="comment">// return from service operation call with the fault</span></div></div><!-- fragment --><p>Here, <code><a class="el" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6" title="Set SOAP 1.1 server fault / SOAP 1.2 receiver fault string and detail. ">soap_receiver_fault</a></code> allocates a fault struct then we set the SOAP Fault details as shown.</p>
<p>Note that SOAP 1.2 supports nested fault sub-codes. These can be set as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____code.html">SOAP_ENV__Code</a> *subcode1 = soap_new_SOAP_ENV__Code(soap);</div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____code.html">SOAP_ENV__Code</a> *subcode2 = soap_new_SOAP_ENV__Code(soap);</div><div class="line"><a class="code" href="group__group__fault.html#gac20c8569833053318196d898fe2566af">soap_sender_fault</a>(soap, <span class="stringliteral">&quot;The requested profile token ProfileToken does not exist.&quot;</span>, NULL); </div><div class="line">subcode1-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____code.html#a6285b1ed8b2cadc318d730f9715b2958">SOAP_ENV__Value</a> = (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;ter:InvalidArgs&quot;</span>; <span class="comment">// a QName value</span></div><div class="line">subcode1-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____code.html#a2d44ac860b79956cff26131fa68b4c5a">SOAP_ENV__Subcode</a> = subcode2;</div><div class="line">subcode2-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____code.html#a6285b1ed8b2cadc318d730f9715b2958">SOAP_ENV__Value</a> = (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;ter:NoProfile&quot;</span>; <span class="comment">// a QName value</span></div><div class="line">subcode2-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____code.html#a2d44ac860b79956cff26131fa68b4c5a">SOAP_ENV__Subcode</a> = NULL;</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a920e2840ab2c816378059022dcfd96e0">fault</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____fault.html#acec1784f16ffd14a69a92b92f0ddd15f">SOAP_ENV__Code</a>-&gt;<a class="code" href="struct_s_o_a_p___e_n_v_____code.html#a2d44ac860b79956cff26131fa68b4c5a">SOAP_ENV__Subcode</a> = subcode1;</div><div class="line"><span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#gaf27d1f10130e4da080975711a7192f07">SOAP_FAULT</a>;</div></div><!-- fragment --><p>This produces:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">SOAP-ENV:Fault</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Code</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">SOAP-ENV:Value</span>&gt;<span class="keyword">SOAP-ENV:Sender</span>&lt;/<span class="keywordtype">SOAP-ENV:Value</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;<span class="keywordtype">SOAP-ENV:Subcode</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &lt;<span class="keywordtype">SOAP-ENV:Value</span>&gt;<span class="keyword">ter:InvalidArgs</span>&lt;/<span class="keywordtype">SOAP-ENV:Value</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;      &lt;<span class="keywordtype">SOAP-ENV:Subcode</span>&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        &lt;<span class="keywordtype">SOAP-ENV:Value</span>&gt;<span class="keyword">ter:NoProfile</span> &lt;/<span class="keywordtype">SOAP-ENV:Value</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &lt;/<span class="keywordtype">SOAP-ENV:Subcode</span>&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;/<span class="keywordtype">SOAP-ENV:Subcode</span>&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Code</span>&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  &lt;<span class="keywordtype">SOAP-ENV:Reason</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &lt;<span class="keywordtype">SOAP-ENV:Text</span> <span class="keyword">xml:lang</span>=<span class="stringliteral">&quot;en&quot;</span>&gt;<span class="keyword">The</span> <span class="keyword">requested</span> <span class="keyword">profile</span> <span class="keyword">token</span> <span class="keyword">ProfileToken</span> <span class="keyword">does</span> <span class="keyword">not</span> <span class="keyword">exist.</span>&lt;/<span class="keywordtype">SOAP-ENV:Text</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  &lt;/<span class="keywordtype">SOAP-ENV:Reason</span>&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&lt;/<span class="keywordtype">SOAP-ENV:Fault</span>&gt;</div></div><!-- fragment --> </div><p>Service operations implementation in a Web service application can return various SOAP Faults customized in this way.</p>
<p>SOAP Fault structures are declared <code>mutable</code>, which means that re-declarations of the structures are permitted and additional members are collected into one final structure by the soapcpp2 tool.</p>
<p>For an example that used the SOAP Fault detail structure:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____detail.html">SOAP_ENV__Detail</a> </div><div class="line">{</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *f__invalid;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *f__unavailable;</div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="struct_s_o_a_p___e_n_v_____detail.html#ae21be5af0f3f6dc47f2dbf4e35e22300">__type</a>;</div><div class="line">    <span class="keywordtype">void</span> *<a class="code" href="struct_s_o_a_p___e_n_v_____detail.html#a159d344759c06f82eae1949aea10a1cf">fault</a>;</div><div class="line">    <a class="code" href="group__group__fault.html#ga5c62d26b4823b76c5b4ef29e7865d3f0">_XML</a> <a class="code" href="struct_s_o_a_p___e_n_v_____detail.html#a261e42921673a28bd085a47d4ed65ce6">__any</a>;</div><div class="line">}; </div><div class="line"><span class="comment">//gsoap ns service method-fault: login f__invalid </span></div><div class="line"><span class="comment">//gsoap ns service method-fault: login f__unavailable </span></div><div class="line"><span class="keywordtype">int</span> ns__login(...);</div></div><!-- fragment --><p>See also API documentation Module <a class="el" href="group__group__fault.html">Fault structure and functions</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="MIME"></a>
MIME attachments</h1>
<p>The gSOAP toolkit supports MIME attachments as per SOAP with Attachments (SwA) specification <a href="http://www.w3.org/TR/SOAP-attachments">http://www.w3.org/TR/SOAP-attachments</a>.</p>
<p>MTOM attachments that are essentially MIME attachments that conform to the MTOM specification <a href="http://www.w3.org/TR/soap12-mtom">http://www.w3.org/TR/soap12-mtom</a> are also supported which are the preferred way to include MIME attachments with SOAP messages, see Section <a class="el" href="index.html#MTOM">MTOM attachments</a>.</p>
<p>In the following discussion, MIME attachment data is assumed to be resident in memory for sending operations and MIME attachments received will be stored in memory managed by the context. MTOM and DIME attachments on the other hand can be streamed and therefore MTOM/DIME attachment data does not need to be stored in memory, see Sections <a class="el" href="index.html#DIME">DIME attachments</a> and <a class="el" href="index.html#MTOM">MTOM attachments</a> .</p>
<p>Transmitting multipart/related MIME attachments with a SOAP/XML message is accomplished with two functions, <code><a class="el" href="group__group__mime.html#ga9180e5ba634b20305b755b410045d9ee" title="Enable MIME attachments. ">soap_set_mime</a></code> and <code><a class="el" href="group__group__mime.html#ga39e5da4f375e8030b8cbddaf0a2a8e6e" title="Add a MIME attachment to the SOAP/XML message. ">soap_set_mime_attachment</a></code>. The first function is for initialization purposes and the latter function is used to specify meta data and content data for each attachment.</p>
<p>See also API documentation Module <a class="el" href="group__group__mime.html">MIME attachment functions</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="SWAsending"></a>
Sending a collection of MIME attachments (SwA)</h2>
<p>The following functions are used to set up a collection of multipart/related MIME attachments for transmission with a SOAP or XML message.</p>
<ul>
<li><code>void <a class="el" href="group__group__mime.html#ga9180e5ba634b20305b755b410045d9ee" title="Enable MIME attachments. ">soap_set_mime(struct soap *soap, const char *boundary, const char *start)</a></code> This function enables sending MIME attachments. This function is generally not required when the context is initialized with <code><a class="el" href="group__group__flags.html#ga988c0f4d52bf6f5cdac8c0e197ebe62a" title="soap_mode ENC output flag value to enable MIME attachments in messages to be sent, receiving is automatic ">SOAP_ENC_MIME</a></code>, because MIME attachments are automatically detected as <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> and <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> structures in the data to serialize as an XML message with the attachments automatically added or MIME attachments can be explicitly added with <code><a class="el" href="group__group__mime.html#ga39e5da4f375e8030b8cbddaf0a2a8e6e" title="Add a MIME attachment to the SOAP/XML message. ">soap_set_mime_attachment</a></code>. Parameter <code>boundary</code> specifies a MIME boundary string or NULL to have the engine generate a MIME boundary string. Parameter <code>start</code> specifies the start content ID for the first MIME body containing the SOAP or XML message. When NULL, the start ID of the SOAP message is <em><code>&lt;SOAP-ENV:Envelope&gt;</code></em>.</li>
<li><code>int soap_set_mime_attachment(struct soap *soap, char *ptr, size_t size, enum soap_mime_encoding encoding, const char *type, const char *id, const char *location, const char *description)</code> This function adds a MIME attachment to a SOAP/XML message to send. The specified <code>ptr</code> points to the data to send of length specified by <code>size</code>. The <code>encoding</code> parameter is a <code><a class="el" href="group__group__mime.html#ga3fec7633da07bff2bf5fd6330bef1844" title="RFC2045 MIME content transfer encodings. ">soap_mime_encoding</a></code> value that is recommended to be specified as <code><a class="el" href="group__group__mime.html#gga3fec7633da07bff2bf5fd6330bef1844a974209a86acc850e3c3d4beb8e579e8c" title="no encoding, raw data content (recommended) ">SOAP_MIME_NONE</a></code> to specify that the MIME data content is not encoded in any way (the MIME attachment function simply copies the raw data to the MIME block without encoding). The <code>type</code> parameter is required and indicates the MIME type of the data, such as "image/jpg". The <code>id</code> parameter uniquely identifies the attachment in the message, which can be omitted by specifying NULL. The <code>location</code> parameter specifies a location string or NULL. The <code>description</code> parameter is a string that describes the data or NULL. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code.</li>
<li><code>void <a class="el" href="group__group__mime.html#ga81cedb24670ebda48a79679d4682211f" title="Disable MIME attachments. ">soap_clr_mime(struct soap *soap)</a></code> This function disables MIME attachments such as after sending a multipart-related message with attachments to switch back to non-multipart-related messaging, unless the data to serialize as a message contains attachments such as <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> for MIME attachments and <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> for MTOM attachments.</li>
</ul>
<p>When providing a MIME boundary with <code><a class="el" href="group__group__mime.html#ga9180e5ba634b20305b755b410045d9ee" title="Enable MIME attachments. ">soap_set_mime</a></code>, you have to make sure the boundary cannot match any parts of the message and attachments that you are sending, because the boundary delineates the attachments.</p>
<p>The internal list of attachments specified with <code><a class="el" href="group__group__mime.html#ga39e5da4f375e8030b8cbddaf0a2a8e6e" title="Add a MIME attachment to the SOAP/XML message. ">soap_set_mime_attachment</a></code> is destroyed with <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> or when a message is received. Therefore, call <code><a class="el" href="group__group__mime.html#ga39e5da4f375e8030b8cbddaf0a2a8e6e" title="Add a MIME attachment to the SOAP/XML message. ">soap_set_mime_attachment</a></code> to set attachments before sending a message.</p>
<p>The following example shows how a multipart/related HTTP message with three MIME attachments is set up and transmitted to a server. In this example we let the message body refer to the attachments using XML <em><code>href</code></em> attributes. The <code>struct claim__form</code> data type includes a definition of a <code>href</code> attribute for this purpose.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>claim__form form1, form2; </div><div class="line">form1.href = <span class="stringliteral">&quot;cid:claim061400a.tiff@claiming-it.com&quot;</span>; </div><div class="line">form2.href = <span class="stringliteral">&quot;cid:claim061400a.jpeg@claiming-it.com&quot;</span>; </div><div class="line"><span class="comment">/* initialize and enable MIME */</span> </div><div class="line"><a class="code" href="group__group__mime.html#ga9180e5ba634b20305b755b410045d9ee">soap_set_mime</a>(soap, NULL, <span class="stringliteral">&quot;&lt;claim061400a.xml@claiming-it.com&gt;&quot;</span>); </div><div class="line"><span class="comment">/* add a base64 encoded tiff image (tiffImage points to base64 data) */</span> </div><div class="line"><a class="code" href="group__group__mime.html#ga39e5da4f375e8030b8cbddaf0a2a8e6e">soap_set_mime_attachment</a>(soap, tiffImage, tiffLen, <a class="code" href="group__group__mime.html#gga3fec7633da07bff2bf5fd6330bef1844a8be678e012a0b38ed7600ba7ce7168a1">SOAP_MIME_BASE64</a>, <span class="stringliteral">&quot;image/tiff&quot;</span>, <span class="stringliteral">&quot;&lt;claim061400a.tiff@claiming-it.com&gt;&quot;</span>, NULL, NULL); </div><div class="line"><span class="comment">/* add a raw binary jpeg image (jpegImage points to raw data) */</span> </div><div class="line"><a class="code" href="group__group__mime.html#ga39e5da4f375e8030b8cbddaf0a2a8e6e">soap_set_mime_attachment</a>(soap, jpegImage, jpegLen, <a class="code" href="group__group__mime.html#gga3fec7633da07bff2bf5fd6330bef1844a980f093599dc29767fcdc0d90723dda1">SOAP_MIME_BINARY</a>, <span class="stringliteral">&quot;image/jpeg&quot;</span>, <span class="stringliteral">&quot;&lt;claim061400a.jpeg@claiming-it.com&gt;&quot;</span>, NULL, NULL); </div><div class="line"><span class="comment">/* send the forms as MIME attachments with this invocation */</span> </div><div class="line"><span class="keywordflow">if</span> (soap_call_claim__insurance_claim_auto(soap, form1, form2, ...)) </div><div class="line">  ... <span class="comment">// an error occurred </span></div><div class="line"><span class="keywordflow">else</span> </div><div class="line">  ... <span class="comment">// process the response</span></div><div class="line"><a class="code" href="group__group__mime.html#ga81cedb24670ebda48a79679d4682211f">soap_clr_mime</a>(soap);</div></div><!-- fragment --><p>The <code>claim__form</code> struct is declared in the interface header file as:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>claim__form </div><div class="line">{</div><div class="line">  @ <span class="keywordtype">char</span> *href; </div><div class="line">};</div></div><!-- fragment --><p>The claim forms in the message consist of <em><code>href</code></em>s to the claim forms attached. The use of <em><code>href</code></em> or other attributes for referring to the MIME attachments is optional according to the SwA standard. MTOM on the other hand mandates the use of <em><code>href</code></em> with XOP elements.</p>
<p>To associate MIME attachments with the request and response of a service operation in the generated WSDL, please see Section <a class="el" href="index.html#MIMEWSDL">Generating MultipartRelated MIME attachment bindings in WSDL</a> .</p>
<p>The server-side code to transmit MIME attachments back to a client:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> claim__insurance_claim_auto(<span class="keyword">struct</span> soap *soap, ...) </div><div class="line">{</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *htmlDoc = ...; <span class="comment">// an HTML message to send as an attachment</span></div><div class="line">  <a class="code" href="group__group__mime.html#ga9180e5ba634b20305b755b410045d9ee">soap_set_mime</a>(soap, NULL, NULL); <span class="comment">// enable MIME</span></div><div class="line">  <span class="comment">// add a HTML document (htmlDoc points to data, where the HTML doc is stored in compliance with 7bit encoding RFC2045) </span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__mime.html#ga39e5da4f375e8030b8cbddaf0a2a8e6e">soap_set_mime_attachment</a>(soap, htmlDoc, strlen(htmlDoc), <a class="code" href="group__group__mime.html#gga3fec7633da07bff2bf5fd6330bef1844af26108ff0cee7079939a79df27f09e04">SOAP_MIME_7BIT</a>, <span class="stringliteral">&quot;text/html&quot;</span>, <span class="stringliteral">&quot;&lt;claim061400a.html@claiming-it.com&gt;&quot;</span>, NULL, NULL)) </div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__mime.html#ga81cedb24670ebda48a79679d4682211f">soap_clr_mime</a>(soap); <span class="comment">// don&#39;t want fault with attachments </span></div><div class="line">    <span class="keywordflow">return</span> soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>; </div><div class="line">  } </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="SWAreceiving"></a>
Retrieving a collection of MIME/MTOM attachments (SwA)</h2>
<p>MIME attachments are automatically parsed and stored in memory managed by the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context. After receiving a set of MIME/MTOM attachments, either at the client-side or the server-side, the list of MIME/MTOM attachments can be traversed to extract meta data and the attachment content. The first attachment in the collection of MIME/MTOM attachments always contains meta data about the SOAP message itself (because the SOAP message was processed the attachment does not contain any useful data).</p>
<p>To traverse the list of MIME attachments in C, you use a loop similar to:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> n = 0;</div><div class="line"><span class="keyword">struct </span><a class="code" href="structsoap__multipart.html">soap_multipart</a> *attachment;</div><div class="line"><span class="keywordflow">for</span> (attachment = soap-&gt;<a class="code" href="structsoap.html#af2f4dbd6f73f19f1beeaa3a7e9d9cc2c">mime</a>.<a class="code" href="structsoap__mime.html#aeef725035ddedf24b29d1070e0f9bb33">list</a>; attachment; attachment = attachment-&gt;<a class="code" href="structsoap__multipart.html#a5521c92e49758ed873d0a8b2ec4b25c8">next</a>)</div><div class="line">{</div><div class="line">  ++n;</div><div class="line">  printf(<span class="stringliteral">&quot;Part %d:\n&quot;</span>, n);</div><div class="line">  printf(<span class="stringliteral">&quot;ptr        =%p\n&quot;</span>, attachment-&gt;<a class="code" href="structsoap__multipart.html#a640f46b605042f37ae1592f77e31c52d">ptr</a>);</div><div class="line">  printf(<span class="stringliteral">&quot;size       =%ul\n&quot;</span>, attachment-&gt;<a class="code" href="structsoap__multipart.html#afc4b69f5e9ade6526b23681c105d5ca5">size</a>);</div><div class="line">  printf(<span class="stringliteral">&quot;id         =%s\n&quot;</span>, attachment-&gt;<a class="code" href="structsoap__multipart.html#ad0bcd79b40a1bc1dc13fc343477f5564">id</a> ? attachment-&gt;<a class="code" href="structsoap__multipart.html#ad0bcd79b40a1bc1dc13fc343477f5564">id</a> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line">  printf(<span class="stringliteral">&quot;type       =%s\n&quot;</span>, attachment-&gt;<a class="code" href="structsoap__multipart.html#a495c8d20e0334be1b1345193ca2fb764">type</a> ? attachment-&gt;<a class="code" href="structsoap__multipart.html#a495c8d20e0334be1b1345193ca2fb764">type</a> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line">  printf(<span class="stringliteral">&quot;location   =%s\n&quot;</span>, attachment-&gt;<a class="code" href="structsoap__multipart.html#af11a70ea80f3e1934d72b292e6d93910">location</a> ? attachment-&gt;<a class="code" href="structsoap__multipart.html#af11a70ea80f3e1934d72b292e6d93910">location</a> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line">  printf(<span class="stringliteral">&quot;description=%s\n&quot;</span>, attachment-&gt;<a class="code" href="structsoap__multipart.html#ab527c6e6cce784c68a5bd9bb80845ca4">description</a> ? attachment-&gt;<a class="code" href="structsoap__multipart.html#ab527c6e6cce784c68a5bd9bb80845ca4">description</a> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line">}</div></div><!-- fragment --><p>C++ programmers can use an iterator instead:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> n = 0;</div><div class="line"><span class="keywordflow">for</span> (<a class="code" href="structsoap__multipart.html#ad9000ffe8f72fef89038c4773efdf575">soap_multipart::iterator</a> i = soap-&gt;<a class="code" href="structsoap.html#af2f4dbd6f73f19f1beeaa3a7e9d9cc2c">mime</a>.<a class="code" href="structsoap__mime.html#ae99fa19c5d24051a495b79a024a3f5f9">begin</a>(); i != soap-&gt;<a class="code" href="structsoap.html#af2f4dbd6f73f19f1beeaa3a7e9d9cc2c">mime</a>.<a class="code" href="structsoap__mime.html#af810e927cdbe61242f978918fc2de748">end</a>(); ++i)</div><div class="line">{</div><div class="line">  ++n;</div><div class="line">  printf(<span class="stringliteral">&quot;Part %d:\n&quot;</span>, n);</div><div class="line">  printf(<span class="stringliteral">&quot;ptr        =%p\n&quot;</span>, i-&gt;ptr);</div><div class="line">  ... <span class="comment">// etc</span></div><div class="line">}</div></div><!-- fragment --><p>Note: keep in mind that the first attachment is associated with the SOAP message and you may want to ignore it.</p>
<p>A call to <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> removes all of the received MIME data. To preserve an attachment in memory, use <code><a class="el" href="group__group__context.html#ga643bb3cdc192ec0dc1a8448498dab401" title="Unlink a block of heap memory managed by the specified soap context, to release the memory explicitly...">soap_unlink</a></code> on the <code>ptr</code> member of the <code><a class="el" href="structsoap__multipart.html" title="DIME/MIME/MTOM attachment data received by the engine. ">soap_multipart</a></code> struct. The <code><a class="el" href="group__group__context.html#ga643bb3cdc192ec0dc1a8448498dab401" title="Unlink a block of heap memory managed by the specified soap context, to release the memory explicitly...">soap_unlink</a></code> function can be used to prevent deallocation of deserialized data.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="DIME"></a>
DIME attachments</h1>
<p>Applications developed with the gSOAP tools can transmit binary DIME attachments stored in memory or in streaming mode by fetching data from a resource or sending data to a resource using callback functions. The maximum DIME attachment size is limited to 8 MB by default as set with <code><a class="el" href="group__group__soap.html#gad4c2ca8c2293fc75075aec4a09f4dc38" title="User-definable maximum length of DIME attachments received (the value is 8 MB by default) ...">SOAP_MAXDIMESIZE</a></code>. This limit can be changed as needed. With streaming DIME using callback functions, data handlers are used to pass the data to and from a resource from which to fetch the data to send or data to store, such as a file or device. See Section <a class="el" href="index.html#DIMEstreaming">Streaming DIME</a> .</p>
<p>For details on DIME attachments, see <a href="http://msdn.microsoft.com/library/en-us/dnglobspec/html/draft-nielsen-dime-02.txt">http://msdn.microsoft.com/library/en-us/dnglobspec/html/draft-nielsen-dime-02.txt</a></p>
<p>See also API documentation Module <a class="el" href="group__group__dime.html">DIME attachment functions</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="DIMEsending"></a>
Sending a collection of DIME attachments</h2>
<p>The following functions can be used to explicitly set up a collection of DIME attachments for transmission with a message. These attachments can be streamed, as described in Section <a class="el" href="index.html#DIMEstreaming">Streaming DIME</a> . Without streaming, each attachment must refer to a block of data in memory.</p>
<ul>
<li><code>void <a class="el" href="group__group__dime.html#ga466502a32af0672d589e919a7c882a57" title="Enable DIME attachments. ">soap_set_dime(struct soap *soap)</a></code> This function enables sending DIME attachments. This function is generally not required because DIME attachments are automatically detected as <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> and <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> structures in the data to serialize as an XML message with the attachments automatically added or DIME attachments can be explicitly added with <code><a class="el" href="group__group__dime.html#ga742f96848174e27bfc8df7425b870f4b" title="Add a DIME attachment to the SOAP/XML message. ">soap_set_dime_attachment</a></code>.</li>
<li><code>int soap_set_dime_attachment(struct soap *soap, char *ptr, size_t size, const char *type, const char *id, unsigned short optype, const char *option)</code> This function adds a DIME attachment to the XML message to send. The specified <code>ptr</code> points to the data to send of length specified by <code>size</code>. The <code>type</code> parameter indicates the MIME type of the data or can be NULL. The <code>id</code> parameter uniquely identifies the attachment in the message, which can be omitted by specifying NULL. The <code>option</code> parameter is an option such as a description of the data and <code>optype</code> is a user-defined option type (as per DIME option specification format). The <code>ptr</code> parameter must be persistent. The <code>ptr</code> parameter passed to this function must be persistent in memory until the attachment was sent. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code.</li>
<li><code>void <a class="el" href="group__group__dime.html#ga7f319170ba950c4b4025c5c1739a26fc" title="Disable DIME attachments. ">soap_clr_dime(struct soap *soap)</a></code> This function disables DIME attachments, unless the data to serialize as an XML message contains attachments defined by <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> and <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> structures.</li>
</ul>
<p>These functions allow DIME attachments to be added to SOAP messages without requiring message body references. This is also referred to as the open DIME attachment style. The closed attachment style requires all DIME attachments to be referenced from the SOAP message body with <em><code>href</code></em> (or similar) references. For the closed style, gSOAP supports an automatic binary data serialization method, see Section <a class="el" href="index.html#DIMEbinary">Serializing binary data with DIME attachments</a> .</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="DIMEreceiving"></a>
Retrieving a collection of DIME attachments</h2>
<p>DIME attachments are automatically parsed and stored in memory (or passed to the streaming handlers via the DIME callback functions when defined). After receiving a set of DIME attachments, either at the client-side or the server-side, the list of DIME attachments can be traversed to extract meta data and the attachment content.</p>
<p>To traverse the list of DIME attachments in C, you use a loop similar to:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> n = 0;</div><div class="line"><span class="keyword">struct </span><a class="code" href="structsoap__multipart.html">soap_multipart</a> *attachment;</div><div class="line"><span class="keywordflow">for</span> (attachment = soap-&gt;<a class="code" href="structsoap.html#a38845a4e0cc0696782769ac9976c4dfa">dime</a>.<a class="code" href="structsoap__dime.html#a478a23b3994a35d1c0945751106cb4f6">list</a>; attachment; attachment = attachment-&gt;<a class="code" href="structsoap__multipart.html#a5521c92e49758ed873d0a8b2ec4b25c8">next</a>)</div><div class="line">{</div><div class="line">  ++n;</div><div class="line">  printf(<span class="stringliteral">&quot;Part %d:\n&quot;</span>, n);</div><div class="line">  printf(<span class="stringliteral">&quot;ptr        =%p\n&quot;</span>, attachment-&gt;<a class="code" href="structsoap__multipart.html#a640f46b605042f37ae1592f77e31c52d">ptr</a>);</div><div class="line">  printf(<span class="stringliteral">&quot;size       =%ul\n&quot;</span>, attachment-&gt;<a class="code" href="structsoap__multipart.html#afc4b69f5e9ade6526b23681c105d5ca5">size</a>);</div><div class="line">  printf(<span class="stringliteral">&quot;id         =%s\n&quot;</span>, attachment-&gt;<a class="code" href="structsoap__multipart.html#ad0bcd79b40a1bc1dc13fc343477f5564">id</a> ? attachment-&gt;<a class="code" href="structsoap__multipart.html#ad0bcd79b40a1bc1dc13fc343477f5564">id</a> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line">  printf(<span class="stringliteral">&quot;type       =%s\n&quot;</span>, attachment-&gt;<a class="code" href="structsoap__multipart.html#a495c8d20e0334be1b1345193ca2fb764">type</a> ? attachment-&gt;<a class="code" href="structsoap__multipart.html#a495c8d20e0334be1b1345193ca2fb764">type</a> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line">}</div></div><!-- fragment --><p>C++ programmers can use an iterator instead:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> n = 0;</div><div class="line"><span class="keywordflow">for</span> (<a class="code" href="structsoap__multipart.html#ad9000ffe8f72fef89038c4773efdf575">soap_multipart::iterator</a> i = soap-&gt;<a class="code" href="structsoap.html#a38845a4e0cc0696782769ac9976c4dfa">dime</a>.<a class="code" href="structsoap__dime.html#a4fe0d524cff9e2e467487dba18dd61f8">begin</a>(); i != soap-&gt;<a class="code" href="structsoap.html#a38845a4e0cc0696782769ac9976c4dfa">dime</a>.<a class="code" href="structsoap__dime.html#af4c0808ed995d085514cfc0962bb4565">end</a>(); ++i)</div><div class="line">{</div><div class="line">  ++n;</div><div class="line">  printf(<span class="stringliteral">&quot;Part %d:\n&quot;</span>, n);</div><div class="line">  printf(<span class="stringliteral">&quot;ptr        =%p\n&quot;</span>, i-&gt;ptr);</div><div class="line">  ... <span class="comment">// etc</span></div><div class="line">}</div></div><!-- fragment --><p>The <code>options</code> member is available as well, but not shown in the code above. The <code>options</code> content is formatted according to the DIME specification: the first two bytes are reserved for the option type, the next two bytes store the size of the option data, followed by the (binary) option data.</p>
<p>A call to <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> removes all of the received DIME data. To preserve an attachment in memory, use <code><a class="el" href="group__group__context.html#ga643bb3cdc192ec0dc1a8448498dab401" title="Unlink a block of heap memory managed by the specified soap context, to release the memory explicitly...">soap_unlink</a></code> on the <code>ptr</code> member of the <code><a class="el" href="structsoap__multipart.html" title="DIME/MIME/MTOM attachment data received by the engine. ">soap_multipart</a></code> struct. The <code><a class="el" href="group__group__context.html#ga643bb3cdc192ec0dc1a8448498dab401" title="Unlink a block of heap memory managed by the specified soap context, to release the memory explicitly...">soap_unlink</a></code> function can be used to prevent deallocation of deserialized data.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="DIMEbinary"></a>
Serializing binary data with DIME attachments</h2>
<p>Binary data stored in extended <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> and <code><a class="el" href="structxsd____hex_binary.html" title="XSD hexBinary structure with attachment data. ">xsd__hexBinary</a></code> types can be serialized and deserialized as DIME attachments when one or more of the extra members <code>id</code>, <code>type</code>, and <code>options</code> are non-NULL. These attachments will be automatically transmitted prior to the sequence of secondary DIME attachments defined by the user with <code><a class="el" href="group__group__dime.html#ga742f96848174e27bfc8df7425b870f4b" title="Add a DIME attachment to the SOAP/XML message. ">soap_set_dime_attachment</a></code> as explained in the previous section. The serialization process is automated for SOAP encoded messages and DIME attachments will be send even when <code><a class="el" href="group__group__dime.html#ga466502a32af0672d589e919a7c882a57" title="Enable DIME attachments. ">soap_set_dime</a></code> or <code><a class="el" href="group__group__dime.html#ga742f96848174e27bfc8df7425b870f4b" title="Add a DIME attachment to the SOAP/XML message. ">soap_set_dime_attachment</a></code> are not used. For non-SOAP-encoded messages such as document/literal messages you must still call <code><a class="el" href="group__group__dime.html#ga466502a32af0672d589e919a7c882a57" title="Enable DIME attachments. ">soap_set_dime</a></code> to enable sending messages with attachments.</p>
<p>To enable serialization of the data as DIME attachments instead of inline base64, we extend the <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> type with three additional members:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>xsd__base64Binary </div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6ba9f9e291b2b26e0696bd48f4e983be">__ptr</a>; </div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structxsd____base64_binary.html#aa2dfd4d99f8280c413b9ff25a69a8729">__size</a>; </div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6398e9d86079896facc3005871d7fe27">id</a>; </div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#acbc2d7ba24334ccc4f8ec36e9122e9e5">type</a>; </div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a16d2bb03d68bf276bad5fd7cccd55bbe">options</a>; </div><div class="line">};</div></div><!-- fragment --><p>The <code>id</code> member is for attachment referencing, typically a content id (CID) or a UUID which can be obtained with <code><a class="el" href="group__group__misc.html#ga5fcf3c8f6f4bc6d5e6efd7a92ceaf399" title="Returns a randomized unique UUID string. ">soap_rand_uuid</a></code>, a <code>type</code> member is used to specify the MIME type of the data, the <code>options</code> member is used to piggy-back additional information with a DIME attachment. The order of the declaration of the members is significant. In addition, no other members or methods may be declared before any of these members in the struct/class, but additional members and methods may appear after the member declarations. The extended <code><a class="el" href="structxsd____hex_binary.html" title="XSD hexBinary structure with attachment data. ">xsd__hexBinary</a></code> type is similar.</p>
<p>The <code>id</code> and <code>type</code> members contain text. The set the DIME-specific options member, you can use the <code><a class="el" href="group__group__dime.html#ga4829f833abe74febcb8e5fe9360ab591" title="Creates a DIME option. ">soap_dime_option</a></code> function <code>char *soap_dime_option(struct soap *soap, unsigned short type, const char *option)</code>.</p>
<p>This function returns a string with this encoding. For example</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>xsd__base64Binary image; </div><div class="line">image.__ptr = ...; </div><div class="line">image.__size = ...; </div><div class="line">image.id = <span class="stringliteral">&quot;uuid:09233523-345b-4351-b623-5dsf35sgs5d6&quot;</span>; </div><div class="line">image.type = <span class="stringliteral">&quot;image/jpeg&quot;</span>; </div><div class="line">image.options = <a class="code" href="group__group__dime.html#ga4829f833abe74febcb8e5fe9360ab591">soap_dime_option</a>(soap, 0, <span class="stringliteral">&quot;My wedding picture&quot;</span>);</div></div><!-- fragment --><p>When either the <code>id</code> or <code>type</code> member values are non-NULL at run time, the data will be serialized as a DIME attachment.</p>
<p>The SOAP/XML message refers to the attachments using <em><code>href</code></em> attributes. This generally works will with SOAP RPC encoded messaging, because <em><code>href</code></em> attributes are permitted. However, with document/literal style the referencing mechanism must be explicitly defined in the schema of the binary type. Therefore, MTOM is the preferred attachment mechanism for document/literal style messaging.</p>
<p>The declaration of an extended binary type in the interface header file for soapcpp2 is:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__myBinaryDataType </div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *__ptr; </div><div class="line">    <span class="keywordtype">int</span> __size; </div><div class="line">    <span class="keywordtype">char</span> *id; </div><div class="line">    <span class="keywordtype">char</span> *type; </div><div class="line">    <span class="keywordtype">char</span> *options; </div><div class="line">};</div></div><!-- fragment --><p>C++ programmers can use inheritance instead of textual extension required in C:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>xsd__base64Binary </div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6ba9f9e291b2b26e0696bd48f4e983be">__ptr</a>; </div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structxsd____base64_binary.html#aa2dfd4d99f8280c413b9ff25a69a8729">__size</a>; </div><div class="line">}; </div><div class="line"><span class="keyword">class </span>ns__myBinaryDataType : <span class="keyword">public</span> xsd__base64Binary </div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a6398e9d86079896facc3005871d7fe27">id</a>; </div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#acbc2d7ba24334ccc4f8ec36e9122e9e5">type</a>; </div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="structxsd____base64_binary.html#a16d2bb03d68bf276bad5fd7cccd55bbe">options</a>; </div><div class="line">};</div></div><!-- fragment --><p>This defines an extension of <em><code>xsd:base64Binary</code></em>, such that the data can be serialized as DIME attachments using <em><code>href</code></em> attributes for referencing. When a different attribute is to be used, this must be explicitly defined:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap WSref schema import: http://schemas.xmlsoap.org/ws/2002/04/reference/ </span></div><div class="line"><span class="keyword">struct </span>ns__myBinaryDataType </div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *__ptr; </div><div class="line">    <span class="keywordtype">int</span> __size; </div><div class="line">    <span class="keywordtype">char</span> *id; </div><div class="line">    <span class="keywordtype">char</span> *type; </div><div class="line">    <span class="keywordtype">char</span> *options; </div><div class="line">  @ <span class="keywordtype">char</span> *WSref__location; </div><div class="line">};</div></div><!-- fragment --><p>The example above uses the <em><code>location</code></em> attribute defined in the content reference schema, as defined in one of the vendor's specific WSDL extensions for DIME <a href="http://www.gotdotnet.com/team/xml_wsspecs/dime/WSDL-Extension-for-DIME.htm">http://www.gotdotnet.com/team/xml_wsspecs/dime/WSDL-Extension-for-DIME.htm</a>.</p>
<p>When receiving DIME attachments, the DIME meta data and binary content are stored in the specified <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> and <code><a class="el" href="structxsd____hex_binary.html" title="XSD hexBinary structure with attachment data. ">xsd__hexBinary</a></code> binary data types only when the XML parts of the message uses <em><code>href</code></em> attributes to refer to these attachments. If so, the binary data type <code>__ptr</code> and <code>__size</code> members are set to the location in memory of the attachment data and length, respectively.</p>
<p>Messages may contain binary data that references external resources not provided as attachments. In that case, the <code>__ptr</code> member is NULL and the <code>id</code> member refers to the external data source.</p>
<p>The <code>dime_id_format</code> attribute of the current context can be set to the default format of DIME id members. The format string must contain a <code>d</code> format specifier (or any other <code>int</code>-based format specifier). The value of this specifier is a non-negative integer, with zero being the value of the DIME attachment id for the SOAP message. For example,</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a8541bff0934439c9f6fee6c449400fbe">dime_id_format</a> = <span class="stringliteral">&quot;id-%x&quot;</span>; </div></div><!-- fragment --><p>As a result, all attachments with a NULL <code>id</code> member will use a auto-generated id value based on the format string.</p>
<dl class="section warning"><dt>Warning</dt><dd>Care must be taken not to introduce duplicate content id values, when assigning content id values to the id members of DIME extended binary data types. Content ids must be unique.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="DIMEstreaming"></a>
Streaming DIME</h2>
<p>Streaming DIME is achieved with callback functions to fetch and store data during transmission. Three function callbacks for streaming DIME output and three callbacks for streaming DIME input are available.</p>
<ul>
<li><code>void *(*soap.fdimereadopen)(struct soap *soap, void *handle, const char *id, const char *type, const char *options)</code> This callback is called by the engine to start sending a streaming DIME attachment. This callback opens a stream to start reading the attachment data to send. The actual data stream will be read in chunks using the <code><a class="el" href="group__group__callbacks.html#ga48270ad98961c3ff48c7b56484ebb3fa" title="Callback to read data in a DIME attachment stream. ">soap::fdimeread</a></code> callback until no more data is available and the <code><a class="el" href="group__group__callbacks.html#ga154752e553be41ed3b10fe3a1273ac71" title="Callback to close a DIME attachment stream after reading. ">soap::fdimereadclose</a></code> callback is called to close the stream. The <code>handle</code> parameter contains the value of the <code>__ptr</code> member variable of the attachment struct/class with data (e.g. <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> or <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> with <code>__ptr</code>, <code>__size</code>, <code>id</code>, <code>type</code> and <code>options</code> members), which should be a pointer to specific information such as a file descriptor or a pointer to a some application-specific data to be passed to this callback. Both the <code>__ptr</code> and <code>__size</code> members of the attachment struct/class should have been set by the application prior to the serialization of the message with attachments. If the <code>__size</code> is zero and HTTP chunking is enabled (with <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code>), then chunked DIME attachments are sent, see <code><a class="el" href="group__group__callbacks.html#ga48270ad98961c3ff48c7b56484ebb3fa" title="Callback to read data in a DIME attachment stream. ">soap::fdimeread</a></code>. The <code>id</code>, <code>type</code> and <code>options</code> parameters are the <code>id</code> (optional ID), <code>type</code> (a MIME type) and <code>options</code> (DIME options are set with <code><a class="el" href="group__group__dime.html#ga4829f833abe74febcb8e5fe9360ab591" title="Creates a DIME option. ">soap_dime_option</a></code>) of the attachment struct/class, respectively, of which at least one member should be non-NULL. The callback should return the <code>handle</code> parameter value or another pointer value, which is passed as the new <code>handle</code> parameter to <code><a class="el" href="group__group__callbacks.html#ga48270ad98961c3ff48c7b56484ebb3fa" title="Callback to read data in a DIME attachment stream. ">soap::fdimeread</a></code> and <code><a class="el" href="group__group__callbacks.html#ga154752e553be41ed3b10fe3a1273ac71" title="Callback to close a DIME attachment stream after reading. ">soap::fdimereadclose</a></code> callbacks. When an error occurred in this callback, the callback should return NULL and set <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code> to an error code, e.g. using <code><a class="el" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6" title="Set SOAP 1.1 server fault / SOAP 1.2 receiver fault string and detail. ">soap_receiver_fault</a></code>. The callback may return NULL and set <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code> to <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> when this specific DIME attachment should not to be streamed and the engine will simply skip it.</li>
<li><code>size_t (*soap.fdimeread)(struct soap *soap, void *handle, char *buf, size_t len)</code> This callback is called by the engine to read a chunk of attachment data to transmit. The <code>handle</code> parameter contains the handle returned by the <code><a class="el" href="group__group__callbacks.html#ga068455ce417bddb1636d4d565e0ebf56" title="Callback to open a streaming DIME attachment for reading. ">soap::fdimereadopen</a></code> callback. The <code>buf</code> parameter is the buffer of length <code>len</code> into which a chunk of data should be written by the callback. The actual amount of data written into the buffer may be less than <code>len</code> and this actual amount should be returned by the callback. A return value of zero indicates an error and <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code> should be set. The <code>__size</code> member variable of the attachment struct/class with data (e.g. <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> or <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> with <code>__ptr</code>, <code>__size</code>, <code>id</code>, <code>type</code> and <code>options</code> members) should be set by the application prior to the serialization of the message with attachments. The value of <code>__size</code> indicates the total size of the attachment data to be transmitted. If the <code>__size</code> member variable is zero and HTTP chunking is enabled (with <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code>), then DIME chunked transfers are activated by the engine, which is more flexible since the attachment data size does not need to be determined in advance. To use DIME chunked transfers, enable HTTP chunking with <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> (also <code><a class="el" href="group__group__flags.html#gaf7cbb692f85f8633c4efc66dfae41e9e" title="soap_mode IO output flag value to store messages temporarily before transmission, e...">SOAP_IO_STORE</a></code> can be used, but this buffers the entire message in memory before transmission) and set the <code>__size</code> member variable of the attachment struct/class to zero. When DIME attachment chunking is enabled, this callback should completely fill the <code>buf</code> buffer with <code>len</code> bytes unless the last data chunk is reached and fewer bytes are returned.</li>
<li><code>void (*soap.fdimereadclose)(struct soap *soap, void *handle)</code> This callback is called by the engine to close the DIME attachment stream after reading. The <code>handle</code> parameter contains the handle returned by the <code><a class="el" href="group__group__callbacks.html#ga068455ce417bddb1636d4d565e0ebf56" title="Callback to open a streaming DIME attachment for reading. ">soap::fdimereadopen</a></code> callback.</li>
<li><code>void *(*soap.fdimewriteopen)(struct soap *soap, const char *id, const char *type, const char *options)</code> Called by the to start receiving a streaming DIME attachment. This callback opens a stream to start writing the attachment data received. The actual data stream will be written in chunks using the <code><a class="el" href="group__group__callbacks.html#ga0f3214caa607f74505f11c76ade85cce" title="Callback to write data in a DIME attachment stream. ">soap::fdimewrite</a></code> callback until no more data is available and the <code><a class="el" href="group__group__callbacks.html#ga1ea0ca0526c4ccba02ec52f62e0678a9" title="Callback to close a DIME attachment stream after writing. ">soap::fdimewriteclose</a></code> callback is called to close the stream. The <code>id</code>, <code>type</code> and <code>options</code> parameters are the <code>id</code>, <code>type</code> and <code>options</code> of the attachment struct/class (e.g. <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> or <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> with <code>__ptr</code>, <code>__size</code>, <code>id</code>, <code>type</code> and <code>options</code> members), respectively. The callback should return a handle, which is passed to the <code><a class="el" href="group__group__callbacks.html#ga0f3214caa607f74505f11c76ade85cce" title="Callback to write data in a DIME attachment stream. ">soap::fdimewrite</a></code> and <code><a class="el" href="group__group__callbacks.html#ga1ea0ca0526c4ccba02ec52f62e0678a9" title="Callback to close a DIME attachment stream after writing. ">soap::fdimewriteclose</a></code> callbacks. The <code>__ptr</code> member variable of the attachment struct/class is set by the engine to the value of this handle. The <code>__size</code> member variable is set to the size of the attachment received. The maximum DIME attachment size received is limited by <code><a class="el" href="group__group__soap.html#gad4c2ca8c2293fc75075aec4a09f4dc38" title="User-definable maximum length of DIME attachments received (the value is 8 MB by default) ...">SOAP_MAXDIMESIZE</a></code>.</li>
<li><code>int (*soap.fdimewrite)(struct soap *soap, void *handle, const char *buf, size_t len)</code> This callback is called by the engine to write a chunk of attachment data received. The <code>handle</code> parameter contains the handle returned by the <code><a class="el" href="group__group__callbacks.html#ga3b1e4aa046b683535110a34fc46ab1eb" title="Callback to open a streaming DIME attachment for writing. ">soap::fdimewriteopen</a></code> callback. The <code>buf</code> parameter contains the data of length <code>len</code>. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code.</li>
<li><code>void (*soap.fdimewriteclose)(struct soap *soap, void *handle)</code> This callback is called by the engine to close the DIME attachment stream after writing. The <code>handle</code> parameter contains the handle returned by the <code><a class="el" href="group__group__callbacks.html#ga3b1e4aa046b683535110a34fc46ab1eb" title="Callback to open a streaming DIME attachment for writing. ">soap::fdimewriteopen</a></code> callback.</li>
</ul>
<p>In addition, a <code>void* <a class="el" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b" title="User-definable variable that may point to user-specified data of any type to pass the data through to...">soap::user</a></code> member is available to pass user-defined data to the callbacks. This way, you can set <code>void* <a class="el" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b" title="User-definable variable that may point to user-specified data of any type to pass the data through to...">soap::user</a></code> to point to application data that the callbacks need such as a file name for example.</p>
<p>The following example illustrates the client-side initialization of an image attachment struct to stream a file into a DIME attachment:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <span class="keyword">struct </span>xsd__base64Binary image; </div><div class="line">  FILE *fd; </div><div class="line">  <span class="keyword">struct </span>stat sb; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  <span class="keywordflow">if</span> (!fstat(fileno(fd), &amp;sb) &amp;&amp; sb.st_size &gt; 0) </div><div class="line">  {</div><div class="line">    <span class="comment">// because we can get the length of the file, we can stream it </span></div><div class="line">    soap.<a class="code" href="group__group__callbacks.html#ga068455ce417bddb1636d4d565e0ebf56">fdimereadopen</a> = dime_read_open; </div><div class="line">    soap.<a class="code" href="group__group__callbacks.html#ga154752e553be41ed3b10fe3a1273ac71">fdimereadclose</a> = dime_read_close; </div><div class="line">    soap.<a class="code" href="group__group__callbacks.html#ga48270ad98961c3ff48c7b56484ebb3fa">fdimeread</a> = dime_read; </div><div class="line">    image.__ptr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)fd; <span class="comment">// must set to non-NULL (this is our fd handle which we need in the callbacks) </span></div><div class="line">    image.__size = sb.st_size; <span class="comment">// must set size </span></div><div class="line">  } </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">  {</div><div class="line">    <span class="comment">// don&#39;t know the size, so buffer it </span></div><div class="line">    <span class="keywordtype">size_t</span> i; </div><div class="line">    <span class="keywordtype">int</span> c; </div><div class="line">    image.__ptr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<a class="code" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c">soap_malloc</a>(&amp;soap, MAX_FILE_SIZE); </div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_FILE_SIZE; i++) </div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> ((c = fgetc(fd)) == EOF) </div><div class="line">        <span class="keywordflow">break</span>; </div><div class="line">      image.__ptr[i] = c; </div><div class="line">    } </div><div class="line">    fclose(fd); </div><div class="line">    image.__size = i; </div><div class="line">  } </div><div class="line">  image.type = <span class="stringliteral">&quot;image/jpeg&quot;</span>; </div><div class="line">  image.options = <a class="code" href="group__group__dime.html#ga4829f833abe74febcb8e5fe9360ab591">soap_dime_option</a>(&amp;soap, 0, <span class="stringliteral">&quot;My picture&quot;</span>); </div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns__webmethod(&amp;soap, ...))</div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  <span class="keywordflow">else</span></div><div class="line">    ... <span class="comment">// success</span></div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> *dime_read_open(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *type, <span class="keyword">const</span> <span class="keywordtype">char</span> *options) </div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> handle; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> dime_read_close(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle) </div><div class="line">{</div><div class="line">  fclose((FILE*)handle); </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">size_t</span> dime_read(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle, <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len) </div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> fread(buf, 1, len, (FILE*)handle); </div><div class="line">}</div></div><!-- fragment --><p>The following example illustrates the streaming of a DIME attachment into a file by a client:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#ga3b1e4aa046b683535110a34fc46ab1eb">fdimewriteopen</a> = dime_write_open; </div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#ga1ea0ca0526c4ccba02ec52f62e0678a9">fdimewriteclose</a> = dime_write_close; </div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#ga0f3214caa607f74505f11c76ade85cce">fdimewrite</a> = dime_write; </div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns__webmethod(&amp;soap, ...))</div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  <span class="keywordflow">else</span></div><div class="line">    ... <span class="comment">// success</span></div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> *dime_write_open(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *type, <span class="keyword">const</span> <span class="keywordtype">char</span> *options) </div><div class="line">{</div><div class="line">  FILE *handle = <a class="code" href="group__group__callbacks.html#ga9b4985eb5a588f4c16ad88ef7ca329dc">fopen</a>(<span class="stringliteral">&quot;somefile&quot;</span>, <span class="stringliteral">&quot;wb&quot;</span>); </div><div class="line">  <span class="keywordflow">if</span> (!handle) </div><div class="line">  {</div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> = <a class="code" href="group__group__errors.html#ga224b2c2b830135f12b53536f189b4ebd">SOAP_EOF</a>; </div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a> = errno; <span class="comment">// get reason </span></div><div class="line">  } </div><div class="line">  <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)handle; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> dime_write_close(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle) </div><div class="line">{</div><div class="line">  <a class="code" href="group__group__callbacks.html#gab9591dd80dbb0e571784bad5421b2202">fclose</a>((FILE*)handle); </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> dime_write(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len) </div><div class="line">{</div><div class="line">  <span class="keywordtype">size_t</span> nwritten; </div><div class="line">  <span class="keywordflow">while</span> (len) </div><div class="line">  {</div><div class="line">    nwritten = fwrite(buf, 1, len, (FILE*)handle); </div><div class="line">    <span class="keywordflow">if</span> (!nwritten) </div><div class="line">    {</div><div class="line">      soap-&gt;<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a> = errno; <span class="comment">// get reason </span></div><div class="line">      <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga224b2c2b830135f12b53536f189b4ebd">SOAP_EOF</a>; </div><div class="line">    } </div><div class="line">    len -= nwritten; </div><div class="line">    buf += nwritten; </div><div class="line">  } </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>Message compression with <code><a class="el" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8" title="soap_mode ENC output flag value to compress messages sent, requires zlib enabled with compile-time fl...">SOAP_ENC_ZLIB</a></code> can be used with DIME to compress the entire message. However, compression requires buffering to determine the HTTP content length header, which cancels the benefits of streaming DIME. To avoid this, you should use chunked HTTP (with the output-mode <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> flag) with compression and streaming DIME. At the server side, when you set <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> before calling <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code>, the engine will automatically revert to buffering (<code><a class="el" href="group__group__flags.html#gaf7cbb692f85f8633c4efc66dfae41e9e" title="soap_mode IO output flag value to store messages temporarily before transmission, e...">SOAP_IO_STORE</a></code> flag is set). You can check this flag with <code>(soap-&gt;omode &amp; SOAP_IO) == SOAP_IO_CHUNK</code> to see if the client accepts chunking. More information about streaming chunked DIME can be found in Section <a class="el" href="index.html#dimechunking">Streaming chunked DIME</a> .</p>
<dl class="section warning"><dt>Warning</dt><dd>The <code>options</code> member is a DIME-specific data structure, consisting of a 4 byte header containing the option type info (hi byte, lo byte), option string length (hi byte, lo byte), followed by a non-'\0' terminated string. The DIME handler recognizes one option at most.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="dimechunking"></a>
Streaming chunked DIME</h2>
<p>To send DIME attachments, the attachment sizes must be determined in advance to calculate HTTP message length required to stream DIME over HTTP. However, chunked DIME together with chunked HTTP can be used to omit this step. First set the <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> flag. Then, to stream chunked DIME, set the <code>__size</code> member of an attachment to zero and enable DIME chunking. The DIME <code><a class="el" href="group__group__callbacks.html#ga48270ad98961c3ff48c7b56484ebb3fa" title="Callback to read data in a DIME attachment stream. ">soap::fdimeread</a></code> callback then fetches data in chunks and it is important to fill the entire buffer unless the end of the data has been reached and the last chunk is to be send. That is, <code><a class="el" href="group__group__callbacks.html#ga48270ad98961c3ff48c7b56484ebb3fa" title="Callback to read data in a DIME attachment stream. ">soap::fdimeread</a></code> should return the value of the last <code>len</code> parameter and fill the entire buffer <code>buf</code> for all chunks except the last. For the last it returns 0.</p>
<p>You can also use the <code><a class="el" href="group__group__flags.html#gaf7cbb692f85f8633c4efc66dfae41e9e" title="soap_mode IO output flag value to store messages temporarily before transmission, e...">SOAP_IO_STORE</a></code> flag, but that cancels the benefits of streaming DIME.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="DIMEWSDL"></a>
WSDL bindings for DIME attachments</h2>
<p>The wsdl2h tool recognizes DIME attachments and produces an annotated header file. Both open and closed layouts are supported for transmitting DIME attachments. For closed formats, all DIME attachments must be referenced from the SOAP message, e.g. using hrefs with SOAP encoding and using the application-specific reference attribute included in the <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> struct or class for document/literal messaging.</p>
<p>The soapcpp2 tool does not produce a WSDL with DIME extensions. DIME is an older binary format that has no WSDL protocol support, unlike MIME and MTOM.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="MTOM"></a>
MTOM attachments</h1>
<p>MTOM (Message Transmission Optimization Mechanism) is a relatively new format for transmitting attachments with SOAP messages (see <a href="http://www.w3.org/TR/soap12-mtom">http://www.w3.org/TR/soap12-mtom</a>). MTOM attachments are essentially MIME attachments with standardized mechanisms for cross referencing attachments from the SOAP body, which is absent in (plain) MIME attachments and optional with DIME attachments.</p>
<p>Unlike the name suggests, the speed by which attached data is transmitted is not increased compared to MIME, DIME, or even XML encoded base64 data, because the performance differences when using gSOAP will be small. The advantage of the format is the standardized attachment reference mechanism, which should improve interoperability.</p>
<p>The MTOM specification mandates SOAP 1.2 and the use of the XOP namespace. The XOP Include element <em><code>xop:Include</code></em> is defined in the interface header file as a <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> struct or class, that is used to reference attachment(s) from the SOAP message body.</p>
<p>Because references from within the SOAP message body to attachments are mandatory with MTOM, the implementation of the serialization and deserialization of MTOM MIME attachments uses the extended binary type comparable to DIME support. This binary type is predefined in the <em><code>import/xop.h</code></em> file:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap xop schema import: http://www.w3.org/2004/08/xop/include </span></div><div class="line"><span class="keyword">struct </span><a class="code" href="struct__xop_____include.html">_xop__Include</a> </div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="struct__xop_____include.html#ab4388e79bc98595fefbde2fbcf5489ba">__ptr</a>; </div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="struct__xop_____include.html#a92be7a45ca282feee3a53fedf5c3a405">__size</a>; </div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="struct__xop_____include.html#a378e555a35df041c14d0f767dd128c20">id</a>; </div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="struct__xop_____include.html#a0d70af0d2c123766ce188cf2dd15833a">type</a>; </div><div class="line">    <span class="keywordtype">char</span> *<a class="code" href="struct__xop_____include.html#a894a54df2d052989ff2c20d344f56c91">options</a>; </div><div class="line">}; </div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__xop_____include.html">_xop__Include</a> <a class="code" href="struct__xop_____include.html">_xop__Include</a>;</div></div><!-- fragment --><p>The additional <code>id</code>, <code>type</code>, and <code>option</code> members enable MTOM attachments for the data pointed to by <code>__ptr</code> of size <code>__size</code>. The process for sending and receiving MTOM XOP attachments is fully automated. The <code>id</code> member references the attachment, typically a content id CID or UUID which can be obtained with <code><a class="el" href="group__group__misc.html#ga5fcf3c8f6f4bc6d5e6efd7a92ceaf399" title="Returns a randomized unique UUID string. ">soap_rand_uuid</a></code>. When set to NULL, a unique CID is automatically used. The <code>type</code> field specifies the required MIME type of the binary data, and the optional <code>options</code> member can be used to piggy-back descriptive text with an attachment. The order of the declaration of the members is significant.</p>
<p>You can import <em><code>xop.h</code></em> in your interface header file to use the MTOM attachments, for example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;import/xop.h&quot;</span> </div><div class="line"><span class="preprocessor">#import &quot;import/xmime5.h&quot;</span> </div><div class="line"><span class="preprocessor">#import &quot;import/soap12.h&quot;</span> </div><div class="line"><span class="comment">/* alternatively, without the import above, use: </span></div><div class="line"><span class="comment">//gsoap SOAP-ENV schema namespace: http://www.w3.org/2003/05/soap-envelope </span></div><div class="line"><span class="comment">//gsoap SOAP-ENC schema namespace: http://www.w3.org/2003/05/soap-encoding </span></div><div class="line"><span class="comment">*/</span> </div><div class="line"></div><div class="line"><span class="comment">//gsoap x schema namespace: http://my.first.mtom.net </span></div><div class="line"><span class="keyword">struct </span>x__myData </div><div class="line">{</div><div class="line">    <a class="code" href="struct__xop_____include.html">_xop__Include</a> xop__Include; <span class="comment">// attachment </span></div><div class="line">  @ <span class="keywordtype">char</span> *xmime5__contentType;  <span class="comment">// and its contentType </span></div><div class="line">}; </div><div class="line"><span class="keywordtype">int</span> x__myMTOMtest(<span class="keyword">struct</span> x__myData *in, <span class="keyword">struct</span> x__myData *out);</div></div><!-- fragment --><p>When an instance of <code>x__myDataType</code> is serialized and either or both the <code>id</code> and <code>type</code> members are non-NULL, the data is transmitted as MTOM MIME attachment if the <code><a class="el" href="group__group__flags.html#gac510f1f7c80fa8a3f20afa2dcfb53fb3" title="soap_mode ENC output flag value to enable MTOM XOP attachments in messages to be sent, receiving is automatic ">SOAP_ENC_MTOM</a></code> flag is set in the gSOAP's soap struct context:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#gac510f1f7c80fa8a3f20afa2dcfb53fb3">SOAP_ENC_MTOM</a>);</div></div><!-- fragment --><p>Without this flag, the attachments will be transmitted in DIME format, which is not what we want. If your current clients and services are based on non-streaming DIME attachments using the SOAP body reference mechanism (thus, without using the <code><a class="el" href="group__group__dime.html#ga742f96848174e27bfc8df7425b870f4b" title="Add a DIME attachment to the SOAP/XML message. ">soap_set_dime_attachment</a></code> function) or plain base64 binary XML data elements, it is very easy to adopt MTOM by renaming the binary types to <code>xop__Include</code> and using the <code><a class="el" href="group__group__flags.html#gac510f1f7c80fa8a3f20afa2dcfb53fb3" title="soap_mode ENC output flag value to enable MTOM XOP attachments in messages to be sent, receiving is automatic ">SOAP_ENC_MTOM</a></code> flag with the SOAP 1.2 namespace.</p>
<p>See also API documentation Module <a class="el" href="group__group__mime.html">MIME attachment functions</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="MIMEWSDL"></a>
Generating MultipartRelated MIME attachment bindings in WSDL</h2>
<p>To generate multipartRelated bindings in the WSDL file indicating the use of MIME attachments, use:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap &lt;prefix&gt; service method-mime-type: ...</span></div></div><!-- fragment --><p>This directive directive can be repeated for each attachment you want to associate with a method's request and response message. see also Section <a class="el" href="index.html#directives">Directives</a> .</p>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;import/xop.h&quot;</span> </div><div class="line"><span class="preprocessor">#import &quot;import/xmime5.h&quot;</span> </div><div class="line"><span class="preprocessor">#import &quot;import/soap12.h&quot;</span> </div><div class="line"></div><div class="line"><span class="comment">//gsoap x schema namespace: http://my.first.mtom.net </span></div><div class="line"><span class="keyword">struct </span>x__myData </div><div class="line">{</div><div class="line">    <a class="code" href="struct__xop_____include.html">_xop__Include</a> xop__Include; <span class="comment">// attachment </span></div><div class="line">  @ <span class="keywordtype">char</span> *xmime5__contentType;  <span class="comment">// and its contentType </span></div><div class="line">}; </div><div class="line"><span class="comment">//gsoap x service method-mime-type: myMTOMtest text/xml </span></div><div class="line"><span class="keywordtype">int</span> x__myMTOMtest(<span class="keyword">struct</span> x__myData *in, <span class="keyword">struct</span> x__myData *out);</div></div><!-- fragment --><p>The <code>//gsoap x service method-mime-type:</code> directive indicates that this operation accepts <em><code>text/xml</code></em> MIME attachments. See the SOAP-with-Attachment specification for the MIME types to use (for example, <code>*/*</code> is a wildcard). If the operation has more than one attachment, just repeat this directive for each attachment you want to bind to the operation.</p>
<p>To bind attachments only to the request message of an operation, use</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap &lt;prefix&gt; service method-input-mime-type: ...</span></div></div><!-- fragment --><p>Similarly, to bind attachments only to the response message of an operation, use:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap &lt;prefix&gt; service method-output-mime-type: ...</span></div></div><!-- fragment --><p>The wsdl2h tool recognizes MIME attachments and produces an annotated header file.</p>
<p>You can repeat these directives for all multipartRelated MIME attachments you want to associate with the service operation input and output.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="MTOMsendingreceiving"></a>
Sending and receiving MTOM attachments</h2>
<p>A receiver must be informed to recognize MTOM attachments by setting the <code><a class="el" href="group__group__flags.html#gac510f1f7c80fa8a3f20afa2dcfb53fb3" title="soap_mode ENC output flag value to enable MTOM XOP attachments in messages to be sent, receiving is automatic ">SOAP_ENC_MTOM</a></code> flag of the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context. Otherwise, the regular MIME attachment mechanism (SwA) will be used to store attachments.</p>
<p>When using wsdl2h to build clients and/or services, you should use the <em><code>typemap.dat</code></em> file included in the gSOAP source code package. The <em><code>typemap.dat</code></em> file defines the XOP namespace and XML MIME namespaces as imported namespaces: </p><pre class="fragment">xop    = &lt;http://www.w3.org/2004/08/xop/include&gt; 
xmime5 = &lt;http://www.w3.org/2005/05/xmlmime&gt; 
xmime4 = &lt;http://www.w3.org/2004/11/xmlmime&gt;
</pre><p>The wsdl2h tool uses the <em><code>typemap.dat</code></em> file to convert WSDL into an interface header file. In this case we don't want the wsdl2h tool to read the XOP schema and translate it, since we have a pre-defined <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> element to handle XOP for MTOM. This <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> element is defined in <em><code>xop.h</code></em>. Therefore, the bindings shown above will not translate the XOP and XML MIME schemas to code, but generates <code>#import</code> statements instead in the generated interface header file:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;xop.h&quot;</span> </div><div class="line"><span class="preprocessor">#import &quot;xmime5.h&quot;</span></div></div><!-- fragment --><p>The <code>#import</code> statements are only added for those namespaces that are actually used.</p>
<p>Let's take a look at an example. The wsdl2h importer generates a header file with <code>#import "xop.h"</code> from a WSDL that references XOP, for example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;xop.h&quot;</span> </div><div class="line"><span class="preprocessor">#import &quot;xmime5.h&quot;</span> </div><div class="line"><span class="keyword">struct </span>ns__Data </div><div class="line">{</div><div class="line">    <a class="code" href="struct__xop_____include.html">_xop__Include</a> xop__Include; </div><div class="line">  @ <span class="keywordtype">char</span> *xmime5__contentType;  </div><div class="line">};</div></div><!-- fragment --><p>Suppose the WSDL defines an operation:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__echoData(<span class="keyword">struct</span> ns__Data *in, <span class="keyword">struct</span> ns__Data *out);</div></div><!-- fragment --><p>After generating the stub functions with the soapcpp2 tool, we can invoke the stub at the client side with:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#gac510f1f7c80fa8a3f20afa2dcfb53fb3">SOAP_ENC_MTOM</a>); </div><div class="line"><span class="keyword">struct </span>ns__Data data; </div><div class="line">data.xop__Include.__ptr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;&lt;b&gt;Hello world!&lt;/b&gt;&quot;</span>; </div><div class="line">data.xop__Include.__size = 20; </div><div class="line">data.xop__Include.id = NULL;            <span class="comment">// CID automatically generated by engine </span></div><div class="line">data.xop__Include.type = <span class="stringliteral">&quot;text/html&quot;</span>;   <span class="comment">// MIME type </span></div><div class="line">data.xop__Include.options = NULL;       <span class="comment">// no descriptive info added </span></div><div class="line">data.xmime5__contentType = <span class="stringliteral">&quot;text/html&quot;</span>; <span class="comment">// MIME type </span></div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__echoData(soap, endpoint, action, &amp;data, &amp;data))</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line"><span class="keywordflow">else</span> </div><div class="line">  printf(<span class="stringliteral">&quot;Got data\n&quot;</span>); </div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div></div><!-- fragment --><p>Note that the <code>xop__Include.type</code> member must be set to transmit MTOM attachments, otherwise inline base64 XML will be sent.</p>
<p>At the server side, we show an example of an operation handler that just copies the input data to output:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__echoData(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> ns__Data *in, <span class="keyword">struct</span> ns__data *out) </div><div class="line">{</div><div class="line">  *out = *in; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>The server must use the <code><a class="el" href="group__group__flags.html#gac510f1f7c80fa8a3f20afa2dcfb53fb3" title="soap_mode ENC output flag value to enable MTOM XOP attachments in messages to be sent, receiving is automatic ">SOAP_ENC_MTOM</a></code> flag to initialize the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context to receive and send MTOM attachments.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="MTOMstreaming"></a>
Streaming MIME/MTOM</h2>
<p>Streaming MIME/MTOM is achieved with callback functions to fetch and store data during transmission. Three function callbacks for streaming MIME/MTOM output and three callbacks for streaming MIME/MTOM input are available.</p>
<ul>
<li><code>void *(*soap.fmimereadopen)(struct soap *soap, void *handle, const char *id, const char *type, const char *description)</code> This callback is called by the engine to start sending a streaming MIME/MTOM attachment. This callback opens a stream to start reading the attachment data to send. The actual data stream will be read in chunks using the <code><a class="el" href="group__group__callbacks.html#gaff40a1ca6fbf075b54ccbf479009ce74" title="Callback to read data in a MIME/MTOM attachment stream. ">soap::fmimeread</a></code> callback until no more data is available and the <code><a class="el" href="group__group__callbacks.html#ga884e94e8450f56049ba5071786170dd5" title="Callback to close a MIME/MTOM attachment stream after reading. ">soap::fmimereadclose</a></code> callback is called to close the stream. The <code>handle</code> parameter contains the value of the <code>__ptr</code> member variable of the attachment struct/class with data (e.g. <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> or <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> with <code>__ptr</code>, <code>__size</code>, <code>id</code>, <code>type</code> and <code>options</code> members), which should be a pointer to specific information such as a file descriptor or a pointer to a some application-specific data to be passed to this callback. Both the <code>__ptr</code> and <code>__size</code> members of the attachment struct/class should have been set by the application prior to the serialization of the message with attachments. If the <code>__size</code> is zero and HTTP chunking is enabled (with <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code>), then chunked MIME/MTOM attachments are sent, see <code><a class="el" href="group__group__callbacks.html#gaff40a1ca6fbf075b54ccbf479009ce74" title="Callback to read data in a MIME/MTOM attachment stream. ">soap::fmimeread</a></code>. The <code>id</code>, <code>type</code> and <code>options</code> parameters are the <code>id</code> (an optional ID), <code>type</code> (a MIME type) and <code>options</code> (a descriptive string) of the attachment struct/class, respectively, of which at least one member should be non-NULL. The callback should return the <code>handle</code> parameter value or another pointer value, which is passed as the new <code>handle</code> parameter to <code><a class="el" href="group__group__callbacks.html#gaff40a1ca6fbf075b54ccbf479009ce74" title="Callback to read data in a MIME/MTOM attachment stream. ">soap::fmimeread</a></code> and <code><a class="el" href="group__group__callbacks.html#ga884e94e8450f56049ba5071786170dd5" title="Callback to close a MIME/MTOM attachment stream after reading. ">soap::fmimereadclose</a></code> callbacks. When an error occurred in this callback, the callback should return NULL and set <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code> to an error code, e.g. using <code><a class="el" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6" title="Set SOAP 1.1 server fault / SOAP 1.2 receiver fault string and detail. ">soap_receiver_fault</a></code>. The callback may return NULL and set <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code> to <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> when this specific MIME/MTOM attachment should not to be streamed and the engine will simply skip it.</li>
<li><code>size_t (*soap.fmimeread)(struct soap *soap, void *handle, char *buf, size_t len)</code> This callback is called by the engine to read a chunk of attachment data to transmit. The <code>handle</code> parameter contains the handle returned by the <code><a class="el" href="group__group__callbacks.html#ga610f2a6a56d5ad04cb5124440a5de1dc" title="Callback to open a streaming MIME/MTOM attachment for reading. ">soap::fmimereadopen</a></code> callback. The <code>buf</code> parameter is the buffer of length <code>len</code> into which a chunk of data should be written by the callback. The actual amount of data written into the buffer may be less than <code>len</code> and this actual amount should be returned by the callback. A return value of zero indicates an error and <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code> should be set. The <code>__size</code> member variable of the attachment struct/class with data (e.g. <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> or <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> with <code>__ptr</code>, <code>__size</code>, <code>id</code>, <code>type</code> and <code>options</code> members) should be set by the application prior to the serialization of the message with attachments. The value of <code>__size</code> indicates the total size of the attachment data to be transmitted. If the <code>__size</code> member variable is zero and HTTP chunking is enabled (with <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code>), then MIME/MTOM chunked transfers are activated by the engine, which is more flexible since the attachment data size does not need to be determined in advance. To use MIME/MTOM chunked transfers, enable HTTP chunking with <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> (also <code><a class="el" href="group__group__flags.html#gaf7cbb692f85f8633c4efc66dfae41e9e" title="soap_mode IO output flag value to store messages temporarily before transmission, e...">SOAP_IO_STORE</a></code> can be used, but this buffers the entire message in memory before transmission) and set the <code>__size</code> member variable of the attachment struct/class to zero. When MIME/MTOM attachment chunking is enabled, this callback should completely fill the <code>buf</code> buffer with <code>len</code> bytes unless the last data chunk is reached and fewer bytes are returned.</li>
<li><code>void (*soap.fmimereadclose)(struct soap *soap, void *handle)</code> This callback is called by the engine to close the MIME/MTOM attachment stream after reading. The <code>handle</code> parameter contains the handle returned by the <code><a class="el" href="group__group__callbacks.html#ga610f2a6a56d5ad04cb5124440a5de1dc" title="Callback to open a streaming MIME/MTOM attachment for reading. ">soap::fmimereadopen</a></code> callback.</li>
<li><code>void *(*soap.fmimewriteopen)(struct soap *soap, void *handle, const char *id, const char *type, const char *description, enum soap_mime_encoding encoding)</code> Called by the to start receiving a streaming MIME/MTOM attachment. This callback opens a stream to start writing the attachment data received. The actual data stream will be written in chunks using the <code><a class="el" href="group__group__callbacks.html#ga9084f0392e4a54287366121d30bc4830" title="Callback to write data in a MIME attachment stream. ">soap::fmimewrite</a></code> callback until no more data is available and the <code><a class="el" href="group__group__callbacks.html#ga8af884096b21cea1b69133843131a47b" title="Callback to close a MIME/MTOM attachment stream after writing. ">soap::fmimewriteclose</a></code> callback is called to close the stream. The <code>id</code>, <code>type</code> and <code>options</code> parameters are the <code>id</code>, <code>type</code> and <code>options</code> of the attachment struct/class (e.g. <code><a class="el" href="structxsd____base64_binary.html" title="XSD base64Binary structure with attachment data. ">xsd__base64Binary</a></code> or <code><a class="el" href="struct__xop_____include.html" title="XOP include structure with attachment data. ">_xop__Include</a></code> with <code>__ptr</code>, <code>__size</code>, <code>id</code>, <code>type</code> and <code>options</code> members), respectively. The callback should return a handle, which is passed to the <code><a class="el" href="group__group__callbacks.html#ga9084f0392e4a54287366121d30bc4830" title="Callback to write data in a MIME attachment stream. ">soap::fmimewrite</a></code> and <code><a class="el" href="group__group__callbacks.html#ga8af884096b21cea1b69133843131a47b" title="Callback to close a MIME/MTOM attachment stream after writing. ">soap::fmimewriteclose</a></code> callbacks. The <code>__ptr</code> member variable of the attachment struct/class is set by the engine to the value of this handle. The <code>__size</code> member variable is set to the size of the attachment received.</li>
<li><code>int (*soap.fmimewrite)(struct soap *soap, void *handle, const char *buf, size_t len)</code> This callback is called by the engine to write a chunk of attachment data received. The <code>handle</code> parameter contains the handle returned by the <code><a class="el" href="group__group__callbacks.html#gaef809b275fd65e57991a80663288fa72" title="Callback to open a streaming MIME/MTOM attachment for writing. ">soap::fmimewriteopen</a></code> callback. The <code>buf</code> parameter contains the data of length <code>len</code>. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code.</li>
<li><code>void (*soap.fmimewriteclose)(struct soap *soap, void *handle)</code> This callback is called by the engine to close the MIME/MTOM attachment stream after writing. The <code>handle</code> parameter contains the handle returned by the <code><a class="el" href="group__group__callbacks.html#gaef809b275fd65e57991a80663288fa72" title="Callback to open a streaming MIME/MTOM attachment for writing. ">soap::fmimewriteopen</a></code> callback.</li>
</ul>
<p>In addition, a <code>void* <a class="el" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b" title="User-definable variable that may point to user-specified data of any type to pass the data through to...">soap::user</a></code> member is available to pass user-defined data to the callbacks. This way, you can set <code>void* <a class="el" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b" title="User-definable variable that may point to user-specified data of any type to pass the data through to...">soap::user</a></code> to point to application data that the callbacks need such as a file name for example.</p>
<p>The following example illustrates the client-side initialization of an image attachment struct to stream a file into a MTOM attachment without HTTP chunking (HTTP streaming chunked MTOM transfer is presented in Section <a class="el" href="index.html#mimechunking">Streaming chunked MIME/MTOM</a> ):</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <span class="keyword">struct </span>xsd__base64Binary image; </div><div class="line">  FILE *fd; </div><div class="line">  <span class="keyword">struct </span>stat sb; </div><div class="line">  <a class="code" href="group__group__context.html#gac87126c3e45d2fda488e9832c2dd5be1">soap_init1</a>(&amp;soap, <a class="code" href="group__group__flags.html#gac510f1f7c80fa8a3f20afa2dcfb53fb3">SOAP_ENC_MTOM</a>); <span class="comment">// mandatory to enable MTOM </span></div><div class="line">  <span class="keywordflow">if</span> (!fstat(fileno(fd), &amp;sb) &amp;&amp; sb.st_size &gt; 0) </div><div class="line">  {</div><div class="line">    <span class="comment">// because we can get the length of the file, we can stream it without chunking </span></div><div class="line">    soap.<a class="code" href="group__group__callbacks.html#ga610f2a6a56d5ad04cb5124440a5de1dc">fmimereadopen</a> = mime_read_open; </div><div class="line">    soap.<a class="code" href="group__group__callbacks.html#ga884e94e8450f56049ba5071786170dd5">fmimereadclose</a> = mime_read_close; </div><div class="line">    soap.<a class="code" href="group__group__callbacks.html#gaff40a1ca6fbf075b54ccbf479009ce74">fmimeread</a> = mime_read; </div><div class="line">    image.__ptr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)fd; <span class="comment">// must set to non-NULL (this is our fd handle which we need in the callbacks) </span></div><div class="line">    image.__size = sb.st_size; <span class="comment">// must set size </span></div><div class="line">  } </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">  {</div><div class="line">    <span class="comment">// don&#39;t know the size, so buffer it </span></div><div class="line">    <span class="keywordtype">size_t</span> i; </div><div class="line">    <span class="keywordtype">int</span> c; </div><div class="line">    image.__ptr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<a class="code" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c">soap_malloc</a>(&amp;soap, MAX_FILE_SIZE); </div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_FILE_SIZE; i++) </div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> ((c = fgetc(fd)) == EOF) </div><div class="line">        <span class="keywordflow">break</span>; </div><div class="line">      image.__ptr[i] = c; </div><div class="line">    } </div><div class="line">    fclose(fd); </div><div class="line">    image.__size = i; </div><div class="line">  } </div><div class="line">  image.type = <span class="stringliteral">&quot;image/jpeg&quot;</span>; <span class="comment">// MIME type </span></div><div class="line">  image.options = <span class="stringliteral">&quot;This is my picture&quot;</span>; <span class="comment">// description of object </span></div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns__webmethod(&amp;soap, ...))</div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  <span class="keywordflow">else</span></div><div class="line">    ... <span class="comment">// success</span></div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> *mime_read_open(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *type, <span class="keyword">const</span> <span class="keywordtype">char</span> *description) </div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> handle; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> mime_read_close(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle) </div><div class="line">{</div><div class="line">  fclose((FILE*)handle); </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">size_t</span> mime_read(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle, <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len) </div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> fread(buf, 1, len, (FILE*)handle); </div><div class="line">}</div></div><!-- fragment --><p>The following example illustrates the streaming of a MIME/MTOM attachment into a file by a client:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#gaef809b275fd65e57991a80663288fa72">fmimewriteopen</a> = mime_write_open; </div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#ga8af884096b21cea1b69133843131a47b">fmimewriteclose</a> = mime_write_close; </div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#ga9084f0392e4a54287366121d30bc4830">fmimewrite</a> = mime_write; </div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns__webmethod(&amp;soap, ...))</div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  <span class="keywordflow">else</span></div><div class="line">    ... <span class="comment">// success</span></div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> *mime_write_open(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *type, <span class="keyword">const</span> <span class="keywordtype">char</span> *description, <span class="keyword">enum</span> <a class="code" href="group__group__mime.html#ga3fec7633da07bff2bf5fd6330bef1844">soap_mime_encoding</a> encoding) </div><div class="line">{</div><div class="line">  FILE *handle = <a class="code" href="group__group__callbacks.html#ga9b4985eb5a588f4c16ad88ef7ca329dc">fopen</a>(<span class="stringliteral">&quot;somefile&quot;</span>, <span class="stringliteral">&quot;wb&quot;</span>); </div><div class="line">  <span class="comment">// We ignore the MIME content transfer encoding here, but should check </span></div><div class="line">  <span class="keywordflow">if</span> (!handle) </div><div class="line">  {</div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> = <a class="code" href="group__group__errors.html#ga224b2c2b830135f12b53536f189b4ebd">SOAP_EOF</a>; </div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a> = errno; <span class="comment">// get reason </span></div><div class="line">  } </div><div class="line">  <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)handle; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> mime_write_close(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle) </div><div class="line">{</div><div class="line">  <a class="code" href="group__group__callbacks.html#gab9591dd80dbb0e571784bad5421b2202">fclose</a>((FILE*)handle); </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> mime_write(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len) </div><div class="line">{</div><div class="line">  <span class="keywordtype">size_t</span> nwritten; </div><div class="line">  <span class="keywordflow">while</span> (len) </div><div class="line">  {</div><div class="line">    nwritten = fwrite(buf, 1, len, (FILE*)handle); </div><div class="line">    <span class="keywordflow">if</span> (!nwritten) </div><div class="line">    {</div><div class="line">      soap-&gt;<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a> = errno; <span class="comment">// get reason </span></div><div class="line">      <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga224b2c2b830135f12b53536f189b4ebd">SOAP_EOF</a>; </div><div class="line">    } </div><div class="line">    len -= nwritten; </div><div class="line">    buf += nwritten; </div><div class="line">  } </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>Message compression with <code><a class="el" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8" title="soap_mode ENC output flag value to compress messages sent, requires zlib enabled with compile-time fl...">SOAP_ENC_ZLIB</a></code> can be used with MIME to compress the entire message. However, compression requires buffering to determine the HTTP content length header, which cancels the benefits of streaming MIME. To avoid this, you should use chunked HTTP (with the output-mode <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> flag) with compression and streaming MIME. At the server side, when you set <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> before calling <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code>, the engine will automatically revert to buffering (<code><a class="el" href="group__group__flags.html#gaf7cbb692f85f8633c4efc66dfae41e9e" title="soap_mode IO output flag value to store messages temporarily before transmission, e...">SOAP_IO_STORE</a></code> flag is set). You can check this flag with <code>(soap-&gt;omode &amp; SOAP_IO) == SOAP_IO_CHUNK</code> to see if the client accepts chunking. More information about streaming chunked MIME can be found in Section <a class="el" href="index.html#mimechunking">Streaming chunked MIME/MTOM</a> ..</p>
<p>Note that the example above for <code>mime_read</code> uses a handle that points to the open file <code>FILE*</code>. The simple example above is not recommended when the platform imposes a limit on the number of open file descriptors. You can use the handle to pass along more information than just the file descriptor. So for example, when the number of open file descriptors is limited on your platform, you should let the handle point to a structure with file-related information. The C++ example below illustrates this:</p>
<div class="fragment"><div class="line">file.xop__Include = soap_new__xop__Include(soap); </div><div class="line">file.xop__Include-&gt;id = NULL; </div><div class="line">file.xop__Include-&gt;type = type; </div><div class="line">file.xop__Include-&gt;options = NULL; </div><div class="line"></div><div class="line">file.xmime5__contentType = type; </div><div class="line">file.filename = filename; </div><div class="line"></div><div class="line"><span class="comment">// The object holding all information to read data </span></div><div class="line">FileStreamIn *ins = <span class="keyword">new</span> FileStreamIn(errorhandler); </div><div class="line">ins-&gt;setFilePath(<a class="code" href="structsoap.html#a3c2bd2822146a8ccca20f8f217c2f309">path</a>); </div><div class="line">ins-&gt;setFileName(filename); </div><div class="line"></div><div class="line">file.xop__Include-&gt;__size = size; </div><div class="line">file.xop__Include-&gt;__ptr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)ins;</div></div><!-- fragment --><p>To read the MTOM data for transmission:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> *mime_read_open(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *type, <span class="keyword">const</span> <span class="keywordtype">char</span> *description) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (!handle) </div><div class="line">    <span class="keywordflow">return</span> NULL; </div><div class="line">  FileStreamIn *ins = (FileStreamIn*)handle; </div><div class="line">  <span class="keywordflow">if</span> (!ins-&gt;open()) </div><div class="line">  {</div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> = <a class="code" href="group__group__errors.html#ga1273756841a728f037ee5328e217eb6e">SOAP_ERR</a>; </div><div class="line">    <span class="keywordflow">return</span> NULL; </div><div class="line">  } </div><div class="line">  <span class="keywordflow">return</span> handle; </div><div class="line">} </div><div class="line"><span class="keywordtype">void</span> mime_read_close(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (!handle) </div><div class="line">    <span class="keywordflow">return</span>; </div><div class="line">  FileStreamIn *ins = (FileStreamIn*)handle; </div><div class="line">  <span class="keyword">delete</span> ins; </div><div class="line">} </div><div class="line"><span class="keywordtype">size_t</span> mime_read(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">void</span> *handle, <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (!handle) </div><div class="line">    <span class="keywordflow">return</span> 0; </div><div class="line">  FileStreamIn *ins = (FileStreamIn*)handle; </div><div class="line">  <span class="keywordtype">size_t</span> nread = ins-&gt;read(buf, len); </div><div class="line">  <span class="keywordflow">if</span> (ins-&gt;streamError()) </div><div class="line">  {</div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> = ins-&gt;streamError(); </div><div class="line">    <span class="keywordflow">return</span> 0; </div><div class="line">  } </div><div class="line">  <span class="keywordflow">return</span> nread; </div><div class="line">}</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="MTOMpoststreaming"></a>
Redirecting inbound MIME/MTOM streams based on SOAP body content</h2>
<p>When it is preferable or required to redirect inbound MIME/MTOM attachment streams based on SOAP message body content, where for example the names of the resources are listed in the SOAP message body, an alternative mechanism must be used to handle the attachments. This mechanism can be used at the client and server side.</p>
<p>Because the routing of the streams is accomplished with explicit function calls, this method should only be used when required and should not be considered optional. That is, when you enable this method, you must check for pending MIME/MTOM attachments and handle them appropriately. This is true even when you don't expect MIME/MTOM attachments in the payload, because the peer may trick you by sending attachments anyway and you should be prepared to accept or reject them.</p>
<p>The explicit MIME/MTOM streaming mechanism consists of three API functions:</p>
<ul>
<li><code>void <a class="el" href="group__group__mime.html#ga57cf2a958b2ce6e957895642cd4c0966" title="Enable post-processing of MIME/MTOM attachments. ">soap_post_check_mime_attachments(struct soap *soap)</a></code> This function enables post-processing of MIME/MTOM attachments received. This means that the presence of MIME/MTOM attachments must be explicitly checked by calling <code><a class="el" href="group__group__mime.html#gaf2cb661a31f0cc431a3738125ddedb8f" title="Check for a MIME/MTOM attachment. ">soap_check_mime_attachments</a></code> after the message was received. When this function returns nonzero (true), then the attachments can be retrieved by calling <code><a class="el" href="group__group__mime.html#ga117fe70b589a08a9fa9ad06c3f5bd009" title="Get a MIME/MTOM attachment. ">soap_recv_mime_attachment</a></code> repeatedly to retrieve each attachment until this function returns NULL. This function returns a pointer to a <code>struct <a class="el" href="structsoap__multipart.html" title="DIME/MIME/MTOM attachment data received by the engine. ">soap_multipart</a></code> attachment.</li>
<li><code>int <a class="el" href="group__group__mime.html#gaf2cb661a31f0cc431a3738125ddedb8f" title="Check for a MIME/MTOM attachment. ">soap_check_mime_attachments(struct soap *soap)</a></code> This function checks the presence of a MIME/MTOM attachment after calling a service operation by returning nonzero when attachments are present. Returns nonzero if attachments are present. Requires <code><a class="el" href="group__group__mime.html#ga57cf2a958b2ce6e957895642cd4c0966" title="Enable post-processing of MIME/MTOM attachments. ">soap_post_check_mime_attachments</a></code>.</li>
<li><code>struct <a class="el" href="structsoap__multipart.html" title="DIME/MIME/MTOM attachment data received by the engine. ">soap_multipart</a> *soap_recv_mime_attachment(struct soap *soap, void *handle)</code> This function parses an attachment and invokes the MIME callbacks when set. The <code>handle</code> parameter is passed to <code>fmimewriteopen</code>. The handle may contain any data that is extracted from the SOAP message body to guide the redirection of the stream in the callbacks. Returns a struct with a <code>char *ptr</code> member that contains the handle value returned by the <code>fmimewriteopen</code> callback, and <code>char *id</code>, <code>char *type</code>, and <code>char *description</code> member variables with the MIME id, type, and description info when present in the attachment.</li>
</ul>
<p>Example client in C:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#gac510f1f7c80fa8a3f20afa2dcfb53fb3">SOAP_ENC_MTOM</a>); </div><div class="line"><a class="code" href="group__group__mime.html#ga57cf2a958b2ce6e957895642cd4c0966">soap_post_check_mime_attachments</a>(soap); </div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__myMethod(soap, ...)) </div><div class="line">{</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); <span class="comment">// an error occurred </span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span> </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__mime.html#gaf2cb661a31f0cc431a3738125ddedb8f">soap_check_mime_attachments</a>(soap))</div><div class="line">  {</div><div class="line">    <span class="comment">// attachments are present, channel is still open </span></div><div class="line">    <span class="keywordflow">do</span></div><div class="line">    {</div><div class="line">      ... <span class="comment">// get data &#39;handle&#39; from SOAP response and pass to callbacks </span></div><div class="line">      ... <span class="comment">// set the fmime callbacks, if needed </span></div><div class="line">      <span class="keyword">struct </span><a class="code" href="structsoap__multipart.html">soap_multipart</a> *content = <a class="code" href="group__group__mime.html#ga117fe70b589a08a9fa9ad06c3f5bd009">soap_recv_mime_attachment</a>(soap, (<span class="keywordtype">void</span>*)handle); </div><div class="line">      printf(<span class="stringliteral">&quot;Received attachment with id=%s and type=%s\n&quot;</span>, content-&gt;<a class="code" href="structsoap__multipart.html#ad0bcd79b40a1bc1dc13fc343477f5564">id</a>?content-&gt;<a class="code" href="structsoap__multipart.html#ad0bcd79b40a1bc1dc13fc343477f5564">id</a>:<span class="stringliteral">&quot;&quot;</span>, content-&gt;<a class="code" href="structsoap__multipart.html#a495c8d20e0334be1b1345193ca2fb764">type</a>?content-&gt;<a class="code" href="structsoap__multipart.html#a495c8d20e0334be1b1345193ca2fb764">type</a>:<span class="stringliteral">&quot;&quot;</span>); </div><div class="line">    } <span class="keywordflow">while</span> (content); </div><div class="line">    <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>) </div><div class="line">      <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">  }</div><div class="line">} </div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div></div><!-- fragment --><p>The server-side service operations are implemented as usual, but with additional checks for MIME/MTOM attachments:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#gac510f1f7c80fa8a3f20afa2dcfb53fb3">SOAP_ENC_MTOM</a>); </div><div class="line">  <a class="code" href="group__group__mime.html#ga57cf2a958b2ce6e957895642cd4c0966">soap_post_check_mime_attachments</a>(soap); </div><div class="line">  <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(soap); </div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__myMethod(<span class="keyword">struct</span> soap *soap, ...) </div><div class="line">{</div><div class="line">  ... <span class="comment">// server-side processing logic </span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__mime.html#gaf2cb661a31f0cc431a3738125ddedb8f">soap_check_mime_attachments</a>(soap))</div><div class="line">  {</div><div class="line">    <span class="comment">// attachments are present, channel is still open </span></div><div class="line">    <span class="keywordflow">do</span> </div><div class="line">    {</div><div class="line">      ... <span class="comment">// get data &#39;handle&#39; from SOAP request and pass to callbacks </span></div><div class="line">      ... <span class="comment">// set the fmime callbacks, if needed </span></div><div class="line">      <span class="keyword">struct </span><a class="code" href="structsoap__multipart.html">soap_multipart</a> *content = <a class="code" href="group__group__mime.html#ga117fe70b589a08a9fa9ad06c3f5bd009">soap_recv_mime_attachment</a>(soap, (<span class="keywordtype">void</span>*)handle); </div><div class="line">      printf(<span class="stringliteral">&quot;Received attachment with id=%s and type=%s\n&quot;</span>, content-&gt;<a class="code" href="structsoap__multipart.html#ad0bcd79b40a1bc1dc13fc343477f5564">id</a>?content-&gt;<a class="code" href="structsoap__multipart.html#ad0bcd79b40a1bc1dc13fc343477f5564">id</a>:<span class="stringliteral">&quot;&quot;</span>, content-&gt;<a class="code" href="structsoap__multipart.html#a495c8d20e0334be1b1345193ca2fb764">type</a>?content-&gt;<a class="code" href="structsoap__multipart.html#a495c8d20e0334be1b1345193ca2fb764">type</a>:<span class="stringliteral">&quot;&quot;</span>); </div><div class="line">    } <span class="keywordflow">while</span> (content); </div><div class="line">    <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>) </div><div class="line">      <span class="keywordflow">return</span> soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>; </div><div class="line">  } </div><div class="line">  ... <span class="comment">// server-side processing logic </span></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="mimechunking"></a>
Streaming chunked MIME/MTOM</h2>
<p>To send MIME/MTOM attachments, the attachment sizes must be determined in advance to calculate HTTP message length required to stream MIME/MTOM over HTTP. However, chunked MIME/MTOM together with chunked HTTP can be used to omit this step. First set the <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> flag. Then, to stream chunked MIME/MTOM, set the <code>__size</code> member of an attachment to zero and enable MIME/MTOM chunking. The MIME/MTOM <code><a class="el" href="group__group__callbacks.html#gaff40a1ca6fbf075b54ccbf479009ce74" title="Callback to read data in a MIME/MTOM attachment stream. ">soap::fmimeread</a></code> callback then fetches data in chunks and it is important to fill the entire buffer unless the end of the data has been reached and the last chunk is to be send. That is, <code><a class="el" href="group__group__callbacks.html#gaff40a1ca6fbf075b54ccbf479009ce74" title="Callback to read data in a MIME/MTOM attachment stream. ">soap::fmimeread</a></code> should return the value of the last <code>len</code> parameter and fill the entire buffer <code>buf</code> for all chunks except the last. For the last it returns 0.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="UDP"></a>
SOAP/XML over UDP</h1>
<p>UDP is a simple, unreliable datagram protocol: UDP sockets are connectionless. UDP address formats are identical to those used by TCP. In particular UDP provides a port identifier in addition to the normal Internet address format. The UDP port space is separate from the TCP port space (i.e. a UDP port may not be "connected" to a TCP port). In addition broadcast packets may be sent (assuming the underlying network supports this) by using a reserved "broadcast
address"; this address is network interface dependent.</p>
<p>Client-side messages with SOAP-over-UDP endpoint URLs (<code>soap.udp://...</code>) are automatically transmitted as datagrams. Server-side applications should set the <code><a class="el" href="group__group__flags.html#ga388dae9abc80cd6f6d0ecfba383da03b" title="soap_mode IO input/output flag value to use UDP datagrams, message size is limited to UDP packet size...">SOAP_IO_UDP</a></code> mode flag to accept UDP requests, e.g. using <code><a class="el" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658" title="Allocate and initialize a new soap context with input and output soap_mode flags. ...">soap_new1</a></code>, <code><a class="el" href="group__group__context.html#gac87126c3e45d2fda488e9832c2dd5be1" title="Initialize a stack-allocated soap context with input and output soap_mode flags. ">soap_init1</a></code>, or <code><a class="el" href="group__group__context.html#ga84f52a67a41009b260ff2c036df7f6ab" title="Set input and output soap_mode flags of the given soap context. ">soap_set_mode</a></code>.</p>
<p>The maximum message length for datagram packets is restricted by the buffer size <code><a class="el" href="group__group__soap.html#ga6ec95d997cc20a6a84dd4d76b3ea2fcc" title="User-definable size of the input and output message buffer soap::buf (the value is 65536 by default) ...">SOAP_BUFLEN</a></code>, which is 65536 by default, unless compiled with <code><a class="el" href="group__group__with.html#gaae03aa5dd66b0251c11ba8fc2fe29ecf" title="When this macro is defined at compile time (undefined by default), memory footprint is significantly ...">WITH_LEAN</a></code> to support small-scale embedded systems. For UDP transport <code><a class="el" href="group__group__soap.html#ga6ec95d997cc20a6a84dd4d76b3ea2fcc" title="User-definable size of the input and output message buffer soap::buf (the value is 65536 by default) ...">SOAP_BUFLEN</a></code> must not exceed the maximum UDP packet size 65536 (the size of datagram messages is constrained by the UDP packet size 2^16=65536 as per UDP standard). You can use compression with <code><a class="el" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8" title="soap_mode ENC output flag value to compress messages sent, requires zlib enabled with compile-time fl...">SOAP_ENC_ZLIB</a></code> to reduce the message size, but note that compressed SOAP-over-UDP is a gSOAP-specific feature because it is not part of the SOAP-over-UDP specification.</p>
<p>The SOAP-over-UDP specification relies on WS-Addressing. The <em><code>wsa.h</code></em> file in the <code>import</code> directory defines the WS-Addressing elements for client and server applications.</p>
<p>The gSOAP implementation conforms to the SOAP-over-UDP requirements:</p>
<ul>
<li>SOAP-over-UDP server endpoint URL format: <em><code>soap.udp://host:port/path</code></em></li>
<li>Support one-way message-exchange pattern (MEP) where a SOAP envelope is carried in a user datagram.</li>
<li>Support request-response message-exchange pattern (MEP) where SOAP envelopes are carried in user datagrams.</li>
<li>Support multicast transmission of SOAP envelopes carried in user datagrams.</li>
<li>Support both SOAP 1.1 and SOAP 1.2 envelopes.</li>
</ul>
<p>The following additional features are also available, but are not supported by the SOAP-over-UDP specification:</p>
<ul>
<li>Zlib/gzip message compression (use compile-time flag <code><a class="el" href="group__group__with.html#gad30a07ea604aea8cb00f41f6310cf30f" title="When this macro is defined at compile time (undefined by default), enables linkage with the zlib libr...">WITH_GZIP</a></code>).</li>
<li>SOAP with DIME attachments over UDP.</li>
<li>SOAP with MIME/MTOM attachments over UDP.</li>
<li>Support for IPv6 (use compile-time flag <code><a class="el" href="group__group__with.html#ga40cbd680e7dbdeb63bce1d6d4b7b9620" title="When this macro is defined at compile time (undefined by default), IPv6 support is enabled and both I...">WITH_IPV6</a></code>)</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="wsaudp"></a>
Using WS-Addressing with SOAP-over-UDP</h2>
<p>A SOAP-over-UDP application may use WS-Addressing to control message delivery as per SOAP-over-UDP specification.</p>
<p>The <em><code>wsa.h</code></em> file in the <code>import</code> directory defines the WS-Addressing elements. To include the WS-Addressing elements in the SOAP Header for messaging, a WS-Addressing capable <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> struct should be defined in your header file by importing <em><code>gsoap/import/wsa.h</code></em> or <em><code>gsoap/import/wsa5.h</code></em>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;wsa.h&quot;</span> </div></div><!-- fragment --><p>We also included a <code>//gsoap wsa schema import:</code> directive in the <em><code>wsa.h</code></em> file to enable the generation of WSDL specifications that import (instead of includes) the WS-Addressing elements. Note that the <code>//gsoapopt w</code> directive (which adds option <b><code>-w</code></b> to run <b><code>soapcpp2 -w</code></b>) must not be present in your header file to enable WSDL generation.</p>
<p>One-way SOAP-over-UDP messages (see Section <a class="el" href="index.html#oneway1">Asynchronous one-way message passing</a> ) should be declared to include the <em><code>wsa:MessageID</code></em>, <em><code>wsa:To</code></em>, and <em><code>wsa:Action</code></em> elements in the SOAP Header of the request message as follows:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service method-header-part:          sendString wsa__MessageID </span></div><div class="line"><span class="comment">//gsoap ns service method-header-part:          sendString wsa__To </span></div><div class="line"><span class="comment">//gsoap ns service method-header-part:          sendString wsa__Action </span></div><div class="line"><span class="keywordtype">int</span> ns__sendString(<span class="keywordtype">char</span> *str, <span class="keywordtype">void</span>);</div></div><!-- fragment --><p>Request-response SOAP-over-UDP messages should be declared to include the <em><code>wsa:MessageID</code></em>, <em><code>wsa:To</code></em>, <em><code>wsa:Action</code></em>, and <em><code>wsa:ReplyTo</code></em> elements in the SOAP Header of the request message, and the the <em><code>wsa:MessageID</code></em>, <em><code>wsa:To</code></em>, <em><code>wsa:Action</code></em>, and <em><code>wsa:RelatesTo</code></em> elements in the SOAP Header of the response message:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service method-header-part:          echoString wsa__MessageID </span></div><div class="line"><span class="comment">//gsoap ns service method-header-part:          echoString wsa__To </span></div><div class="line"><span class="comment">//gsoap ns service method-header-part:          echoString wsa__Action </span></div><div class="line"><span class="comment">//gsoap ns service method-input-header-part:    echoString wsa__ReplyTo </span></div><div class="line"><span class="comment">//gsoap ns service method-output-header-part:   echoString wsa__RelatesTo </span></div><div class="line"><span class="keywordtype">int</span> ns__echoString(<span class="keywordtype">char</span> *str, <span class="keywordtype">char</span> **res);</div></div><!-- fragment --><p>For the content requirements of these elements, please consult the SOAP-over-UDP specification and/or read the next sections explaining SOAP-over-UDP unicast, multicast, one-way, and request-response client and server applications.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="unicast"></a>
Client-side one-way UDP unicast</h3>
<p>This example assumes that the interface header file includes the SOAP Header with WS-Addressing elements, see <a class="el" href="index.html#wsaplugin">The WS-Addressing plugin</a>, and the <code>ns__sendString</code> function discussed in Section <a class="el" href="index.html#wsaudp">Using WS-Addressing with SOAP-over-UDP</a>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;plugin/wsaapi.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>soap soap; </div><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line"><a class="code" href="group__group__plugin.html#gad645e5a58ed442fe4753dcc2338c8bdb">soap_register_plugin</a>(&amp;soap, soap_wsa);</div><div class="line">soap.<a class="code" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474">send_timeout</a> = 5; <span class="comment">// 5 seconds max socket delay </span></div><div class="line"><span class="comment">// set up WS-Addressing header</span></div><div class="line">soap_wsa_request(&amp;soap, <span class="stringliteral">&quot;message ID&quot;</span>, <span class="stringliteral">&quot;endpoint&quot;</span>, <span class="stringliteral">&quot;SOAP action&quot;</span>);</div><div class="line"><span class="comment">// Send the message over UDP: </span></div><div class="line"><span class="keywordflow">if</span> (soap_send_ns__echoString(&amp;soap, <span class="stringliteral">&quot;soap.udp://endpoint&quot;</span>, <span class="stringliteral">&quot;SOAP action&quot;</span>, <span class="stringliteral">&quot;hello world!&quot;</span>)) </div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); <span class="comment">// error </span></div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line"><a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="multicast"></a>
Client-side one-way UDP multicast</h3>
<p>This example is similar to the one-way unicast example discussed above, but uses a broadcast address and the <code>SO_BROADCAST</code> socket option:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;plugin/wsaapi.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>soap soap; </div><div class="line">in_addr_t addr = inet_addr(<span class="stringliteral">&quot;1.2.3.4&quot;</span>); <span class="comment">// optional </span></div><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line"><a class="code" href="group__group__plugin.html#gad645e5a58ed442fe4753dcc2338c8bdb">soap_register_plugin</a>(&amp;soap, soap_wsa);</div><div class="line">soap.<a class="code" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474">send_timeout</a> = 5; <span class="comment">// 5 seconds max socket delay</span></div><div class="line">soap.<a class="code" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794">connect_flags</a> = SO_BROADCAST; <span class="comment">// required for broadcast </span></div><div class="line">soap.<a class="code" href="structsoap.html#accb43a5716005b473fa1d5688967a3b3">ipv4_multicast_if</a> = &amp;addr; <span class="comment">// optional for IPv4: see setsockopt IPPROTO_IP IP_MULTICAST_IF </span></div><div class="line">soap.<a class="code" href="structsoap.html#a3db0542e8eb7db6a2f2cbc16fb24082b">ipv6_multicast_if</a> = addr; <span class="comment">// optional for IPv6: multicast sin6_scope_id </span></div><div class="line">soap.<a class="code" href="structsoap.html#aa5faa7630425a8ab8018f0b2d4d0c18d">ipv4_multicast_ttl</a> = 1; <span class="comment">// optional, see setsockopt IPPROTO_IP, IP_MULTICAST_TTL </span></div><div class="line"><span class="comment">// set up WS-Addressing header</span></div><div class="line">soap_wsa_request(&amp;soap, <span class="stringliteral">&quot;message ID&quot;</span>, <span class="stringliteral">&quot;endpoint&quot;</span>, <span class="stringliteral">&quot;SOAP action&quot;</span>);</div><div class="line"><span class="comment">// Send the message over UDP to a broadcast address: </span></div><div class="line"><span class="keywordflow">if</span> (soap_send_ns__echoString(&amp;soap, <span class="stringliteral">&quot;soap.udp://endpoint&quot;</span>, <span class="stringliteral">&quot;SOAP action&quot;</span>, <span class="stringliteral">&quot;hello world!&quot;</span>)) </div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); <span class="comment">// report error </span></div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line"><a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div></div><!-- fragment --><p>Please refer to the socket options for <code>IPPROTO_IP</code> <code>IP_MULTICAST_IF</code> to specify the default interface for multicast datagrams to be sent from. This is a <code>struct in_addr</code> (<code>in_addr_t</code> for <code>sin6_scope_id</code>) interface value. Otherwise, the default interface set by the system administrator will be used (if any).</p>
<p>Please refer to the socket options for <code>IPPROTO_IP</code> <code>IP_MULTICAST_TTL</code> to limit the lifetime of the packet. Multicast datagrams are sent with a default value of 1, to prevent them to be forwarded beyond the local network. This parameter can be set between 1 to 255.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="requestresponseunicast"></a>
Client-side request-response UDP unicast</h3>
<p>This example assumes that the interface header file for soapcpp2 includes the SOAP Header with WS-Addressing elements imported with <code>#import "wsa.h"</code> and the <code>ns__echoString</code> function discussed in Section <a class="el" href="index.html#wsaudp">Using WS-Addressing with SOAP-over-UDP</a> .</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;plugin/wsaapi.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>soap soap; </div><div class="line"><span class="keyword">struct </span>wsa__EndpointReferenceType replyTo; <span class="comment">// (anonymous) reply address </span></div><div class="line"><span class="keywordtype">char</span> *res; <span class="comment">// server response </span></div><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line"><a class="code" href="group__group__plugin.html#gad645e5a58ed442fe4753dcc2338c8bdb">soap_register_plugin</a>(&amp;soap, soap_wsa);</div><div class="line">soap.<a class="code" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474">send_timeout</a> = 5; <span class="comment">// 5 seconds max socket delay </span></div><div class="line">soap.<a class="code" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388">recv_timeout</a> = 5; <span class="comment">// 5 seconds max socket delay </span></div><div class="line"><span class="comment">// set up WS-Addressing header</span></div><div class="line">soap_wsa_request(&amp;soap, <span class="stringliteral">&quot;message ID&quot;</span>, <span class="stringliteral">&quot;endpoint&quot;</span>, <span class="stringliteral">&quot;SOAP action&quot;</span>);</div><div class="line">soap_wsa_add_ReplyTo(&amp;soap, NULL); <span class="comment">// anonymous ReplyTo address</span></div><div class="line"><span class="comment">// Send and receive messages over UDP: </span></div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__echoString(&amp;soap, <span class="stringliteral">&quot;soap.udp://endpoint &quot;</span>SOAP action<span class="stringliteral">&quot;, &quot;</span>hello world!<span class="stringliteral">&quot;, &amp;res)) </span></div><div class="line"><span class="stringliteral">{</span></div><div class="line"><span class="stringliteral">  if (soap.error == SOAP_EOF &amp;&amp; soap.errnum == 0) </span></div><div class="line"><span class="stringliteral">    ... // Timeout: no response from server (message already delivered?) </span></div><div class="line"><span class="stringliteral">  else </span></div><div class="line"><span class="stringliteral">    soap_print_fault(&amp;soap, stderr); </span></div><div class="line"><span class="stringliteral">} </span></div><div class="line"><span class="stringliteral">else </span></div><div class="line"><span class="stringliteral">  ... // UDP server response is stored in &#39;res&#39; </span></div><div class="line"><span class="stringliteral">// check SOAP header received, if applicable </span></div><div class="line"><span class="stringliteral">check_header(&amp;soap.header); </span></div><div class="line"><span class="stringliteral">soap_destroy(&amp;soap);</span></div><div class="line"><span class="stringliteral">soap_end(&amp;soap);</span></div><div class="line"><span class="stringliteral">soap_done(&amp;soap);</span></div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="requestresponsemulticast"></a>
Client-side request-response multicast</h3>
<p>This example is similar to the request-response unicast example discussed above, but uses a broadcast address and the <code>SO_BROADCAST</code> socket option. Because we expect to receive multiple responses, we also need to use separate request-response messages to send one request and consume multiple responses. In this example we defined a <code>bcastString</code> request and a <code>bcastStringResponse</code> response message, which are essentially declared as one-way messages in the header file:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service method-header-part:          bcastString wsa__MessageID </span></div><div class="line"><span class="comment">//gsoap ns service method-header-part:          bcastString wsa__To </span></div><div class="line"><span class="comment">//gsoap ns service method-header-part:          bcastString wsa__Action </span></div><div class="line"><span class="comment">//gsoap ns service method-header-part:          bcastString wsa__ReplyTo </span></div><div class="line"><span class="keywordtype">int</span> ns__bcastString(<span class="keywordtype">char</span> *str, <span class="keywordtype">void</span>); </div><div class="line"><span class="comment">//gsoap ns service method-header-part:          bcastStringResponse wsa__MessageID </span></div><div class="line"><span class="comment">//gsoap ns service method-header-part:          bcastStringResponse wsa__To </span></div><div class="line"><span class="comment">//gsoap ns service method-header-part:          bcastStringResponse wsa__Action </span></div><div class="line"><span class="comment">//gsoap ns service method-header-part:          bcastStringResponse wsa__RelatesTo </span></div><div class="line"><span class="keywordtype">int</span> ns__bcastStringResponse(<span class="keywordtype">char</span> *res, <span class="keywordtype">void</span>);</div></div><!-- fragment --><p>To obtain response one-way operations, use <a href="#wsdl2h-b"><b><code>wsdl2h -b</code></b> option <b><code>-b</code></b></a>.</p>
<p>The client code includes a loop to receive response messages until a timeout occurs:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;plugin/wsaapi.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>soap soap; </div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_s_o_a_p___e_n_v_____header.html">SOAP_ENV__Header</a> header; </div><div class="line"><span class="keyword">struct </span>wsa__EndpointReferenceType replyTo; </div><div class="line"><span class="keywordtype">char</span> *res; </div><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line"><a class="code" href="group__group__plugin.html#gad645e5a58ed442fe4753dcc2338c8bdb">soap_register_plugin</a>(&amp;soap, soap_wsa);</div><div class="line">soap.<a class="code" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794">connect_flags</a> = SO_BROADCAST; </div><div class="line">soap.<a class="code" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474">send_timeout</a> = 5; <span class="comment">// 5 seconds max socket delay </span></div><div class="line">soap.<a class="code" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388">recv_timeout</a> = 5; <span class="comment">// 5 seconds max socket delay </span></div><div class="line"><span class="comment">// set up WS-Addressing header</span></div><div class="line">soap_wsa_request(&amp;soap, <span class="stringliteral">&quot;message ID&quot;</span>, <span class="stringliteral">&quot;endpoint&quot;</span>, <span class="stringliteral">&quot;SOAP action&quot;</span>);</div><div class="line">soap_wsa_add_ReplyTo(&amp;soap, NULL); <span class="comment">// anonymous ReplyTo address</span></div><div class="line"><span class="keywordflow">if</span> (soap_send_ns__bcastString(&amp;soap, <span class="stringliteral">&quot;soap.udp://endpoint&quot;</span>, <span class="stringliteral">&quot;SOAP action&quot;</span>, <span class="stringliteral">&quot;hello world!&quot;</span>)) </div><div class="line">{</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">}</div><div class="line"><span class="keywordflow">else</span> </div><div class="line">{</div><div class="line">  <span class="keywordflow">while</span> (1)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (soap_recv_ns__bcastStringResponse(&amp;soap, &amp;res)) </div><div class="line">      <span class="keywordflow">break</span>; </div><div class="line">    ... <span class="comment">// Got response &#39;res&#39; from a server </span></div><div class="line">  } </div><div class="line">  <span class="keywordflow">if</span> (soap.<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> == <a class="code" href="group__group__errors.html#ga224b2c2b830135f12b53536f189b4ebd">SOAP_EOF</a> &amp;&amp; soap.<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a> == 0) </div><div class="line">    ... <span class="comment">// Timeout: no more messages received </span></div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">} </div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line"><a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div></div><!-- fragment --><p>Note that a server for the <code>bcastString</code> does not need to use two-one way messages. Thus, multicast request-response message pattern can be declared and implemented as request-response operations at the server side.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="soapoverudp"></a>
SOAP-over-UDP server</h2>
<p>The following example code illustrates a SOAP-over-UDP server for one-way <code>sendString</code> and request-response <code>echoString</code> messages. This example assumes that the interface header file includes the SOAP Header with WS-Addressing elements imported with <code>#import "wsa.h"</code> and the <code>ns__echoString</code> function discussed in Section <a class="el" href="index.html#wsaudp">Using WS-Addressing with SOAP-over-UDP</a> .</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;plugin/wsaapi.h&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <a class="code" href="group__group__context.html#gac87126c3e45d2fda488e9832c2dd5be1">soap_init1</a>(&amp;soap, <a class="code" href="group__group__flags.html#ga388dae9abc80cd6f6d0ecfba383da03b">SOAP_IO_UDP</a>); <span class="comment">// must set UDP flag </span></div><div class="line">  <a class="code" href="group__group__plugin.html#gad645e5a58ed442fe4753dcc2338c8bdb">soap_register_plugin</a>(&amp;soap, soap_wsa);</div><div class="line">  <span class="comment">// bind to host (NULL = current host) and port: </span></div><div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(<a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(&amp;soap, <a class="code" href="structsoap.html#ab8f356cfb0a1ba87c26cb0ae4c9ee713">host</a>, port, BACKLOG))) </div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  <span class="keywordflow">while</span> (1)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(&amp;soap)) </div><div class="line">      <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); <span class="comment">// report the problem </span></div><div class="line">    <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap); </div><div class="line">    <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap); </div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap); <span class="comment">// close connection </span></div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__echoString(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *str, <span class="keywordtype">char</span> **res) </div><div class="line">{</div><div class="line">  <span class="comment">// check if WS-Addressing headers are present and correct</span></div><div class="line">  <span class="keywordflow">if</span> (soap_wsa_check(soap))</div><div class="line">    <span class="keywordflow">return</span> soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>;</div><div class="line">  <span class="comment">// should check for duplicate messages (something that WS-ReliableMessaging does too)</span></div><div class="line">  <span class="keywordflow">if</span> (check_received(soap-&gt;<a class="code" href="structsoap.html#ac091dfe4e01b6a082d916c381e7006ba">header</a>-&gt;wsa__MessageID)) </div><div class="line">  {</div><div class="line">    <span class="comment">// Request message already received </span></div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#gaa03308d50b94828cbc49724d049d9d2d">SOAP_STOP</a>; <span class="comment">// don&#39;t return response </span></div><div class="line">  } </div><div class="line">  *res = str; </div><div class="line">  <span class="comment">// return OK with WS-Addressing reply headers, message ID is id_count+1</span></div><div class="line">  <span class="keywordflow">return</span> soap_wsa_reply(soap, <a class="code" href="group__group__s2s.html#ga9afdf8de7a8373f1747f41f8e3d5ee39">soap_int2s</a>(soap, id_count++), <span class="stringliteral">&quot;http://genivia.com/udp/echoStringResponse&quot;</span>);</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__sendString(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *str) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (soap_wsa_check(soap))</div><div class="line">    <span class="keywordflow">return</span> soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>;</div><div class="line">  <span class="comment">// should check for duplicate messages </span></div><div class="line">  <span class="keywordflow">if</span> (check_received(soap-&gt;<a class="code" href="structsoap.html#ac091dfe4e01b6a082d916c381e7006ba">header</a>-&gt;wsa__MessageID)) </div><div class="line">  {</div><div class="line">    <span class="comment">// Request message already received </span></div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#gaa03308d50b94828cbc49724d049d9d2d">SOAP_STOP</a>;</div><div class="line">  } </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>;</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__sendStringResponse(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *res) </div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>; <span class="comment">// we don&#39;t serve this operation</span></div><div class="line">}</div></div><!-- fragment --><p>The server binds to a host and port and accepts messages in a loop. Because UDP does not have the equivalent of an accept, the messages cannot be dispatched to threads. Instead the <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> waits for a message and immediately accepts it. You can use a receive timeout value for <code><a class="el" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388" title="User-definable timeout to receive a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::recv_timeout</a></code> to make <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> non-blocking.</p>
<p>To obtain response one-way operations from a WSDL, use <a href="#wsdl2h-b"><b><code>wsdl2h -b</code></b> option <b><code>-b</code></b></a>. This produces additional one-way operations to support asynchronous handling of response messages in the same way requests are handled.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="soapoverudpmulticast"></a>
SOAP-over-UDP multicast receiving server</h3>
<p>For UDP multicast support, follow the suggestions in Section <a class="el" href="index.html#soapoverudp">SOAP-over-UDP server</a> and change the initialization parts of the code to enable UDP multicast port binding by to telling the kernel which multicast groups you are interested in:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;plugin/wsaapi.h&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <span class="keyword">struct </span>ip_mreq mcast; </div><div class="line">  <a class="code" href="group__group__context.html#gac87126c3e45d2fda488e9832c2dd5be1">soap_init1</a>(&amp;soap, <a class="code" href="group__group__flags.html#ga388dae9abc80cd6f6d0ecfba383da03b">SOAP_IO_UDP</a>); </div><div class="line">  <a class="code" href="group__group__plugin.html#gad645e5a58ed442fe4753dcc2338c8bdb">soap_register_plugin</a>(&amp;soap, soap_wsa);</div><div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(<a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(&amp;soap, host, port, BACKLOG))) </div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  mcast.imr_multiaddr.s_addr = inet_addr(put IP multicast address of group here); </div><div class="line">  mcast.imr_interface.s_addr = htonl(INADDR_ANY); </div><div class="line">  <span class="keywordflow">if</span> (setsockopt(soap.<a class="code" href="structsoap.html#ab649b8f3b71081d14ec6350ab4b06794">master</a>, IPPROTO_IP, IP_ADD_MEMBERSHIP, &amp;mcast, <span class="keyword">sizeof</span>(mcast))&lt;0) </div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  ... <span class="comment">//</span></div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">}</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="compilerflags"></a>
Compile-time flags</h1>
<p>The following macros are defined in the API documentation Module <a class="el" href="group__group__with.html">WITH_MACRO compile-time flags</a>. These macros are used to enable or disable features as specified below, by compiling source code files with compiler option <b><code>-D</code></b> to set the macro:</p>
<table class="doxtable">
<tr>
<th>define </th><th>result  </th></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga176c2f40b17a2952361c37c4602a4c37" title="When this macro is defined at compile time (undefined by default) then the header file specified by t...">SOAPDEFS_H</a></code> </td><td>the header file to include, if different from <code>soapdefs.h</code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga24620333a812a36ed84902ff3d897ff6" title="When this macro is defined at compile time (undefined by default), a user-supplied file named soapdef...">WITH_SOAPDEFS_H</a></code> </td><td>includes the <code>soapdefs.h</code> file for custom settings, see Section <a class="el" href="index.html#soapdefs">Using the soapdefs.h header file</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga447e0fdc3b39acab817a73181b16cc14" title="When this macro is defined at compile time (undefined by default), removes dependency on C++ std::str...">WITH_COMPAT</a></code> </td><td>removes dependency on C++ stream libraries and C++ exceptions </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gaae03aa5dd66b0251c11ba8fc2fe29ecf" title="When this macro is defined at compile time (undefined by default), memory footprint is significantly ...">WITH_LEAN</a></code> </td><td>creates a small-footprint executable, see Section <a class="el" href="index.html#lean">How to minimize application memory footprint</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga6c72f5017edb6930c54a8f70d9fb40b9" title="When this macro is defined at compile time (undefined by default), memory footprint is further reduce...">WITH_LEANER</a></code> </td><td>creates an even smaller footprint executable, see Section <a class="el" href="index.html#lean">How to minimize application memory footprint</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gaf82a624c2531f5e26bf234bc39ae07bd" title="When this macro is defined at compile time uses faster memory allocation at a cost of larger memory b...">WITH_FAST</a></code> </td><td>use faster memory allocation when used with <code><a class="el" href="group__group__with.html#gaae03aa5dd66b0251c11ba8fc2fe29ecf" title="When this macro is defined at compile time (undefined by default), memory footprint is significantly ...">WITH_LEAN</a></code> or <code><a class="el" href="group__group__with.html#ga6c72f5017edb6930c54a8f70d9fb40b9" title="When this macro is defined at compile time (undefined by default), memory footprint is further reduce...">WITH_LEANER</a></code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga77f061a12d88eb8b7dae8b07cf90e29d" title="When this macro is defined at compile time (undefined by default), HTTP cookie support is enabled in ...">WITH_COOKIES</a></code> </td><td>enables HTTP cookies, see Sections <a class="el" href="index.html#clientcookie">Client-side cookie support</a> and <a class="el" href="index.html#servercookie">Server-side cookie support</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gab08b437f239f365c2a266d25e45b0148" title="When this macro is defined at compile time (undefined by default), HTTP cookie support is enabled (as...">WITH_INSECURE_COOKIES</a></code> </td><td>enables HTTP cookies and allows cookies with their Secure flag set to be sent over insecure channels </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga40cbd680e7dbdeb63bce1d6d4b7b9620" title="When this macro is defined at compile time (undefined by default), IPv6 support is enabled and both I...">WITH_IPV6</a></code> </td><td>enables IPv6 support </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga2854fe8474c2f87a9916d892306cb94c" title="When this macro is defined at compile time (undefined by default), IPv6-only is enabled for port bind...">WITH_IPV6_V6ONLY</a></code> </td><td>enables IPv6 support with IPv6-only server option </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gae5fa06f0e13edb611016c85364b0d0f0" title="When this macro is defined at compile time (undefined by default), enables linkage with OpenSSL for H...">WITH_OPENSSL</a></code> </td><td>enables OpenSSL, see Sections <a class="el" href="index.html#clientopenssl">Secure clients with HTTPS</a> and <a class="el" href="index.html#serveropenssl">Secure Web services with HTTPS</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gaba33a0ba79add64c641997a7e5070f27" title="When this macro is defined at compile time (undefined by default), enables linking the GNUTLS library...">WITH_GNUTLS</a></code> </td><td>enables GNUTLS, see Sections <a class="el" href="index.html#clientopenssl">Secure clients with HTTPS</a> and <a class="el" href="index.html#serveropenssl">Secure Web services with HTTPS</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gad30a07ea604aea8cb00f41f6310cf30f" title="When this macro is defined at compile time (undefined by default), enables linkage with the zlib libr...">WITH_GZIP</a></code> </td><td>enables gzip and deflate compression, see Section <a class="el" href="index.html#compression">Zlib compression</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gad2cdc1f87f3fc46b92e957d9e251797c" title="When this macro is defined at compile time (undefined by default), enables linking the zlib library f...">WITH_ZLIB</a></code> </td><td>enables deflate compression only, see Section <a class="el" href="index.html#compression">Zlib compression</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga4a743d1499292194cfc81d305500c83f" title="When this macro is defined at compile time (undefined by default), enables linkage with the ntlm libr...">WITH_NTLM</a></code> </td><td>enables NTLM support </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gac12224709e8774c00afebe02a0ee0c8d" title="When this macro is defined at compile time (defined by default for most platforms), the C locale is enabled in the engine, opposite of WITH_NO_C_LOCALE ">WITH_C_LOCALE</a></code> </td><td>force the use locale functions when available to ensure locale-independent number conversions </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gac587d5d27bcbceffb66741f230333a67" title="When this macro is defined at compile time (undefined by default), the use of the C locale is disable...">WITH_NO_C_LOCALE</a></code> </td><td>remove the use of locale functions to improve portability </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga3a92e63a0dd8b9d3701d001cafcde955" title="When this macro is defined at compile time (defined by default for most platforms), include xlocale.h to define locale_t and the _l locale-specific functions. ">WITH_INCLUDE_XLOCALE_H</a></code> </td><td>force the inclusion of <code>&lt;xlocale.h&gt;</code> to define <code>locale_t</code> and <code>_l</code> functions, to improve portability </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gac446a18bcd54c58c0b62362f2e6113e2" title="When this macro is defined at compile time (undefined by default), enables WS-Security signature veri...">WITH_DOM</a></code> </td><td>enable DOM parsing in the engine, required by the WS-Security plugin </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gaa3632d9a171ac29a7cb4a4c4861d8e8d" title="When this macro is defined at compile time (undefined by default), replaces UTF-8 content that is out...">WITH_REPLACE_ILLEGAL_UTF8</a></code> </td><td>enable strict UTF-8, replaces UTF-8 content that is outside the allowed range with U+FFFD </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gac697013bbde81d22d15d83d122f85f18" title="When this macro is defined at compile time (undefined by default), enables and configures the engine ...">WITH_FASTCGI</a></code> </td><td>enables FastCGI, see Section <a class="el" href="index.html#fastcgi">FastCGI</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga93604d4f98eeeedcc7af19ff83192308" title="When this macro is defined at compile time (undefined by default), removes all IO and socket library ...">WITH_NOIO</a></code> </td><td>removes IO operations, to eliminate the use of BSD sockets, see Section <a class="el" href="index.html#noio">How to remove the BSD socket library requirement</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gaea95327865324f1aba294f3ae5d13dd4" title="When this macro is defined at compile time (undefined by default), permanently disables XML ID (id at...">WITH_NOIDREF</a></code> </td><td>removes id and href/ref multi-reference data, more aggressive than using the <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> runtime flag </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga9e4012870cc520445f8bb0b08f8ae2bc" title="When this macro is defined at compile time (undefined by default), permanently removes the HTTP stack...">WITH_NOHTTP</a></code> </td><td>removes the HTTP stack to reduce code size </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga1c6f7ec29799a308133930ffc4d7109a" title="When this macro is defined at compile time (undefined by default), removes and ignores the timezone i...">WITH_NOZONE</a></code> </td><td>disables and ignores the timezone in <code>xsd:dateTime</code> values </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga376e550466f3e75f529e113fcf36f86a" title="When this macro is defined at compile time, default empty namespaces are not required to parse XML an...">WITH_NOEMPTYNAMESPACES</a></code> </td><td>disables xmlns="" default empty namespaces from XML messages </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gaa0f80155c2f036cd4da1735cafc9e60b">WITH_NOEMPTYSTRUCT</a></code> </td><td>inserts a dummy member in empty structs to allow compilation </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gab0e1c923db1547a75ad010a3172c065a" title="When this macro is defined at compile time (undefined by default), omits SOAP Header and Fault serial...">WITH_NOGLOBAL</a></code> </td><td>omit SOAP Header and Fault serialization code, prevents duplicate definitions with generated soapXYZLib code </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gac22000b4058bb41a88750d10785baaf1" title="When this macro is defined at compile time (undefined by default), removes dependence on the global n...">WITH_NONAMESPACES</a></code> </td><td>disables dependence on global <code>namespaces</code> table, a table must be set explicitly with <code><a class="el" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5" title="Activates an XML namespace table to generate and resolve xmlns namespace prefixes in XML messages...">soap_set_namespaces</a></code> see also Section <a class="el" href="index.html#nstable">XML namespaces and the namespace mapping table</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga2e3f4fd002ffd6b7f0b675a2dd78ca17" title="When this macro is defined at compile time (undefined by default), retains the parsed CDATA sections ...">WITH_CDATA</a></code> </td><td>retains the parsed CDATA sections in literal XML strings </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gaa0801009d3ed28b2c66063c26423fa8d" title="When this macro is defined at compile time (undefined by default), makes C++ service class operation ...">WITH_PURE_VIRTUAL</a></code> </td><td>enables C++ abstract service classes with pure virtual methods, requires soapcpp2 option <code>-i</code> or <code>-j</code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#gad994e1b9a0209a5da210eab3a69c52e1" title="When this macro is defined at compile time (undefined by default), enables C++ base service classes w...">WITH_DEFAULT_VIRTUAL</a></code> </td><td>enables C++ base service classes with default virtual methods returning fault <code><a class="el" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad" title="A soap_status error code: the service request dispatcher did not find a matching service operation fo...">SOAP_NO_METHOD</a></code>, requires soapcpp2 option <code>-i</code> or <code>-j</code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga3a99ea572d2ad520776c2a92a5f50304" title="When this macro is defined at compile time (undefined by default), enables case insensitive XML tag n...">WITH_CASEINSENSITIVETAGS</a></code> </td><td>enables case insensitive XML parsing </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga11ff99091a8f7fa179705bb3bff1aed2" title="When this macro is defined at compile time (undefined by default), prevents a server port from stayin...">WITH_SOCKET_CLOSE_ON_EXIT</a></code> </td><td>prevents a server port from staying in listening mode after exit by internally setting <code>fcntl(sock, F_SETFD, FD_CLOEXEC)</code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga32da1a1af344a155b0ad01e6dbb7daaa" title="When this macro is defined at compile time (undefined by default), the engine transmits TCP FIN using...">WITH_TCPFIN</a></code> </td><td>enables TCP FIN after sends when socket is ready to close </td></tr>
<tr>
<td><code><a class="el" href="group__group__with.html#ga0f1f2dd7a7d88f5acdaaab010d8e99ff" title="When this macro is defined at compile time (undefined by default), the engine is configured to enable...">WITH_SELF_PIPE</a></code> </td><td>enables a "self pipe" to enable the <code><a class="el" href="group__group__io.html#ga139afbf916c84724fef3f82aca4857d3" title="Close the connection of the specified context using a self-pipe. ">soap_close_connection</a></code> function (gSOAP 2.8.71 or greater) </td></tr>
</table>
<p>The following subset of macros are defined in the API documentation Module <a class="el" href="group__group__soap.html">SOAP_MACRO compile-time values</a>. These macros are used to enable or disable features as specified below, by compiling source code files with compiler option <b><code>-D</code></b> to set the macro:</p>
<table class="doxtable">
<tr>
<th>define </th><th>result  </th></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga71b70dabc89650ed7197fd6d97bb4543" title="Macro expands to (std::nothrow) to prevent the deserializer&#39;s memory allocator from throwing an excep...">SOAP_NOTHROW</a></code> </td><td>expands to <code>(std::nothrow)</code> to prevent memory allocation exceptions (<code><a class="el" href="group__group__errors.html#ga9fd637076afcd330401f2cd0a71fe729" title="A soap_status error code: out of memory. ">SOAP_EOM</a></code> is used instead), this macro can be changed </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga6ec95d997cc20a6a84dd4d76b3ea2fcc" title="User-definable size of the input and output message buffer soap::buf (the value is 65536 by default) ...">SOAP_BUFLEN</a></code> </td><td>the length of the internal message buffer, impacts communications performance </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga2652270988caffd32e990912aa3905f4" title="User-definable maximum length of HTTP headers (the value is 8192 by default) ">SOAP_HDRLEN</a></code> </td><td>the maximum length of HTTP headers </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga69f1ba9e1b47201e54822f365087f5a5" title="User-definable maximum length of XML tags and URLs (the value is 1024 by default) ...">SOAP_TAGLEN</a></code> </td><td>the maximum length of XML tags and URLs </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga92d654b655b8aca035c8281a836f495f" title="User-definable maximum length of temporary string values stored in soap::msgbuf and soap::tmpbuf...">SOAP_TMPLEN</a></code> </td><td>the maximum length of temporary string values, short strings and brief error messages </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#gafd23342e94173d223a24814545babdaf" title="User-definable maximum size of a block of memory that malloc can allocate or 0 for no limit (the valu...">SOAP_MAXALLOCSIZE</a></code> </td><td>the maximum size of a block of memory that <code>malloc</code> can allocate </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga29a7dab5c96c2724b3c234505d52c76e" title="User-definable macro to protect excessive SOAP array allocation requests by defining a maximum alloca...">SOAP_MAXARRAYSIZE</a></code> </td><td>the maximum allocation threshold to pre-allocate SOAP arrays in memory </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#gad4c2ca8c2293fc75075aec4a09f4dc38" title="User-definable maximum length of DIME attachments received (the value is 8 MB by default) ...">SOAP_MAXDIMESIZE</a></code> </td><td>the maximum DIME attachment size allowed to receive </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga59f0c79e1cd2a135f74351bf9f8c17a6" title="User-definable maximum number of EINTR interrupts to ignore while polling a socket for pending activi...">SOAP_MAXEINTR</a></code> </td><td>maximum number of EINTR interrupts to ignore while polling a socket for pending activity </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga449296b6ea91c469c16ed505f04ca070" title="Trusted inflated content size (1 MB by default), larger content is subject to the SOAP_MINDEFLATERATI...">SOAP_MAXINFLATESIZE</a></code> </td><td>trusted inflated content size (1 MB by default) </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga9750ea0479df8aa88e06f6a148b2a670" title="User-definable maximum iterations in the server-side soap_serve loop (or the C++ service class serve ...">SOAP_MAXKEEPALIVE</a></code> </td><td>maximum iterations in the <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> loop on HTTP keep-alive connections </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#gabd0dd334a752d8c145fa720deb905508" title="User-definable maximum string content length for strings not already constrained by XML schema valida...">SOAP_MAXLENGTH</a></code> </td><td>maximum string content length for strings not already constrained by XML schema validation constraints </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga2ad35599c611417132d6b0a9b6870652" title="User-definable maximum XML nesting depth level permitted by the XML parser, must be greater than zero...">SOAP_MAXLEVEL</a></code> </td><td>maximum XML nesting depth level permitted by the XML parser </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga3933a58d23a5bf2ad64039725cb23786" title="User-definable maximum number of array or container elements for containers that are not already cons...">SOAP_MAXOCCURS</a></code> </td><td>maximum number of array or container elements for containers that are not already constrained by XML schema validation constraints </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga61bac5e1247c779c5ea27090faf0e79d" title="Trusted deflation ratio after SOAP_MAXINFLATESIZE is reached, trust when compressed / deflated &gt; SOAP...">SOAP_MINDEFLATERATIO</a></code> </td><td>trusted deflation ratio after <code><a class="el" href="group__group__soap.html#ga449296b6ea91c469c16ed505f04ca070" title="Trusted inflated content size (1 MB by default), larger content is subject to the SOAP_MINDEFLATERATI...">SOAP_MAXINFLATESIZE</a></code> is reached </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#gad4edb63b6b20a8e5ac3891550013f64a" title="Macro is set to SOAP_PURE_VIRTUAL = 0 at compile time when macro WITH_PURE_VIRTUAL is defined...">SOAP_PURE_VIRTUAL</a></code> </td><td>set to <code>= 0</code> when <code><a class="el" href="group__group__with.html#gaa0801009d3ed28b2c66063c26423fa8d" title="When this macro is defined at compile time (undefined by default), makes C++ service class operation ...">WITH_PURE_VIRTUAL</a></code> is defined </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#gab18ff4d6039f1387641508ae7be8a145" title="User-definable length of RSA keys used for https connections (the value is 2048 by default) ...">SOAP_SSL_RSA_BITS</a></code> </td><td>length of the RSA key (2048 by default) </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga3a42c92a6417928388f4ee790ff74434" title="User-definable 8 bit integer that represents a character that could not be converted to an ASCII char...">SOAP_UNKNOWN_CHAR</a></code> </td><td>an 8 bit integer that represents a character that could not be converted to an ASCII char, i.e. when converting an XML Unicode character </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#gaafe757ff5b99e03ae2c7814dedf9aa8e" title="A user-definable integer Unicode value representing a character that replaces an invalid Unicode code...">SOAP_UNKNOWN_UNICODE_CHAR</a></code> </td><td>integer Unicode value representing a character that replaces an invalid Unicode code point </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#gabd3b66726c9832645b90f313b109d4b5" title="User-definable macro that represents the LONG64 printf %-format. ">SOAP_LONG_FORMAT</a></code> </td><td>macro that represents the <code><a class="el" href="group__group__soap.html#ga78b36c5636eb5283d651b69d8684c6ae" title="User-definable macro that represents a portable signed 64 bit integer type. ">LONG64</a></code> printf %-format </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#ga8867a4e80f19a89f21ccc660a70a60b9" title="User-definable macro that represents the ULONG64 printf %-format. ">SOAP_ULONG_FORMAT</a></code> </td><td>macro that represents the <code><a class="el" href="group__group__soap.html#ga7c6e38d209f60a18e362172dca1a3b6e" title="User-definable macro that represents a portable unsigned 64 bit integer type. ">ULONG64</a></code> printf %-format </td></tr>
<tr>
<td><code><a class="el" href="group__group__soap.html#gab9e77b1557780293eec0b269ef191472" title="Macro that defines a portable invalid socket value (usually -1, but the value depends on the OS) ...">SOAP_INVALID_SOCKET</a></code> </td><td>portable invalid socket value, can also use <code><a class="el" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c" title="Function macro to check if a socket is valid, i.e. not equal to SOAP_INVALID_SOCKET ...">soap_valid_socket(sock)</a></code> to check if <code>sock</code> is valid </td></tr>
</table>
<dl class="section warning"><dt>Warning</dt><dd>It is important that any of these macros when defined should be consistently defined when compiling source code files, such as <em><code>gsoap/stdsoap2.cpp</code></em>, <em><code>soapC.cpp</code></em>, <em><code>soapClient.cpp</code></em>, <em><code>soapServer.cpp</code></em>, and all application source code files that include <em><code>gsoap/stdsoap2.h</code></em> or <em><code>soapH.h</code></em>. If the macros are not consistently defined at compile time then the application will likely crash due to a mismatches in the declaration and use of the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context that is customized by these flags.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="soapdefs"></a>
Using the soapdefs.h header file</h2>
<p>The <em><code>soapdefs.h</code></em> header file is included in <em><code>gsoap/stdsoap2.h</code></em> when compiling with compile-time flag <code><a class="el" href="group__group__with.html#ga24620333a812a36ed84902ff3d897ff6" title="When this macro is defined at compile time (undefined by default), a user-supplied file named soapdef...">WITH_SOAPDEFS_H</a></code>: </p><pre class="fragment"> c++ -D WITH_SOAPDEFS_H -c stdsoap2.cpp
</pre><p>The <em><code>soapdefs.h</code></em> file allows users to include definitions and add includes without requiring changes to <em><code>gsoap/stdsoap2.h</code></em>. You can also specify the header file name to include as a macro <code>SOAPDEFS_H</code> to override the name <em><code>soapdefs.h</code></em>: </p><pre class="fragment"> c++ -D SOAPDEFS_H=mydefs.h -c stdsoap2.cpp
</pre><p>For example,</p>
<div class="fragment"><div class="line"><span class="comment">// Contents of file &quot;soapdefs.h&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;ostream&gt;</span> </div></div><!-- fragment --><p>The following header file for soapcpp2 refers to <code>std::ostream</code> without soapcpp2 throwing errors, by using <code>extern</code> to declare <code>class std::ostream</code>:</p>
<div class="fragment"><div class="line"><span class="comment">// std::ostream can&#39;t be serialized, but need to be declared to make it visible to gSOAP </span></div><div class="line"><span class="keyword">extern</span> <span class="keyword">class </span>std::ostream;</div><div class="line"></div><div class="line"><span class="keyword">class </span>ns__myClass </div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> print(std::ostream &amp;s) <span class="keyword">const</span>; <span class="comment">// we need std::ostream here </span></div><div class="line">    ... <span class="comment">//</span></div><div class="line">};</div></div><!-- fragment --><p>See also Section <a class="el" href="index.html#transient">Transient data types</a> , non-serializable data types.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="flags"></a>
Run-time flags</h1>
<p>The gSOAP engine state is stored in the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context that is initialized and controlled by various optional runtime flags. Most flags are applicable to either processing input or to processing output, but some are applicable to both input and output message and document processing.</p>
<p>Furthermore, these flags are divided into four categories: transport (IO), content encoding (ENC), XML parsing and generation (XML), and C/C++ usage (C).</p>
<p>The input-mode and output-mode flags for inbound (in) and outbound (out) message processing are:</p>
<table class="doxtable">
<tr>
<th>mode flag </th><th>in/out </th><th>result  </th></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gabdb47a4b2321c119055eff7db3ecd7e6" title="soap_mode IO output flag value to flush the message sent immediately without buffering (the default m...">SOAP_IO_FLUSH</a></code> </td><td>out </td><td>flush output immediately </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga6a6adad44553be54bf5ad2c23d8779c5" title="soap_mode IO output flag value to buffer the message sent in packets of size SOAP_BUFLEN, do not combine this flag with SOAP_IO_FLUSH, SOAP_IO_STORE, SOAP_IO_CHUNK ">SOAP_IO_BUFFER</a></code> </td><td>out </td><td>enable output buffering, the default mode for socket connections </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gaf7cbb692f85f8633c4efc66dfae41e9e" title="soap_mode IO output flag value to store messages temporarily before transmission, e...">SOAP_IO_STORE</a></code> </td><td>out </td><td>store the entire outbound message to calculate HTTP content length </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> </td><td>out </td><td>enable HTTP chunking </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gae27399f26b6a31d91b6884b957925c3e" title="soap_mode IO output flag value to calculate message length when sending a message without transmissio...">SOAP_IO_LENGTH</a></code> </td><td>out </td><td>used with two-phase serialization, first phase with this flag to calculate HTTP content length </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2" title="soap_mode IO input and output flag value to keep the socket connection alive for SOAP_MAXKEEPALIVE me...">SOAP_IO_KEEPALIVE</a></code> </td><td>in+out </td><td>keep socket connections alive, when supported by the HTTP peer </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga388dae9abc80cd6f6d0ecfba383da03b" title="soap_mode IO input/output flag value to use UDP datagrams, message size is limited to UDP packet size...">SOAP_IO_UDP</a></code> </td><td>in+out </td><td>use UDP (datagram) transport, maximum message length is <code><a class="el" href="group__group__soap.html#ga6ec95d997cc20a6a84dd4d76b3ea2fcc" title="User-definable size of the input and output message buffer soap::buf (the value is 65536 by default) ...">SOAP_BUFLEN</a></code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gaa7c4614834a9bd49062fff8789793899" title="soap_mode ENC input/output flag value to omit the HTTP headers from messages sent and disable detecti...">SOAP_ENC_PLAIN</a></code> </td><td>in+out </td><td>use plain messages without parsing or emitting HTTP headers </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga861483fce0d5bd598aa79126d5cefeba" title="soap_mode ENC input/output flag (deprecated, same as SOAP_ENC_PLAIN for backward compatibility) ...">SOAP_ENC_XML</a></code> </td><td></td><td>alias for <code><a class="el" href="group__group__flags.html#gaa7c4614834a9bd49062fff8789793899" title="soap_mode ENC input/output flag value to omit the HTTP headers from messages sent and disable detecti...">SOAP_ENC_PLAIN</a></code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gafaa6a1c2684babe91bea2e181b1f77e6" title="soap_mode ENC output flag value to enable DIME attachments (for internal use only) ...">SOAP_ENC_DIME</a></code> </td><td>out </td><td>use DIME encoding, automatic when DIME attachments are used </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga988c0f4d52bf6f5cdac8c0e197ebe62a" title="soap_mode ENC output flag value to enable MIME attachments in messages to be sent, receiving is automatic ">SOAP_ENC_MIME</a></code> </td><td>out </td><td>use MIME encoding instead of DIME, activated using <code><a class="el" href="group__group__mime.html#ga9180e5ba634b20305b755b410045d9ee" title="Enable MIME attachments. ">soap_set_mime</a></code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gac510f1f7c80fa8a3f20afa2dcfb53fb3" title="soap_mode ENC output flag value to enable MTOM XOP attachments in messages to be sent, receiving is automatic ">SOAP_ENC_MTOM</a></code> </td><td>out </td><td>use MTOM XOP attachments instead of DIME and MIME </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8" title="soap_mode ENC output flag value to compress messages sent, requires zlib enabled with compile-time fl...">SOAP_ENC_ZLIB</a></code> </td><td>out </td><td>compress output with Zlib, using deflate or gzip format </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gae6d18011864ddee75adeccf523ca8dfe" title="soap_mode ENC input/output flag value to enable TLS/SSL, e.g. HTTPS, requires OpenSSL or GNUTLS enabl...">SOAP_ENC_SSL</a></code> </td><td>in+out </td><td>use SSL/TLS, automatic when connecting "https:" endpoints </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga0bfffccff8ea0245f4de6670a0b36e69" title="soap_mode XML output flag value to enable XML (and JSON) message indentation in messages sent ...">SOAP_XML_INDENT</a></code> </td><td>out </td><td>output indented XML and JSON </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga757fa32433be64f8c228b1ecce727815" title="soap_mode XML output flag value to send XML messages in exclusive canonical format as per W3C XML C14...">SOAP_XML_CANONICAL</a></code> </td><td>out </td><td>output canonical XML </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gaabf4437aeb9a8ae91bfbc3cdce538a6b" title="soap_mode XML output flag value to send XML messages with XML default namespaces for elements instead...">SOAP_XML_DEFAULTNS</a></code> </td><td>out </td><td>output XML with default namespace bindings <code>xmlns="..."</code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga8b2d0f16b4872a26c28f36243c4ea6a9" title="soap_mode XML input flag value to ignore XML namespaces in messages received ">SOAP_XML_IGNORENS</a></code> </td><td>in </td><td>ignores XML namespaces in XML input </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> </td><td>in </td><td>apply strict validation of XML input </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> </td><td>in+out </td><td>out: serialize data as XML trees (no multi-ref, duplicate data when necessary); in: ignore id attributes (do not resolve id-ref) </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> </td><td>out </td><td>serialize application data as an XML graph with multi-ref id/ref attributes </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga4954f2e4d1f7a42a8502e91e6d7988bb" title="soap_mode XML output flag value to serialize C/C++ NULL pointers in XML as elements with attribute xs...">SOAP_XML_NIL</a></code> </td><td>out </td><td>serialize NULL data as xsi:nil attributed elements </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga39ec9cf415fb3768f1038b9a6b28c85e" title="soap_mode XML output flag value to serialize C/C++ data structures in XML without xsi:type attributes...">SOAP_XML_NOTYPE</a></code> </td><td>out </td><td>disable <em><code>xsi:type</code></em> attributes </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gac613f90d420290bb8ef9207deaa3525e" title="soap_mode C-related input flag value to ignore array items that are out of bounds when deserializing ...">SOAP_C_NOIOB</a></code> </td><td>in </td><td>do not fault with <code><a class="el" href="group__group__errors.html#ga4bf925c17a1c81e99de6bfdb7d85c19a" title="A soap_status error code: SOAP array index out of bounds. ">SOAP_IOB</a></code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga9006d22d0abc39831dfe3ce1e491ce6f" title="soap_mode C-related input/output flag value to serialize and deserialize 8-bit C/C++ strings containi...">SOAP_C_UTFSTRING</a></code> </td><td>in+out </td><td>serialize 8-bit character strings "as is", meaning 8-bit strings have UTF-8 content </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#gabe62a741fb99a476524000aaacd4b354" title="soap_mode C-related input/output flag value to serialize and deserialize 8-bit multibyte C/C++ string...">SOAP_C_MBSTRING</a></code> </td><td>in+out </td><td>enable multibyte character support for 8-bit character strings </td></tr>
<tr>
<td><code><a class="el" href="group__group__flags.html#ga04a49fa6705c53484fb8a4324191cca9" title="soap_mode C-related input/output flag value to serialize empty strings as elements with attribute xsi...">SOAP_C_NILSTRING</a></code> </td><td>out </td><td>serialize empty strings as xsi:nil attributed elements </td></tr>
</table>
<p>All flags are independent and can be combined using a bitwise or (<code>|</code>), except for <code><a class="el" href="group__group__flags.html#gabdb47a4b2321c119055eff7db3ecd7e6" title="soap_mode IO output flag value to flush the message sent immediately without buffering (the default m...">SOAP_IO_FLUSH</a></code>, <code><a class="el" href="group__group__flags.html#ga6a6adad44553be54bf5ad2c23d8779c5" title="soap_mode IO output flag value to buffer the message sent in packets of size SOAP_BUFLEN, do not combine this flag with SOAP_IO_FLUSH, SOAP_IO_STORE, SOAP_IO_CHUNK ">SOAP_IO_BUFFER</a></code>, <code><a class="el" href="group__group__flags.html#gaf7cbb692f85f8633c4efc66dfae41e9e" title="soap_mode IO output flag value to store messages temporarily before transmission, e...">SOAP_IO_STORE</a></code>, and <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> which are enumerations and only one of these I/O flags can be used. Also the XML serialization flags <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> and <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> should not be mixed.</p>
<p>To allocate and initialize a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context with input and output mode flags:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap * <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> iomode);</div><div class="line"><span class="keyword">struct </span>soap * <a class="code" href="group__group__context.html#ga12a87f6795b62b05164edc392b2adb1d">soap_new2</a>(<a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a4c24dec1ac79111c4ebeb30ba73cca65">imode</a>, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a0f7cfb4dd32a7be1ec63a20f55e12521">omode</a>);</div></div><!-- fragment --><p>To initialize a stack-allocated <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context with input and output mode flags:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__group__context.html#gac87126c3e45d2fda488e9832c2dd5be1">soap_init1</a>(<span class="keyword">struct</span> soap *soap, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> iomode);</div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__group__context.html#ga3c70b587fc4f65553cfe69751d1a157e">soap_init2</a>(<span class="keyword">struct</span> soap *soap, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a4c24dec1ac79111c4ebeb30ba73cca65">imode</a>, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a0f7cfb4dd32a7be1ec63a20f55e12521">omode</a>);</div></div><!-- fragment --><p>To set and clear mode flags use:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__group__context.html#ga84f52a67a41009b260ff2c036df7f6ab">soap_set_mode</a>(<span class="keyword">struct</span> soap *soap, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> iomode); <span class="comment">// set input and output mode flags</span></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__group__context.html#gaa9b0819dae844b848bcd8a3598a301aa">soap_set_imode</a>(<span class="keyword">struct</span> soap *soap, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a4c24dec1ac79111c4ebeb30ba73cca65">imode</a>); <span class="comment">// set input mode flags</span></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__group__context.html#gaf6fa6e197f360834eae124fa37e68cf7">soap_set_omode</a>(<span class="keyword">struct</span> soap *soap, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a0f7cfb4dd32a7be1ec63a20f55e12521">omode</a>); <span class="comment">// set output mode flags</span></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__group__context.html#ga06f769f80bcea7beb2ebffd0a40fc521">soap_clr_mode</a>(<span class="keyword">struct</span> soap *soap, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> iomode); <span class="comment">// clear input and output mode flags</span></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__group__context.html#ga0e789bd6c2f76609aec0c9f93d121e4c">soap_clr_imode</a>(<span class="keyword">struct</span> soap *soap, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a4c24dec1ac79111c4ebeb30ba73cca65">imode</a>); <span class="comment">// clear input mode flags</span></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__group__context.html#ga8c28d2943bee7aa5c3ffaf32803b31bd">soap_clr_omode</a>(<span class="keyword">struct</span> soap *soap, <a class="code" href="group__group__flags.html#ga72b0491c9cbf2071f0c96c7d29b719bb">soap_mode</a> <a class="code" href="structsoap.html#a0f7cfb4dd32a7be1ec63a20f55e12521">omode</a>); <span class="comment">// clear output mode flags</span></div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> mode flag can be used to improve interoperability with SOAP implementations that are not fully SOAP 1.1/1.2 RPC encoding compliant with respect to processing id-href/ref attributes. However, tree serialization will duplicate data when this data is co-referenced. Cycles are detected and broken to avoid infinite serialization.</dd></dl>
<p>In addition to the context mode flags, the following context flags can be used to set <code>setsockopt</code> level <code>SOL_SOCKET</code> options when sockets are created, though some options may not be applicable to your operating system:</p>
<table class="doxtable">
<tr>
<th>context flag with setsockopt option </th><th>result  </th></tr>
<tr>
<td><code><a class="el" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794" title="User-definable setsockopt level SOL_SOCKET flags when connecting soap::socket to a server (the value ...">soap::connect_flags</a></code> = <code>SO_NOSIGPIPE</code> </td><td>disables SIGPIPE </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794" title="User-definable setsockopt level SOL_SOCKET flags when connecting soap::socket to a server (the value ...">soap::connect_flags</a></code> = <code>SO_DEBUG</code> </td><td>turns on recording of debugging information in the underlying protocol modules </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794" title="User-definable setsockopt level SOL_SOCKET flags when connecting soap::socket to a server (the value ...">soap::connect_flags</a></code> = <code>SO_BROADCAST</code> </td><td>permits sending of broadcast messages, for example with UDP, when permitted </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794" title="User-definable setsockopt level SOL_SOCKET flags when connecting soap::socket to a server (the value ...">soap::connect_flags</a></code> = <code>SO_LINGER</code> </td><td>sets client-side linger time to the value of <code><a class="el" href="structsoap.html#a0f4d025053fde77216a0ca674077198d" title="User-definable linger time value, requires the SO_LINGER setsockopt flag value to be assigned to soap...">soap::linger_time</a></code> </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794" title="User-definable setsockopt level SOL_SOCKET flags when connecting soap::socket to a server (the value ...">soap::connect_flags</a></code> = <code>SO_DONTROUTE</code> </td><td>enables routing bypass for outgoing messages </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#ad98f12f602efdde049dbd367a43e7cb0" title="User-definable setsockopt level SOL_SOCKET flags (0 by default), when nonzero sets the soap::socket f...">soap::accept_flags</a></code> = <code>SO_NOSIGPIPE</code> </td><td>disables SIGPIPE (check your OS, this is not portable) </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#ad98f12f602efdde049dbd367a43e7cb0" title="User-definable setsockopt level SOL_SOCKET flags (0 by default), when nonzero sets the soap::socket f...">soap::accept_flags</a></code> = <code>SO_DEBUG</code> </td><td>turns on recording of debugging information in the underlying protocol modules </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#ad98f12f602efdde049dbd367a43e7cb0" title="User-definable setsockopt level SOL_SOCKET flags (0 by default), when nonzero sets the soap::socket f...">soap::accept_flags</a></code> = <code>SO_LINGER</code> </td><td>sets server-side linger time to the value of <code><a class="el" href="structsoap.html#a0f4d025053fde77216a0ca674077198d" title="User-definable linger time value, requires the SO_LINGER setsockopt flag value to be assigned to soap...">soap::linger_time</a></code> </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#ad98f12f602efdde049dbd367a43e7cb0" title="User-definable setsockopt level SOL_SOCKET flags (0 by default), when nonzero sets the soap::socket f...">soap::accept_flags</a></code> = <code>SO_DONTROUTE</code> </td><td>enables routing bypass for outgoing messages </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#a6b18b017ce2c77ac2b6331469094de59" title="User-definable setsockopt level SOL_SOCKET flags when binding soap::master socket (the value is 0 by ...">soap::bind_flags</a></code> = <code>SO_REUSEADDR</code> </td><td>enables local address reuse immediately, use with caution </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#a6b18b017ce2c77ac2b6331469094de59" title="User-definable setsockopt level SOL_SOCKET flags when binding soap::master socket (the value is 0 by ...">soap::bind_flags</a></code> = <code>SO_REUSEPORT</code> </td><td>enables duplicate address and port bindings </td></tr>
</table>
<p>For example, when <code><a class="el" href="structsoap.html#ad98f12f602efdde049dbd367a43e7cb0" title="User-definable setsockopt level SOL_SOCKET flags (0 by default), when nonzero sets the soap::socket f...">soap::accept_flags</a></code> is set to <code>(SO_NOSIGPIPE | SO_LINGER)</code> this disables SIGPIPE signals and set linger time value given by <code><a class="el" href="structsoap.html#a0f4d025053fde77216a0ca674077198d" title="User-definable linger time value, requires the SO_LINGER setsockopt flag value to be assigned to soap...">soap::linger_time</a></code>, which is zero by default.</p>
<p>The <code><a class="el" href="structsoap.html#aae3eee771d8c4031d30d4ca7633edf9f" title="User-definable socket send and recv flags, for example assign MSG_NOSIGNAL to disable sigpipe (the va...">soap::socket_flags</a></code> context flag can be used to pass options to the <code>&lt;sys/socket.h&gt;</code> <code>send</code>, <code>sendto</code>, <code>recv</code>, and <code>recvfrom</code> calls made by the engine, though some options may not be applicable to your operating system:</p>
<table class="doxtable">
<tr>
<th>context flag with sent/recv flags </th><th>result  </th></tr>
<tr>
<td><code><a class="el" href="structsoap.html#aae3eee771d8c4031d30d4ca7633edf9f" title="User-definable socket send and recv flags, for example assign MSG_NOSIGNAL to disable sigpipe (the va...">soap::socket_flags</a></code> = <code>MSG_NOSIGNAL</code> </td><td>disables SIGPIPE </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#aae3eee771d8c4031d30d4ca7633edf9f" title="User-definable socket send and recv flags, for example assign MSG_NOSIGNAL to disable sigpipe (the va...">soap::socket_flags</a></code> = <code>MSG_DONTROUTE</code> </td><td>enables routing bypass for outgoing messages </td></tr>
</table>
<p>Furthermore, the <code>setsockopt</code> level <code>SOL_SOCKET</code> options <code>SO_SNDBUF</code> and <code>SO_RCVBUF</code> are set the engine when <code><a class="el" href="structsoap.html#a02a7fffd05ff6e6c751f2033ef83854f" title="User-definable value to set SO_SNDBUF setsockopt (the value is SOAP_BUFLEN by default) ...">soap::sndbuf</a></code> and <code><a class="el" href="structsoap.html#af2b1fc40a14f7ed925658246a26497c8" title="User-definable value to set SO_RCVBUF setsockopt (the value is SOAP_BUFLEN by default) ...">soap::rcvbuf</a></code> are set to a nonzero value. The default value is <code><a class="el" href="group__group__soap.html#ga6ec95d997cc20a6a84dd4d76b3ea2fcc" title="User-definable size of the input and output message buffer soap::buf (the value is 65536 by default) ...">SOAP_BUFLEN</a></code>, which is the same size used by the internal buffer <code><a class="el" href="structsoap.html#acda1736fbaac07261226befe165a5681" title="Internal buffer with partial data received or partial data to be sent, where the data occupies soap::...">soap::buf</a></code> to send and receive messages. A zero value omits the internal <code>setsockopt</code> call to set these options. Setting these values to zero activates auto-tuning with Linux 2.4 and greater.</p>
<p>The <code>setsockopt</code> level <code>SOL_SOCKET</code> option <code>SO_KEEPALIVE</code> is set when keep-alive is enabled with context flag <code><a class="el" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2" title="soap_mode IO input and output flag value to keep the socket connection alive for SOAP_MAXKEEPALIVE me...">SOAP_IO_KEEPALIVE</a></code> or when <code><a class="el" href="structsoap.html#af8f80a7bd8c09335c6fb836a612231bb" title="User-definable value to set SO_KEEPALIVE setsockopt (0 by default unless the SOAP_IO_KEEPALIVE mode f...">soap::tcp_keep_alive</a></code> is nonzero. With <code><a class="el" href="structsoap.html#af8f80a7bd8c09335c6fb836a612231bb" title="User-definable value to set SO_KEEPALIVE setsockopt (0 by default unless the SOAP_IO_KEEPALIVE mode f...">soap::tcp_keep_alive</a></code> additional options can be specified with <code><a class="el" href="structsoap.html#a8c0822cb0399ed55de6c2a482171868f" title="User-definable value to set TCP_KEEPIDLE setsockopt (the value is 0 by default) ">soap::tcp_keep_idle</a></code>, <code><a class="el" href="structsoap.html#a822aba3e7ae74fa86277c683569f80ae" title="User-definable value to set TCP_KEEPINTVL setsockopt (the value is 0 by default) ">soap::tcp_keep_intvl</a></code>, and <code><a class="el" href="structsoap.html#a811041faab1cf481e7e656f81dc88901" title="User-definable value to set TCP_KEEPCNT setsockopt (the value is 0 by default) ">soap::tcp_keep_cnt</a></code>. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">soap-&gt;<a class="code" href="structsoap.html#af8f80a7bd8c09335c6fb836a612231bb">tcp_keep_alive</a> = 1;   <span class="comment">// setsockopt SO_KEEPALIVE</span></div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a8c0822cb0399ed55de6c2a482171868f">tcp_keep_idle</a> = 30;   <span class="comment">// time in seconds the connection needs to remain idle before TCP starts sending keepalive probes</span></div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a822aba3e7ae74fa86277c683569f80ae">tcp_keep_intvl</a> = 120; <span class="comment">// time in seconds between individual keepalive probes</span></div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a811041faab1cf481e7e656f81dc88901">tcp_keep_cnt</a> = 5;     <span class="comment">// maximum number of keepalive probes TCP should send before dropping the connection</span></div></div><!-- fragment --><p>For UDP messaging, use <code><a class="el" href="group__group__flags.html#ga388dae9abc80cd6f6d0ecfba383da03b" title="soap_mode IO input/output flag value to use UDP datagrams, message size is limited to UDP packet size...">SOAP_IO_UDP</a></code>. See also Section <a class="el" href="index.html#UDP">SOAP/XML over UDP</a>. The context flags that can be set at the client side for UDP messaging are <code><a class="el" href="structsoap.html#accb43a5716005b473fa1d5688967a3b3" title="User-definable value to set setsockopt level IPPROTO_IP to IP_MULTICAST_IF when non-NULL. ">soap::ipv4_multicast_if</a></code>, <code><a class="el" href="structsoap.html#aa5faa7630425a8ab8018f0b2d4d0c18d" title="User-definable value to set setsockopt level IPPROTO_IP to IP_MULTICAST_TTL when nonzero. ">soap::ipv4_multicast_ttl</a></code>, and <code><a class="el" href="structsoap.html#a3db0542e8eb7db6a2f2cbc16fb24082b" title="User-definable value to set sockaddr_in6::sin6_scope_id when nonzero. ">soap::ipv6_multicast_if</a></code>:</p>
<table class="doxtable">
<tr>
<th>context flag </th><th>result  </th></tr>
<tr>
<td><code><a class="el" href="structsoap.html#accb43a5716005b473fa1d5688967a3b3" title="User-definable value to set setsockopt level IPPROTO_IP to IP_MULTICAST_IF when non-NULL. ">soap::ipv4_multicast_if</a></code> </td><td>set <code>setsockopt</code> level <code>IPPROTO_IP</code> to <code>IP_MULTICAST_IF</code> with value <code><a class="el" href="structsoap.html#accb43a5716005b473fa1d5688967a3b3" title="User-definable value to set setsockopt level IPPROTO_IP to IP_MULTICAST_IF when non-NULL. ">soap::ipv4_multicast_if</a></code> when non-NULL </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#aa5faa7630425a8ab8018f0b2d4d0c18d" title="User-definable value to set setsockopt level IPPROTO_IP to IP_MULTICAST_TTL when nonzero. ">soap::ipv4_multicast_ttl</a></code> </td><td>set <code>setsockopt</code> level <code>IPPROTO_IP</code> to <code>IP_MULTICAST_TTL</code> with value <code><a class="el" href="structsoap.html#aa5faa7630425a8ab8018f0b2d4d0c18d" title="User-definable value to set setsockopt level IPPROTO_IP to IP_MULTICAST_TTL when nonzero. ">soap::ipv4_multicast_ttl</a></code> when nonzero </td></tr>
<tr>
<td><code><a class="el" href="structsoap.html#a3db0542e8eb7db6a2f2cbc16fb24082b" title="User-definable value to set sockaddr_in6::sin6_scope_id when nonzero. ">soap::ipv6_multicast_if</a></code> </td><td>set <code>sockaddr_in6::sin6_scope_id</code> to <code><a class="el" href="structsoap.html#a3db0542e8eb7db6a2f2cbc16fb24082b" title="User-definable value to set sockaddr_in6::sin6_scope_id when nonzero. ">soap::ipv6_multicast_if</a></code> when nonzero </td></tr>
</table>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="errcodes"></a>
Run-time error codes</h1>
<p>Status error codes are integer values, which are returned by the gSOAP API functions. The full list of <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error codes is listed below:</p>
<table class="doxtable">
<tr>
<th>Error code </th><th>Description  </th></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> </td><td>No error (zero) </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga90e9ae93e9af73b25daf7c26eede7dd6" title="A soap_status error code: the service returned a SOAP 1.1 client fault / SOAP 1.2 sender fault to the...">SOAP_CLI_FAULT</a></code> </td><td>The service returned a SOAP 1.1 client fault / SOAP 1.2 sender fault to the client </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga1662809ae1930f48066c06302b3d6207" title="A soap_status error code: SOAP 1.2 DataEncodingUnknown fault (unused in practice) ...">SOAP_DATAENCODINGUNKNOWN</a></code> </td><td>SOAP 1.2 DataEncodingUnknown fault </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga122216a634ba30e3cc6e7ba53218dd97" title="A soap_status error code: an HTTP DELETE request was received by the service but the DELETE request c...">SOAP_DEL_METHOD</a></code> </td><td>An HTTP DELETE request was received by the service but the DELETE request callback <code><a class="el" href="group__group__callbacks.html#gaf2bda0187489c8f2b9857f61b96ad0e0" title="Callback to implement logic at the server-side to serve responses to HTTP DELETE requests from client...">soap::fdel</a></code> is not implemented, see Section <a class="el" href="index.html#callback">Function callbacks for customized I/O and HTTP handling</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gaedff5041616d51d113a1a3563068e381" title="A soap_status error code: end of DIME attachments protocol error. ">SOAP_DIME_END</a></code> </td><td>End of DIME attachments protocol error </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gac875b699af64ac0c23a2dc9593c79688" title="A soap_status error code: DIME formatting error or DIME attachment size exceeds SOAP_MAXDIMESIZE ...">SOAP_DIME_ERROR</a></code> </td><td>DIME formatting error or DIME attachment size exceeds <code><a class="el" href="group__group__soap.html#gad4c2ca8c2293fc75075aec4a09f4dc38" title="User-definable maximum length of DIME attachments received (the value is 8 MB by default) ...">SOAP_MAXDIMESIZE</a></code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gaa961540f8e8b1c09ba0dc0b7e2474d80" title="A soap_status error code: DIME attachment has no href from SOAP body and no DIME callbacks were defin...">SOAP_DIME_HREF</a></code> </td><td>DIME attachment has no href from SOAP body and no DIME callbacks were defined to save the attachment </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga2c812ebb082e15cad8a8d7d88deca77a" title="A soap_status error code: DIME version error. ">SOAP_DIME_MISMATCH</a></code> </td><td>DIME version error </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga247547c60fe02deac752a2ae21fe531a" title="A soap_status error code: XML element has duplicate id attribute value (applicable to SOAP multi-ref ...">SOAP_DUPLICATE_ID</a></code> </td><td>XML element has duplicate id attribute value (applicable to SOAP multi-ref encoding and <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> serialization) </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga21bd498f0ec1848472cd97d7a32e3d56" title="A soap_status error code: XML element or attribute is empty when a value is required. ">SOAP_EMPTY</a></code> </td><td>XML element or attribute is empty when a value is required </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga224b2c2b830135f12b53536f189b4ebd" title="A soap_status error code: unexpected end of file, no input, transmission interrupted or timed out (sa...">SOAP_EOF</a></code> </td><td>Unexpected end of file, no input, transmission interrupted or timed out, same as <code>EOF</code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga9fd637076afcd330401f2cd0a71fe729" title="A soap_status error code: out of memory. ">SOAP_EOM</a></code> </td><td>Out of memory </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga1273756841a728f037ee5328e217eb6e" title="A soap_status error code: an unspecified error occurred. ">SOAP_ERR</a></code> </td><td>Same as <code>EOF</code>, but indicates an unspecified error </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gaf27d1f10130e4da080975711a7192f07" title="A soap_status error code: the fault code to be returned by a service operation when calling soap_send...">SOAP_FAULT</a></code> </td><td>The fault code to be returned by a service operation when calling <code><a class="el" href="group__group__fault.html#gac20c8569833053318196d898fe2566af" title="Set SOAP 1.1 client fault / SOAP 1.2 sender fault string and detail. ">soap_sender_fault</a></code> (client is at fault) or <code><a class="el" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6" title="Set SOAP 1.1 server fault / SOAP 1.2 receiver fault string and detail. ">soap_receiver_fault</a></code> (server is at fault), clients receive the fault as <code><a class="el" href="group__group__errors.html#ga90e9ae93e9af73b25daf7c26eede7dd6" title="A soap_status error code: the service returned a SOAP 1.1 client fault / SOAP 1.2 sender fault to the...">SOAP_CLI_FAULT</a></code> or <code><a class="el" href="group__group__errors.html#gab541fcea670401ec0679d7e95d09ba32" title="A soap_status error code: service returned a SOAP 1.1 server fault / SOAP 1.2 receiver fault to the c...">SOAP_SVR_FAULT</a></code> respectively </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga514709514aa7ec51e92fcd51ebedb5af" title="A soap_status error code: too many open sockets. ">SOAP_FD_EXCEEDED</a></code> </td><td>Too many open sockets </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga9efce27c8560ec9cb2184fcb58a85bd9" title="A soap_status error code: XML element or attribute value is fixed and the parsed value does not match...">SOAP_FIXED</a></code> </td><td>XML element or attribute value is fixed and the parsed value does not match the fixed value </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gac62f5f70e545ea8fbcbb181e88750d56" title="A soap_status error code: an HTTP GET request was received by the service but the GET request callbac...">SOAP_GET_METHOD</a></code> </td><td>An HTTP GET request was received by the service but the GET request callback <code><a class="el" href="group__group__callbacks.html#gae022204ff7004df2d5ac9e083cbb5b16" title="Callback to implement logic at the server-side to serve responses to HTTP GET requests from clients...">soap::fget</a></code> is not implemented, see Sections <a class="el" href="index.html#get">How to implement HTTP GET, PUT, and PATCH services</a> and <a class="el" href="index.html#callback">Function callbacks for customized I/O and HTTP handling</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga6cd5d130ef1d431f0596edf4084acb07" title="A soap_status error code: reference to object in XML identified by its id attribute is incompatible w...">SOAP_HREF</a></code> </td><td>Reference to object in XML identified by its id attribute is incompatible with the object referred to by the ref or href attribute (applicable to SOAP multi-ref encoding and <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> serialization) </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gad04b91a2b60f648f97fd226cb2b43b51" title="A soap_status error code: an unspecified HTTP error occured. ">SOAP_HTTP_ERROR</a></code> </td><td>An unspecified HTTP error occurred </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga7f0daf7a83ff107406f8726139338cbb" title="A soap_status error code: an HTTP request was received by the service that cannot be handled...">SOAP_HTTP_METHOD</a></code> </td><td>An HTTP request was received by the service that cannot be handled </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga4bf925c17a1c81e99de6bfdb7d85c19a" title="A soap_status error code: SOAP array index out of bounds. ">SOAP_IOB</a></code> </td><td>SOAP array index out of bounds </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gada50f79e7b120b498bd05426a424e4af" title="A soap_status error code: XML element or attribute value length validation error or SOAP_MAXLENGTH ex...">SOAP_LENGTH</a></code> </td><td>XML element or attribute length validation error or <code><a class="el" href="group__group__soap.html#gabd0dd334a752d8c145fa720deb905508" title="User-definable maximum string content length for strings not already constrained by XML schema valida...">SOAP_MAXLENGTH</a></code> exceeded </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga960d32bcdfd9d166d78b19a0885b61d8" title="A soap_status error code: XML nesting depth level when parsing XML exceeds SOAP_MAXLEVEL ...">SOAP_LEVEL</a></code> </td><td>XML nesting depth level exceeds <code><a class="el" href="group__group__soap.html#ga2ad35599c611417132d6b0a9b6870652" title="User-definable maximum XML nesting depth level permitted by the XML parser, must be greater than zero...">SOAP_MAXLEVEL</a></code> </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga9f2f25c41ca0263da404d3073fd71349" title="A soap_status error code: end of MIME/MTOM attachments protocol error. ">SOAP_MIME_END</a></code> </td><td>End of MIME attachments protocol error </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga4a3ff27eee1c447d94ba458f592ec87f" title="A soap_status error code: MIME/MTOM attachment parsing error. ">SOAP_MIME_ERROR</a></code> </td><td>MIME attachment parsing error </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gae799c6e786b0446d51b7aca6522d8e9d" title="A soap_status error code: MIME/MTOM attachment has no href from SOAP body and no MIME callbacks were ...">SOAP_MIME_HREF</a></code> </td><td>MIME attachment has no href from SOAP body and no MIME callbacks were defined to save the attachment </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga7a0da83313ae56525de8f7169fab3fa9" title="A soap_status error code: an XML element with id attribute is missing that should match the element w...">SOAP_MISSING_ID</a></code> </td><td>An XML element with id attribute is missing that should match the element with href/ref attribute (applicable to SOAP multi-ref encoding and <code><a class="el" href="group__group__flags.html#gaf3ce7bc1679e665ac6b23da56510f645" title="soap_mode XML input/output flag value to serialize C/C++ (cyclic) data structures in XML with id-ref ...">SOAP_XML_GRAPH</a></code> serialization) </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga0c86323f5a2ae76f52f9d1bfe452d8fc" title="A soap_status error code: memory overflow or memory corruption error (applicable in DEBUG mode only) ...">SOAP_MOE</a></code> </td><td>Memory overflow or memory corruption error (applicable in <code><a class="el" href="group__group__debug.html#gad72dbcf6d0153db1b8d8a58001feed83" title="User-definable macro to enable debugging and logging. ">DEBUG</a></code> mode only) </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga6e6849f52e3641ffba443df668d55168" title="A soap_status error code: an XML element is present with a mustUnderstand attribute which must be und...">SOAP_MUSTUNDERSTAND</a></code> </td><td>An XML element is present with a mustUnderstand attribute which must be understood but is not deserialized </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga7ae932668854b3e2a8ce21ab8960bf1f" title="A soap_status error code: XML namespace name mismatch validation error. ">SOAP_NAMESPACE</a></code> </td><td>XML namespace name mismatch validation error </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga978837444338734aa247152871b6e92d" title="A soap_status error code: no data in the HTTP body of the message received. ">SOAP_NO_DATA</a></code> </td><td>No data in the HTTP body of the message received </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad" title="A soap_status error code: the service request dispatcher did not find a matching service operation fo...">SOAP_NO_METHOD</a></code> </td><td>The service request dispatcher did not find a matching service operation for a service request </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga3c7951b18d6593b4a1dfec9d468bb3c0" title="A soap_status error code: no XML element tag was found when one was expected. ">SOAP_NO_TAG</a></code> </td><td>No XML element tag was found when one was expected </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gae4b63fe5c5938cd0241d390bf1c97f7c" title="A soap_status error code: an NTLM authentication handshake error occured. ">SOAP_NTLM_ERROR</a></code> </td><td>An NTLM authentication handshake error occurred </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga76179757f85e61d0dfe0be58ab4be99a" title="A soap_status error code: XML element has an xsi:nil attribute when the element is not nillable...">SOAP_NULL</a></code> </td><td>XML element has an <code>xsi:nil</code> attribute when the element is not nillable, causing a validation error </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga544607e40f8cdc217279ce7128758ea2" title="A soap_status error code: XML element has a minOccurs or maxOccurs constraint validation error or SOA...">SOAP_OCCURS</a></code> </td><td>XML element minOccurs or maxOccurs validation error or <code><a class="el" href="group__group__soap.html#ga3933a58d23a5bf2ad64039725cb23786" title="User-definable maximum number of array or container elements for containers that are not already cons...">SOAP_MAXOCCURS</a></code> exceeded </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gaf8d3f932c1d555c2cbca899c1095d40e" title="A soap_status error code: an HTTP PATCH request was received by the service but the PATCH request cal...">SOAP_PATCH_METHOD</a></code> </td><td>An HTTP PATCH request was received by the service but the PATCH request callback <code><a class="el" href="group__group__callbacks.html#ga808a6a9b7e6d17e039fb53a5e8a9b84a" title="Callback to implement logic at the server-side to serve responses to HTTP PATCH requests from clients...">soap::fpatch</a></code> is not implemented, see Section <a class="el" href="index.html#callback">Function callbacks for customized I/O and HTTP handling</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gab75f1c93d4fcae739c26fc8fa087c153" title="A soap_status error code: XML element or attribute value pattern mismatch causes a validation error...">SOAP_PATTERN</a></code> </td><td>XML element or attribute value pattern mismatch </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga955e26e41395aed19fd78ce1a2f395b0" title="A soap_status error code: failed to register plugin. ">SOAP_PLUGIN_ERROR</a></code> </td><td>Failed to register plugin </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga5f3631972d5eaa9b7c9a80eff8c2e4ee" title="A soap_status error code: attribute is prohibited but present. ">SOAP_PROHIBITED</a></code> </td><td>XML attribute is prohibited but present </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gad8fb6bd54608a32e89ddef0b33575bb5" title="A soap_status error code: an HTTP PUT request was received by the service but the PUT request callbac...">SOAP_PUT_METHOD</a></code> </td><td>An HTTP PUT request was received by the service but the PUT request callback <code><a class="el" href="group__group__callbacks.html#gaf263ffe14d8c2508ce4c734d4f33a854" title="Callback to implement logic at the server-side to serve responses to HTTP PUT requests from clients...">soap::fput</a></code> is not implemented, see Section <a class="el" href="index.html#callback">Function callbacks for customized I/O and HTTP handling</a> </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gaec868309483d86ccc641ea753d422677" title="A soap_status error code: attribute is required but not present. ">SOAP_REQUIRED</a></code> </td><td>XML attribute is required but not present </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga2a67e043632ead3810bb847eadd09ac4" title="A soap_status error code: an SSL error occured. ">SOAP_SSL_ERROR</a></code> </td><td>An SSL error occurred </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gab541fcea670401ec0679d7e95d09ba32" title="A soap_status error code: service returned a SOAP 1.1 server fault / SOAP 1.2 receiver fault to the c...">SOAP_SVR_FAULT</a></code> </td><td>The service returned a SOAP 1.1 server fault or SOAP 1.2 receiver fault to the client </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga517c3887f1fbec8304dbe0a001996c39" title="A soap_status error code: an XML syntax error occurred while parsing the input. ">SOAP_SYNTAX_ERROR</a></code> </td><td>An XML syntax error occurred while parsing the input </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga7f4d934410ea4dd2ffa5ad7fcaae7e70" title="A soap_status error code: XML element tag parsed does not match anything that is expected. ">SOAP_TAG_MISMATCH</a></code> </td><td>XML element tag parsed does not match anything that is expected </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga5087817634de39f79e74246b1eb4da54" title="A soap_status error code: a TCP/IP connection error occured. ">SOAP_TCP_ERROR</a></code> </td><td>A TCP/IP connection error occurred </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gafea66c256bdaa8376e12106e36307c02" title="A soap_status error code: XML element or attribute has a mismatching type or value that is causing a ...">SOAP_TYPE</a></code> </td><td>XML element or attribute has a mismatching type or value that is causing a validation error </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga68fef55a590136841ec89052091f04b8" title="A soap_status error code: a UDP/IP connection error occured or the message too large to store in a UD...">SOAP_UDP_ERROR</a></code> </td><td>A UDP/IP connection error occurred or the message too large to store in a UDP packet </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gacf92b9abfa654b47497c8761a75c82f2" title="A soap_status error code: soap::user not set to non-NULL. ">SOAP_USER_ERROR</a></code> </td><td><a class="el" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b" title="User-definable variable that may point to user-specified data of any type to pass the data through to...">soap::user</a> not set to non-NULL </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga7591ced9d3c04aaf88605eb39ed69bd5" title="A soap_status error code: a UTF-8 decoding error occured. ">SOAP_UTF_ERROR</a></code> </td><td>An UTF-8 decoding error occurred </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#ga483988fe69702114394b03c7605a49d9" title="A soap_status error code: SOAP version mismatch or no SOAP message is received. ">SOAP_VERSIONMISMATCH</a></code> </td><td>SOAP version mismatch or no SOAP message is received </td></tr>
<tr>
<td><code><a class="el" href="group__group__errors.html#gaa22b195e900b8f0bf3cfe69f4eead9ae" title="A soap_status error code: a zlib error occured. ">SOAP_ZLIB_ERROR</a></code> </td><td>A zlib error occurred </td></tr>
</table>
<p>A status code of <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> (zero) is returned by a gSOAP API function when the function call was successful, otherwise a non-zero error code is returned. The status error code is also stored in the current <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context as <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code>. For IO and socket-related errors, also the <code><a class="el" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13" title="The errno value of the last failed IO operation. ">soap::errnum</a></code> variable is set to the <code>errno</code> value of the system error for example when a <code><a class="el" href="group__group__errors.html#ga224b2c2b830135f12b53536f189b4ebd" title="A soap_status error code: unexpected end of file, no input, transmission interrupted or timed out (sa...">SOAP_EOF</a></code> error occurred.</p>
<p>To display the error, use <code><a class="el" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af" title="Print error message on the specified output. ">soap_print_fault(struct soap *soap, FILE *fd)</a></code> where the current value of <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code> is used by the function to print the error to the specified <code>fd</code> file. Alternatively, in C++ you can use <code><a class="el" href="group__group__fault.html#gaab984763de3f5fdd4363aa62b4f250c2" title="Print error message on the specified output stream. ">soap_stream_fault(struct soap *soap, std::ostream&amp; os)</a></code> to print the error on the specified <code>os</code> output stream.</p>
<p>To display the location of an XML parsing and validation error, use <code><a class="el" href="group__group__fault.html#gaa70822938e0f116d1d0020aff66cc795" title="Print the location in the message where and when the error occurred. ">soap_print_fault_location(struct soap *soap, FILE *fd)</a></code> or <code><a class="el" href="group__group__fault.html#ga48129588ed481ab84698fa5cd84851a5" title="Print the location in the message where and when the error occurred. ">soap_stream_fault_location(struct soap *soap, std::ostream&amp; os)</a></code> to print part of the XML with the error location marked in the XML output.</p>
<p>To save the error in a string buffer <code>buf[0...len-1]</code>, use <code><a class="el" href="group__group__fault.html#gafc9d67060889f7243381299047f0e8e6" title="Print error message to the specified string buffer. ">soap_sprint_fault(struct soap*, char *buf, size_t len)</a></code>, where <code>buf</code> is populated with the fault message terminating with a <code>\0</code>.</p>
<p>To determine the type of error that occurred, use:</p><ul>
<li><code><a class="el" href="group__group__errors.html#ga6b7afdaae55aa75bd611f2e37d2a6758" title="Check for XML parsing and validation errors, returns true if the specified error code is an XML error...">soap_xml_error_check(soap_status e)</a></code> checks for XML parsing and validation errors, returns true if the specified error code is an XML error.</li>
<li><code><a class="el" href="group__group__errors.html#gab8d8472136e27ca8e89c1dfbac1b6244" title="Check for SOAP protocol faults and errors, returns true if the specified error code is a SOAP protoco...">soap_soap_error_check(soap_status e)</a></code> checks for SOAP protocol faults and errors, returns true if the specified error code is a SOAP protocol error.</li>
<li><code><a class="el" href="group__group__errors.html#ga4c10eeefec04f4e4a92f1ffeb3317785" title="Check for HTTP protocol errors, returns true if the specified error code is an HTTP protocol error or...">soap_http_error_check(soap_status e)</a></code> checks for HTTP protocol errors, returns true if the specified error code is an HTTP protocol error or a HTTP status code between 100 and 599 returned by an HTTP server.</li>
<li><code><a class="el" href="group__group__errors.html#ga1c3ae093e72a6a3bce6f5e1df3dd8d71" title="Check for TCP protocol errors, returns true if the specified error code is a TCP error, when true use soap::errnum to retrieve the errno value of the failure to determine the cause. ">soap_tcp_error_check(soap_status e)</a></code> checks for TCP protocol errors, returns true if the specified error code is a TCP error, when true use <code><a class="el" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13" title="The errno value of the last failed IO operation. ">soap::errnum</a></code> to retrieve the <code>errno</code> value to determine the cause.</li>
<li><code><a class="el" href="group__group__errors.html#gaa21364c2c09672019052bb8d648634c6" title="Check for UDP protocol errors, returns true if the specified error code is a UDP error, when true use soap::errnum to retrieve the errno value of the failure to determine the cause. ">soap_udp_error_check(soap_status e)</a></code> checks for UDP protocol errors, returns true if the specified error code is a UDP error, when true use <code><a class="el" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13" title="The errno value of the last failed IO operation. ">soap::errnum</a></code> to retrieve the <code>errno</code> value to determine the cause.</li>
<li><code><a class="el" href="group__group__errors.html#ga3b334592652ba6b933d38576e39a7025" title="Check for SSL/TLS protocol errors, returns true if the specified error code is a SSL/TLS error...">soap_ssl_error_check(soap_status e)</a></code> checks for SSL/TLS protocol errors, returns true if the specified error code is a SSL/TLS error, when true use <code><a class="el" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13" title="The errno value of the last failed IO operation. ">soap::errnum</a></code> to retrieve the <code>errno</code> value to determine the cause.</li>
<li><code><a class="el" href="group__group__errors.html#ga093d1cfafb5cee9ae36c1f2a2d6797f7" title="Check for zlib library errors, returns true if the specified error code is a zlib error...">soap_zlib_error_check(soap_status e)</a></code> checks for zlib library errors, returns true if the specified error code is a zlib error.</li>
</ul>
<p>An HTTP status code is returned when the client fails to connect to an HTTP server and the HTTP server response with an error. The list of HTTP status codes is given below:</p>
<table class="doxtable">
<tr>
<th>Code </th><th>Description  </th></tr>
<tr>
<td>200 </td><td>OK (no error) </td></tr>
<tr>
<td>201 </td><td>Created </td></tr>
<tr>
<td>202 </td><td>Accepted </td></tr>
<tr>
<td>203 </td><td>Non-Authoritative Information </td></tr>
<tr>
<td>204 </td><td>No Content </td></tr>
<tr>
<td>205 </td><td>Reset Content </td></tr>
<tr>
<td>206 </td><td>Partial Content </td></tr>
<tr>
<td>300 </td><td>Multiple Choices </td></tr>
<tr>
<td>301 </td><td>Moved Permanently </td></tr>
<tr>
<td>302 </td><td>Found </td></tr>
<tr>
<td>303 </td><td>See Other </td></tr>
<tr>
<td>304 </td><td>Not Modified </td></tr>
<tr>
<td>305 </td><td>Use Proxy </td></tr>
<tr>
<td>307 </td><td>Temporary Redirect </td></tr>
<tr>
<td>400 </td><td>Bad Request </td></tr>
<tr>
<td>401 </td><td>Unauthorized </td></tr>
<tr>
<td>402 </td><td>Payment Required </td></tr>
<tr>
<td>403 </td><td>Forbidden </td></tr>
<tr>
<td>404 </td><td>Not Found </td></tr>
<tr>
<td>405 </td><td>Method Not Allowed </td></tr>
<tr>
<td>406 </td><td>Not Acceptable </td></tr>
<tr>
<td>407 </td><td>Proxy Authentication Required </td></tr>
<tr>
<td>408 </td><td>Request Time-out </td></tr>
<tr>
<td>409 </td><td>Conflict </td></tr>
<tr>
<td>410 </td><td>Gone </td></tr>
<tr>
<td>411 </td><td>Length Required </td></tr>
<tr>
<td>412 </td><td>Precondition Failed </td></tr>
<tr>
<td>413 </td><td>Request Entity Too Large </td></tr>
<tr>
<td>414 </td><td>Request-URI Too Large </td></tr>
<tr>
<td>415 </td><td>Unsupported Media Type </td></tr>
<tr>
<td>416 </td><td>Requested range not satisfiable </td></tr>
<tr>
<td>417 </td><td>Expectation Failed </td></tr>
<tr>
<td>500 </td><td>Internal Server Error </td></tr>
<tr>
<td>501 </td><td>Not Implemented </td></tr>
<tr>
<td>502 </td><td>Bad Gateway </td></tr>
<tr>
<td>503 </td><td>Service Unavailable </td></tr>
<tr>
<td>504 </td><td>Gateway Time-out </td></tr>
<tr>
<td>505 </td><td>HTTP Version not supported </td></tr>
</table>
<p>HTTP status code 200 is not flagged as an error by the engine. Status codes 201 and 202 are informative and should not be considered errors by the application logic.</p>
<p>Server-side implementations of service operations should return <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> when the operation was successful, which returns a "200 OK" HTTP header with the XML response message. Server-side implementations of service operations in gSOAP may directly return an HTTP status code when an HTTP-related error should be returned. For example, <code>return 404</code> returns "404 Not Found" to the client and the <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code> variable is set to 404 at the client side.</p>
<p>To return a SOAP Fault from a server-side implementation of a service operation, use one of the following functions to populate the SOAP Fault message:</p><ul>
<li><code>int <a class="el" href="group__group__fault.html#gac20c8569833053318196d898fe2566af" title="Set SOAP 1.1 client fault / SOAP 1.2 sender fault string and detail. ">soap_sender_fault(struct soap *soap, const char *faultstring, const char *faultdetail)</a></code> returns <code><a class="el" href="group__group__errors.html#gaf27d1f10130e4da080975711a7192f07" title="A soap_status error code: the fault code to be returned by a service operation when calling soap_send...">SOAP_FAULT</a></code> and populates a SOAP Fault message indicating a SOAP 1.1 client fault / SOAP 1.2 sender fault that is populated with the text <code>faultstring</code> and an XML fragment <code>faultdetail</code> or NULL when omitted.</li>
<li><code>int <a class="el" href="group__group__fault.html#gaf273fe8f08c8ddd558d509c45d7dc20d" title="Set SOAP 1.1 client fault / SOAP 1.2 sender fault subcode, string and detail. ">soap_sender_fault_subcode(struct soap *soap, const char *faultsubcode, const char *faultstring, const char *faultdetail)</a></code> same as <code><a class="el" href="group__group__fault.html#gac20c8569833053318196d898fe2566af" title="Set SOAP 1.1 client fault / SOAP 1.2 sender fault string and detail. ">soap_sender_fault</a></code> with the addition of a QName-formatted string <code>faultsubcode</code>.</li>
<li><code>int <a class="el" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6" title="Set SOAP 1.1 server fault / SOAP 1.2 receiver fault string and detail. ">soap_receiver_fault(struct soap *soap, const char *faultstring, const char *faultdetail)</a></code> returns <code><a class="el" href="group__group__errors.html#gaf27d1f10130e4da080975711a7192f07" title="A soap_status error code: the fault code to be returned by a service operation when calling soap_send...">SOAP_FAULT</a></code> and populates a SOAP Fault message indicating a SOAP 1.1 server fault / SOAP 1.2 receiver fault that is populated with the text <code>faultstring</code> and an XML fragment <code>faultdetail</code> or NULL when omitted.</li>
<li><code>int <a class="el" href="group__group__fault.html#gaa5544bc29083bb0b28cda5b4ad696d6a" title="Set SOAP 1.1 server fault / SOAP 1.2 receiver fault subcode, string and detail. ">soap_receiver_fault_subcode(struct soap *soap, const char *faultsubcode, const char *faultstring, const char *faultdetail)</a></code> same as <code><a class="el" href="group__group__fault.html#ga91dc6bcc3c5f35e023b78a6f46a79ed6" title="Set SOAP 1.1 server fault / SOAP 1.2 receiver fault string and detail. ">soap_receiver_fault</a></code> with the addition of a QName-formatted string <code>faultsubcode</code>.</li>
</ul>
<p>A receiver error indicates that the service could not handle the client request, but it can possibly recover from the error later, for example when resources are temporarily unavailable. A sender error indicates that the client request is faulty and s rejected by the service.</p>
<p>See Section <a class="el" href="index.html#fault">SOAP Fault processing</a> for more details on how to use these functions.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="memory"></a>
Memory management</h1>
<p>Memory management with gSOAP is automatic. The engine context manages all memory allocated to serialize data and for temporary storage. Deserialized data is allocated in managed memory and data structures can be allocated in managed memory by the user when desired using <code>soap_new_T</code> functions generated by soapcpp2 for each serializable type <code>T</code>. All memory managed by a context is deallocated with <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code> to destroy managed C++ objects and <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> to delete all other managed data. When a context is finalized or freed with <code><a class="el" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a" title="Finalize the given soap context, i.e. when the soap context is stack allocated, automatically invoked...">soap_done(struct soap*)</a></code> and <code><a class="el" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a" title="Finalize and free the given soap context from unmanaged heap memory. ">soap_free(struct soap*)</a></code> then managed memory is not released, so it is important to call the deallocation functions first. This was done to allow managed data to outlive the context, such as deserialized objects, but this is rarely if ever used because deleting the outlived data explicitly is prone to mistakes.</p>
<p>If you want to let deserialized data outlive a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context that you are about to free, then you can delegate management of the data to another <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context with <code><a class="el" href="group__group__context.html#gaa959ff61609f7b324527e88655c2377f" title="Delegate the deletion of all managed objects and data from the specified soap context to another soap...">soap_delegate_deletion(struct soap *soap_from, struct soap *soap_to)</a></code>. This moves all deserialized and temporary data to the other <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context <code>soap_to</code>, which will delete its data and all the delegated data it is responsible for when you call <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code> and <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code>. This can be particularly useful for making client calls inside a server operation, i.e. a mixed server and client. The client call inside the server operation requires a new <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context, e.g. copied from the server's with <code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy</a></code>. Before destroying the client context with <code><a class="el" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a" title="Finalize and free the given soap context from unmanaged heap memory. ">soap_free</a></code>, the data can be delegated to the server's context with <code><a class="el" href="group__group__context.html#gaa959ff61609f7b324527e88655c2377f" title="Delegate the deletion of all managed objects and data from the specified soap context to another soap...">soap_delegate_deletion</a></code>. See for example <em><code>gsoap/samples/mashup/mashupserver.c</code></em> in the gSOAP source code package.</p>
<p>The functions related to memory management by the context are:</p>
<ul>
<li><code>void * <a class="el" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c" title="Allocate a block of heap memory managed by the specified soap context. ">soap_malloc(struct soap *soap, size_t n)</a></code> return pointer to <code>n</code> bytes of managed memory.</li>
<li><code>char * <a class="el" href="group__group__context.html#ga41747ef145667bdff9c66cdd2bc86653" title="Copy a string to managed memory. ">soap_strdup(struct soap *soap, const char *s)</a></code> return pointer to duplicate of string <code>s</code> in managed memory.</li>
<li><code>char * <a class="el" href="group__group__context.html#ga7fe9c27b0f0eac077bc13caf816fbba8" title="Copy a wide string to managed memory. ">soap_wstrdup(struct soap *soap, const wchar_t *s)</a></code> return pointer to duplicate of string <code>s</code> in managed memory.</li>
<li><code>T * soap_new_T(struct soap *soap)</code> allocates and default-initializes data of type <code>T</code>, C++ only.</li>
<li><code>T * soap_new_T(struct soap *soap, int n)</code> allocates and default-initializes and array of type <code>T</code>, where <code>n</code> = -1 allocates a single non-array value.</li>
<li><code>T * soap_new_set_T(struct soap *soap, m1, ..., mn)</code> allocates a struct or class <code>T</code> and initializes its members with the values <code>m1</code> to <code>mn</code>.</li>
<li><code>T * soap_new_req_T(struct soap *soap, m1, ..., mn)</code> allocates a struct or class <code>T</code> and initializes its required members with the values <code>m1</code> to <code>mn</code>, required means non-optional member as required by XML validation when this data is serialized in XML.</li>
<li><code>void <a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy(struct soap *soap)</a></code> deletes all context-managed C++ objects and must be called before <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code>.</li>
<li><code>void <a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end(struct soap *soap)</a></code> deletes temporary data and all deserialized data except C++ objects, see above.</li>
<li><code>void <a class="el" href="group__group__context.html#gace16239b47adccf9e4dc307cebe6a323" title="Delete temporary data. ">soap_free_temp(struct soap *soap)</a></code> deletes temporary data but leaves deserialized context-managed data intact.</li>
<li><code>void <a class="el" href="group__group__context.html#gacdc44bad1fbf1851f3664b887e807c85" title="Explicitly dealllocates a block of managed memory that is managed by the specified soap context and r...">soap_dealloc(struct soap *soap, void *p)</a></code> deallocates context-managed objects or data at location <code>p</code> in memory.</li>
<li><code>int <a class="el" href="group__group__context.html#ga643bb3cdc192ec0dc1a8448498dab401" title="Unlink a block of heap memory managed by the specified soap context, to release the memory explicitly...">soap_unlink(struct soap *soap, const void *p)</a></code> unlink object or data at location <code>p</code> from management by the context, this object or data must be deallocated by the user.</li>
<li><code>void <a class="el" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a" title="Finalize the given soap context, i.e. when the soap context is stack allocated, automatically invoked...">soap_done(struct soap *soap)</a></code> finalizes the context but does not delete any managed objects or data.</li>
<li><code>void <a class="el" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a" title="Finalize and free the given soap context from unmanaged heap memory. ">soap_free(struct soap *soap)</a></code> finalizes and frees the context (contexts allocated with <code><a class="el" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c" title="Allocate and initialize a new soap context. ">soap_new</a></code> or <code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy</a></code>) but does not delete any managed objects or data.</li>
<li><code>void <a class="el" href="group__group__context.html#gaa959ff61609f7b324527e88655c2377f" title="Delegate the deletion of all managed objects and data from the specified soap context to another soap...">soap_delegate_deletion(struct soap *soap_from, struct soap *soap_to)</a></code> moves all C++ objects, data, and temporary data managed by the <code>soap_from</code> context to another context <code>soap_to</code>, which manages the data until deleted with <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code> and <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code>.</li>
</ul>
<p>To help understand the differences between managed objects, managed data, and managed temporary data: temporary data is created by the engine to keep track of things, such as hash tables to keep pointer reference information for serialization and hash tables to keep XML id/href information for multi-reference object deserialization. Deserialized data is allocated by the context in managed memory when constructing data structures by deserializing XML and JSON messages. Data is stored in memory managed by the context using calls to <code><a class="el" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c" title="Allocate a block of heap memory managed by the specified soap context. ">soap_malloc</a></code> to allocate heap space with <code>malloc</code>. A tiny bit more space is allocated to keep track of the allocations and to add a "canary" word to detect heap memory overflows. Heap memory overflows are detected when context-managed data is deallocated with <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code>. C++ objects are allocated with <code>new</code> instead of <code>malloc</code> and are tracked as well. These objects are deallocated with <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code>.</p>
<p>When the gSOAP application is compiled with <b><code>-DDEBUG</code></b> using the compile-time flag <code><a class="el" href="group__group__debug.html#gad72dbcf6d0153db1b8d8a58001feed83" title="User-definable macro to enable debugging and logging. ">DEBUG</a></code>, the engine reports memory leaks which are detected by <code><a class="el" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a" title="Finalize the given soap context, i.e. when the soap context is stack allocated, automatically invoked...">soap_done</a></code> and <code><a class="el" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a" title="Finalize and free the given soap context from unmanaged heap memory. ">soap_free</a></code>. To improve the accuracy of detection, no memory is actually freed until <code><a class="el" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a" title="Finalize the given soap context, i.e. when the soap context is stack allocated, automatically invoked...">soap_done</a></code> or <code><a class="el" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a" title="Finalize and free the given soap context from unmanaged heap memory. ">soap_free</a></code> are called to detect memory issues, so any calls to <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code> and <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> are actually deferred to be executed when the context finalizes.</p>
<p>While memory management in gSOAP is automatic, it does not enforce its own memory management policy on the user. To move managed objects and data into unmanaged heap space, the <code>soap_dup_T</code> deep copy functions generated by <b><code>soapcpp2 -Ec</code></b> option <b><code>-Ec</code></b> can be used. To delete deep copies, the <code>soap_del_T</code> deep deletion functions generated by <b><code>soapcpp2 -Ed</code></b> option <b><code>-Ed</code></b> can be used. After copying the usual <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code> and <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> functions remove the managed originals. See also Section <a class="el" href="index.html#deep">Generating deep copy and deletion functions</a>.</p>
<p>Furthermore, the memory allocation functions <code>malloc</code> and <code>new</code> used by the engine internally can be replaced with other allocators by defining <code>SOAP_MALLOC</code> and <code>SOAP_FREE</code> to replace <code>malloc</code> and <code>free</code>, and define <code>SOAP_NEW</code>, <code>SOAP_NEW_ARRAY</code>, <code>SOAP_PLACEMENT_NEW</code>, and <code>SOAP_DELETE</code>, <code>SOAP_DELETE_ARRAY</code> to replace <code>new</code> and <code>delete</code> used by the engine to allocate managed memory. One can for example use a garbage collector with gSOAP by defining suitable replacements.</p>
<p>More information on memory management can be found in the <a href="../../databinding/html/index.html">C and C++ XML Data Bindings</a> documentation that has separate sections on memory management in C and in C++.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="classmemory"></a>
Intra-class memory management</h1>
<p>When a class <code>T</code> has a <code>struct soap * T::soap</code> member declared in an interface header file for soapcpp2, then this member will be set to point to the current context by the deserializers and by the <code>soap_default</code> method of the class and by the <code>soap_default_T</code> and <code>soap_new_T</code> functions for this class named <code>T</code>. This simplifies memory management by class methods that allocate data associated with the class instance that must be managed by the context.</p>
<p>Consider for example the following class declaration:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Class </div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    Class();</div><div class="line">    ~Class();</div><div class="line">    <span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>;</div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">    <span class="keywordtype">void</span> setName(<span class="keyword">const</span> <span class="keywordtype">char</span> *s); </div><div class="line">    <span class="keywordtype">char</span> *getName();</div><div class="line">};</div></div><!-- fragment --><p>Since the <code>name</code> member is a character pointer to a string, where should we allocate this string? In most cases we will add a constructor that initially sets <code>name</code> to NULL and a destructor that deletes <code>name</code> when non-NULL, like so:</p>
<div class="fragment"><div class="line">Class::Class() </div><div class="line">{</div><div class="line">  soap = NULL;</div><div class="line">  name = NULL;</div><div class="line">} </div><div class="line">Class::~Class() </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (name)</div><div class="line">    free(name);</div><div class="line">}</div></div><!-- fragment --><p>However, when instances of <code>Class</code> are deserialized we have a problem with this approach because <code>free(name)</code> deletes a managed string, which is managed by the context. Because the deserializer also sets the <code>soap</code> member of this class, there is an easy solution to this problem:</p>
<div class="fragment"><div class="line">Class::~Class() </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (!soap &amp;&amp; name)</div><div class="line">    free(name);</div><div class="line">}</div></div><!-- fragment --><p>This only frees <code>name</code> if the <code>soap</code> context pointer member is NULL, meaning that a managed string <code>name</code> will be deleted as usual with the deserialized class using <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code> and <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code>.</p>
<p>The other methods are also made cognizant of the presence of a context:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> Class::setName(<span class="keyword">const</span> <span class="keywordtype">char</span> *s)</div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (soap)</div><div class="line">    name = <a class="code" href="group__group__context.html#ga41747ef145667bdff9c66cdd2bc86653">soap_strdup</a>(soap, s);</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">    name = strdup(s);</div><div class="line">}</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *getName()</div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> name;</div><div class="line">}</div></div><!-- fragment --><p>Another approach is to use <code><a class="el" href="group__group__context.html#ga643bb3cdc192ec0dc1a8448498dab401" title="Unlink a block of heap memory managed by the specified soap context, to release the memory explicitly...">soap_unlink</a></code> to unlink data managed by the context and make all allocations explicitly:</p>
<div class="fragment"><div class="line">Class::~Class() </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (name)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__context.html#ga643bb3cdc192ec0dc1a8448498dab401">soap_unlink</a>(soap, name); <span class="comment">// unlinks the name if soap is non-NULL</span></div><div class="line">    free(name);</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="keywordtype">void</span> Class::setName(<span class="keyword">const</span> <span class="keywordtype">char</span> *s)</div><div class="line">{</div><div class="line">  name = strdup(s);</div><div class="line">}</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *getName()</div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> name;</div><div class="line">}</div></div><!-- fragment --><p>The <code><a class="el" href="group__group__context.html#ga643bb3cdc192ec0dc1a8448498dab401" title="Unlink a block of heap memory managed by the specified soap context, to release the memory explicitly...">soap_unlink</a></code> call unlinks data and objects from managed memory. In this way <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code> and <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> can be called later even when this class was deserialized.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="debugging"></a>
Debugging</h1>
<p>To activate debugging and message logging compile the source code with compile-time flag <code><a class="el" href="group__group__debug.html#gad72dbcf6d0153db1b8d8a58001feed83" title="User-definable macro to enable debugging and logging. ">DEBUG</a></code>. Or when using <b><code>-lgsoap</code></b> or <b><code>-lgsoap++</code></b> then reinstall gSOAP with <b><code>./configure --enable-debug</code></b> and <b><code>make</code></b>.</p>
<p>When your gSOAP client or server applications run, they will log their activity in three separate files:</p>
<ul>
<li><em><code>SENT.log</code></em> a concatenation of all messages sent</li>
<li><em><code>RECV.log</code></em> a concatenation of all messages received</li>
<li><em><code>TEST.log</code></em> a log of the engine's operations</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>The gSOAP client and server applications will run slow due to debugging and message logging.</dd></dl>
<p>You can set macro <code><a class="el" href="group__group__debug.html#ga245426f6e253f0d00529a2b72447b956" title="User-definable macro to enable debugging and logging with time stamps. ">DEBUG_STAMP</a></code> instead of <code><a class="el" href="group__group__debug.html#gad72dbcf6d0153db1b8d8a58001feed83" title="User-definable macro to enable debugging and logging. ">DEBUG</a></code> to add time stamps to <code>TEST.log</code>. This works on all operating systems supporting the <code>gettimeofday</code> function.</p>
<p>When installing a CGI service application compiled with debugging enabled, the log files may sometimes not be created due to file access permission restrictions imposed on CGI applications. To get around this, create empty log files with universal write permissions. Be careful about the security implication of this.</p>
<p>You can actually test a CGI service application without deploying it on the Web. To do this, create the CGI service application and send it a request message using redirection as follows: </p><pre class="fragment">./service.cgi &lt; ns.add.req.xml
</pre><p>this should display the service response on the terminal, where <em><code>ns.add.req.xml</code></em> was generated by soapcpp2 or a modified version of this file. You can also use a <em><code>SENT.log</code></em> file produced by a client application to redirect to the CGI service application. You can also use the gSOAP <a href="../../testmsgr/html/index.html">Test Messenger</a> application to generate randomized messages to test your servers.</p>
<p>The file names of the log files and the logging activity can be controlled at the application level. This allows the creation of separate log files by separate services, clients, and threads. For example, the following service logs all messages (but no debug messages) in separate directories:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line"><a class="code" href="group__group__debug.html#ga3cc1cddba7dcbc38cdb1bc66c4e08fec">soap_set_recv_logfile</a>(soap, <span class="stringliteral">&quot;logs/recv/service12.log&quot;</span>); <span class="comment">// append all messages received in /logs/recv/service12.log </span></div><div class="line"><a class="code" href="group__group__debug.html#ga95729c28f712cf4bca312595b5ce2687">soap_set_sent_logfile</a>(soap, <span class="stringliteral">&quot;logs/sent/service12.log&quot;</span>); <span class="comment">// append all messages sent in /logs/sent/service12.log </span></div><div class="line"><a class="code" href="group__group__debug.html#ga409ebe1fb5f1044a20ad12b382068148">soap_set_test_logfile</a>(soap, NULL);                      <span class="comment">// no file name: do not save debug messages </span></div><div class="line">... <span class="comment">//</span></div><div class="line"><a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(soap); </div><div class="line">... <span class="comment">//</span></div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div></div><!-- fragment --><p>Likewise, messages can be logged for individual client-side service operation calls in a client application.</p>
<p>To log messages more efficiently, use the <code><a class="el" href="group__group__debug.html#gac637945d0869d91a4b00dc1ddaced537" title="The logging plugin registration function. ">logging</a></code> plugin.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="limitations"></a>
Limitations</h1>
<p>From the perspective of the C/C++ language, a few C/C++ language features are not supported by gSOAP and these features cannot be used in an interface header file for soapcpp2.</p>
<ul>
<li>STL: the soapcpp2 tool supports the serialization of C++ strings <code>std::string</code> and <code>std::wstring</code> and the containers <code>std::deque</code>, <code>std::list</code>, <code>std::vector</code>, and <code>std::set</code>, (see Section <a class="el" href="index.html#templates">STL containers</a> ). Also <code>std::shared_ptr</code>, <code>std::unique_ptr</code>, and <code>std::auto_ptr</code> are supported. Other STL types are not serializable.</li>
<li>Templates: the soapcpp2 tool assumes that templates classes have only one template parameter type and these templates are containers of values of this template parameter type. This template class should define <code>begin()</code>, <code>end()</code>, <code>size()</code>, <code>clear()</code>, and <code>insert()</code> methods.</li>
<li>Inheritance: single class inheritance is supported.</li>
<li>Abstract methods: a class must be instantiable to support serialization of that class. An abstract class when used should be declared transient, see Section <a class="el" href="index.html#transient">Transient data types</a>.</li>
<li>Directives: directives and pragmas such as <code>#include</code> and <code>#define</code> are moved to the generated <em><code>soapStub.h</code></em> source code by soapcpp2. These directives are all placed at the top of that file, see <a class="el" href="index.html#pragmas">The #include and #define directives</a>. Use the <code>#import</code> directive to import interface header files into other interface header files, see Section <a class="el" href="index.html#import">The #import directive</a> .</li>
<li>C and C++ code statements: no code statements are allows in interface header files. Class methods should be declared without code in <code>{</code> and <code>}</code>. Also constructor initializers are not allowed. Class method implementations should be defined in a separate C++ source file.</li>
<li>C++ references: these cannot be serialized, use pointers instead.</li>
</ul>
<p>The following C/C++ data types require some attention to ensure they can be serialized:</p>
<ul>
<li>Union types: a union data type can not be serialized unless run-time information is associated with a union for the serializer to determine which union member is valid. To serialize a union, place the union in a struct or class as a member and precede this member with an integer member that serves as a selector. See Section <a class="el" href="index.html#union">Union serialization</a> for details.</li>
<li><code>void*</code> types: the <code>void*</code> data type cannot be serialized unless run-time type information is associated with the pointer using a <code>int __type</code> member in the struct or class that contains the <code>void*</code> member. See Section <a class="el" href="index.html#void">Void pointer serialization</a> for details.</li>
<li>Pointers to arrays: any pointer, except for C strings which are pointers to an array of characters, are treated by the soapcpp2 tool as if the pointer points to only one value. Consequently, the serialization functions for pointers only serialize the first value pointed to, when the pointer is non-NULL. To declare pointers to arrays as struct and class members, a size member is included in the struct or class, see Section <a class="el" href="index.html#dynarray">Dynamic array serialization</a> for details.</li>
<li>Constant values: <code>const</code> constant values such as <code>const</code> members of a struct or class cannot be serialized except for <code>const char*</code> and <code>const wchar_t*</code> strings.</li>
<li>Uninitialized pointers: Obviously, all pointers that are part of a data structure to serialize must be valid or NULL. Otherwise the serializer will crash.</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h1><a class="anchor" id="advanced"></a>
Advanced features</h1>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="internationalization"></a>
Internationalization</h2>
<p>Regular 8-bit strings cannot hold wide characters outside of the character range [1,255]. Of course you can use wide strings instead of 8-bit strings in the interface header file for soapcpp2. Alternatively, set the <code><a class="el" href="group__group__flags.html#ga9006d22d0abc39831dfe3ce1e491ce6f" title="soap_mode C-related input/output flag value to serialize and deserialize 8-bit C/C++ strings containi...">SOAP_C_UTFSTRING</a></code> mode flag to encode wide characters in 8-bit strings in UTF-8 format.</p>
<p>For example, the <em><code>xsd:string</code></em> string schema type can be declared as a wide-character string and used subsequently:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">wchar_t</span> *xsd__string; </div><div class="line"><span class="keywordtype">int</span> ns__myMethod(xsd__string input, xsd__string *output);</div></div><!-- fragment --><p>To do so automatically with wsdl2h, edit <em><code>typemap.dat</code></em> and add the line: </p><pre class="fragment">xsd__string = | wchar_t* | wchar_t*
</pre><p>or for C++: </p><pre class="fragment">xsd__string = | std::wstring | std::wstring*
</pre><p>Alternatively, 8-bit strings can hold UTF-8 formatted wide characters when the <code><a class="el" href="group__group__flags.html#ga9006d22d0abc39831dfe3ce1e491ce6f" title="soap_mode C-related input/output flag value to serialize and deserialize 8-bit C/C++ strings containi...">SOAP_C_UTFSTRING</a></code> flag is enabled, see Section <a class="el" href="index.html#flags">Run-time flags</a> . The application is responsible for filling regular strings with UTF-8 content.</p>
<p>Also the <code><a class="el" href="group__group__flags.html#gabe62a741fb99a476524000aaacd4b354" title="soap_mode C-related input/output flag value to serialize and deserialize 8-bit multibyte C/C++ string...">SOAP_C_MBSTRING</a></code> flag can be used to activate multibyte character support. Multibyte support depends on the locale settings for dealing with extended natural language encodings.</p>
<p>Both 8-bit strings and wide-character strings can be used together within an application. For example, the following header file declaration introduces two string schema types:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">wchar_t</span> *xsd__string; </div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *xsd__string_; <span class="comment">// trailing &#39;_&#39; avoids name clash </span></div><div class="line"><span class="keywordtype">int</span> ns__myMethod(xsd__string input, xsd__string_ *output);</div></div><!-- fragment --><p>Please consult the UTF-8 specification for details on the UTF-8 format when processing 8-bit strings with UTF-8 content. Note that the ASCII character set [1-127] is a subset of UTF-8. Therefore, with the <code><a class="el" href="group__group__flags.html#ga9006d22d0abc39831dfe3ce1e491ce6f" title="soap_mode C-related input/output flag value to serialize and deserialize 8-bit C/C++ strings containi...">SOAP_C_UTFSTRING</a></code> flag set, strings may hold ASCII character data and UTF-8 extensions.</p>
<p>See also <a href="../../databinding/html/index.html">C and C++ XML data bindings</a> documentation for more details on using <em><code>typemap.dat</code></em> for wsdl2h.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="directives"></a>
Directives</h2>
<p>An interface header file for soapcpp2 may include <code>//gsoap</code> directives to configure messaging protocols such as SOAP or REST, to associate SOAP Headers and Faults with messages, and to set properties of the Web service defined in the soapcpp2-generated WSDL and XSD files. Directives for soapcpp2 are specified as <code>//gsoap</code>-comments that are processed by soapcpp2.</p>
<h3><a class="anchor" id="directives-1"></a>
Service directives</h3>
<p>A service directive must start at a new line and is of the form:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap &lt;prefix&gt; service &lt;property&gt;: &lt;value&gt;</span></div></div><!-- fragment --><p>where <code>&lt;prefix&gt;</code> is the XML namespace prefix of a service binding. The <code>&lt;property&gt;</code> and <code>&lt;value&gt;</code> fields are one of the following:</p>
<table class="doxtable">
<tr>
<th>property </th><th>value  </th></tr>
<tr>
<td><code>name</code> </td><td>name of the service, optionally followed by text describing the service </td></tr>
<tr>
<td><code>namespace</code> </td><td>URI of the WSDL targetNamespace </td></tr>
<tr>
<td><code>documentation</code> </td><td>text describing the service (see also the <code>name</code> property), multiple permitted </td></tr>
<tr>
<td><code>doc</code> </td><td>an alias for the <code>documentation</code> property </td></tr>
<tr>
<td><code>style</code> </td><td><code>document</code> (default) SOAP messaging style or <code>rpc</code> for SOAP RPC </td></tr>
<tr>
<td><code>encoding</code> </td><td><code>literal</code> (default), <code>encoded</code> for SOAP encoding, or a custom URI </td></tr>
<tr>
<td><code>protocol</code> </td><td>specifies SOAP or REST, see below </td></tr>
<tr>
<td><code>port</code> </td><td>URL of the service endpoint, usually an http or https address, to use in the WSDL definitions/service/port/address/@location </td></tr>
<tr>
<td><code>location</code> </td><td>an alias for the <code>port</code> property </td></tr>
<tr>
<td><code>endpoint</code> </td><td>an alias for the <code>port</code> property </td></tr>
<tr>
<td><code>transport</code> </td><td>URI declaration of the transport, usually <code><a href="http://schemas.xmlsoap.org/soap/http">http://schemas.xmlsoap.org/soap/http</a></code> </td></tr>
<tr>
<td><code>definitions</code> </td><td>name of the WSDL definitions/@name </td></tr>
<tr>
<td><code>type</code> </td><td>name of the WSDL definitions/portType/@name (WSDL2.0 interface/@name) </td></tr>
<tr>
<td><code>portType</code> </td><td>an alias for the <code>type</code> property (<code>portType</code> follows SOAP 1.1 naming conventions) </td></tr>
<tr>
<td><code>interface</code> </td><td>an alias for the <code>type</code> property (<code>interface</code> follows SOAP 1.2 naming conventions) </td></tr>
<tr>
<td><code>binding</code> </td><td>name of the WSDL definitions/binding/@name </td></tr>
<tr>
<td><code>portName</code> </td><td>name of the WSDL definitions/service/port/@name </td></tr>
<tr>
<td><code>executable</code> </td><td>name of the "executable" to use in the WSDL definitions/service/port/address/@location </td></tr>
</table>
<p>The service <code>name</code> and <code>namespace</code> properties are required in order to generate a valid WSDL with soapcpp2. The other properties are optional.</p>
<p>The <code>style</code> and <code>encoding</code> property defaults are changed with <b><code>soapcpp2 -e</code></b> option <b><code>-e</code></b> to <code>rpc</code> and <code>encoded</code>.</p>
<p>You can override the <code>port</code> endpoint URL at runtime in the auto-generated <code>soap_call_prefix__func</code> service call (C/C++ client side) and in the C++ proxy class service call.</p>
<p>Protocol property values are:</p>
<table class="doxtable">
<tr>
<th>protocol value </th><th>description  </th></tr>
<tr>
<td><code>SOAP</code> </td><td>SOAP transport, supporting both SOAP 1.1 and 1.2 </td></tr>
<tr>
<td><code>SOAP1.1</code> </td><td>SOAP 1.1 transport (same as <code>soapcpp2 -1</code>) </td></tr>
<tr>
<td><code>SOAP1.2</code> </td><td>SOAP 1.2 transport (same as <code>soapcpp2 -2</code>) </td></tr>
<tr>
<td><code>SOAP-GET</code> </td><td>one-way SOAP 1.1 or 1.2 with HTTP GET </td></tr>
<tr>
<td><code>SOAP1.1-GET</code> </td><td>one-way SOAP 1.1 with HTTP GET </td></tr>
<tr>
<td><code>SOAP1.2-GET</code> </td><td>one-way SOAP 1.2 with HTTP GET </td></tr>
<tr>
<td><code>HTTP</code> </td><td>an alias for <code>POST</code> (same as <code>soapcpp2 -0</code>) </td></tr>
<tr>
<td><code>POST</code> </td><td>non-SOAP REST protocol with HTTP POST </td></tr>
<tr>
<td><code>GET</code> </td><td>non-SOAP REST protocol with HTTP GET </td></tr>
<tr>
<td><code>PUT</code> </td><td>non-SOAP REST protocol with HTTP PUT </td></tr>
<tr>
<td><code>DELETE</code> </td><td>non-SOAP REST protocol with HTTP DELETE </td></tr>
</table>
<p>The <code>protocol</code> property is <code>SOAP</code> by default. The default is changed with <b><code>soapcpp2 -1</code></b> option <b><code>-1</code></b> to SOAP 1.1, <b><code>soapcpp2 -2</code></b> option <b><code>-2</code></b> to SOAP 1.2, and non-SOAP REST with <b><code>soapcpp2 -0</code></b> option <b><code>-0</code></b></p>
<p>The <code>GET</code> protocols for SOAP and REST require that the service operations only use primitive types with their input parameters, because these parameters are encoded with the URL as URL query values.</p>
<p>To let directives take effect with service operations, you should bind the service operations to the WSDL namespace of a service by using the namespace prefix as part of the identifier name of the function that defines the service operation:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> prefix__func(arg1, arg2, ..., argn, result);</div></div><!-- fragment --><p>where <code>prefix</code> can now be used to let directives take effect on this service operation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="directives-2"></a>
Service method directives</h3>
<p>Service properties are applicable to a service and to all of its operations. Service method directives are specifically applicable to a service operation.</p>
<p>A service method directive is of the form:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap &lt;prefix&gt; service method-&lt;property&gt;: &lt;method&gt; &lt;value&gt;</span></div></div><!-- fragment --><p>where <code>&lt;prefix&gt;</code> is the XML namespace prefix of a service binding and <code>&lt;method&gt;</code> is the unqualified name of a service operation. The <code>&lt;property&gt;</code> and <code>&lt;value&gt;</code> fields are one of the following:</p>
<table class="doxtable">
<tr>
<th>method property </th><th>value  </th></tr>
<tr>
<td><code>method-documentation</code> </td><td>text describing the service operation </td></tr>
<tr>
<td><code>method</code> </td><td>same as above, shorthand form </td></tr>
<tr>
<td><code>method-action</code> </td><td><code>""</code> or URI SOAPAction HTTP header, or URL query string for REST protocols </td></tr>
<tr>
<td><code>method-input-action</code> </td><td><code>""</code> or URI SOAPAction HTTP header of service request messages </td></tr>
<tr>
<td><code>method-output-action</code> </td><td><code>""</code> or URI SOAPAction HTTP header of service response messages </td></tr>
<tr>
<td><code>method-fault-action</code> </td><td><code>""</code> or URI SOAPAction HTTP header of service fault messages </td></tr>
<tr>
<td><code>method-header-part</code> </td><td>member name of the <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> struct used in SOAP Header </td></tr>
<tr>
<td><code>method-input-header-part</code> </td><td>member name of the <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> struct used in SOAP Headers of requests </td></tr>
<tr>
<td><code>method-output-header-part</code> </td><td>member name of the <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> struct used in SOAP Headers of responses </td></tr>
<tr>
<td><code>method-fault</code> </td><td>type name of a struct or class member used in <code>SOAP_ENV__Details</code> struct </td></tr>
<tr>
<td><code>method-mime-type</code> </td><td>REST content type or SOAP MIME attachment content type(s) </td></tr>
<tr>
<td><code>method-input-mime-type</code> </td><td>REST content type or SOAP MIME attachment content type(s) of request message </td></tr>
<tr>
<td><code>method-output-mime-type</code> </td><td>REST content type or SOAP MIME attachment content type(s) of response message </td></tr>
<tr>
<td><code>method-style</code> </td><td><code>document</code> or <code>rpc</code> </td></tr>
<tr>
<td><code>method-encoding</code> </td><td><code>literal</code>, <code>encoded</code>, or a custom URI for encodingStyle of messages </td></tr>
<tr>
<td><code>method-response-encoding</code> </td><td><code>literal</code>, <code>encoded</code>, or a custom URI for encodingStyle of response messages </td></tr>
<tr>
<td><code>method-protocol</code> </td><td>SOAP or REST, see <a class="el" href="index.html#directives-1">Service directives</a> </td></tr>
</table>
<p>The <code>method-header-part</code> properties can be repeated for a service operation to declare multiple SOAP Header parts that the service operation requires. You can use <code>method-input-header-part</code> and <code>method-output-header-part</code> to differentiate between request and response messages.</p>
<p>The <code>method-fault</code> property can be repeated for a service operation to declare multiple faults that the service operation may return.</p>
<p>The <code>method-action</code> property serves two purposes:</p>
<ol type="1">
<li>To set the SOAPAction header for SOAP protocols, i.e. sets the definitions/binding/operation/SOAP:operation/@soapAction.</li>
<li>To set the URL query string for endpoints with REST protocols, i.e. sets the definitions/binding/operation/HTTP:operation/@location, which specifies a URL query string (starts with a <code>?</code>) to complete the service endpoint URL or extends the endpoint URL with a local path (starts with a <code>/</code>).</li>
</ol>
<p>Use <code>method-input-action</code> and <code>method-output-action</code> to differentiate the SOAPAction between SOAP request and response messages.</p>
<p>You can always override the port endpoint URL and action values at runtime in the auto-generated <code>soap_call_prefix__func</code> service call (C/C++ client side) and in the auto-generated C++ proxy class service calls. A runtime NULL endpoint URL and/or action uses the defaults set by these directives.</p>
<p>The <code>method-mime-type</code> property serves two purposes:</p>
<ol type="1">
<li>To set the type of MIME/MTOM attachments used with SOAP protocols. Multiple attachment types can be declared for a SOAP service operation, i.e. adds definitions/binding/operation/input/MIME:multipartRelated/MIME:part/MIME:content/@type for each type specified.</li>
<li>To set the MIME type of a REST operation. This replaces XML declared in WSDL by definitions/binding/operation/(input|output)/MIME:mimeXml with MIME:content/@type. Use <code>application/x-www-form-urlencoded</code> with REST POST and PUT protocols to send encoded form data automatically instead of XML. Only primitive type values can be transmitted with form data, such as numbers and strings, i.e. only types that are legal to use as attributes members.</li>
</ol>
<p>Use <code>method-input-mime-type</code> and <code>method-output-mime-type</code> to differentiate the attachment types between request and response messages.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="directives-3"></a>
Schema directives</h3>
<p>A schema directive is of the form:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap &lt;prefix&gt; schema &lt;property&gt;: &lt;value&gt;</span></div></div><!-- fragment --><p>where <code>&lt;prefix&gt;</code> is the XML namespace prefix of a schema. The <code>&lt;property&gt;</code> and <code>&lt;value&gt;</code> fields are one of the following:</p>
<table class="doxtable">
<tr>
<th>property </th><th>value  </th></tr>
<tr>
<td><code>namespace</code> </td><td>URI of the XSD targetNamespace </td></tr>
<tr>
<td><code>namespace2</code> </td><td>alternate URI pattern for the XSD namespace (i.e. URI is also accepted by the XML parser) </td></tr>
<tr>
<td><code>import</code> </td><td>URI of an imported namespace, as an alternative or in addition to <code>namespace</code>, adds <code>xsd:import</code> to the generated WSDL and XSD files </td></tr>
<tr>
<td><code>form</code> </td><td><code>unqualified</code> (default) or <code>qualified</code> local element and attribute form defaults </td></tr>
<tr>
<td><code>elementForm</code> </td><td><code>unqualified</code> (default) or <code>qualified</code> local element form default </td></tr>
<tr>
<td><code>attributeForm</code> </td><td><code>unqualified</code> (default) or <code>qualified</code> local attribute form default </td></tr>
<tr>
<td><code>typed</code> </td><td><code>no</code> (default) or <code>yes</code> for serializers to add <code>xsi:type</code> attributes to XML </td></tr>
</table>
<p>The <code>namespace2</code> URI is a pattern with <code>*</code> matching any sequence of characters and <code>-</code> matching any character. This pattern instructs the XML parser and validator to also accept the URI pattern as a valid namespace for the specified <code>&lt;prefix&gt;</code>.</p>
<p>The <code>typed</code> property is <code>no</code> by default and can be changed to <code>yes</code> with <b><code>soapcpp2 -t</code></b> option <b><code>-t</code></b>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="directives-4"></a>
Schema type directives</h3>
<p>A schema type directive is of the form:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap &lt;prefix&gt; schema type-&lt;property&gt;: &lt;name&gt; &lt;value&gt;</span></div><div class="line"><span class="comment">//gsoap &lt;prefix&gt; schema type-&lt;property&gt;: &lt;name&gt;::&lt;member&gt; &lt;value&gt;</span></div></div><!-- fragment --><p>where <code>&lt;prefix&gt;</code> is the XML namespace prefix of a schema and <code>&lt;name&gt;</code> is an unqualified name of a C/C++ type, and the optional <code>&lt;member&gt;</code> is a class/struct members or enum constant.</p>
<p>You can describe a type with one of the following:</p>
<table class="doxtable">
<tr>
<th>type property </th><th>value  </th></tr>
<tr>
<td><code>type-documentation</code> </td><td>text describing the schema type </td></tr>
<tr>
<td><code>type</code> </td><td>an alias for the <code>type-documentation</code> property </td></tr>
</table>
<p>For example, you can add a description to an enumeration:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns schema type: Vowels The letters A, E, I, O, U, and sometimes Y</span></div><div class="line"><span class="comment">//gsoap ns schema type: Vowels::Y A vowel, sometimes</span></div><div class="line"><span class="keyword">enum class</span> ns__Vowels : char { A = <span class="charliteral">&#39;A&#39;</span>, E = <span class="charliteral">&#39;E&#39;</span>, I = <span class="charliteral">&#39;I&#39;</span>, O = <span class="charliteral">&#39;O&#39;</span>, U = <span class="charliteral">&#39;U&#39;</span>, Y = <span class="charliteral">&#39;Y&#39;</span> };</div></div><!-- fragment --><p>This documented enumeration maps to a simpleType restriction of <em><code>xsd:string</code></em> in the soapcpp2-generated schema:</p>
<div class="alt"> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">simpleType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Vowels&quot;</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;<span class="keywordtype">annotation</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;<span class="keywordtype">documentation</span>&gt;<span class="keyword">The</span> <span class="keyword">letters</span> <span class="keyword">A</span>, <span class="keyword">E</span>, <span class="keyword">I</span>, <span class="keyword">O</span>, <span class="keyword">U</span>, <span class="keyword">and</span> <span class="keyword">sometimes</span> <span class="keyword">Y</span>&lt;/<span class="keywordtype">documentation</span>&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;/<span class="keywordtype">annotation</span>&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;<span class="keywordtype">restriction</span> <span class="keyword">base</span>=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;A&quot;</span>/&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;E&quot;</span>/&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;I&quot;</span>/&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;O&quot;</span>/&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;U&quot;</span>/&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &lt;<span class="keywordtype">enumeration</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;Y&quot;</span>&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;      &lt;<span class="keywordtype">annotation</span>&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        &lt;<span class="keywordtype">documentation</span>&gt;<span class="keyword">A</span> <span class="keyword">vowel</span>, <span class="keyword">sometimes</span>&lt;/<span class="keywordtype">documentation</span>&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      &lt;/<span class="keywordtype">annotation</span>&gt;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    &lt;<span class="keywordtype">enumeration</span>/&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  &lt;/<span class="keywordtype">restriction</span>&gt;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;&lt;/<span class="keywordtype">simpleType</span>&gt;</div></div><!-- fragment --> </div><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example12"></a>
Example</h3>
<p>The use of directives is best illustrated with an example. The example uses a hypothetical stock quote service and exchange rate service, actual services such as these are available for free on the web.</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns1 service namespace:  urn:GetQuote </span></div><div class="line"><span class="keywordtype">int</span> ns1__getQuote(<span class="keywordtype">char</span> *symbol, <span class="keywordtype">float</span> &amp;result); </div><div class="line"></div><div class="line"><span class="comment">//gsoap ns2 service namespace:  urn:CurrencyExchange </span></div><div class="line"><span class="keywordtype">int</span> ns2__getRate(<span class="keywordtype">char</span> *country1, <span class="keywordtype">char</span> *country2, <span class="keywordtype">float</span> &amp;result); </div><div class="line"></div><div class="line"><span class="comment">//gsoap ns3 service name:       quotex </span></div><div class="line"><span class="comment">//gsoap ns3 service style:      rpc </span></div><div class="line"><span class="comment">//gsoap ns3 service encoding:   encoded </span></div><div class="line"><span class="comment">//gsoap ns3 service port:       http://www.mydomain.com/quotex.cgi </span></div><div class="line"><span class="comment">//gsoap ns3 service namespace:  urn:quotex </span></div><div class="line"><span class="keywordtype">int</span> ns3__getQuote(<span class="keywordtype">char</span> *symbol, <span class="keywordtype">char</span> *country, <span class="keywordtype">float</span> &amp;result);</div></div><!-- fragment --><p>The <em><code>quotex.h</code></em> example is a new Web Service created by combining two existing Web Services: a Stock Quote service and a Currency Exchange service.</p>
<p>The namespace prefix <code>ns3</code> is used for the new <code>quotex</code> Web Service with namespace URI <em><code>urn:quotex</code></em>, service name <code>quotex</code>, and endpoint port <em><code><a href="http://www.mydomain.com/quotex.cgi">http://www.mydomain.com/quotex.cgi</a></code></em>.</p>
<p>Since the new Web Service invokes the <code>ns1__getQuote</code> and <code>ns2__getRate</code> service operations, the service namespaces and other details such as style and encoding of these methods are given by directives. After invoking the soapcpp2 tool on the <em><code>quotex.h</code></em> header file: </p><pre class="fragment"> soapcpp2 quotex.h
</pre><p>the WSDL of the new <code>quotex</code> Web Service is saved as <em><code>quotex.wsdl</code></em>. Since the service name, endpoint port, and namespace URI were provided in the header file, the generated WSDL file can be published together with the compiled Web Service installed as a CGI application.</p>
<p>The namespace mapping table for the <em><code>quotex.cpp</code></em> Web Service implementation is saved as <em><code>quotex.nsmap</code></em>. This file can be directly included in <em><code>quotex.cpp</code></em> instead of specified by hand in the source of <em><code>quotex.cpp</code></em>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="transient"></a>
Transient data types</h2>
<p>There are situations when certain types have to be used in an interface header file, but the types are not serializable and therefore have to be "invisible" to the soapcpp2 tool. These types are called transient.</p>
<p>This feature is useful when a library type is used in the interface header file as part of a struct or class, for example the <code>FILE</code> type or <code>std::ostream</code> that are clearly not serializable. If these types are introduced in an interface header file then these types must be declared transient. Otherwise, soapcpp2 will throw an error.</p>
<p>To declare a transient type use <code>extern</code>. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="keyword">class </span>FILE;</div></div><!-- fragment --><p>Even though <code>FILE</code> is not a class, this declaration merely introduces the <code>FILE</code> type name without specifying its details.</p>
<p>In C we can still use the class keyword, because no code is generated by soapcpp2 for this transient type.</p>
<p>We can then use this type elsewhere, for example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ns__record</div><div class="line">{</div><div class="line">    FILE *fd;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *name;</div><div class="line">};</div></div><!-- fragment --><p>Only the <code>name</code> member is serialized of <code>ns__record</code>.</p>
<p>Another example:</p>
<div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="keyword">class </span>std::ostream; <span class="comment">// std::ostream can&#39;t be serialized, but need to be declared</span></div><div class="line"><span class="keyword">class </span>ns__myClass </div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> print(std::ostream &amp;s) <span class="keyword">const</span>; <span class="comment">// need ostream here </span></div><div class="line">    ... <span class="comment">//</span></div><div class="line">};</div></div><!-- fragment --><p>In other cases we do want to declare a type that soapcpp2 should copy into <em><code>soapStub.h</code></em> for the application source code, but which should not be serializable. We can use <code>extern</code> for this or put the declaration in <code>[</code> and <code>]</code> brackets:</p>
<div class="fragment"><div class="line">[ </div><div class="line">  <span class="keyword">class </span>ns__myBase <span class="comment">// base class need not be serializable</span></div><div class="line">  {</div><div class="line">    ... <span class="comment">// members</span></div><div class="line">  }; </div><div class="line">] </div><div class="line"><span class="keyword">class </span>ns__myDerived : ns__myBase </div><div class="line">{</div><div class="line">  ... <span class="comment">// members</span></div><div class="line">}; </div></div><!-- fragment --><p>We can use <code>[</code> and <code>]</code> brackets for parts of the code, for example to make several class members transient:</p>
<div class="fragment"><div class="line">[ <span class="keyword">typedef</span> <span class="keywordtype">int</span> transientInt; ] </div><div class="line"><span class="keyword">class </span>ns__myClass </div><div class="line">{</div><div class="line">  <span class="keywordtype">int</span> a; <span class="comment">// will be serialized </span></div><div class="line">  [ </div><div class="line">  <span class="keywordtype">int</span> b; <span class="comment">// transient member </span></div><div class="line">  <span class="keywordtype">char</span> s[256]; <span class="comment">// transient member </span></div><div class="line">  ]  </div><div class="line">  <span class="keyword">extern</span> <span class="keywordtype">float</span> d; <span class="comment">// transient type float and member</span></div><div class="line">  <span class="keywordtype">char</span> *t; <span class="comment">// will be serialized </span></div><div class="line">  transientInt *n; <span class="comment">// transient type int and member </span></div><div class="line">  [ </div><div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> method(<span class="keywordtype">char</span> buf[1024]); <span class="comment">// does not create a char[1024] serializer </span></div><div class="line">  ]  </div><div class="line">};</div></div><!-- fragment --><p>In this example, <code>ns__myClass</code> has three transient members: <code>b</code>, <code>s</code>, and <code>n</code> which will not be serialized. Member <code>n</code> is transient because the type is declared within a transient block. Pointers, references, and arrays of transient types are transient. The single class method is encapsulated within <code>[</code> and <code>]</code> to prevent soapcpp2 from creating serializers for the <code>char[1024]</code> type.</p>
<p>We also use <code>[</code> and <code>]</code> brackets to introduce a transient integer type <code>transientInt</code> using a typedef. We cannot use <code>extern</code> with <code>typedef</code> because this construct is reserved for custom serializers.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="volatile"></a>
Serialization "as is" of volatile data types</h2>
<p>Types declared <code>volatile</code> in an interface header file are serializable but not copied by soapcpp2 to <em><code>soapStub.h</code></em>. These types are typically library types that are included in the source code and should not be redefined in the application source code. We want to serialize these library types "as is" without redefining them.</p>
<p>Consider for example <code>struct tm</code>, declared in <em><code>time.h</code></em>. The structure may actually vary between platforms, but the <code>tm</code> structure includes at least the following members as declared in the following interface header file for soapcpp2:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"><span class="keyword">volatile</span> <span class="keyword">struct </span>tm </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> tm_sec;         <span class="comment">/* seconds (0 - 60) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_min;         <span class="comment">/* minutes (0 - 59) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_hour;        <span class="comment">/* hours (0 - 23) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_mday;        <span class="comment">/* day of month (1 - 31) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_mon;         <span class="comment">/* month of year (0 - 11) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_year;        <span class="comment">/* year - 1900 */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_wday;        <span class="comment">/* day of week (Sunday = 0) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_yday;        <span class="comment">/* day of year (0 - 365) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_isdst;       <span class="comment">/* is summer time in effect? */</span> </div><div class="line">    <span class="keywordtype">char</span> *tm_zone;        <span class="comment">/* abbreviation of timezone name */</span> </div><div class="line">    <span class="keywordtype">long</span> tm_gmtoff;      <span class="comment">/* offset from UTC in seconds */</span> </div><div class="line">};</div></div><!-- fragment --><p>By declaring struct <code>tm</code> volatile, soapcpp2 does not redefine it in the output source code. The <code>#include &lt;time.h&gt;</code> is copied to the source code output. We can now serialize the <code>tm</code> structure. The following example serializes the local time stored in a <code>tm</code> structure to stdout:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">time_t T = time(NULL); </div><div class="line"><span class="keyword">struct </span>tm *t = localtime(&amp;T); </div><div class="line">soap_write_tm(soap, t); </div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div></div><!-- fragment --><p>It is also possible to serialize the <code>tm</code> members as XML attributes by declaring the members as attributes with the <code>@</code> qualifier, see Section <a class="el" href="index.html#attributes">How to declare XML attributes</a> .</p>
<p>If you want to produce a schema file, say <em><code>time.xsd</code></em>, that defines an XML schema and namespace for the <code>tm</code> struct, you can add a <code>typedef</code> declaration to the header file:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"><span class="keyword">volatile</span> <span class="keyword">struct </span>tm</div><div class="line">{</div><div class="line">    ... <span class="comment">// see above</span></div><div class="line">};</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>tm time__struct_tm;</div></div><!-- fragment --><p>or simply use colon notation since we keep the <code>tm</code> name:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"><span class="keyword">volatile</span> <span class="keyword">struct </span>time:tm </div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> tm_sec;         <span class="comment">/* seconds (0 - 60) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_min;         <span class="comment">/* minutes (0 - 59) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_hour;        <span class="comment">/* hours (0 - 23) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_mday;        <span class="comment">/* day of month (1 - 31) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_mon;         <span class="comment">/* month of year (0 - 11) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_year;        <span class="comment">/* year - 1900 */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_wday;        <span class="comment">/* day of week (Sunday = 0) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_yday;        <span class="comment">/* day of year (0 - 365) */</span> </div><div class="line">    <span class="keywordtype">int</span> tm_isdst;       <span class="comment">/* is summer time in effect? */</span> </div><div class="line">    <span class="keywordtype">char</span> *tm_zone;      <span class="comment">/* abbreviation of timezone name */</span> </div><div class="line">    <span class="keywordtype">long</span> tm_gmtoff;     <span class="comment">/* offset from UTC in seconds */</span> </div><div class="line">};</div></div><!-- fragment --><p>We used the typedef name <code>time__struct_tm</code> rather than <code>time__tm</code>, because a schema name clash will occur for the first example above that has <code>tm</code> already declared as serializable type in the schema of the generated WSDL. The second example with the colon notation avoids this altogether.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="extern"></a>
How to declare custom serializers and deserializers</h2>
<p>You can implement your own custom serializers for data types. A custom serializer is declared in an interface header file for soapcpp2 using the pair of keywords <code>extern typedef</code>. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="keyword">typedef</span> <span class="keywordtype">char</span> *MyData; </div><div class="line"><span class="keyword">struct </span>Sample </div><div class="line">{</div><div class="line">    MyData s; <span class="comment">// use custom serializer for this member </span></div><div class="line">    <span class="keywordtype">char</span> *t;  <span class="comment">// use auto-generated serializer</span></div><div class="line">};</div></div><!-- fragment --><p>Then provide the following functions for each <code>extern typedef</code> declares type <code>T</code>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> soap_serialize_T(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> T *a);</div><div class="line"><span class="keywordtype">void</span> soap_default_T(<span class="keyword">struct</span> soap *soap, T *a);</div><div class="line"><span class="keywordtype">int</span> soap_out_T(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keyword">const</span> T *a, <span class="keyword">const</span> <span class="keywordtype">char</span> *type);</div><div class="line">T *soap_in_T(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag, T *a, <span class="keyword">const</span> <span class="keywordtype">char</span> *type);</div></div><!-- fragment --><p>The function prototypes of these functions can be found in the soapcpp2-generated <em><code>soapH.h</code></em> file.</p>
<p>For example, the serialization of <code>MyData</code> can be done with the following code:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> soap_serialize_MyData(<span class="keyword">struct</span> soap *soap, MyData <span class="keyword">const</span>*a) </div><div class="line">{</div><div class="line">  <span class="comment">// no need to mark this node (for multi-ref and cycle detection) </span></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>;</div><div class="line">}</div><div class="line"><span class="keywordtype">void</span> soap_default_MyData(<span class="keyword">struct</span> soap *soap, MyData *a) </div><div class="line">{</div><div class="line">  *a = NULL;</div><div class="line">} </div><div class="line"><span class="keywordtype">int</span> soap_out_MyData(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, MyData <span class="keyword">const</span>*a, <span class="keyword">const</span> <span class="keywordtype">char</span> *type) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (soap_element_begin_out(soap, tag, <span class="keywordtype">id</span>, type) <span class="comment">// print XML beginning tag </span></div><div class="line">   || <a class="code" href="group__group__io.html#ga7712f5bc36127050a11ad995d0593bdc">soap_send</a>(soap, *a) <span class="comment">// just print the string (no XML conversion) </span></div><div class="line">   || soap_element_end_out(soap, tag)) <span class="comment">// print XML ending tag </span></div><div class="line">    <span class="keywordflow">return</span> soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line">MyData **soap_in_MyData(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag, MyData *a, <span class="keyword">const</span> <span class="keywordtype">char</span> *type) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (soap_element_begin_in(soap, tag)) </div><div class="line">    <span class="keywordflow">return</span> NULL; </div><div class="line">  <span class="keywordflow">if</span> (!a) </div><div class="line">    a = (MyData*)<a class="code" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c">soap_malloc</a>(soap, <span class="keyword">sizeof</span>(MyData)); </div><div class="line">  <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#addf099ccce764cf38f96be305b44406a">null</a>) </div><div class="line">    *a = NULL; <span class="comment">// xsi:nil element </span></div><div class="line">  <span class="keywordflow">if</span> (*soap-&gt;type &amp;&amp; <a class="code" href="group__group__misc.html#ga91a35d2f67eeea8dc31fd23a3cea65d4">soap_match_tag</a>(soap, soap-&gt;type, type)) </div><div class="line">  {</div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> = <a class="code" href="group__group__errors.html#gafea66c256bdaa8376e12106e36307c02">SOAP_TYPE</a>; </div><div class="line">    <span class="keywordflow">return</span> NULL; <span class="comment">// type mismatch </span></div><div class="line">  } </div><div class="line">  <span class="keywordflow">if</span> (*soap-&gt;href) </div><div class="line">    a = (MyData**)soap_id_forward(soap, soap-&gt;href, a, 0, SOAP_TYPE_MyData, 0, <span class="keyword">sizeof</span>(MyData), 0, NULL, NULL) </div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a3b89f13ece11d9f9b6e48bf15ff48be6">body</a>) </div><div class="line">  {</div><div class="line">    <span class="keywordtype">char</span> *s = soap_value(soap); <span class="comment">// fill buffer </span></div><div class="line">    *a = (<span class="keywordtype">char</span>*)<a class="code" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c">soap_malloc</a>(soap, strlen(s)+1); </div><div class="line">    strcpy(*a, s); </div><div class="line">  } </div><div class="line">  <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a3b89f13ece11d9f9b6e48bf15ff48be6">body</a> &amp;&amp; soap_element_end_in(soap, tag)) </div><div class="line">    <span class="keywordflow">return</span> NULL; </div><div class="line">  <span class="keywordflow">return</span> a; </div><div class="line">}</div></div><!-- fragment --><p>More information on custom serialization is available in the gSOAP source code package in the <em><code>gsoap/custom</code></em> directory, where you can also find several custom serializers to use with your projects.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="callback"></a>
Function callbacks for customized I/O and HTTP handling</h2>
<p>The following list of functions can be used for customized HTTP handling and I/O.</p>
<p>See also API documentation Module <a class="el" href="group__group__callbacks.html">Callback functions</a>.</p>
<p>To reset the callback functions to the internal functions of the engine, use <code><a class="el" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a" title="Finalize the given soap context, i.e. when the soap context is stack allocated, automatically invoked...">soap_done</a></code> followed by <code><a class="el" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c" title="Initialize a stack-allocated soap context. ">soap_init</a></code>. This re-initializes the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context, removes all plugins, and resets function callbacks.</p>
<h3>fpost</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga78d2b5440b33d3882b595ca8cfdec425" title="Callback that populates and then sends HTTP headers from the client-side to a connected HTTP server...">soap::fpost</a>)(struct soap *soap, const char *endpoint, const char *host, int port, const char *path, const char *action, ULONG64 count)</code></p>
<p>This callback is called at the server side by the engine to send the HTTP headers to the connected client. The parameter <code>status</code> should be an HTTP status error code or <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> (200 OK) or <code><a class="el" href="group__group__io.html#ga17cdc287dd916e5d2b3467ccec177d5a" title="A special soap_status error code to signal that a custom HTTP response is present and no HTTP respons...">SOAP_HTML</a></code> or <code><a class="el" href="group__group__io.html#ga05be99343f556fe70940145e874cdb99" title="A special soap_status error code to signal that a custom file-based HTTP response is present and no H...">SOAP_FILE</a></code>. Using <code><a class="el" href="group__group__io.html#ga17cdc287dd916e5d2b3467ccec177d5a" title="A special soap_status error code to signal that a custom HTTP response is present and no HTTP respons...">SOAP_HTML</a></code> sets the content-type header to <code>text/html; charset=utf-8</code>. Using <code><a class="el" href="group__group__io.html#ga05be99343f556fe70940145e874cdb99" title="A special soap_status error code to signal that a custom file-based HTTP response is present and no H...">SOAP_FILE</a></code> sets the content-type header to the value of <code><a class="el" href="structsoap.html#ae5e98733a4349b5e1466a9e0ccc22c11" title="String with HTTP content type header value received, can also be assigned to specify a content type h...">soap::http_content</a></code>. Extra HTTP headers are added when <code><a class="el" href="structsoap.html#afb22ae0a494a35268914286bd00446ab" title="User-definable string that specifies an extra HTTP header or headers when separated by CRLF...">soap::http_extra_header</a></code> is set to one or more header lines separated by CRLF. When redefining this callback, use function <code><a class="el" href="group__group__io.html#ga7712f5bc36127050a11ad995d0593bdc" title="Send a string. ">soap_send</a></code> to write the header contents. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga3d8e8e2b7ad7f1ac995c287b3a9f67a9" title="Callback that populates and then sends HTTP headers from the server-side to a connected client...">soap::fresponse</a></code> is <code>http_response</code>.</p>
<h3>fresponse</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga3d8e8e2b7ad7f1ac995c287b3a9f67a9" title="Callback that populates and then sends HTTP headers from the server-side to a connected client...">soap::fresponse</a>)(struct soap *soap, int soap_error_code, ULONG64 count)</code></p>
<p>This callback is called at the server side by the engine to send the HTTP headers to the connected client. The parameter <code>status</code> should be an HTTP status error code or <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> (200 OK) or <code><a class="el" href="group__group__io.html#ga17cdc287dd916e5d2b3467ccec177d5a" title="A special soap_status error code to signal that a custom HTTP response is present and no HTTP respons...">SOAP_HTML</a></code> or <code><a class="el" href="group__group__io.html#ga05be99343f556fe70940145e874cdb99" title="A special soap_status error code to signal that a custom file-based HTTP response is present and no H...">SOAP_FILE</a></code>. Using <code><a class="el" href="group__group__io.html#ga17cdc287dd916e5d2b3467ccec177d5a" title="A special soap_status error code to signal that a custom HTTP response is present and no HTTP respons...">SOAP_HTML</a></code> sets the content-type header to <code>text/html; charset=utf-8</code>. Using <code><a class="el" href="group__group__io.html#ga05be99343f556fe70940145e874cdb99" title="A special soap_status error code to signal that a custom file-based HTTP response is present and no H...">SOAP_FILE</a></code> sets the content-type header to the value of <code><a class="el" href="structsoap.html#ae5e98733a4349b5e1466a9e0ccc22c11" title="String with HTTP content type header value received, can also be assigned to specify a content type h...">soap::http_content</a></code>. Extra HTTP headers are added when <code><a class="el" href="structsoap.html#afb22ae0a494a35268914286bd00446ab" title="User-definable string that specifies an extra HTTP header or headers when separated by CRLF...">soap::http_extra_header</a></code> is set to one or more header lines separated by CRLF. When redefining this callback, use function <code><a class="el" href="group__group__io.html#ga7712f5bc36127050a11ad995d0593bdc" title="Send a string. ">soap_send</a></code> to write the header contents. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga3d8e8e2b7ad7f1ac995c287b3a9f67a9" title="Callback that populates and then sends HTTP headers from the server-side to a connected client...">soap::fresponse</a></code> is <code>http_response</code>.</p>
<h3>fposthdr</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#gab836b5b06024279f4ee190e69d7ccf75" title="Callback that sends a single HTTP header given a key-value pair. ">soap::fposthdr</a>)(struct soap *soap, const char *key, const char *val)</code></p>
<p>This callback is called by <code><a class="el" href="group__group__callbacks.html#ga78d2b5440b33d3882b595ca8cfdec425" title="Callback that populates and then sends HTTP headers from the client-side to a connected HTTP server...">soap::fpost</a></code> and <code><a class="el" href="group__group__callbacks.html#ga3d8e8e2b7ad7f1ac995c287b3a9f67a9" title="Callback that populates and then sends HTTP headers from the server-side to a connected client...">soap::fresponse</a></code> to send an HTTP header with a key and an optional value. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#gab836b5b06024279f4ee190e69d7ccf75" title="Callback that sends a single HTTP header given a key-value pair. ">soap::fposthdr</a></code> is <code>http_post_header</code>.</p>
<h3>fparse</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga9cb05ce98f845f16c920c44426ac35a5" title="Callback that reads and parses HTTP and MIME headers. ">soap::fparse</a>)(struct soap *soap)</code></p>
<p>This callback is called by the engine (as a client or server) to read and parse HTTP headers or MIME headers. When redefined, this function should at read or skip the entire HTTP header to reach the message body. Function <code><a class="el" href="group__group__io.html#ga3f54c5916c6f6ddffec5d7120a230f46" title="Get a header line. ">soap_getline</a></code> is used by this callback to read each header line into an internal buffer <code><a class="el" href="structsoap.html#a58350076d9fa133bacca27424fe0feff" title="Internal buffer to hold short messages, URLs and HTTP/MIME header lines, must have at least SOAP_TMPL...">soap::msgbuf</a></code> with <code><a class="el" href="group__group__io.html#ga3f54c5916c6f6ddffec5d7120a230f46" title="Get a header line. ">soap_getline</a>(soap, soap-&gt;msgbuf, sizeof(soap-&gt;msgbuf))</code>. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code>, or a gSOAP error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga9cb05ce98f845f16c920c44426ac35a5" title="Callback that reads and parses HTTP and MIME headers. ">soap::fparse</a></code> is <code>http_parse</code>.</p>
<h3>fparsehdr</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga70b75026b5fb1a9a2d5779f72454f082" title="Callback that consumes an HTTP header that consists of a key-value pair. ">soap::fparsehdr</a>)(struct soap *soap, const char *key, const char *val)</code></p>
<p>This callback is called by <code><a class="el" href="group__group__callbacks.html#ga9cb05ce98f845f16c920c44426ac35a5" title="Callback that reads and parses HTTP and MIME headers. ">soap::fparse</a></code>, consumes an HTTP header that is split in a key-value pair and updates the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context state accordingly. The context is updated with the HTTP header information received, but HTTP headers are not literally retained by the engine. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or <code><a class="el" href="group__group__errors.html#gaa03308d50b94828cbc49724d049d9d2d" title="An internal soap_status error code to signal that an HTTP response must not be produced. ">SOAP_STOP</a></code> to prevent further reading of the HTTP body, or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga70b75026b5fb1a9a2d5779f72454f082" title="Callback that consumes an HTTP header that consists of a key-value pair. ">soap::fparsehdr</a></code> is <code>http_parse_header</code>.</p>
<h3>fget</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#gae022204ff7004df2d5ac9e083cbb5b16" title="Callback to implement logic at the server-side to serve responses to HTTP GET requests from clients...">soap::fget</a>)(struct soap *soap)</code></p>
<p>This callback is called by the service dispatcher when an HTTP GET request is pending. Redefine this callback to respond to HTTP GET requests with content, see the <code><a class="el" href="group__group__io.html#ga0ecdc43a53e494edc4f84e8c135659ba" title="The HTTP GET plugin registration function. ">http_get</a></code> HTTP GET plugin for more details. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#gae022204ff7004df2d5ac9e083cbb5b16" title="Callback to implement logic at the server-side to serve responses to HTTP GET requests from clients...">soap::fget</a></code> is the internal static function <code>http_get</code> that returns the <code><a class="el" href="group__group__errors.html#gac62f5f70e545ea8fbcbb181e88750d56" title="A soap_status error code: an HTTP GET request was received by the service but the GET request callbac...">SOAP_GET_METHOD</a></code> error.</p>
<h3>fput</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#gaf263ffe14d8c2508ce4c734d4f33a854" title="Callback to implement logic at the server-side to serve responses to HTTP PUT requests from clients...">soap::fput</a>)(struct soap *soap)</code></p>
<p>This callback is called by the service dispatcher when an HTTP PUT request is pending. Redefine this callback to respond to HTTP PUT requests, see the <code><a class="el" href="group__group__io.html#ga4c08d5ef28bc0dc37eee4633acdd1140" title="The HTTP POST plugin registration function. ">http_post</a></code> HTTP POST plugin for more details. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#gaf263ffe14d8c2508ce4c734d4f33a854" title="Callback to implement logic at the server-side to serve responses to HTTP PUT requests from clients...">soap::fput</a></code> is the internal static function <code>http_put</code> that returns the <code><a class="el" href="group__group__errors.html#gad8fb6bd54608a32e89ddef0b33575bb5" title="A soap_status error code: an HTTP PUT request was received by the service but the PUT request callbac...">SOAP_PUT_METHOD</a></code> error.</p>
<h3>fpatch</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga808a6a9b7e6d17e039fb53a5e8a9b84a" title="Callback to implement logic at the server-side to serve responses to HTTP PATCH requests from clients...">soap::fpatch</a>)(struct soap *soap)</code></p>
<p>This callback is called by the service dispatcher when an HTTP PATCH request is pending. Redefine this callback to respond to HTTP PATCH requests, see the <code><a class="el" href="group__group__io.html#ga4c08d5ef28bc0dc37eee4633acdd1140" title="The HTTP POST plugin registration function. ">http_post</a></code> HTTP POST plugin for more details. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga808a6a9b7e6d17e039fb53a5e8a9b84a" title="Callback to implement logic at the server-side to serve responses to HTTP PATCH requests from clients...">soap::fpatch</a></code> is the internal static function <code>http_patch</code> that returns the <code><a class="el" href="group__group__errors.html#gaf8d3f932c1d555c2cbca899c1095d40e" title="A soap_status error code: an HTTP PATCH request was received by the service but the PATCH request cal...">SOAP_PATCH_METHOD</a></code> error.</p>
<h3>fdel</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#gaf2bda0187489c8f2b9857f61b96ad0e0" title="Callback to implement logic at the server-side to serve responses to HTTP DELETE requests from client...">soap::fdel</a>)(struct soap *soap)</code></p>
<p>This callback is called by the service dispatcher when an HTTP DELETE request is pending. Redefine this callback to respond to HTTP DELETE requests, see the <code><a class="el" href="group__group__io.html#ga4c08d5ef28bc0dc37eee4633acdd1140" title="The HTTP POST plugin registration function. ">http_post</a></code> HTTP POST plugin for more details. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#gaf2bda0187489c8f2b9857f61b96ad0e0" title="Callback to implement logic at the server-side to serve responses to HTTP DELETE requests from client...">soap::fdel</a></code> is the internal static function <code>http_del</code> that returns the <code><a class="el" href="group__group__errors.html#ga122216a634ba30e3cc6e7ba53218dd97" title="A soap_status error code: an HTTP DELETE request was received by the service but the DELETE request c...">SOAP_DEL_METHOD</a></code> error.</p>
<h3>fopt</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga65272c1ecb5ed9925a5a670cf7e77d10" title="Callback to implement logic at the server-side to serve responses to HTTP OPTION requests from client...">soap::fopt</a>)(struct soap *soap)</code></p>
<p>Called by the service dispatcher when an HTTP OPTION request is pending. Redefine this callback to respond to HTTP OPTION requests, see the <code><a class="el" href="group__group__io.html#ga4c08d5ef28bc0dc37eee4633acdd1140" title="The HTTP POST plugin registration function. ">http_post</a></code> HTTP POST plugin for more details. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga65272c1ecb5ed9925a5a670cf7e77d10" title="Callback to implement logic at the server-side to serve responses to HTTP OPTION requests from client...">soap::fopt</a></code> is the internal static function <code>http_200</code> that returns HTTP 200 OK.</p>
<h3>fhead</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#gadff52b7b3ecc16379eb2d7b1ff361978" title="Callback to implement logic at the server-side to serve responses to HTTP HEAD requests from clients...">soap::fhead</a>)(struct soap *soap)</code></p>
<p>This callback is called by the service dispatcher when an HTTP HEAD request is pending. Redefine this callback to respond to HTTP HEAD requests more specifically. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#gadff52b7b3ecc16379eb2d7b1ff361978" title="Callback to implement logic at the server-side to serve responses to HTTP HEAD requests from clients...">soap::fhead</a></code> is the internal static function <code>http_200</code> that returns HTTP 200 OK.</p>
<h3>fform</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga052cdf13e382b4af3d16128955546671" title="Callback to implement logic at the server-side to handle HTML forms, such as done by the callbacks pr...">soap::fform</a>)(struct soap *soap)</code></p>
<p>This callback is called by the HTTP FORM handler plugin to parse HTML forms received with HTTP POST and PUT requests, see the <code>;:http_form</code> HTTP FORM plugin for more details. The HTTP body with the form data should be parsed by this callback, otherwise HTTP keep-alive messages will end up out of sync as a result of the current position not being advanced to the end of the HTTP body. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. No built-in function is assigned to <code><a class="el" href="group__group__callbacks.html#ga052cdf13e382b4af3d16128955546671" title="Callback to implement logic at the server-side to handle HTML forms, such as done by the callbacks pr...">soap::fform</a></code>.</p>
<h3>fheader</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#gae88b674df5fdcfa866c04e4330fe0afe" title="Callback to inspect the SOAP Header received before the rest of the message with the SOAP Body is con...">soap::fheader</a>)(struct soap *soap)</code></p>
<p>This callback is called immediately after parsing a SOAP Header into the <code><a class="el" href="structsoap.html#ac091dfe4e01b6a082d916c381e7006ba" title="The soap::header points to a SOAP_ENV__Header structure with the SOAP Header that was received or tha...">soap::header</a></code> structure. The SOAP Header structure <code><a class="el" href="structsoap.html#ac091dfe4e01b6a082d916c381e7006ba" title="The soap::header points to a SOAP_ENV__Header structure with the SOAP Header that was received or tha...">soap::header</a></code> can be inspected by this function and verified or rejected before the rest of the message with the SOAP Body is consumed. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. No built-in function is assigned to <code><a class="el" href="group__group__callbacks.html#gae88b674df5fdcfa866c04e4330fe0afe" title="Callback to inspect the SOAP Header received before the rest of the message with the SOAP Body is con...">soap::fheader</a></code>.</p>
<h3>fignore</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga0c2e1a0b5a5197128af1acc48662b1bd" title="Callback to catch unrecognized XML elements and overrides SOAP_XML_STRICT validation errors for these...">soap::fignore</a>)(struct soap *soap, const char *tag)</code></p>
<p>This callback is called when an unrecognized XML element was encountered on the input that could be ignored depending on some specified logic. The <code>tag</code> parameter is the offending XML element tag name string. The callback should return <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> to ignore the element or return an <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code such as <code><a class="el" href="group__group__errors.html#ga7f4d934410ea4dd2ffa5ad7fcaae7e70" title="A soap_status error code: XML element tag parsed does not match anything that is expected. ">SOAP_TAG_MISMATCH</a></code> to trigger a validation error. This callback also overrides <code>mustUnderstand</code> attributes on unrecognized SOAP Header elements that normally raise faults. It is strongly recommended that the callback returns <code><a class="el" href="group__group__errors.html#ga6e6849f52e3641ffba443df668d55168" title="A soap_status error code: an XML element is present with a mustUnderstand attribute which must be und...">SOAP_MUSTUNDERSTAND</a></code> when <code><a class="el" href="structsoap.html#a17c750f20dab579a6a23c30199ed1263" title="The soap::mustUnderstand flag is set when a SOAP Header element carries a SOAP-ENV:mustUnderstand att...">soap::mustUnderstand</a></code> != <code>0</code>. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. No built-in function is assigned to <code><a class="el" href="group__group__callbacks.html#ga0c2e1a0b5a5197128af1acc48662b1bd" title="Callback to catch unrecognized XML elements and overrides SOAP_XML_STRICT validation errors for these...">soap::fignore</a></code>.</p>
<h3>fsvalidate</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga6a5e29b860d28f855c8d9a67c096d311" title="Callback to validate strings against XML regex patterns. ">soap::fsvalidate</a>)(struct soap *soap, const char *pattern, const char *string)</code></p>
<p>This callback is called to validate a string against an XML regex pattern. Patterns use XML schema regex syntax. This callback allows user-defined pattern validation that is normally disabled. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> when the string matches the pattern or <code><a class="el" href="group__group__errors.html#gafea66c256bdaa8376e12106e36307c02" title="A soap_status error code: XML element or attribute has a mismatching type or value that is causing a ...">SOAP_TYPE</a></code> when the string does not match. No built-in function is assigned to <code><a class="el" href="group__group__callbacks.html#ga6a5e29b860d28f855c8d9a67c096d311" title="Callback to validate strings against XML regex patterns. ">soap::fsvalidate</a></code>.</p>
<h3>fwvalidate</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga1a38366b5b84730713c45ccada84e3ca" title="Callback to validate wide strings against XML regex patterns. ">soap::fwvalidate</a>)(struct soap *soap, const char *pattern, const wchar_t *string)</code> This callback is called to validate a wide string against an XML regex pattern. Patterns use XML schema regex syntax. This callback allows user-defined pattern validation that is normally disabled. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> when the string matches the pattern or <code><a class="el" href="group__group__errors.html#gafea66c256bdaa8376e12106e36307c02" title="A soap_status error code: XML element or attribute has a mismatching type or value that is causing a ...">SOAP_TYPE</a></code> when the string does not match. No built-in function is assigned to <code><a class="el" href="group__group__callbacks.html#ga1a38366b5b84730713c45ccada84e3ca" title="Callback to validate wide strings against XML regex patterns. ">soap::fwvalidate</a></code>.</p>
<h3>fseterror</h3>
<p><code>void (<a class="el" href="group__group__callbacks.html#ga4523d86587b4181a138850b92498f5b7" title="Callback to inspect or override fault code or fault string messages. ">soap::fseterror</a>)(struct soap *soap, const char **code, const char **string)</code></p>
<p>This callback is called by the engine when an error is raised to allow inspection or overriding of the fault code or fault string messages before the error is reported or transmitted. No built-in function is assigned to <code><a class="el" href="group__group__callbacks.html#ga4523d86587b4181a138850b92498f5b7" title="Callback to inspect or override fault code or fault string messages. ">soap::fseterror</a></code>.</p>
<h3>fopen</h3>
<p><code>SOAP_SOCKET (<a class="el" href="group__group__callbacks.html#ga9b4985eb5a588f4c16ad88ef7ca329dc" title="Callback that opens a socket connection to a server endpoint. ">soap::fopen</a>)(struct soap *soap, const char *endpoint, const char *host, int port)</code></p>
<p>This callback is called by the engine at the client-side by <code><a class="el" href="group__group__io.html#ga5c87e9d0a43fe18cc349c724f198f64a" title="Connect to a server using HTTP POST. ">soap_connect</a></code> or <code><a class="el" href="group__group__io.html#ga315b6e1d5888780bf4ef320c50f23796" title="Connect to a server. ">soap_connect_command</a></code> to open a TCP or UDP connection to a server specified at an endpoint. Parameters <code>host</code> and <code>port</code> are micro-parsed from <code>endpoint</code> before being passed to <code><a class="el" href="group__group__callbacks.html#ga9b4985eb5a588f4c16ad88ef7ca329dc" title="Callback that opens a socket connection to a server endpoint. ">soap::fopen</a></code>. Returns a valid socket or <code><a class="el" href="group__group__soap.html#gab9e77b1557780293eec0b269ef191472" title="Macro that defines a portable invalid socket value (usually -1, but the value depends on the OS) ...">SOAP_INVALID_SOCKET</a></code> with a <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code> set to a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code and <code><a class="el" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13" title="The errno value of the last failed IO operation. ">soap::errnum</a></code> set to <code>errno</code> of the connection failure. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga9b4985eb5a588f4c16ad88ef7ca329dc" title="Callback that opens a socket connection to a server endpoint. ">soap::fopen</a></code> is <code>tcp_connect</code>.</p>
<h3>faccept</h3>
<p><code>SOAP_SOCKET (<a class="el" href="group__group__callbacks.html#ga8249b4c23f662dbe680ad0deef274ae8" title="Callback that waits for and accepts a socket connection requested by a client. ">soap::faccept</a>)(struct soap *soap, SOAP_SOCKET s, struct sockaddr *a, int *n)</code></p>
<p>This callback is called by <code><a class="el" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6" title="Accept a connection with a client. ">soap_accept</a></code> (or the C++ service class <code>accept</code> method) to wait for and accept a socket connection requested by a client. Returns a valid socket or <code><a class="el" href="group__group__soap.html#gab9e77b1557780293eec0b269ef191472" title="Macro that defines a portable invalid socket value (usually -1, but the value depends on the OS) ...">SOAP_INVALID_SOCKET</a></code> when an error occurred and sets <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code> to a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> value. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga8249b4c23f662dbe680ad0deef274ae8" title="Callback that waits for and accepts a socket connection requested by a client. ">soap::faccept</a></code> is <code>tcp_accept</code>.</p>
<h3>fclose</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#gab9591dd80dbb0e571784bad5421b2202" title="Callback that closes the current socket connection. ">soap::fclose</a>)(struct soap *soap)</code></p>
<p>This callback is called by the engine at the client-side to close the current socket connection before a new socket connection is established. This callback may be called multiple times (e.g. by the engine and by plugins) to close the same socket <code><a class="el" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046" title="The socket set by soap_accept (or the C++ service class accept method) or soap_connect or soap_connec...">soap::socket</a></code>. Checks internally if <code><a class="el" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046" title="The socket set by soap_accept (or the C++ service class accept method) or soap_connect or soap_connec...">soap::socket</a></code> == <code><a class="el" href="group__group__soap.html#gab9e77b1557780293eec0b269ef191472" title="Macro that defines a portable invalid socket value (usually -1, but the value depends on the OS) ...">SOAP_INVALID_SOCKET</a></code> before closing, which means that the socket was already closed. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#gab9591dd80dbb0e571784bad5421b2202" title="Callback that closes the current socket connection. ">soap::fclose</a></code> is <code>tcp_disconnect</code>.</p>
<h3>fresolve</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga0ae800fa60c5e65a867e5d0e3ce7223e" title="Callback that resolves a host name by address translation. ">soap::fresolve</a>)(struct soap *soap, const char *addr, struct in_addr *inaddr)</code></p>
<p>This callback is called by <code><a class="el" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18" title="Bind and listen to a port. ">soap_bind</a></code> (or the C++ service class <code>bind</code> method) at the server-side and by <code><a class="el" href="group__group__io.html#ga5c87e9d0a43fe18cc349c724f198f64a" title="Connect to a server using HTTP POST. ">soap_connect</a></code> or <code><a class="el" href="group__group__io.html#ga315b6e1d5888780bf4ef320c50f23796" title="Connect to a server. ">soap_connect_command</a></code> at the client-side with a host <code>name</code> parameter to resolve to address <code>inaddr</code> by address translation. When successful sets parameter <code>inaddr</code> and returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga0ae800fa60c5e65a867e5d0e3ce7223e" title="Callback that resolves a host name by address translation. ">soap::fresolve</a></code> is <code>tcp_gethost</code>.</p>
<h3>fconnect</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga0a0d27154b0e9e32d9adbcc4efc92b5c" title="Callback that overrides the client-side connecting operations. ">soap::fconnect</a>)(struct soap *soap, const char *endpoint, const char *host, int port)</code></p>
<p>This callback is called by the engine to optionally override client-side connecting. The parameters <code>host</code> and <code>port</code> were micro-parsed from the <code>endpoint</code> prior to passing them to this callback. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. No built-in function is assigned to <code><a class="el" href="group__group__callbacks.html#ga0a0d27154b0e9e32d9adbcc4efc92b5c" title="Callback that overrides the client-side connecting operations. ">soap::fconnect</a></code>.</p>
<h3>fdisconnect</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga2de194075f645d77c15f78c52ca24858" title="Callback that executes disconnect logic before closing. ">soap::fdisconnect</a>)(struct soap *soap)</code></p>
<p>This callback is called by the engine <code><a class="el" href="group__group__io.html#ga06d59094afa3df6b1b9f6b2bb484207c" title="Close the socket connection. ">soap_closesock</a></code> before the <code><a class="el" href="group__group__callbacks.html#gab9591dd80dbb0e571784bad5421b2202" title="Callback that closes the current socket connection. ">soap::fclose</a></code> callback is called to shutdown/disconnect. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. No built-in function is assigned to <code><a class="el" href="group__group__callbacks.html#ga2de194075f645d77c15f78c52ca24858" title="Callback that executes disconnect logic before closing. ">soap::fdisconnect</a></code>.</p>
<h3>fclosesocket</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga21edadcbd081c7f37822d04bb05a9d29" title="Callback that closes a given socket. ">soap::fclosesocket</a>)(struct soap *soap, SOAP_SOCKET sock)</code></p>
<p>This callback is called to close a socket by the engine. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga21edadcbd081c7f37822d04bb05a9d29" title="Callback that closes a given socket. ">soap::fclosesocket</a></code> is <code>tcp_closesocket</code>.</p>
<h3>fshutdownsocket</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga51e09ddf769a2ddcd874fb6e6fb5289d" title="Callback that shuts down a given socket. ">soap::fshutdownsocket</a>)(struct soap *soap, SOAP_SOCKET sock, int how)</code></p>
<p>This callback is called to shut down a socket by the engine. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga51e09ddf769a2ddcd874fb6e6fb5289d" title="Callback that shuts down a given socket. ">soap::fshutdownsocket</a></code> is <code>tcp_shutdownsocket</code>.</p>
<h3>fpoll</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga20210aa171019b27ef182d853e2d6e2f" title="Callback that blocks until activity is detected on the soap::socket or soap::master socket...">soap::fpoll</a>)(struct soap *soap)</code></p>
<p>This callback is called by the engine to wait for activity on the <code><a class="el" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046" title="The socket set by soap_accept (or the C++ service class accept method) or soap_connect or soap_connec...">soap::socket</a></code> or <code><a class="el" href="structsoap.html#ab649b8f3b71081d14ec6350ab4b06794" title="The socket set by soap_bind (or the C++ service class bind method) to serve as the master socket boun...">soap::master</a></code> socket using <code>poll</code> or <code>select</code>. Times out when <code><a class="el" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474" title="User-definable timeout to send a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::send_timeout</a></code> or <code><a class="el" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388" title="User-definable timeout to receive a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::recv_timeout</a></code> are nonzero. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga20210aa171019b27ef182d853e2d6e2f" title="Callback that blocks until activity is detected on the soap::socket or soap::master socket...">soap::fpoll</a></code> is <code>soap_poll</code>.</p>
<h3>frecv</h3>
<p><code>size_t (<a class="el" href="group__group__callbacks.html#ga0c218cd5552045745cc640998e25ed72" title="Callback that receives bytes of data into the given buffer. ">soap::frecv</a>)(struct soap *soap, char *buf, size_t len)</code></p>
<p>This callback is called by the engine to receive (or read) data into a specified buffer <code>buf</code> and <code>len</code>. The source for the data to read by this callback is <code><a class="el" href="structsoap.html#a285e8a3584ffb1cea07a700c951e436d" title="The source to read data from when non-NULL, which in C++ is a std::istream object and in C is a 0-ter...">soap::is</a></code> when non-NULL, <code><a class="el" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046" title="The socket set by soap_accept (or the C++ service class accept method) or soap_connect or soap_connec...">soap::socket</a></code> when valid, or <code><a class="el" href="structsoap.html#a192c25cc206668600212fd34f6541f34" title="The file descriptor to read data from when no socket communications are set (soap::socket == SOAP_INV...">soap::recvfd</a></code>. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga0c218cd5552045745cc640998e25ed72" title="Callback that receives bytes of data into the given buffer. ">soap::frecv</a></code> is <code>frecv</code>.</p>
<h3>fsend</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#gafd52b80655e4f1021edd6c55b8dfedff" title="Callback that sends the given bytes of data. ">soap::fsend</a>)(struct soap *soap, const char *buf, size_t len)</code></p>
<p>This callback is called by the engine to send (or write) data specified by <code>data</code> bytes of length <code>len</code>. The sink for the data to be sent to is typically <code><a class="el" href="structsoap.html#a1579bd8bd106afc9a906a673ca473046" title="The socket set by soap_accept (or the C++ service class accept method) or soap_connect or soap_connec...">soap::socket</a></code>, <code><a class="el" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9" title="The file descriptor to write data to when no socket communications are set (soap::socket == SOAP_INVA...">soap::sendfd</a></code> or <code><a class="el" href="structsoap.html#a27b166e404c7c98cfa45d6d7a5da90c0" title="The sink to write data to when non-NULL, which in C++ is a std::ostream object and in C is a pointer ...">soap::os</a></code>. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#gafd52b80655e4f1021edd6c55b8dfedff" title="Callback that sends the given bytes of data. ">soap::fsend</a></code> is <code>fsend</code>.</p>
<h3>fserverloop</h3>
<p><code>int (<a class="el" href="group__group__callbacks.html#ga76024ad8bab31b591432a5dbdcf3a0a4" title="Callback executed by the engine at the server side immediately after a server operation successfully ...">soap::fserveloop</a>)(struct soap *soap)</code></p>
<p>This callback is called after each successful completion of a server operation in the server loop. Executes immediately after sending the response to a client and before the next keep-alive server loop iteration when enabled with <code><a class="el" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2" title="soap_mode IO input and output flag value to keep the socket connection alive for SOAP_MAXKEEPALIVE me...">SOAP_IO_KEEPALIVE</a></code>. This callback can be used to reclaim resources in the keep-alive server loop, for example managed memory can be reclaimed by calling <code><a class="el" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9" title="Delete all dynamically-allocated C++ objects managed by the specified soap context. ">soap_destroy</a></code> and <code><a class="el" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9" title="Delete all data from heap memory managed by the specified soap context and release the freed memory b...">soap_end</a></code> in that order and all deserialized and other dynamically-allocated data managed by the context will be deallocated. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. No built-in function is assigned to <code><a class="el" href="group__group__callbacks.html#ga76024ad8bab31b591432a5dbdcf3a0a4" title="Callback executed by the engine at the server side immediately after a server operation successfully ...">soap::fserveloop</a></code>.</p>
<h3>fmalloc</h3>
<p><code>void (<a class="el" href="group__group__callbacks.html#gae2a9bb5e497817ef2af6f2c8fc1089d9" title="Callback to override dynamic memory allocation and management. ">soap::fmalloc</a>)(struct soap *soap, size_t size)</code></p>
<p>This callback can be used to override memory allocation and management done by <code><a class="el" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c" title="Allocate a block of heap memory managed by the specified soap context. ">soap_malloc</a></code> in C. Memory allocated via this callback will not be managed and not be automatically released by the engine. Instead, the application using this callback should release allocated memory. All allocations done by <code><a class="el" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c" title="Allocate a block of heap memory managed by the specified soap context. ">soap_malloc</a></code> are replaced with a call to <code><a class="el" href="group__group__callbacks.html#gae2a9bb5e497817ef2af6f2c8fc1089d9" title="Callback to override dynamic memory allocation and management. ">soap::fmalloc</a></code>. However, no other allocations, such as <code><a class="el" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c" title="Allocate and initialize a new soap context. ">soap_new</a></code> and <code>soap_new_T</code> for C++ classes <code>T</code> are affected, because objects are allocated differently. This callback is therefore not useful for C++ applications. Returns a pointer to dynamically allocated memory or NULL on failure to allocate. No built-in function is assigned to <code><a class="el" href="group__group__callbacks.html#gae2a9bb5e497817ef2af6f2c8fc1089d9" title="Callback to override dynamic memory allocation and management. ">soap::fmalloc</a></code>.</p>
<dl class="section warning"><dt>Warning</dt><dd>Deprecated since 2.8.72. Define <code><a class="el" href="group__group__soap.html#gae230c94899bda500324e3d93105ec0d6" title="User-definable macro to override malloc() for context-managed heap allocation (excluding C++ class in...">SOAP_MALLOC</a></code> and <code><a class="el" href="group__group__soap.html#gaf24c3943fa576663cd8495ce80138cde" title="User-definable macro to override free() for context-managed heap allocation (excluding C++ class inst...">SOAP_FREE</a></code> instead.</dd></dl>
<h3>user variable</h3>
<p>A <code>void* <a class="el" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b" title="User-definable variable that may point to user-specified data of any type to pass the data through to...">soap::user</a></code> variable is available to pass user-defined data to the callbacks.</p>
<h3>Examples</h3>
<p>The following example uses I/O callbacks for customized serialization of data into a fixed-size buffer and deserialization back into a data structure:</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> buf[10000]; <span class="comment">// XML buffer </span></div><div class="line"><span class="keywordtype">int</span> len1 = 0;    <span class="comment">// #chars written </span></div><div class="line"><span class="keywordtype">int</span> len2 = 0;    <span class="comment">// #chars read </span></div><div class="line"></div><div class="line"><span class="comment">// mysend: put XML in buf[] </span></div><div class="line"><span class="keywordtype">int</span> mysend(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keywordtype">size_t</span> n) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (len1 + n &gt; <span class="keyword">sizeof</span>(buf)) </div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga224b2c2b830135f12b53536f189b4ebd">SOAP_EOF</a>; </div><div class="line">  strcpy(buf + len1, s); </div><div class="line">  len1 += n; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">// myrecv: get XML from buf[] </span></div><div class="line"><span class="keywordtype">size_t</span> myrecv(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *s, <span class="keywordtype">size_t</span> n) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (len2 + n &gt; len1) </div><div class="line">    n = len1 - len2; </div><div class="line">  strncpy(s, buf + len2, n); </div><div class="line">  len2 += n; </div><div class="line">  <span class="keywordflow">return</span> n; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <span class="keyword">struct </span>ns__person p; </div><div class="line">  <a class="code" href="group__group__context.html#gac87126c3e45d2fda488e9832c2dd5be1">soap_init1</a>(&amp;soap, <a class="code" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493">SOAP_XML_TREE</a>); </div><div class="line">  len1 = len2 = 0;     <span class="comment">// reset buffer pointers </span></div><div class="line">  p.name = <span class="stringliteral">&quot;John Doe&quot;</span>; </div><div class="line">  p.age = 25; </div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#gafd52b80655e4f1021edd6c55b8dfedff">fsend</a> = mysend; <span class="comment">// assign callback </span></div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#ga0c218cd5552045745cc640998e25ed72">frecv</a> = myrecv; <span class="comment">// assign callback </span></div><div class="line">  <span class="keywordflow">if</span> (soap_write_ns__person(&amp;soap, &amp;p))</div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stdout); </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  <span class="keywordflow">if</span> (soap_read_ns__Person(&amp;soap, &amp;p))</div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stdout); </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">}</div></div><!-- fragment --><p>A fixed-size buffer to store the outbound message sent is not flexible to handle large content. To store the message in an expanding buffer:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>buffer </div><div class="line">{</div><div class="line">  <span class="keywordtype">size_t</span> len; </div><div class="line">  <span class="keywordtype">size_t</span> max; </div><div class="line">  <span class="keywordtype">char</span> *buf; </div><div class="line">}; </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <span class="keyword">struct </span>ns__person p; </div><div class="line">  <span class="keyword">struct </span>buffer *h = malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> buffer)); </div><div class="line">  h-&gt;len = 0; </div><div class="line">  h-&gt;max = 0; </div><div class="line">  h-&gt;buf = NULL; </div><div class="line">  <a class="code" href="group__group__context.html#gac87126c3e45d2fda488e9832c2dd5be1">soap_init1</a>(&amp;soap, <a class="code" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493">SOAP_XML_TREE</a>); </div><div class="line">  soap.<a class="code" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b">user</a> = (<span class="keywordtype">void</span>*)h; <span class="comment">// pass buffer as a handle to the callback </span></div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#gafd52b80655e4f1021edd6c55b8dfedff">fsend</a> = mysend;  <span class="comment">// assign callback </span></div><div class="line">  <span class="keywordflow">if</span> (soap_write_ns__person(&amp;soap, &amp;p))</div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stdout); </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  <span class="keywordflow">if</span> (h-&gt;len) </div><div class="line">  {</div><div class="line">    ... <span class="comment">// use h-&gt;buf[0..h-&gt;len-1] content </span></div><div class="line">    <span class="comment">// then cleanup: </span></div><div class="line">    h-&gt;len = 0; </div><div class="line">    h-&gt;max = 0; </div><div class="line">    free(h-&gt;buf); </div><div class="line">    h-&gt;buf = NULL; </div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> mysend(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keywordtype">size_t</span> n) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>buffer *h = (<span class="keyword">struct </span>buffer*)soap-&gt;<a class="code" href="structsoap.html#a8eb35c04359a567c0b5e2664f3f94d5b">user</a>; <span class="comment">// get buffer through handle </span></div><div class="line">  <span class="keywordtype">int</span> m = h-&gt;max, k = h-&gt;len + n; </div><div class="line">  <span class="comment">// need to increase space? </span></div><div class="line">  if (m == 0) </div><div class="line">    m = 1024; </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">    <span class="keywordflow">while</span> (k &gt;= m) </div><div class="line">      m *= 2; </div><div class="line">  <span class="keywordflow">if</span> (m != h-&gt;max) </div><div class="line">  {</div><div class="line">    <span class="keywordtype">char</span> *buf = malloc(m); </div><div class="line">    memcpy(buf, h-&gt;buf, h-&gt;len); </div><div class="line">    h-&gt;max = m; </div><div class="line">    <span class="keywordflow">if</span> (h-&gt;buf) </div><div class="line">      free(h-&gt;buf); </div><div class="line">    h-&gt;buf = buf; </div><div class="line">  } </div><div class="line">  memcpy(h-&gt;buf + h-&gt;len, s, n); </div><div class="line">  h-&gt;len += n; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>The following example illustrates customized I/O and HTTP header handling. The XML message is saved to a file to demonstrate I/O and HTTP callbacks. The client proxy then reads the file contents as the service response. To perform this trick, the service response has exactly the same structure as the request. This is declared by the <code>struct ns__test</code> output parameter part of the service operation declaration. This struct resembles the service request (see the generated <em><code>soapStub.h</code></em> file generated by soapcpp2 from the interface header file input).</p>
<p>The interface header file for soapcpp2 is:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service name: callback </span></div><div class="line"><span class="comment">//gsoap ns service namespace: urn:callback </span></div><div class="line"><span class="keyword">struct </span>ns__person </div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name; </div><div class="line">    <span class="keywordtype">int</span> age; </div><div class="line">}; </div><div class="line"><span class="keywordtype">int</span> ns__test(<span class="keyword">struct</span> ns__person in, <span class="keyword">struct</span> ns__test &amp;out);</div></div><!-- fragment --><p>The client program is:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span> </div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span> </div><div class="line"></div><div class="line"><a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> myopen(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *endpoint, <span class="keyword">const</span> <span class="keywordtype">char</span> *host, <span class="keywordtype">int</span> port) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (strncmp(endpoint, <span class="stringliteral">&quot;file:&quot;</span>, 5)) </div><div class="line">  {</div><div class="line">    printf(<span class="stringliteral">&quot;File name expected\n&quot;</span>); </div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__soap.html#gab9e77b1557780293eec0b269ef191472">SOAP_INVALID_SOCKET</a>; </div><div class="line">  } </div><div class="line">  <span class="keywordflow">if</span> ((soap-&gt;<a class="code" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9">sendfd</a> = soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a> = open(host, O_RDWR|O_CREAT, S_IWUSR|S_IRUSR)) &lt; 0) </div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__soap.html#gab9e77b1557780293eec0b269ef191472">SOAP_INVALID_SOCKET</a>; </div><div class="line">  <span class="keywordflow">return</span> soap-&gt;<a class="code" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9">sendfd</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> myclose(<span class="keyword">struct</span> soap *soap) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9">sendfd</a> &gt; 2)  <span class="comment">// still open? </span></div><div class="line">    close(soap-&gt;<a class="code" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9">sendfd</a>); <span class="comment">// then close it </span></div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a> = 0;      <span class="comment">// set back to stdin </span></div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a200d71a901cdc5c9aa02140e9d2369b9">sendfd</a> = 1;      <span class="comment">// set back to stdout </span></div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> mypost(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *endpoint, <span class="keyword">const</span> <span class="keywordtype">char</span> *host, <span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keyword">const</span> <span class="keywordtype">char</span> *action, <a class="code" href="group__group__soap.html#ga7c6e38d209f60a18e362172dca1a3b6e">ULONG64</a> count) </div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga7712f5bc36127050a11ad995d0593bdc">soap_send</a>(soap, <span class="stringliteral">&quot;Custom-generated file\n&quot;</span>); <span class="comment">// writes to soap-&gt;sendfd </span></div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> myparse(<span class="keyword">struct</span> soap *soap) </div><div class="line">{</div><div class="line">  <span class="keywordtype">char</span> buf[256]; </div><div class="line">  <span class="keywordflow">if</span> (lseek(soap-&gt;<a class="code" href="structsoap.html#a192c25cc206668600212fd34f6541f34">recvfd</a>, 0, SEEK_SET) &lt; 0 || <a class="code" href="group__group__io.html#ga3f54c5916c6f6ddffec5d7120a230f46">soap_getline</a>(soap, buf, 256)) <span class="comment">// go to begin and skip custom header </span></div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga224b2c2b830135f12b53536f189b4ebd">SOAP_EOF</a>; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <span class="keyword">struct </span>ns__test r; </div><div class="line">  <span class="keyword">struct </span>ns__person p; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap);</div><div class="line">  p.name = <span class="stringliteral">&quot;John Doe&quot;</span>; </div><div class="line">  p.age = 99; </div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#ga9b4985eb5a588f4c16ad88ef7ca329dc">fopen</a> = myopen;   <span class="comment">// use custom open </span></div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#ga78d2b5440b33d3882b595ca8cfdec425">fpost</a> = mypost;   <span class="comment">// use custom post </span></div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#ga9cb05ce98f845f16c920c44426ac35a5">fparse</a> = myparse; <span class="comment">// use custom response parser </span></div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#gab9591dd80dbb0e571784bad5421b2202">fclose</a> = myclose; <span class="comment">// use custom close </span></div><div class="line">  soap_call_ns__test(&amp;soap, <span class="stringliteral">&quot;file://test.xml&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, p, r); </div><div class="line">  <span class="keywordflow">if</span> (soap.<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>) </div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stdout); </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">}</div></div><!-- fragment --><p>SOAP 1.1/1.2 RPC encoding specifies that SOAP/XML elements may be ignored when present in a SOAP payload on the receiving side. However, document/literal style messaging validates XML messages and extra elements cannot just be ignored as such. With SOAP document/literal style it is recommended to enable the <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> mode flag. With SOAP RPC encoding, the engine ignores XML elements that are unknown by default, unless the XML attribute <em><code>mustUnderstand="true"</code></em> is present in the XML element. It may be undesirable for elements to be ignored when the outcome of the omission is uncertain. The <code><a class="el" href="group__group__callbacks.html#ga0c2e1a0b5a5197128af1acc48662b1bd" title="Callback to catch unrecognized XML elements and overrides SOAP_XML_STRICT validation errors for these...">soap::fignore</a></code> callback can be set to a function that returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> in case the element can be safely ignored, or <code><a class="el" href="group__group__errors.html#ga6e6849f52e3641ffba443df668d55168" title="A soap_status error code: an XML element is present with a mustUnderstand attribute which must be und...">SOAP_MUSTUNDERSTAND</a></code> to throw an exception, or to perform some application-specific action. For example, to throw an exception as soon as an unknown element is encountered on the input, use:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">  soap-&gt;<a class="code" href="group__group__callbacks.html#ga0c2e1a0b5a5197128af1acc48662b1bd">fignore</a> = myignore; </div><div class="line">  ... <span class="comment">// soap_call_ns__webmethod(soap, ...) or soap_serve(soap) </span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> myignore(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag) </div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga6e6849f52e3641ffba443df668d55168">SOAP_MUSTUNDERSTAND</a>; <span class="comment">// never skip elements (secure) </span></div><div class="line">} </div></div><!-- fragment --><p>To selectively throw an exception when <em><code>mustUnderstand="true"</code></em> SOAP Header element is encountered or when an unknown element is encountered except for element <em><code>ns:xyz</code></em>, use:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">  soap-&gt;<a class="code" href="group__group__callbacks.html#ga0c2e1a0b5a5197128af1acc48662b1bd">fignore</a> = ignore; </div><div class="line">  ... <span class="comment">// soap_call_ns__webmethod(soap, ...) or soap_serve(soap) </span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ignore(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag) </div><div class="line">{</div><div class="line">  <span class="comment">// do not ignore mustUnderstand=&quot;true&quot; </span></div><div class="line">  <span class="keywordflow">if</span> (!soap-&gt;<a class="code" href="structsoap.html#a17c750f20dab579a6a23c30199ed1263">mustUnderstand</a>)</div><div class="line">  {</div><div class="line">    <span class="comment">// tags &lt;ns:someElement&gt; can be safely ignored</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__misc.html#ga91a35d2f67eeea8dc31fd23a3cea65d4">soap_match_tag</a>(soap, tag, <span class="stringliteral">&quot;ns:someElement&quot;</span>) == <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>)</div><div class="line">      <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga6e6849f52e3641ffba443df668d55168">SOAP_MUSTUNDERSTAND</a>; </div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_namespace.html">Namespace</a> namespaces[] = </div><div class="line">{</div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENV&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;SOAP-ENC&quot;</span>, <span class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsi&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;xsd&quot;</span>,      <span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> }, </div><div class="line">  { <span class="stringliteral">&quot;ns&quot;</span>,       <span class="stringliteral">&quot;some-URI&quot;</span>}, <span class="comment">// binds &quot;ns&quot; namespace prefix to schema URI</span></div><div class="line">  { NULL, NULL} </div><div class="line">];</div></div><!-- fragment --><p>Function <code><a class="el" href="group__group__misc.html#ga91a35d2f67eeea8dc31fd23a3cea65d4" title="Match an XML tag name. ">soap_match_tag</a></code> compares two tags. The third parameter may be a pattern where <code>*</code> is a wildcard and <code>-</code> is a single character wildcard. So for example <code>soap_match_tag(soap, tag, "ns:*")</code> will match any element in namespace <code>ns</code> or when no namespace prefix is present in the XML message.</p>
<p>The callback can also be used to keep track of unknown elements in an internal data structure such as a list:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Unknown </div><div class="line">{</div><div class="line">  <span class="keywordtype">char</span> *tag; </div><div class="line">  <span class="keyword">struct </span>Unknown *next; </div><div class="line">}; </div><div class="line"><span class="keywordtype">int</span> myignore(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag) </div><div class="line">{</div><div class="line">  <span class="keywordtype">char</span> *s = (<span class="keywordtype">char</span>*)<a class="code" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c">soap_malloc</a>(soap, strlen(tag)+1); </div><div class="line">  <span class="keyword">struct </span>Unknown *u = (<span class="keyword">struct </span>Unknown*)<a class="code" href="group__group__context.html#gaba556710e010feeb2211ed43b5bf059c">soap_malloc</a>(soap, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> Unknown)); </div><div class="line">  <span class="keywordflow">if</span> (s &amp;&amp; u) </div><div class="line">  {</div><div class="line">    strcpy(s, tag); </div><div class="line">    u-&gt;tag = s; </div><div class="line">    u-&gt;next = ulist; </div><div class="line">    ulist = u; </div><div class="line">  } </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>; </div><div class="line">  <span class="keyword">struct </span>Unknown *ulist = NULL; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  soap.<a class="code" href="group__group__callbacks.html#ga0c2e1a0b5a5197128af1acc48662b1bd">fignore</a> = myignore; </div><div class="line">  ... <span class="comment">// soap_call_ns__webmethod(soap, ...) or soap_serve(soap) </span></div><div class="line">  ... <span class="comment">// print the list of unknown elements stored in ulist</span></div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">}</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="http307"></a>
How to handle HTTP 307 temporary redirect</h2>
<p>The client-side handling of HTTP 307 code "Temporary Redirect" and any of the redirect codes 301, 302, and 303 are not automated. Client application developers may want to consider adding a few lines of code to support redirects. It was decided not to automatically support redirects for the following reasons:</p>
<ul>
<li>Redirecting a secure HTTPS address to a non-secure HTTP address via 307 creates a security vulnerability.</li>
<li>Cyclic redirects must be detected (e.g. allowing only a limited number of redirect levels).</li>
<li>Redirecting HTTP POST will result in re-serialization and re-post of the entire SOAP request. The SOAP request message must be re-posted in its entirety when re-issuing the SOAP operation to a new address.</li>
</ul>
<p>To implement client-side 307 redirect, add the following lines of code:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *endpoint = NULL; <span class="comment">// use default endpoint given in WSDL or specify one here</span></div><div class="line"><span class="keywordtype">int</span> redirects = 10;          <span class="comment">// max redirect count </span></div><div class="line"><span class="keywordflow">while</span> (redirects--) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns1__myMethod(soap, endpoint, ...)) </div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> ((soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> &gt;= 301 &amp;&amp; soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> &lt;= 303) || soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> == 307) </div><div class="line">    {</div><div class="line">      endpoint = <a class="code" href="group__group__context.html#ga41747ef145667bdff9c66cdd2bc86653">soap_strdup</a>(soap, soap-&gt;<a class="code" href="structsoap.html#aed1b86b8a34aea86103751a932c9dce9">endpoint</a>); <span class="comment">// endpoint from HTTP 301, 302, 303, 307 Location header </span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> </div><div class="line">    {</div><div class="line">      ... <span class="comment">// handle error </span></div><div class="line">      <span class="keywordflow">break</span>; </div><div class="line">    } </div><div class="line">  } </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">  {</div><div class="line">    <span class="keywordflow">break</span>; <span class="comment">// all OK now</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="get"></a>
How to implement HTTP GET, PUT, and PATCH services</h2>
<p>To implement HTTP GET request responses, define the <code><a class="el" href="group__group__callbacks.html#gae022204ff7004df2d5ac9e083cbb5b16" title="Callback to implement logic at the server-side to serve responses to HTTP GET requests from clients...">soap::fget</a></code> callback function. The callback is required to produce a response to the request in textual form, such as a Web page or an XML or JSON response.</p>
<p>You can also use the <code><a class="el" href="group__group__io.html#ga0ecdc43a53e494edc4f84e8c135659ba" title="The HTTP GET plugin registration function. ">http_get</a></code> plugin which essentially sets the <code><a class="el" href="group__group__callbacks.html#gae022204ff7004df2d5ac9e083cbb5b16" title="Callback to implement logic at the server-side to serve responses to HTTP GET requests from clients...">soap::fget</a></code> callback and also keeps track of the number of HTTP GET and POST requests made at the server side.</p>
<p>The following example produces a Web page upon a HTTP GET request (e.g. from a browser):</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">  soap-&gt;<a class="code" href="group__group__callbacks.html#gae022204ff7004df2d5ac9e083cbb5b16">fget</a> = <a class="code" href="group__group__io.html#ga0ecdc43a53e494edc4f84e8c135659ba">http_get</a>; </div><div class="line">  ... <span class="comment">//</span></div><div class="line">  <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(soap); </div><div class="line">  ... <span class="comment">//</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__group__io.html#ga0ecdc43a53e494edc4f84e8c135659ba">http_get</a>(<span class="keyword">struct</span> soap *soap) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga0390e58bd2a3ebe6fe3a46de0534a614">soap_response</a>(soap, <a class="code" href="group__group__io.html#ga17cdc287dd916e5d2b3467ccec177d5a">SOAP_HTML</a>) <span class="comment">// HTTP response header with text/html </span></div><div class="line">   || <a class="code" href="group__group__io.html#ga7712f5bc36127050a11ad995d0593bdc">soap_send</a>(soap, <span class="stringliteral">&quot;&lt;HTML&gt;My Web server is operational.&lt;/HTML&gt;&quot;</span>)</div><div class="line">   || <a class="code" href="group__group__io.html#ga290ddb46afdbf5ec6669b6ac8daca5c9">soap_end_send</a>(soap))</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga06d59094afa3df6b1b9f6b2bb484207c">soap_closesock</a>(soap);</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga06d59094afa3df6b1b9f6b2bb484207c">soap_closesock</a>(soap);</div><div class="line">}</div></div><!-- fragment --><p>The example below produces a WSDL file upon a HTTP GET with path <code>?wsdl</code>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__group__io.html#ga0ecdc43a53e494edc4f84e8c135659ba">http_get</a>(<span class="keyword">struct</span> soap *soap) </div><div class="line">{</div><div class="line">  FILE *fd = NULL;</div><div class="line">  <span class="keywordtype">char</span> *s = strchr(soap-&gt;<a class="code" href="structsoap.html#a3c2bd2822146a8ccca20f8f217c2f309">path</a>, <span class="charliteral">&#39;?&#39;</span>); </div><div class="line">  <span class="keywordflow">if</span> (!s || strcmp(s, <span class="stringliteral">&quot;?wsdl&quot;</span>)) </div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#gac62f5f70e545ea8fbcbb181e88750d56">SOAP_GET_METHOD</a>; </div><div class="line">  fd = <a class="code" href="group__group__callbacks.html#ga9b4985eb5a588f4c16ad88ef7ca329dc">fopen</a>(<span class="stringliteral">&quot;myservice.wsdl&quot;</span>, <span class="stringliteral">&quot;rb&quot;</span>); <span class="comment">// open WSDL file to copy </span></div><div class="line">  <span class="keywordflow">if</span> (!fd) </div><div class="line">    <span class="keywordflow">return</span> 404; <span class="comment">// return HTTP not found error </span></div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#ae5e98733a4349b5e1466a9e0ccc22c11">http_content</a> = <span class="stringliteral">&quot;text/xml&quot;</span>; <span class="comment">// HTTP header with text/xml content </span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga0390e58bd2a3ebe6fe3a46de0534a614">soap_response</a>(soap, <a class="code" href="group__group__io.html#ga05be99343f556fe70940145e874cdb99">SOAP_FILE</a>) == <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">while</span> (1)</div><div class="line">    {</div><div class="line">      <span class="keywordtype">size_t</span> r = fread(soap-&gt;<a class="code" href="structsoap.html#a194bcafed0c3e368b92f452fc80b2d31">tmpbuf</a>, 1, <span class="keyword">sizeof</span>(soap-&gt;<a class="code" href="structsoap.html#a194bcafed0c3e368b92f452fc80b2d31">tmpbuf</a>), fd); </div><div class="line">      <span class="keywordflow">if</span> (!r || <a class="code" href="group__group__io.html#gab3b1ba631a0c47d67fe31474982bde86">soap_send_raw</a>(soap, soap-&gt;<a class="code" href="structsoap.html#a194bcafed0c3e368b92f452fc80b2d31">tmpbuf</a>, r)) </div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    } </div><div class="line">  }</div><div class="line">  <a class="code" href="group__group__callbacks.html#gab9591dd80dbb0e571784bad5421b2202">fclose</a>(fd); </div><div class="line">  <a class="code" href="group__group__io.html#ga290ddb46afdbf5ec6669b6ac8daca5c9">soap_end_send</a>(soap);</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga06d59094afa3df6b1b9f6b2bb484207c">soap_closesock</a>(soap);</div><div class="line">}</div></div><!-- fragment --><p>This example shows how one predetermined file is served. The <em><code>gsoap/samples/webserver</code></em> demonstrates how files should be served in general, by adding the necessary logic to add media types to HTTP headers and to restrict the selection of files that should be served.</p>
<dl class="section warning"><dt>Warning</dt><dd>When serving files as responses to requests, we need to be vary careful, because we don't want requests to snoop around in directories and serve files that should be protected from public view. Therefore, when adding logic to serve files, we must reject request that have <code><a class="el" href="structsoap.html#a3c2bd2822146a8ccca20f8f217c2f309" title="The client request path as received on the server side. ">soap::path</a></code> values with a <code>/</code> or a <code>\</code> (<code><a class="el" href="structsoap.html#a3c2bd2822146a8ccca20f8f217c2f309" title="The client request path as received on the server side. ">soap::path</a></code> is a string with the path part of the URL, starting with a <code>/</code>). If these are allowed, then we must at least check for <code>..</code> in the path to avoid request from snooping around in higher directories all the way up to the root.</dd></dl>
<p>For a one-way SOAP/XML message, you can also return a SOAP/XML response:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__group__io.html#ga0ecdc43a53e494edc4f84e8c135659ba">http_get</a>(<span class="keyword">struct</span> soap *soap) </div><div class="line">{</div><div class="line">  <a class="code" href="group__group__io.html#ga0390e58bd2a3ebe6fe3a46de0534a614">soap_response</a>(soap, <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>); </div><div class="line">  <span class="keywordflow">return</span> soap_send_ns1__mySendMethodResponse(soap, <span class="stringliteral">&quot;&quot;</span>, NULL, ... params ...); </div><div class="line">} </div></div><!-- fragment --><p>where <code>ns1__mySendMethodResponse</code> is a one-way message declared in a interface header file as:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns1__mySendMethodResponse(... params ..., <span class="keywordtype">void</span>);</div></div><!-- fragment --><p>The generated <em><code>soapClient.cpp</code></em> includes the sending-side stub function.</p>
<p>The examples above are for HTTP GET. To implement HTTP PUT and PATCH set the <code><a class="el" href="group__group__callbacks.html#gaf263ffe14d8c2508ce4c734d4f33a854" title="Callback to implement logic at the server-side to serve responses to HTTP PUT requests from clients...">soap::fput</a></code> and <code><a class="el" href="group__group__callbacks.html#ga808a6a9b7e6d17e039fb53a5e8a9b84a" title="Callback to implement logic at the server-side to serve responses to HTTP PATCH requests from clients...">soap::fpatch</a></code> callback functions or use the <code><a class="el" href="group__group__io.html#ga4c08d5ef28bc0dc37eee4633acdd1140" title="The HTTP POST plugin registration function. ">http_post</a></code> plugin which is more capable.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="keepalive"></a>
TCP and HTTP keep-alive</h2>
<p>To activate HTTP keep-alive, set the <code><a class="el" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2" title="soap_mode IO input and output flag value to keep the socket connection alive for SOAP_MAXKEEPALIVE me...">SOAP_IO_KEEPALIVE</a></code> flag for both input and output modes, see Section <a class="el" href="index.html#flags">Run-time flags</a> . For example</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap soap; </div><div class="line"><a class="code" href="group__group__context.html#gac87126c3e45d2fda488e9832c2dd5be1">soap_init1</a>(&amp;soap, <a class="code" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2">SOAP_IO_KEEPALIVE</a>); </div></div><!-- fragment --><p>When a client or a service communicates with another client or service that supports keep alive, the <code><a class="el" href="structsoap.html#a3d93ba968bb58373f5884177a7ec0d83" title="HTTP keep-alive flag (try to enable when -1, disabled when 0) and counter (enabled when &gt;0) ...">soap::keep_alive</a></code> variable will be set to 1, otherwise it is reset to 0 indicating that the other party wants to close the connection. The connection maybe terminated on either end before the communication completed, for example when the server keep-alive connection has timed out. This may generate a "Broken Pipe" signal on Unix/Linux platforms. This signal can be caught with a signal handler:</p>
<div class="fragment"><div class="line">signal(SIGPIPE, sigpipe_handle);</div></div><!-- fragment --><p>where, for example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> sigpipe_handle(<span class="keywordtype">int</span> x) { }</div></div><!-- fragment --><p>Alternatively, broken pipes can be kept silent by setting:</p>
<div class="fragment"><div class="line">soap.<a class="code" href="structsoap.html#aae3eee771d8c4031d30d4ca7633edf9f">socket_flags</a> = MSG_NOSIGNAL;</div></div><!-- fragment --><p>This setting will not generate a SIGPIPE but read/write operations return <code><a class="el" href="group__group__errors.html#ga224b2c2b830135f12b53536f189b4ebd" title="A soap_status error code: unexpected end of file, no input, transmission interrupted or timed out (sa...">SOAP_EOF</a></code> instead. Note that Windows does not support signals and lack the <code>MSG_NOSIGNAL</code> flag.</p>
<p>If the client does not close the connection, the server will wait forever when no <code><a class="el" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388" title="User-definable timeout to receive a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::recv_timeout</a></code> is specified, so be careful to set timeouts, See Section <a class="el" href="index.html#timeout">Timeout management for non-blocking operations</a>. In addition, other clients will be denied service as long as a client keeps the connection to the server open. To prevent this from happening, the service should be multi-threaded such that each thread handles the client connection:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap, *tsoap; </div><div class="line">  <a class="code" href="group__group__threads.html#ga53ca774b0fc84afe282a5419d2d7239a">THREAD_TYPE</a> tid; </div><div class="line">  <span class="keywordtype">int</span> m, s; </div><div class="line">  <a class="code" href="group__group__context.html#ga3c70b587fc4f65553cfe69751d1a157e">soap_init2</a>(&amp;soap, <a class="code" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2">SOAP_IO_KEEPALIVE</a>, <a class="code" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2">SOAP_IO_KEEPALIVE</a>); </div><div class="line">  soap.<a class="code" href="structsoap.html#a1d7aca6ac1d62302102c17508a8b0ec0">max_keep_alive</a> = 100; <span class="comment">// at most 100 calls per keep-alive session </span></div><div class="line">  soap.<a class="code" href="structsoap.html#a78199a81c504833047224a0ceff6f906">accept_timeout</a> = 600; <span class="comment">// optional: let server time out after ten minutes of inactivity </span></div><div class="line">  m = <a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(&amp;soap, NULL, 18000, BACKLOG); <span class="comment">// use port 18000 on the current machine </span></div><div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(m)) </div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;Socket connection successful %d\n&quot;</span>, m); </div><div class="line">  <span class="keywordflow">for</span> (<a class="code" href="structsoap.html#a407dae4bc84d0e7b809d51a3b8798e0c">count</a> = 0; <a class="code" href="structsoap.html#a407dae4bc84d0e7b809d51a3b8798e0c">count</a> &gt;= 0; <a class="code" href="structsoap.html#a407dae4bc84d0e7b809d51a3b8798e0c">count</a>++) </div><div class="line">  {</div><div class="line">    soap.<a class="code" href="structsoap.html#aae3eee771d8c4031d30d4ca7633edf9f">socket_flags</a> = MSG_NOSIGNAL; <span class="comment">// use this </span></div><div class="line">    soap.<a class="code" href="structsoap.html#ad98f12f602efdde049dbd367a43e7cb0">accept_flags</a> = SO_NOSIGPIPE; <span class="comment">// or this to prevent SIGPIPE </span></div><div class="line">    s = <a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(&amp;soap); </div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(s)) </div><div class="line">    {</div><div class="line">      fprintf(stderr, <span class="stringliteral">&quot;Accept socket %d connection from IP %d.%d.%d.%d\n&quot;</span>, s, (<span class="keywordtype">int</span>)(soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;24)&amp;0xFF, (<span class="keywordtype">int</span>)(soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;16)&amp;0xFF, (<span class="keywordtype">int</span>)(soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&gt;&gt;8)&amp;0xFF, (<span class="keywordtype">int</span>)soap.<a class="code" href="structsoap.html#a4565a0ad4ea08ada721155ded8e8036f">ip</a>&amp;0xFF); </div><div class="line">      tsoap = <a class="code" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a">soap_copy</a>(&amp;soap); </div><div class="line">      <span class="keywordflow">if</span> (!tsoap)</div><div class="line">        <a class="code" href="group__group__io.html#ga0ca0c64dc76af8617956a62cf117db94">soap_force_closesock</a>(&amp;soap);</div><div class="line">      <span class="keywordflow">else</span></div><div class="line">        <span class="keywordflow">while</span> (<a class="code" href="group__group__threads.html#gabee88cce937a2709b4799ed8df36d486">THREAD_CREATE</a>(&amp;tid, (<span class="keywordtype">void</span>*(*)(<span class="keywordtype">void</span>*))process_request, (<span class="keywordtype">void</span>*)tsoap))</div><div class="line">          sleep(1); <span class="comment">// failed, try again</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (soap.<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a>) <span class="comment">// accept failed, try again after 1 second</span></div><div class="line">    {</div><div class="line">      <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">      sleep(1);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">      fprintf(stderr, <span class="stringliteral">&quot;Server timed out\n&quot;</span>);</div><div class="line">      <span class="keywordflow">break</span>; </div><div class="line">    } </div><div class="line">  } </div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> *process_request(<span class="keywordtype">void</span> *tsoap) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>*soap = (<span class="keyword">struct </span>soap*)tsoap;</div><div class="line">  <a class="code" href="group__group__threads.html#ga5848fc7adb50b3a15e40955dce7f8f53">THREAD_DETACH</a>(<a class="code" href="group__group__threads.html#ga9ab5a77b8cf2b98f7d6c1b48bb421f69">THREAD_ID</a>); </div><div class="line">  ((<span class="keyword">struct </span>soap*)soap)-&gt;recv_timeout = 60; <span class="comment">// Timeout after 1 minute stall on recv </span></div><div class="line">  ((<span class="keyword">struct </span>soap*)soap)-&gt;send_timeout = 10; <span class="comment">// Timeout after 10 second stall on send </span></div><div class="line">  <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(soap); </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap); </div><div class="line">  <span class="keywordflow">return</span> NULL; </div><div class="line">}</div></div><!-- fragment --><p>A client call will automatically attempt to re-establish a connection to a server when the server has terminated the connection for any reason. This way, a sequence of calls can be made to the server while keeping the connection open. Client stub functions poll the server to check if the connection is still open. When the connection was terminated by the server, the client will automatically reconnect.</p>
<p>A client may clear the <code><a class="el" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2" title="soap_mode IO input and output flag value to keep the socket connection alive for SOAP_MAXKEEPALIVE me...">SOAP_IO_KEEPALIVE</a></code> flag just before the last call to a server to let the server know it wants to close the connection after this last call. This will close the socket after the call and also informs the server to gracefully close the connection.</p>
<p>The client-side can also set the TCP keep-alive socket properties, using the <code><a class="el" href="structsoap.html#af8f80a7bd8c09335c6fb836a612231bb" title="User-definable value to set SO_KEEPALIVE setsockopt (0 by default unless the SOAP_IO_KEEPALIVE mode f...">soap::tcp_keep_alive</a></code> flag (set to 1 to enable), <code><a class="el" href="structsoap.html#a8c0822cb0399ed55de6c2a482171868f" title="User-definable value to set TCP_KEEPIDLE setsockopt (the value is 0 by default) ">soap::tcp_keep_idle</a></code> to set the <code>TCP_KEEPIDLE</code> value, <code><a class="el" href="structsoap.html#a822aba3e7ae74fa86277c683569f80ae" title="User-definable value to set TCP_KEEPINTVL setsockopt (the value is 0 by default) ">soap::tcp_keep_intvl</a></code> to set the <code>TCP_KEEPINTVL</code> value, and <code><a class="el" href="structsoap.html#a811041faab1cf481e7e656f81dc88901" title="User-definable value to set TCP_KEEPCNT setsockopt (the value is 0 by default) ">soap::tcp_keep_cnt</a></code> to set the <code>TCP_KEEPCNT</code> value.</p>
<p>If a client is in the middle of soap call that might take a long time and the server goes away/down the caller does not get any feedback until the <code><a class="el" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388" title="User-definable timeout to receive a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::recv_timeout</a></code> is reached. Enabling TCP keep alive on systems that support it allows for a faster connection teardown detection for applications that need it.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="chunked"></a>
HTTP chunked transfer encoding</h2>
<p>Outbound HTTP messages are not chunked unless the <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> flag is enabled. Chunking may improve the speed of message sending with HTTP, because the message length does not need to be determined in advance for the HTTP content length header.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="buffered"></a>
HTTP buffered sends</h2>
<p>The entire outbound message can be stored in a buffer to determine the HTTP content length rather than the two-phase encoding used by gSOAP client-side stub functions and server-side skeleton functions generated by soapcpp2, which perform a separate pass over the data to determine the length of the outbound message. Setting the flag <code><a class="el" href="group__group__flags.html#gaf7cbb692f85f8633c4efc66dfae41e9e" title="soap_mode IO output flag value to store messages temporarily before transmission, e...">SOAP_IO_STORE</a></code> for the output mode will buffer the entire message. This may or may not speed up the transmission of messages, depending on the content, but may require significant storage space to hold large messages temporarily.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="authentication"></a>
HTTP authentication</h2>
<p>The following sections explain how to authenticate with HTTP bearer, basic, digest, and NTLM. Proxy authentication is also covered.</p>
<p>You could also use the WinInet plugin available in the <em><code>gsoap/mod_gsoap</code></em> directory of the gSOAP source code package to simplify Internet access for gSOAP client applications and deal with encryption, proxies, and authentication, see the gSOAP <a href="../../wininet/html/index.html">WinInet plugin</a> documentation.</p>
<p>The gSOAP CURL plugin can also be used to develop gSOAP client applications and CURL implements various HTTP authentication methods, see the gSOAP <a href="../../curl/html/index.html">CURL plugin</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="bearerauthentication"></a>
HTTP bearer authentication</h3>
<p>HTTP bearer authentication is enabled at the client-side by setting the <code><a class="el" href="structsoap.html#a5213a5328b44244689fd3c2937cc8b92" title="User-definable HTTP authorization bearer token value to be sent by the client, server side receives t...">soap::bearer</a></code> string to the bearer token:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a5213a5328b44244689fd3c2937cc8b92">bearer</a> = <span class="stringliteral">&quot;...&quot;</span>; </div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, ...))</div><div class="line">  ... <span class="comment">// error</span></div><div class="line"><span class="keywordflow">else</span></div><div class="line">  ... <span class="comment">// OK</span></div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="basicauthentication"></a>
HTTP basic authentication</h3>
<p>HTTP basic authentication is enabled at the client-side by setting the <code>const char* <a class="el" href="structsoap.html#a2ede02095d98942f4c220fd17b495703" title="User-definable HTTP and NTLM authorization user id string for HTTP basic and NTLM authentication by t...">soap::userid</a></code> and <code>const char* <a class="el" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3" title="User-definable HTTP and NTLM authorization password string required for HTTP basic and NTLM authentic...">soap::passwd</a></code> strings to a username and password, respectively. A server may request user authentication and denies access (HTTP 401 error) when the client tries to connect without HTTP authentication (or with the wrong authentication information).</p>
<p>Basic authentication should only be used over HTTPS, because the credentials are sent in the clear with HTTP. See Section <a class="el" href="index.html#httpdaplugin">The HTTP digest authentication plugin</a> to use the HTTP digest plugin that is safe for authentication over HTTP.</p>
<p>Here is an example client code fragment to set the HTTP authentication username and password:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a2ede02095d98942f4c220fd17b495703">userid</a> = <span class="stringliteral">&quot;guest&quot;</span>; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3">passwd</a> = <span class="stringliteral">&quot;visit&quot;</span>; </div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, ...))</div><div class="line">  ... <span class="comment">// error</span></div><div class="line"><span class="keywordflow">else</span></div><div class="line">  ... <span class="comment">// success</span></div></div><!-- fragment --><p>A client SOAP request will have the following HTTP header: </p><pre class="fragment">POST /XXX HTTP/1.1 
Host: YYY 
User-Agent: gSOAP/2.8 
Content-Type: text/xml; charset=utf-8 
Content-Length: ZZZ 
Authorization: Basic Z3Vlc3Q6Z3Vlc3Q= 
</pre><p>A client must set the <code>const char* <a class="el" href="structsoap.html#a2ede02095d98942f4c220fd17b495703" title="User-definable HTTP and NTLM authorization user id string for HTTP basic and NTLM authentication by t...">soap::userid</a></code> and <code>const char* <a class="el" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3" title="User-definable HTTP and NTLM authorization password string required for HTTP basic and NTLM authentic...">soap::passwd</a></code> strings for each call that requires client authentication. The strings are reset after each successful or unsuccessful call.</p>
<p>When present, the <code>WWW-Authenticate</code> HTTP header returned by the server with the authentication realm is stored in the the <code><a class="el" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd" title="The HTTP and NTLM authorization realm/domain string received by the client with the WWW-Authenticate ...">soap::authrealm</a></code> string. This is useful for clients to use this domain information to respond to authentication requests.</p>
<p>A stand-alone gSOAP Web Service application can enforce HTTP authentication on clients by checking the <code>const char* <a class="el" href="structsoap.html#a2ede02095d98942f4c220fd17b495703" title="User-definable HTTP and NTLM authorization user id string for HTTP basic and NTLM authentication by t...">soap::userid</a></code> and <code>const char* <a class="el" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3" title="User-definable HTTP and NTLM authorization password string required for HTTP basic and NTLM authentic...">soap::passwd</a></code> strings. These strings are set when a client request contains HTTP authentication headers. The strings should be checked in each service method (that requires authentication to execute).</p>
<p>Here is an example service method implementation that enforced client authentication:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keyword">struct</span> soap *soap, ...) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (!soap-&gt;<a class="code" href="structsoap.html#a2ede02095d98942f4c220fd17b495703">userid</a></div><div class="line">   || !soap-&gt;<a class="code" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3">passwd</a></div><div class="line">   || strcmp(soap-&gt;<a class="code" href="structsoap.html#a2ede02095d98942f4c220fd17b495703">userid</a>, <span class="stringliteral">&quot;guest&quot;</span>)</div><div class="line">   || strcmp(soap-&gt;<a class="code" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3">passwd</a>, <span class="stringliteral">&quot;visit&quot;</span>)) </div><div class="line">  {</div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd">authrealm</a> = <span class="stringliteral">&quot;...&quot;</span>; <span class="comment">// domain realm accessed (optional, NULL to omit)</span></div><div class="line">    <span class="keywordflow">return</span> 401; </div><div class="line">  }</div><div class="line">  ... <span class="comment">// webmethod logic</span></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>;</div><div class="line">}</div></div><!-- fragment --><p>When the authentication fails, the service response with a SOAP Fault message and a HTTP error code "401 Unauthorized". The HTTP error codes are described in Section <a class="el" href="index.html#errcodes">Run-time error codes</a> .</p>
<p>To return a non-SOAP error, use:</p>
<div class="fragment"><div class="line"><span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga6ac5e550072a59c8b6d432b63cc3543a">soap_send_empty_response</a>(soap, 401); </div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="NTLMauthentication"></a>
HTTP NTLM authentication</h3>
<p>HTTP NTLM authentication is enabled at the client-side by installing <code>libntlm</code> from <a href="http://www.nongnu.org/libntlm">http://www.nongnu.org/libntlm</a> and compiling all project source codes with the compile-time flag <code><a class="el" href="group__group__with.html#ga4a743d1499292194cfc81d305500c83f" title="When this macro is defined at compile time (undefined by default), enables linkage with the ntlm libr...">WITH_NTLM</a></code>.</p>
<p>In your application code set the <code>const char* <a class="el" href="structsoap.html#a2ede02095d98942f4c220fd17b495703" title="User-definable HTTP and NTLM authorization user id string for HTTP basic and NTLM authentication by t...">soap::userid</a></code> and <code>const char* <a class="el" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3" title="User-definable HTTP and NTLM authorization password string required for HTTP basic and NTLM authentic...">soap::passwd</a></code> strings to a username and password. A server may request NTLM authentication and denies access (HTTP 401 authentication required or HTTP 407 HTTP proxy authentication required) when the client tries to connect without HTTP authentication (or with the wrong authentication information).</p>
<p>Here is an example client code fragment to set the NTLM authentication username and password:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2">SOAP_IO_KEEPALIVE</a>); </div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, ...)) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> == 401) </div><div class="line">  {</div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#a2ede02095d98942f4c220fd17b495703">userid</a> = <span class="stringliteral">&quot;Zaphod&quot;</span>; </div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3">passwd</a> = <span class="stringliteral">&quot;Beeblebrox&quot;</span>; </div><div class="line">    <span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, ...)) </div><div class="line">      ... <span class="comment">// error</span></div><div class="line">    <span class="keywordflow">else</span></div><div class="line">      ... <span class="comment">// success</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>The following NTLM handshake between the client C and server S is performed: </p><pre class="fragment">1: C  --&gt; S &amp; POST ... 
            &amp; Content-Type: text/xml; charset=utf-8 

2: C &lt;--  S &amp; 401 Unauthorized 
            &amp; WWW-Authenticate: NTLM 

3: C  --&gt; S &amp; GET ... 
            &amp; Authorization: NTLM &lt;base64-encoded type-1-message&gt; 

4: C &lt;--  S &amp; 401 Unauthorized 
            &amp; WWW-Authenticate: NTLM &lt;base64-encoded type-2-message&gt; 

5: C  --&gt; S &amp; POST ... 
            &amp; Content-Type: text/xml; charset=utf-8 
            &amp; Authorization: NTLM &lt;base64-encoded type-3-message&gt; 

6: C &lt;--  S &amp; 200 OK
</pre><p>where stages 1 and 2 indicates a client attempting to connect without authorization information, which is the first method call in the code above. Stage 3 to 6 happen with the proper client authentication set with <code>const char* <a class="el" href="structsoap.html#a2ede02095d98942f4c220fd17b495703" title="User-definable HTTP and NTLM authorization user id string for HTTP basic and NTLM authentication by t...">soap::userid</a></code> and <code>const char* <a class="el" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3" title="User-definable HTTP and NTLM authorization password string required for HTTP basic and NTLM authentic...">soap::passwd</a></code>. Optionally, the <code>const char* <a class="el" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd" title="The HTTP and NTLM authorization realm/domain string received by the client with the WWW-Authenticate ...">soap::authrealm</a></code> string should be set as well to indicate the domain accessed (this string is normally set when the server responds with HTTP 401 so the client receives this server domain information). NTLM authenticates connections, not requests. When the connection is kept alive, subsequent messages can be exchanged without re-authentication.</p>
<p>To avoid the overhead of the first rejected call, use:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2">SOAP_IO_KEEPALIVE</a>); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#af2c9e77616c132831ebf041d9e4d18b1">ntlm_challenge</a> = <span class="stringliteral">&quot;&quot;</span>; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a2ede02095d98942f4c220fd17b495703">userid</a> = <span class="stringliteral">&quot;Zaphod&quot;</span>; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3">passwd</a> = <span class="stringliteral">&quot;Beeblebrox&quot;</span>; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd">authrealm</a> = <span class="stringliteral">&quot;Ursa-Minor&quot;</span>; </div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, ...)) </div><div class="line">  ... <span class="comment">// error</span></div><div class="line"><span class="keywordflow">else</span></div><div class="line">  ... <span class="comment">// success</span></div></div><!-- fragment --><p>When the authentication fails (stage 1 and 2), the service response with HTTP error code "401 Unauthorized" and <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code> is set to HTTP code 401.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="NTLMproxyauthentication"></a>
HTTP proxy NTLM authentication</h3>
<p>For HTTP 407 Proxy Authentication Required set the <code><a class="el" href="structsoap.html#a7e7e9e9d65bba6237298cf2ed7cec599" title="User-definable proxy authorization user id string to authenticate and connect to an HTTP proxy...">soap::proxy_userid</a></code> and <code><a class="el" href="structsoap.html#ad75a4abe119a1a74a26d06401fa11c3a" title="User-definable proxy authorization password string to authenticate and connect to an HTTP proxy...">soap::proxy_passwd</a></code>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2">SOAP_IO_KEEPALIVE</a>); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac172bd9019afeebb3635b3a9f72a9101">proxy_host</a> = <span class="stringliteral">&quot;...&quot;</span>; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a037554fd2cf54fb9a6d5326b11c8ffa0">proxy_port</a> = ...; </div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, ...)) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> == 407) </div><div class="line">  {</div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#a7e7e9e9d65bba6237298cf2ed7cec599">proxy_userid</a> = <span class="stringliteral">&quot;Zaphod&quot;</span>; </div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#ad75a4abe119a1a74a26d06401fa11c3a">proxy_passwd</a> = <span class="stringliteral">&quot;Beeblebrox&quot;</span>; </div><div class="line">    soap-&gt;<a class="code" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd">authrealm</a> = <span class="stringliteral">&quot;Ursa-Minor&quot;</span>; </div><div class="line">    <span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, ...)) </div><div class="line">      ... <span class="comment">// error</span></div><div class="line">    <span class="keywordflow">else</span></div><div class="line">      ... <span class="comment">// success</span></div></div><!-- fragment --><p>To avoid the overhead of the first rejected call, use:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga51cde138234ed7ec8c4e25bdf6418658">soap_new1</a>(<a class="code" href="group__group__flags.html#ga0a4635737732c912058ff4dba668c1b2">SOAP_IO_KEEPALIVE</a>); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac172bd9019afeebb3635b3a9f72a9101">proxy_host</a> = <span class="stringliteral">&quot;...&quot;</span>; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a037554fd2cf54fb9a6d5326b11c8ffa0">proxy_port</a> = ...; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a7e7e9e9d65bba6237298cf2ed7cec599">proxy_userid</a> = <span class="stringliteral">&quot;Zaphod&quot;</span>; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ad75a4abe119a1a74a26d06401fa11c3a">proxy_passwd</a> = <span class="stringliteral">&quot;Beeblebrox&quot;</span>; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd">authrealm</a> = <span class="stringliteral">&quot;Ursa-Minor&quot;</span>; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#af2c9e77616c132831ebf041d9e4d18b1">ntlm_challenge</a> = <span class="stringliteral">&quot;&quot;</span>; </div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, ...)) </div><div class="line">  ... <span class="comment">// error</span></div><div class="line"><span class="keywordflow">else</span></div><div class="line">  ... <span class="comment">// success</span></div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="proxyauthentication"></a>
HTTP proxy basic authentication</h3>
<p>HTTP proxy authentication (basic) is enabled at the client-side by setting the <code><a class="el" href="structsoap.html#a7e7e9e9d65bba6237298cf2ed7cec599" title="User-definable proxy authorization user id string to authenticate and connect to an HTTP proxy...">soap::proxy_userid</a></code> and <code><a class="el" href="structsoap.html#ad75a4abe119a1a74a26d06401fa11c3a" title="User-definable proxy authorization password string to authenticate and connect to an HTTP proxy...">soap::proxy_passwd</a></code> strings to a username and password, respectively. For example, a proxy server may request user authentication. Otherwise, access is denied by the proxy (HTTP 407 error). Example client code fragment to set proxy server, username, and password:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac172bd9019afeebb3635b3a9f72a9101">proxy_host</a> = <span class="stringliteral">&quot;xx.xx.xx.xx&quot;</span>; <span class="comment">// IP or domain </span></div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a037554fd2cf54fb9a6d5326b11c8ffa0">proxy_port</a> = 8080; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a7e7e9e9d65bba6237298cf2ed7cec599">proxy_userid</a> = <span class="stringliteral">&quot;guest&quot;</span>; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ad75a4abe119a1a74a26d06401fa11c3a">proxy_passwd</a> = <span class="stringliteral">&quot;guest&quot;</span>; </div></div><!-- fragment --><p>A client SOAP request will have the following HTTP header: </p><pre class="fragment">POST /XXX HTTP/1.1 
Host: YYY 
User-Agent: gSOAP/2.8 
Content-Type: text/xml; charset=utf-8 
Content-Length: ZZZ 
Proxy-Authorization: Basic Z3Vlc3Q6Z3Vlc3Q= 
</pre><p>When X-Forwarded-For headers are returned by the proxy, the header can be accessed in the <code><a class="el" href="structsoap.html#a59b7a3c700fd54ba1708f97c7b60876b" title="The X-Forwarding-For HTTP header string value received. ">soap::proxy_from</a></code> string.</p>
<p>The CONNECT method is used for HTTP proxy authentication: </p><pre class="fragment">CONNECT server.example.com:80 HTTP/1.1
</pre><p>In some cases, you will notice that the Host HTTP header uses the CONNECT protocol: </p><pre class="fragment">CONNECT server.example.com:80 HTTP/1.1 
Host: server.example.com:80
</pre><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="tips"></a>
Performance improvement tips</h2>
<p>Here are some tips you can use to speed up gSOAP. The default settings are chosen to maximize portability and compatibility. The settings can be tweaked to optimize the performance as follows:</p>
<ul>
<li>Increase the buffer size <code><a class="el" href="group__group__soap.html#ga6ec95d997cc20a6a84dd4d76b3ea2fcc" title="User-definable size of the input and output message buffer soap::buf (the value is 65536 by default) ...">SOAP_BUFLEN</a></code> by changing the <code><a class="el" href="group__group__soap.html#ga6ec95d997cc20a6a84dd4d76b3ea2fcc" title="User-definable size of the input and output message buffer soap::buf (the value is 65536 by default) ...">SOAP_BUFLEN</a></code> macro in <em><code>gsoap/stdsoap2.h</code></em>. Use buffer size 2^18=262144 for example.</li>
<li>Use HTTP keep-alive at the client-side, see Section <a class="el" href="index.html#keepalive">TCP and HTTP keep-alive</a> , when the client needs to make a series of calls to the same server. Server-side keep-alive support can greatly improve performance of both client and server. But be aware that clients and services under Unix/Linux require signal handlers to catch dropped connections.</li>
<li>Use HTTP chunked transfers, see Section <a class="el" href="index.html#chunked">HTTP chunked transfer encoding</a> .</li>
<li>Do not use gzip compression, since the overhead of compression is typically higher than the bandwidth gains.</li>
<li>Set the <code><a class="el" href="group__group__flags.html#gaa631be9579f581f96ea5ecf91b837493" title="soap_mode XML input/output flag value to serialize C/C++ data structures as XML trees without id-href...">SOAP_XML_TREE</a></code> flag to disable id-ref multi-ref object serialization. This boosts performance significantly and works with SOAP document/literal style (i.e. no id-ref graph serialization as required with SOAP encoding style). Do not use this for SOAP RPC encoded messaging.</li>
<li>Compile <em><code>gsoap/stdsoap2.c</code></em> and <em><code>gsoap/stdsoap2.cpp</code></em> and all other source codes with the compile time flag <code><a class="el" href="group__group__with.html#gaea95327865324f1aba294f3ae5d13dd4" title="When this macro is defined at compile time (undefined by default), permanently disables XML ID (id at...">WITH_NOIDREF</a></code> to improve performance even better by permanently disabling id-ref multi-ref object serialization. Do not use this for SOAP RPC encoded messaging.</li>
<li>Do not use DEBUG mode, since the overhead of logging is significant.</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="safety"></a>
Safety guards</h2>
<p>The following settings are important to ensure that XML messaging is safe by defining reasonable XML message restrictions. Also messaging timeouts should be set as explained in Section <a class="el" href="index.html#timeout">Timeout management for non-blocking operations</a>.</p>
<p>The XML parser is configured to restrict the XML nesting depth level to <code><a class="el" href="group__group__soap.html#ga2ad35599c611417132d6b0a9b6870652" title="User-definable maximum XML nesting depth level permitted by the XML parser, must be greater than zero...">SOAP_MAXLEVEL</a></code> and restricts the repeated occurrence of elements that are deserialized into arrays and containers by <code><a class="el" href="group__group__soap.html#ga3933a58d23a5bf2ad64039725cb23786" title="User-definable maximum number of array or container elements for containers that are not already cons...">SOAP_MAXOCCURS</a></code>. These macros can be changed, but you can also change the following context attributes at run-time, e.g. to enhance the safety for specific service and/or client operations:</p>
<ul>
<li><code><a class="el" href="structsoap.html#a80dbe084f7efe713ac93e6e6a2d30d7f" title="User-definable maximum XML and JSON nesting level permitted, initially set to SOAP_MAXLEVEL (the valu...">soap::maxlevel</a></code> restricts the XML nesting depth level, where the default value is <code><a class="el" href="group__group__soap.html#ga2ad35599c611417132d6b0a9b6870652" title="User-definable maximum XML nesting depth level permitted by the XML parser, must be greater than zero...">SOAP_MAXLEVEL</a></code> = 10000.</li>
<li><code><a class="el" href="structsoap.html#a00bc20ad1100f580a173ba651e05bcb9" title="User-definable maximum array and container size (maximum item occurrence constraint) as parsed from X...">soap::maxoccurs</a></code> restricts the number of repeated occurrences of elements that are deserialized into arrays and structs, where the default value is <code><a class="el" href="group__group__soap.html#ga3933a58d23a5bf2ad64039725cb23786" title="User-definable maximum number of array or container elements for containers that are not already cons...">SOAP_MAXOCCURS</a></code> = 100000.</li>
<li><code><a class="el" href="structsoap.html#aa5d564f947cbd74c29124972823fe775" title="User-definable maximum string length parsed from XML and JSON, initially set to SOAP_MAXLENGTH, zero or negative means unlimited (0 by default) ">soap::maxlength</a></code> restricts the length of strings deserialized from XML. A zero or negative value is unrestricted length. When restricted, the XML schema validation maxLength takes precedence over this length restriction. So setting a smaller value will not interfere with the XML validation rules. The default value is <code><a class="el" href="group__group__soap.html#gabd0dd334a752d8c145fa720deb905508" title="User-definable maximum string content length for strings not already constrained by XML schema valida...">SOAP_MAXLENGTH</a></code> = 0. Note that string length is expressed in number of characters, not bytes. So UTF-8 encodings are not truncated.</li>
<li><code><a class="el" href="structsoap.html#a345900c2db67e915ceb02bfa21ecbcbd" title="User-definable maximum message length that is permitted to be received, zero means unlimited (the val...">soap::recv_maxlength</a></code> the maximum length of messages received, 2GB by default.</li>
</ul>
<p>XML schema validation constraints are enforced with the <code><a class="el" href="group__group__flags.html#ga5faa29a69a247642495846d69ec8b90d" title="soap_mode XML input flag value to enable strict XML validation of messages received ...">SOAP_XML_STRICT</a></code> context flag. The schema maxLength validation constraint overrules the <code><a class="el" href="structsoap.html#aa5d564f947cbd74c29124972823fe775" title="User-definable maximum string length parsed from XML and JSON, initially set to SOAP_MAXLENGTH, zero or negative means unlimited (0 by default) ">soap::maxlength</a></code> guard. The schema maxOccurs validation constraint does not overrule the <code><a class="el" href="structsoap.html#a00bc20ad1100f580a173ba651e05bcb9" title="User-definable maximum array and container size (maximum item occurrence constraint) as parsed from X...">soap::maxoccurs</a></code> guard, so arrays and containers are always restricted in length by this guard.</p>
<p>Other compile-time configuration settings are:</p>
<ul>
<li><code><a class="el" href="group__group__soap.html#gafd23342e94173d223a24814545babdaf" title="User-definable maximum size of a block of memory that malloc can allocate or 0 for no limit (the valu...">SOAP_MAXALLOCSIZE</a></code> the maximum size of a block of memory that <code>malloc</code> can allocate.</li>
<li><code><a class="el" href="group__group__soap.html#ga29a7dab5c96c2724b3c234505d52c76e" title="User-definable macro to protect excessive SOAP array allocation requests by defining a maximum alloca...">SOAP_MAXARRAYSIZE</a></code> the maximum allocation threshold to pre-allocate SOAP arrays in memory.</li>
<li><code><a class="el" href="group__group__soap.html#gad4c2ca8c2293fc75075aec4a09f4dc38" title="User-definable maximum length of DIME attachments received (the value is 8 MB by default) ...">SOAP_MAXDIMESIZE</a></code> the maximum DIME attachment size allowed to receive.</li>
<li><code><a class="el" href="group__group__soap.html#ga59f0c79e1cd2a135f74351bf9f8c17a6" title="User-definable maximum number of EINTR interrupts to ignore while polling a socket for pending activi...">SOAP_MAXEINTR</a></code> maximum number of EINTR interrupts to ignore while polling a socket for pending activity.</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="timeout"></a>
Timeout management for non-blocking operations</h2>
<p>Socket connect, accept, send, and receive timeout values can be set to manage socket communication timeouts. The <code><a class="el" href="structsoap.html#af32b5f3975eac2bd1202571515859163" title="User-definable timeout when waiting to connect to a server at the client-side, positive timeout value...">soap::connect_timeout</a></code>, <code><a class="el" href="structsoap.html#a78199a81c504833047224a0ceff6f906" title="User-definable timeout when waiting to accept a request from a client at the server-side with soap_ac...">soap::accept_timeout</a></code>, <code><a class="el" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474" title="User-definable timeout to send a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::send_timeout</a></code>, <code><a class="el" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388" title="User-definable timeout to receive a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::recv_timeout</a></code> and <code><a class="el" href="structsoap.html#afcf1d236d052579122f785d7639c43c7" title="User-definable timeout to send or receive an entire message, positive timeout values are seconds...">soap::transfer_timeout</a></code> context attributes of the current context <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> can be set to the appropriate user-defined socket send, receive, and accept timeout values. A positive value measures the timeout in seconds. A negative timeout value measures the timeout in microseconds (10^-6 sec).</p>
<p>The <code><a class="el" href="structsoap.html#af32b5f3975eac2bd1202571515859163" title="User-definable timeout when waiting to connect to a server at the client-side, positive timeout value...">soap::connect_timeout</a></code> specifies the timeout for <code>soap_call_ns__webmethod</code> stub function calls and for C++ proxy class calls.</p>
<p>The <code><a class="el" href="structsoap.html#a78199a81c504833047224a0ceff6f906" title="User-definable timeout when waiting to accept a request from a client at the server-side with soap_ac...">soap::accept_timeout</a></code> specifies the timeout for <code><a class="el" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6" title="Accept a connection with a client. ">soap_accept</a></code> calls.</p>
<p>The <code><a class="el" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474" title="User-definable timeout to send a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::send_timeout</a></code> and <code><a class="el" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388" title="User-definable timeout to receive a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::recv_timeout</a></code> specify the timeout for non-blocking socket I/O operations. This is the maximum delay on the socket operation permitted.</p>
<p>The <code><a class="el" href="structsoap.html#afcf1d236d052579122f785d7639c43c7" title="User-definable timeout to send or receive an entire message, positive timeout values are seconds...">soap::transfer_timeout</a></code> is new since 2.8.48 and limits the time a message send and a message receive operation can take. This value should be used in combination with <code><a class="el" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474" title="User-definable timeout to send a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::send_timeout</a></code> and <code><a class="el" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388" title="User-definable timeout to receive a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::recv_timeout</a></code> for accurate timeout control. The <code><a class="el" href="structsoap.html#a345900c2db67e915ceb02bfa21ecbcbd" title="User-definable maximum message length that is permitted to be received, zero means unlimited (the val...">soap::recv_maxlength</a></code> value when non-zero limits the length of messages that can be received in bytes in total in decompressed form (message length includes HTTP headers and HTTP chunk size fields). The value of <code><a class="el" href="structsoap.html#a345900c2db67e915ceb02bfa21ecbcbd" title="User-definable maximum message length that is permitted to be received, zero means unlimited (the val...">soap::recv_maxlength</a></code> is 2GB by default.</p>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474">send_timeout</a> = 10; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388">recv_timeout</a> = 10; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388">recv_timeout</a> = 60; </div></div><!-- fragment --><p>This will result in a timeout if no data can be send in 10 seconds and no data is received within 10 seconds after initiating a send or receive operation over the socket. A value of zero disables timeout, for example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474">send_timeout</a> = 0; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388">recv_timeout</a> = 0;  </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388">recv_timeout</a> = 0; </div></div><!-- fragment --><p>When a timeout occurs in the send or receive operations, a <code><a class="el" href="group__group__errors.html#ga224b2c2b830135f12b53536f189b4ebd" title="A soap_status error code: unexpected end of file, no input, transmission interrupted or timed out (sa...">SOAP_EOF</a></code> exception will be raised ("end of file or no input"). Negative timeout values measure timeouts in microseconds, for example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define uSec *-1 </span></div><div class="line"><span class="preprocessor">#define mSec *-1000 </span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a78199a81c504833047224a0ceff6f906">accept_timeout</a> = 10 uSec; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474">send_timeout</a> = 20 mSec; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388">recv_timeout</a> = 20 mSec; </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388">recv_timeout</a> = 10;</div></div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>Many Linux versions do not support non-blocking <code>connect()</code>. Therefore, setting <code><a class="el" href="structsoap.html#af32b5f3975eac2bd1202571515859163" title="User-definable timeout when waiting to connect to a server at the client-side, positive timeout value...">soap::connect_timeout</a></code> for non-blocking <code>soap_call_ns__webmethod</code> calls may not work under Linux.</dd>
<dd>
Interrupts (EINTR) can affect the blocking time in I/O operations. The maximum number of EINTR that will not trigger an error is set by <code><a class="el" href="group__group__soap.html#ga59f0c79e1cd2a135f74351bf9f8c17a6" title="User-definable maximum number of EINTR interrupts to ignore while polling a socket for pending activi...">SOAP_MAXEINTR</a></code> in <em><code>gsoap/stdsoap2.h</code></em>, which is 10 by default. Each EINTR may increase the blocking time by up to one second, up to <code><a class="el" href="group__group__soap.html#ga59f0c79e1cd2a135f74351bf9f8c17a6" title="User-definable maximum number of EINTR interrupts to ignore while polling a socket for pending activi...">SOAP_MAXEINTR</a></code> seconds total.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="forceclose"></a>
Closing connections by force</h2>
<p>To close a socket connection by force, you can use <code>soap_force_closesock(soap)</code>, which closes the connection regardless if keep-alive is active. By contrast, <code>soap_closesock(soap)</code> only closes the connection when keep-alive is not active.</p>
<p>To force-close a connection from another thread, compile stdsoap2.c or stdsoap2.cpp and your project source code with <code><a class="el" href="group__group__with.html#ga0f1f2dd7a7d88f5acdaaab010d8e99ff" title="When this macro is defined at compile time (undefined by default), the engine is configured to enable...">WITH_SELF_PIPE</a></code> to enable this feature. Use <code>soap_close_connection(soap)</code> on the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context that must close. You can make this call from another thread and pass the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context to this function of the thread that must close connections.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="socketopt"></a>
Socket options and flags</h2>
<p>Socket communications can be controlled with socket options and flags. The <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context flags are:</p>
<ul>
<li><code><a class="el" href="structsoap.html#aae3eee771d8c4031d30d4ca7633edf9f" title="User-definable socket send and recv flags, for example assign MSG_NOSIGNAL to disable sigpipe (the va...">soap::socket_flags</a></code> to set flags for the socket <code>send</code> and <code>recv</code> calls.</li>
<li><code><a class="el" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794" title="User-definable setsockopt level SOL_SOCKET flags when connecting soap::socket to a server (the value ...">soap::connect_flags</a></code> to set client-side <code>setsockopt</code> <code>SOL_SOCKET</code> socket options when connecting.</li>
<li><code><a class="el" href="structsoap.html#a6b18b017ce2c77ac2b6331469094de59" title="User-definable setsockopt level SOL_SOCKET flags when binding soap::master socket (the value is 0 by ...">soap::bind_flags</a></code> to set server-side <code>setsockopt</code> <code>SOL_SOCKET</code> socket options when executing <code><a class="el" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18" title="Bind and listen to a port. ">soap_bind</a></code>.</li>
<li><code><a class="el" href="structsoap.html#a90e04027ea9efa26e550f5438ab9f3d6" title="User-definable flag, when nonzero enables IPPROTO_IPV6 setsockopt IPV6_V6ONLY when binding the soap::...">soap::bind_v6only</a></code> set to 1 to set <code>setsockopt</code> <code>IPPROTO_IPV6</code> <code>IPV6_V6ONLY</code>.</li>
<li><code><a class="el" href="structsoap.html#ad98f12f602efdde049dbd367a43e7cb0" title="User-definable setsockopt level SOL_SOCKET flags (0 by default), when nonzero sets the soap::socket f...">soap::accept_flags</a></code> to set flags to the <code>setsockopt</code> socket options when executing <code><a class="el" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6" title="Accept a connection with a client. ">soap_accept</a></code>.</li>
</ul>
<p>See the operating system manual pages of <code>send</code> and <code>recv</code> for <code><a class="el" href="structsoap.html#aae3eee771d8c4031d30d4ca7633edf9f" title="User-definable socket send and recv flags, for example assign MSG_NOSIGNAL to disable sigpipe (the va...">soap::socket_flags</a></code> values and see the operating system manual pages of <code>setsockopt</code> for <code><a class="el" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794" title="User-definable setsockopt level SOL_SOCKET flags when connecting soap::socket to a server (the value ...">soap::connect_flags</a></code>, <code><a class="el" href="structsoap.html#a6b18b017ce2c77ac2b6331469094de59" title="User-definable setsockopt level SOL_SOCKET flags when binding soap::master socket (the value is 0 by ...">soap::bind_flags</a></code>, and <code><a class="el" href="structsoap.html#ad98f12f602efdde049dbd367a43e7cb0" title="User-definable setsockopt level SOL_SOCKET flags (0 by default), when nonzero sets the soap::socket f...">soap::accept_flags</a></code> (level <code>SOL_SOCKET</code>) values. These <code>SO_</code> socket option flags (see <code>setsockopt</code> manual pages) can be bit-wise or-ed to set multiple socket options at once.</p>
<p>The client-side flag <code><a class="el" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794" title="User-definable setsockopt level SOL_SOCKET flags when connecting soap::socket to a server (the value ...">soap::connect_flags</a></code> = <code>SO_LINGER</code> is supported with values <code>l_onoff</code> = 1 and <code>l_linger</code> = <code><a class="el" href="structsoap.html#a0f4d025053fde77216a0ca674077198d" title="User-definable linger time value, requires the SO_LINGER setsockopt flag value to be assigned to soap...">soap::linger_time</a></code>. The <code><a class="el" href="structsoap.html#a0f4d025053fde77216a0ca674077198d" title="User-definable linger time value, requires the SO_LINGER setsockopt flag value to be assigned to soap...">soap::linger_time</a></code> determines the wait time (the time resolution is system dependent, though according to some experts only zero and nonzero values matter). The linger option can be used to manage the number of connections that remain in <code>TIME_WAIT</code> state at the server side.</p>
<p>For example, to disable SIGPIPE signals on Unix/Linux platforms use: <code><a class="el" href="structsoap.html#aae3eee771d8c4031d30d4ca7633edf9f" title="User-definable socket send and recv flags, for example assign MSG_NOSIGNAL to disable sigpipe (the va...">soap::socket_flags</a></code> = <code>MSG_NOSIGNAL</code> and/or <code><a class="el" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794" title="User-definable setsockopt level SOL_SOCKET flags when connecting soap::socket to a server (the value ...">soap::connect_flags</a></code> = <code>SO_NOSIGPIPE</code> (i.e. client-side connect) depending on your platform.</p>
<p>Use <code><a class="el" href="structsoap.html#a6b18b017ce2c77ac2b6331469094de59" title="User-definable setsockopt level SOL_SOCKET flags when binding soap::master socket (the value is 0 by ...">soap::bind_flags</a></code> = <code>SO_REUSEADDR</code> to enable server-side port reuse and local port sharing (but be aware of the possible security implications such as port hijacking).</p>
<p>Note that you have access to the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a>-&gt;master</code> socket value returned by <code><a class="el" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18" title="Bind and listen to a port. ">soap_bind</a></code> so you can set multiple socket options by calling <code>setsockopt</code> as follows:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> sock = <a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(soap, host, port, backlog); </div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(sock)) </div><div class="line">{</div><div class="line">  setsockopt(sock, ..., ..., ..., ...);</div><div class="line">  setsockopt(sock, ..., ..., ..., ...);</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="hostportconnect"></a>
Overriding the host and port to connect</h2>
<p>To override the host and port of the client connecting to a server, set <code><a class="el" href="structsoap.html#a166405369ad10bc20b90fb9285420cae" title="User-definable string to override the host name or IP address in the HTTP header when connecting at t...">soap::override_host</a></code> and <code><a class="el" href="structsoap.html#a914dcb6eb067f2fd3a47f9207257b606" title="User-definable port number to override the port address in the HTTP header when connecting at the cli...">soap::override_port</a></code>:</p>
<div class="fragment"><div class="line">soap-&gt;<a class="code" href="structsoap.html#a166405369ad10bc20b90fb9285420cae">override_host</a> = <span class="stringliteral">&quot;example.com&quot;</span>; <span class="comment">// host name or IP address </span></div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a914dcb6eb067f2fd3a47f9207257b606">override_port</a> = 80;            <span class="comment">// port number to use when overriding the address</span></div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="serveropenssl"></a>
Secure Web services with HTTPS</h2>
<p>To enable SSL for stand-alone gSOAP Web servers, first install OpenSSL and use option the compile-time flag <code><a class="el" href="group__group__with.html#gae5fa06f0e13edb611016c85364b0d0f0" title="When this macro is defined at compile time (undefined by default), enables linkage with OpenSSL for H...">WITH_OPENSSL</a></code> to compile the sources with your C or C++ compiler (or use the compile-time flag <code><a class="el" href="group__group__with.html#gaba33a0ba79add64c641997a7e5070f27" title="When this macro is defined at compile time (undefined by default), enables linking the GNUTLS library...">WITH_GNUTLS</a></code> if you prefer GNUTLS), for example: </p><pre class="fragment"> c++ -DWITH_OPENSSL -o myprog myprog.cpp stdsoap2.cpp soapC.cpp soapServer.cpp -lssl -lcrypto
</pre><p>With GNUTLS: </p><pre class="fragment"> c++ -DWITH_GNUTLS -o myprog myprog.cpp stdsoap2.cpp soapC.cpp soapServer.cpp -lgnutls -lgcrypt -lgpg-error
</pre><p>SSL support for stand-alone gSOAP Web services is enabled by calling <code><a class="el" href="group__group__ssl.html#ga990083effa5d8ed931fd75dc2630a2cc" title="Accept SSL/TLS connection. ">soap_ssl_accept</a></code> to perform the SSL/TLS handshake after <code><a class="el" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6" title="Accept a connection with a client. ">soap_accept</a></code>. In addition, a key file, a CA file (or path to certificates), DH file (if RSA is not used), and password need to be supplied. Instructions on how to do this can be found in the OpenSSL documentation <a href="http://www.openssl.org">http://www.openssl.org</a>. See also Section <a class="el" href="index.html#ssl">SSL certificates and key files</a> .</p>
<p>Let's take a look at an example SSL secure multi-threaded stand-alone SOAP Web Service:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <a class="code" href="group__group__soap.html#ga6eb1bde7cecc2fbadbcbbc6395227439">SOAP_SOCKET</a> m, s; </div><div class="line">  <a class="code" href="group__group__threads.html#ga53ca774b0fc84afe282a5419d2d7239a">THREAD_TYPE</a> tid; </div><div class="line">  <span class="keyword">struct </span>soap *<a class="code" href="structsoap.html#a740f8760f6ee4c6584e25c612f585d70">soap</a>, *tsoap; </div><div class="line">  <a class="code" href="group__group__ssl.html#ga570b262ac9d55fc509f1f5999deaa18f">soap_ssl_init</a>(); <span class="comment">/* init OpenSSL (skipping this or calling multiple times is OK, since the engine will init SSL automatically) */</span></div><div class="line">  <span class="comment">/* soap_ssl_noinit(); */</span> <span class="comment">/* do not init OpenSSL (if SSL is already initialized elsewhere in this application) */</span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__ssl.html#gaedc51dd2ab95cdff45057639fac70a8f">CRYPTO_thread_setup</a>()) <span class="comment">/* OpenSSL thread mutex setup */</span></div><div class="line">  {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Cannot setup thread mutex\n&quot;</span>); </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7">soap_ssl_server_context</a>(soap, </div><div class="line">    <a class="code" href="group__group__ssl.html#ga63d10bdcb2b678d9d55cab31e1bdaf3e">SOAP_SSL_DEFAULT</a>, </div><div class="line">    <span class="stringliteral">&quot;server.pem&quot;</span>,      <span class="comment">/* keyfile: required when server must authenticate to clients (see SSL docs on how to obtain this file) */</span> </div><div class="line">    <span class="stringliteral">&quot;password&quot;</span>,        <span class="comment">/* password to read the key file (not used with GNUTLS) */</span> </div><div class="line">    <span class="stringliteral">&quot;cacert.pem&quot;</span>,      <span class="comment">/* optional cacert file to store trusted certificates */</span> </div><div class="line">    NULL,              <span class="comment">/* optional capath to directory with trusted certificates */</span> </div><div class="line">    <span class="stringliteral">&quot;dh512.pem&quot;</span>,       <span class="comment">/* DH file name or DH key len bits (minimum is 512, e.g. &quot;512&quot;) to generate DH param, if NULL use RSA */</span> </div><div class="line">    NULL,              <span class="comment">/* if randfile!=NULL: use a file with random data to seed randomness */</span>  </div><div class="line">    NULL               <span class="comment">/* optional server identification to enable SSL session caching to speed up TLS (must be a unique name) */</span></div><div class="line">  )) </div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  m = <a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(soap, NULL, 18000, BACKLOG); <span class="comment">/* use port 18000 */</span></div><div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(m)) </div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  fprintf(stderr, <span class="stringliteral">&quot;Socket connection successful: master socket = %d\n&quot;</span>, m); </div><div class="line">  <span class="keywordflow">while</span> (1)</div><div class="line">  {</div><div class="line">    s = <a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(soap); </div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Socket connection successful: slave socket = %d\n&quot;</span>, s); </div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(s)) </div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a>) <span class="comment">/* accept failed, try again after 1 second */</span></div><div class="line">      {</div><div class="line">        <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">        sleep(1);</div><div class="line">        <span class="keywordflow">continue</span>; <span class="comment">/* retry */</span></div><div class="line">      }</div><div class="line">      fprintf(stderr, <span class="stringliteral">&quot;Server timed out\n&quot;</span>);</div><div class="line">      <span class="keywordflow">break</span>; </div><div class="line">    } </div><div class="line">    tsoap = <a class="code" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a">soap_copy</a>(soap);</div><div class="line">    <span class="keywordflow">if</span> (!tsoap) </div><div class="line">      <a class="code" href="group__group__io.html#ga0ca0c64dc76af8617956a62cf117db94">soap_force_closesock</a>(soap);</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">      <span class="keywordflow">while</span> (<a class="code" href="group__group__threads.html#gabee88cce937a2709b4799ed8df36d486">THREAD_CREATE</a>(&amp;tid, (<span class="keywordtype">void</span>*(*)(<span class="keywordtype">void</span>*))&amp;process_request, (<span class="keywordtype">void</span>*)tsoap))</div><div class="line">        sleep(1); <span class="comment">/* failed, try again */</span></div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap); <span class="comment">/* deallocates SSL context */</span></div><div class="line">  <a class="code" href="group__group__ssl.html#ga8b29e4ea1419a4af49823862765f2918">CRYPTO_thread_cleanup</a>(); <span class="comment">/* OpenSSL thread mutex cleanup */</span></div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">}  </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> *process_request(<span class="keywordtype">void</span> *tsoap) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = (<span class="keyword">struct </span>soap*)tsoap;</div><div class="line">  <a class="code" href="group__group__threads.html#ga5848fc7adb50b3a15e40955dce7f8f53">THREAD_DETACH</a>(<a class="code" href="group__group__threads.html#ga9ab5a77b8cf2b98f7d6c1b48bb421f69">THREAD_ID</a>); </div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__ssl.html#ga990083effa5d8ed931fd75dc2630a2cc">soap_ssl_accept</a>(soap)) </div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">    <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(soap); </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div><div class="line">  <span class="keywordflow">return</span> NULL; </div><div class="line">}</div></div><!-- fragment --><p>The <code><a class="el" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7" title="Initialize the server-side SSL/TLS context. ">soap_ssl_server_context</a></code> function initializes the server-side SSL context. The <em><code>server.pem</code></em> key file is the server's private key concatenated with its certificate. The <em><code>cacert.pem</code></em> is used to authenticate clients and contains the client certificates. Alternatively a directory name can be specified. This directory is assumed to contain the certificates. The <em><code>dh512.pem</code></em> file specifies that DH will be used for key agreement instead of RSA. A numeric value greater than 512 can be provided instead as a string constant (e.g. <code>"512"</code>) to allow the engine to generate the DH parameters on the fly (this can take a while) rather than retrieving them from a file. The randfile entry can be used to seed the PRNG. The last entry enable server-side session caching to speed up TLS. A unique server name is required.</p>
<p>You can specify a cipher list to use with TLSv1.2 and below with <code>SSL_CTX_set_cipher_list(soap-&gt;ctx, "...")</code> where <code>soap-&gt;ctx</code> is the SSL context created by <code><a class="el" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7" title="Initialize the server-side SSL/TLS context. ">soap_ssl_server_context()</a></code>. Likewise, use <code>SSL_CTX_set_ciphersuites(soap-&gt;ctx, "...")</code> to configure the available TLSv1.3 ciphersuites.</p>
<p>We refer to the OpenSSL documentation and manual pages of <code>SSL_CTX_set_cipher_list</code> and <code>SSL_CTX_set_ciphersuites</code> for details on the latest cipher lists and suites available to use.</p>
<p>The GNUTLS mutex lock setup is automatically performed in the engine, but only when POSIX threads are detected and available.</p>
<p>All OpenSSL versions prior to 1.1.0 require mutex locks to be explicitly set up in your code for multi-threaded applications by calling <code><a class="el" href="group__group__ssl.html#gaedc51dd2ab95cdff45057639fac70a8f" title="Setup function for OpenSSL versions prior to 1.1.1 to set locks for multi-threaded SSL/TLS applicatio...">CRYPTO_thread_setup()</a></code> and <code><a class="el" href="group__group__ssl.html#ga8b29e4ea1419a4af49823862765f2918" title="Cleanup function for OpenSSL versions prior to 1.1.1. ">CRYPTO_thread_cleanup()</a></code> as was shown in the code above. OpenSSL 1.1.0 and greater does not require these locks to be set up. If you are not sure which version of OpenSSL you may be using with your multi-threaded application, then set up the locks.</p>
<p>For Unix and Linux, make sure you have signal handlers set in your service and/or client applications to catch broken connections (<code>SIGPIPE</code>):</p>
<div class="fragment"><div class="line">signal(SIGPIPE, sigpipe_handle);</div></div><!-- fragment --><p>where, for example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> sigpipe_handle(<span class="keywordtype">int</span> x) { }</div></div><!-- fragment --><p>By default, clients are not required to authenticate. To require client authentication use the following:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7">soap_ssl_server_context</a>(&amp;soap, </div><div class="line">    <a class="code" href="group__group__ssl.html#ga4ab5e7f3fbb00fa2669e29e9ca000d12">SOAP_SSL_REQUIRE_CLIENT_AUTHENTICATION</a>, </div><div class="line">    <span class="stringliteral">&quot;server.pem&quot;</span>, </div><div class="line">    <span class="stringliteral">&quot;password&quot;</span>, </div><div class="line">    <span class="stringliteral">&quot;cacert.pem&quot;</span>, </div><div class="line">    NULL, </div><div class="line">    <span class="stringliteral">&quot;dh512.pem&quot;</span>, </div><div class="line">    NULL, </div><div class="line">    NULL)) </div><div class="line">{</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">  exit(EXIT_FAILURE); </div><div class="line">}</div></div><!-- fragment --><p>This requires each client to authenticate with its certificate, in addition for the server to authenticate to the client.</p>
<p>Since release version 2.8.20, SSL v3 is disabled. To enable SSL v3 together with TLS 1.0 and higher, use <code><a class="el" href="group__group__ssl.html#gaf273a14b5105e943a0280947d7def8ff" title="soap_ssl_flags flag value to enable both SSL v3 and TLS 1 (TLS 1.0 to max) ">SOAP_SSLv3_TLSv1</a></code> with <code><a class="el" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7" title="Initialize the server-side SSL/TLS context. ">soap_ssl_server_context</a></code>. To use TLS 1.1 and 1.2 use <code>SOAP_TLSv1_1 | SOAP_TLSv1_2</code>. To use TLS 1.2 only use <code><a class="el" href="group__group__ssl.html#gaaec41400f54924b9f7eb260f206a18dd" title="soap_ssl_flags flag value to enable TLS 1.2 ">SOAP_TLSv1_2</a></code>. To use SSL v3 only use <code><a class="el" href="group__group__ssl.html#ga0d4dc7f02c689dd69a5508848b7b701d" title="soap_ssl_flags flag value to enable SSL v3 but disable TLS, should be used for legacy purposes only ...">SOAP_SSLv3</a></code>.</p>
<p>The <code>cacert</code> file and <code>capath</code> are optional. Either one can be specified when clients must run on non-trusted systems (<code>capath</code> is not used with GNUTLS). We want to avoid storing trusted certificates in the default location on the file system when that is not secure. Therefore, a flat <em><code>cacert.pem</code></em> file or directory can be specified to store trusted certificates.</p>
<p>The gSOAP package includes a <em><code>cacerts.pem</code></em> file with the certificates of all certificate authorities. You can use this file to verify the authentication of servers that provide certificates issued by these CAs.</p>
<p>The <em><code>cacert.pem</code></em>, <em><code>client.pem</code></em>, and <em><code>server.pem</code></em> files in the gSOAP package are examples of self-signed certificates. The <em><code>client.pem</code></em> and <em><code>server.pem</code></em> contain the client/server private key concatenated with the certificate. The keyfiles (<em><code>client.pem</code></em> and <em><code>server.pem</code></em>) are created by concatenating the private key PEM with the certificate PEM. The keyfile should not be shared with any party. With OpenSSL, you can encrypt the keyfiles with a password to offer some protection and the password is used in the client/server code to read the keyfile. GNUTLS does not support this feature and cannot encrypt or decrypt a keyfile.</p>
<dl class="section warning"><dt>Warning</dt><dd>It is important that the <code><a class="el" href="group__group__with.html#gae5fa06f0e13edb611016c85364b0d0f0" title="When this macro is defined at compile time (undefined by default), enables linkage with OpenSSL for H...">WITH_OPENSSL</a></code> macro must be consistently defined to compile the sources, such as <em><code>gsoap/stdsoap2.cpp</code></em>, <em><code>soapC.cpp</code></em>, <em><code>soapClient.cpp</code></em>, <em><code>soapServer.cpp</code></em>, and all application sources that include <em><code>gsoap/stdsoap2.h</code></em> or <em><code>soapH.h</code></em>. If the macros are not consistently used, the application will crash due to a mismatches in the declaration and access of the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context.</dd></dl>
<p>See also API documentation Module <a class="el" href="group__group__ssl.html">SSL/TLS context and functions</a> for more details on the SSL/TLS functions.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="clientopenssl"></a>
Secure clients with HTTPS</h2>
<p>To utilize HTTPS/SSL, you need to install the OpenSSL library on your platform or GNUTLS for a light-weight SSL/TLS library. After installation, compile all the sources of your application with compile-time flag <code><a class="el" href="group__group__with.html#gae5fa06f0e13edb611016c85364b0d0f0" title="When this macro is defined at compile time (undefined by default), enables linkage with OpenSSL for H...">WITH_OPENSSL</a></code> (or <code><a class="el" href="group__group__with.html#gaba33a0ba79add64c641997a7e5070f27" title="When this macro is defined at compile time (undefined by default), enables linking the GNUTLS library...">WITH_GNUTLS</a></code> when using GNUTLS). For example on Linux: </p><pre class="fragment"> c++ -DWITH_OPENSSL myclient.cpp stdsoap.cpp soapC.cpp soapClient.cpp -lssl -lcrypto
</pre><p>or Unix: </p><pre class="fragment"> c++ -DWITH_OPENSSL myclient.cpp stdsoap.cpp soapC.cpp soapClient.cpp -lxnet -lsocket -lnsl -lssl -lcrypto
</pre><p>or you can add the following line to <em><code>soapdefs.h</code></em>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define WITH_OPENSSL</span></div></div><!-- fragment --><p>and compile with compile-time flag <code><a class="el" href="group__group__with.html#ga24620333a812a36ed84902ff3d897ff6" title="When this macro is defined at compile time (undefined by default), a user-supplied file named soapdef...">WITH_SOAPDEFS_H</a></code> to include <em><code>soapdefs.h</code></em> in your project. Alternatively, compile with GNUTLS: </p><pre class="fragment"> c++ -DWITH_GNUTLS myclient.cpp stdsoap.cpp soapC.cpp soapClient.cpp -lgnutls -lgcrypt -lgpg-error
</pre><p>A client program simply uses the prefix <em><code>https:</code></em> instead of <em><code>http:</code></em> in the endpoint URL of a service operation call to a Web Service to use encrypted transfers (if the service supports HTTPS). You need to specify the client-side key file and password of the keyfile:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap soap;</div><div class="line"><a class="code" href="group__group__ssl.html#ga570b262ac9d55fc509f1f5999deaa18f">soap_ssl_init</a>(); <span class="comment">/* init OpenSSL (skipping this or calling multiple times is OK, since the engine will init SSL automatically) */</span></div><div class="line"><span class="comment">/* soap_ssl_noinit(); */</span> <span class="comment">/* do not init OpenSSL (if SSL is already initialized elsewhere in this application) */</span></div><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap);</div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__group__ssl.html#ga269c7732b1cda9dc79db08fcbf1d5438">soap_ssl_client_context</a>(&amp;soap, </div><div class="line">  <a class="code" href="group__group__ssl.html#ga63d10bdcb2b678d9d55cab31e1bdaf3e">SOAP_SSL_DEFAULT</a>, </div><div class="line">  <span class="stringliteral">&quot;client.pem&quot;</span>,        <span class="comment">/* keyfile: required only when client must authenticate to server (see SSL docs on how to obtain this file) */</span> </div><div class="line">  <span class="stringliteral">&quot;password&quot;</span>,          <span class="comment">/* password to read the key file (not used with GNUTLS) */</span> </div><div class="line">  <span class="stringliteral">&quot;cacerts.pem&quot;</span>,       <span class="comment">/* cacert file to store trusted certificates (needed to verify server) */</span> </div><div class="line">  NULL,                <span class="comment">/* capath to directory with trusted certificates */</span> </div><div class="line">  NULL         <span class="comment">/* if randfile!=NULL: use a file with random data to seed randomness */</span>  </div><div class="line">)) </div><div class="line">{</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">  exit(EXIT_FAILURE); </div><div class="line">} </div><div class="line">soap_call_ns__mymethod(&amp;soap, <span class="stringliteral">&quot;https://domain/path/secure.cgi&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, ...);</div></div><!-- fragment --><p>By default, server authentication is enabled and the <em><code>cacerts.pem</code></em> or <code>capath</code> (not used with GNUTLS) must be set so that the CA certificates of the server(s) are accessible at run time. The <em><code>cacerts.pem</code></em> file included in the gSOAP source code package contains the certificates of common CAs. This file must be supplied with the client, if server authentication is required. Alternatively, you can use the <em><code>gsoap/plugin/cacerts.h</code></em> and <em><code>gsoap/plugin/cacerts.c</code></em> code to embed CA certificates in your client code.</p>
<p>You can specify a cipher list to use with TLSv1.2 and below with <code>SSL_CTX_set_cipher_list(soap-&gt;ctx, "...")</code> where <code>soap-&gt;ctx</code> is the SSL context created by <code><a class="el" href="group__group__ssl.html#ga269c7732b1cda9dc79db08fcbf1d5438" title="Initialize the client-side SSL/TLS context. ">soap_ssl_client_context()</a></code>. Likewise, use <code>SSL_CTX_set_ciphersuites(soap-&gt;ctx, "...")</code> to configure the available TLSv1.3 ciphersuites.</p>
<p>We refer to the OpenSSL documentation and manual pages of <code>SSL_CTX_set_cipher_list</code> and <code>SSL_CTX_set_ciphersuites</code> for details on the latest cipher lists and suites available to use.</p>
<p>Other client-side SSL options are <code><a class="el" href="group__group__ssl.html#ga2d7d44f0b65da9941f0272b0f73745f5" title="soap_ssl_flags flag for clients to allow clients to skip common name checks against the host name of ...">SOAP_SSL_SKIP_HOST_CHECK</a></code> to skip the host name verification check and <code><a class="el" href="group__group__ssl.html#gaa78c27c03ccd2fb47afda6b83a3fd01c" title="soap_ssl_flags flag value to allow self-signed and expired certificates and those without CRL to be u...">SOAP_SSL_ALLOW_EXPIRED_CERTIFICATE</a></code> to allow connecting to a host with an expired certificate. For example,</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap soap;</div><div class="line"><a class="code" href="group__group__ssl.html#ga570b262ac9d55fc509f1f5999deaa18f">soap_ssl_init</a>(); <span class="comment">/* init OpenSSL (skipping this or calling multiple times is OK, since the engine will init SSL automatically) */</span></div><div class="line"><span class="comment">/* soap_ssl_noinit(); */</span> <span class="comment">/* do not init OpenSSL (if SSL is already initialized elsewhere in this application) */</span></div><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap);</div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__group__ssl.html#ga269c7732b1cda9dc79db08fcbf1d5438">soap_ssl_client_context</a>(&amp;soap, </div><div class="line">  <a class="code" href="group__group__ssl.html#ga8c9f87b34ff34020349d4fe7300c47bc">SOAP_SSL_REQUIRE_SERVER_AUTHENTICATION</a>  </div><div class="line">  | <a class="code" href="group__group__ssl.html#ga2d7d44f0b65da9941f0272b0f73745f5">SOAP_SSL_SKIP_HOST_CHECK</a>, </div><div class="line">  | <a class="code" href="group__group__ssl.html#gaa78c27c03ccd2fb47afda6b83a3fd01c">SOAP_SSL_ALLOW_EXPIRED_CERTIFICATE</a>, </div><div class="line">  <span class="stringliteral">&quot;client.pem&quot;</span>,        <span class="comment">/* keyfile: required only when client must authenticate to server (see SSL docs on how to obtain this file) */</span> </div><div class="line">  <span class="stringliteral">&quot;password&quot;</span>,          <span class="comment">/* password to read the key file (not used with GNUTLS) */</span> </div><div class="line">  <span class="stringliteral">&quot;cacerts.pem&quot;</span>,       <span class="comment">/* cacert file to store trusted certificates (needed to verify server) */</span></div><div class="line">  NULL,                <span class="comment">/* capath to directory with trusted certificates */</span> </div><div class="line">  NULL         <span class="comment">/* if randfile!=NULL: use a file with random data to seed randomness */</span>  </div><div class="line">)) </div><div class="line">{</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">  exit(EXIT_FAILURE); </div><div class="line">} </div><div class="line">soap_call_ns__mymethod(&amp;soap, <span class="stringliteral">&quot;https://domain/path/secure.cgi&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, ...);</div></div><!-- fragment --><p>For systems based on Microsoft windows, the WinInet module can be used instead, see <code>mod_gsoap/gsoap_win/wininet</code>.</p>
<p>Since release version 2.8.20 SSL v3 is disabled. To enable SSL v3 together with TLS 1.0 and higher, use <code><a class="el" href="group__group__ssl.html#gaf273a14b5105e943a0280947d7def8ff" title="soap_ssl_flags flag value to enable both SSL v3 and TLS 1 (TLS 1.0 to max) ">SOAP_SSLv3_TLSv1</a></code> with <code><a class="el" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7" title="Initialize the server-side SSL/TLS context. ">soap_ssl_server_context</a></code>. To use TLS 1.1 and 1.2 use <code>SOAP_TLSv1_1 | SOAP_TLSv1_2</code>. To use TLS 1.2 only use <code><a class="el" href="group__group__ssl.html#gaaec41400f54924b9f7eb260f206a18dd" title="soap_ssl_flags flag value to enable TLS 1.2 ">SOAP_TLSv1_2</a></code>. To use SSL v3 only use <code><a class="el" href="group__group__ssl.html#ga0d4dc7f02c689dd69a5508848b7b701d" title="soap_ssl_flags flag value to enable SSL v3 but disable TLS, should be used for legacy purposes only ...">SOAP_SSLv3</a></code>.</p>
<p>To disable server authentication for testing purposes, use the following:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__group__ssl.html#ga269c7732b1cda9dc79db08fcbf1d5438">soap_ssl_client_context</a>(&amp;soap, </div><div class="line">  <a class="code" href="group__group__ssl.html#ga52614007d0c0359ceaf86588f47661b9">SOAP_SSL_NO_AUTHENTICATION</a>, </div><div class="line">  NULL, </div><div class="line">  NULL, </div><div class="line">  NULL, </div><div class="line">  NULL, </div><div class="line">  NULL </div><div class="line">)) </div><div class="line">{</div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line">  exit(EXIT_FAILURE); </div><div class="line">} </div></div><!-- fragment --><p>This also assumes that the server does not require clients to authenticate (the keyfile is absent).</p>
<p>Make sure you have signal handlers set in your application to catch broken connections (<code>SIGPIPE</code>):</p>
<div class="fragment"><div class="line">signal(SIGPIPE, sigpipe_handle);</div></div><!-- fragment --><p>where, for example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> sigpipe_handle(<span class="keywordtype">int</span> x) { }</div></div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>It is important that the <code><a class="el" href="group__group__with.html#gae5fa06f0e13edb611016c85364b0d0f0" title="When this macro is defined at compile time (undefined by default), enables linkage with OpenSSL for H...">WITH_OPENSSL</a></code> macro is consistently defined to compile the sources, such as <em><code>gsoap/stdsoap2.cpp</code></em>, <em><code>soapC.cpp</code></em>, <em><code>soapClient.cpp</code></em>, <em><code>soapServer.cpp</code></em>, and all application sources that include <em><code>gsoap/stdsoap2.h</code></em> or <em><code>soapH.h</code></em>. If the macros are not consistently used, the application will crash due to a mismatches in the declaration and access of the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context. Alternatively, use library <b><code>-lgsoapssl</code></b> or <b><code>-lgsoapssl++</code></b> and compile everything else with <code><a class="el" href="group__group__with.html#gae5fa06f0e13edb611016c85364b0d0f0" title="When this macro is defined at compile time (undefined by default), enables linkage with OpenSSL for H...">WITH_OPENSSL</a></code>.</dd>
<dd>
Concurrent client calls with threads should use separate <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> contexts In addition, the thread initialization code discussed in Section <a class="el" href="index.html#serveropenssl">Secure Web services with HTTPS</a> must be used to properly setup OpenSSL in a multi-threaded client application.</dd></dl>
<p>See also API documentation Module <a class="el" href="group__group__ssl.html">SSL/TLS context and functions</a> for more details on the SSL/TLS functions.</p>
<p>You can also use the WinInet interface to establish secure HTTPS connections on Windows machines, available in the <em><code>gsoap/mod_gsoap</code></em> directory of the gSOAP source code package, see also Section <a class="el" href="index.html#wininetplugin">The WinInet plugin</a>. Or you can use the CURL plugin to use CURL to establish secure HTTPS connections, see Section <a class="el" href="index.html#curlplugin">The CURL plugin</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="sslauthenticationcallbacks"></a>
SSL authentication callbacks</h2>
<p>The <code>fsslauth</code> callback function controls OpenSSL/GNUTLS authentication initialization:</p>
<ul>
<li><code>int (<a class="el" href="group__group__callbacks.html#gaec56697005ded17d4d19705013f908ee" title="Callback to initialize the OpenSSL library. ">soap::fsslauth</a>)(struct soap *soap)</code> This callback is called to initialize the OpenSSL or GNUTLS context for HTTPS connections configured with the parameters passed to <code><a class="el" href="group__group__ssl.html#ga269c7732b1cda9dc79db08fcbf1d5438" title="Initialize the client-side SSL/TLS context. ">soap_ssl_client_context</a></code> and <code><a class="el" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7" title="Initialize the server-side SSL/TLS context. ">soap_ssl_server_context</a></code>. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> (int) error code. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#gaec56697005ded17d4d19705013f908ee" title="Callback to initialize the OpenSSL library. ">soap::fsslauth</a></code> is <code>ssl_auth_init</code>.</li>
</ul>
<p>The <code>fsslverify</code> callback function controls OpenSSL peer certificate verification, via internally invoking <code>SSL_CTX_set_verify</code>:</p>
<ul>
<li><code>int (soap::fssverify)(int ok, X509_STORE_CTX *store</code> This callback is called by the engine to manage the verification of the certificate provided by a peer, such as the certificate provided by a server connected over HTTPS or to verify the certificate included with a WS-Security message. To require certificate verification of a server connected via HTTPS, use <code><a class="el" href="group__group__ssl.html#ga269c7732b1cda9dc79db08fcbf1d5438" title="Initialize the client-side SSL/TLS context. ">soap_ssl_client_context</a></code> with <code><a class="el" href="group__group__ssl.html#ga8c9f87b34ff34020349d4fe7300c47bc" title="soap_ssl_flags flag for clients to require servers to authenticate to clients during the HTTPS handsh...">SOAP_SSL_REQUIRE_SERVER_AUTHENTICATION</a></code>. To require certificate verification of a client connected to a server, use <code><a class="el" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7" title="Initialize the server-side SSL/TLS context. ">soap_ssl_server_context</a></code> with <code><a class="el" href="group__group__ssl.html#ga4ab5e7f3fbb00fa2669e29e9ca000d12" title="soap_ssl_flags flag for servers to require clients to authenticate to servers during the HTTPS handsh...">SOAP_SSL_REQUIRE_CLIENT_AUTHENTICATION</a></code>. The <code>ok</code> parameter of this callback indicates whether the verification of the certificate in question passed (<code>ok</code> == 1) or failed (<code>ok</code> == 0) as determined by the OpenSSL library based on the <code><a class="el" href="group__group__ssl.html#ga269c7732b1cda9dc79db08fcbf1d5438" title="Initialize the client-side SSL/TLS context. ">soap_ssl_client_context</a></code> or <code><a class="el" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7" title="Initialize the server-side SSL/TLS context. ">soap_ssl_server_context</a></code> configuration. If the callback returns 1 then the handshake is continued and the connection maybe established. To return 1 when <code>ok</code> == 0 requires resetting the error state with <code>X509_STORE_CTX_set_error(store, X509_V_OK)</code>. If the callback returns 0 then the handshake is immediately terminated with "verification failed" and a verification failure alert is sent to the peer. The built-in function assigned to <code><a class="el" href="group__group__callbacks.html#ga49fee9ca4a78f9a681afbdfbc0194bf0" title="Callback to manage the verification of the certificate provided by a peer (typically a server) ...">soap::fsslverify</a></code> is <code>ssl_verify_callback</code> or when <code><a class="el" href="group__group__ssl.html#gaa78c27c03ccd2fb47afda6b83a3fd01c" title="soap_ssl_flags flag value to allow self-signed and expired certificates and those without CRL to be u...">SOAP_SSL_ALLOW_EXPIRED_CERTIFICATE</a></code> is used <code>ssl_verify_callback_allow_expired_certificate</code>.</li>
</ul>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="ssl"></a>
SSL certificates and key files</h2>
<p>The gSOAP package includes a <em><code>cacerts.pem</code></em> file with the certificates of all certificate authorities. You can use this file to verify the authentication of servers that provide certificates issued by these CAs. Just set the <code>cafile</code> parameter to the location of this file on your file system. Therefore, when you obtain a certificate signed by a trusted CA you can simply use the <em><code>cacerts.pem</code></em> file to develop client applications that can verify the authenticity of your server.</p>
<p>Alternatively, you can use the <em><code>gsoap/plugin/cacerts.h</code></em> and <em><code>gsoap/plugin/cacerts.c</code></em> code to embed CA certificates in your client code.</p>
<p>For systems based on Microsoft windows, the WinInet module can be used instead, see the <code>README.txt</code> located in the gSOAP source code package under <code>mod_gsoap/gsoap_win/wininet</code>, see the gSOAP <a href="../../wininet/html/index.html">WinInet plugin</a> documentation.</p>
<p>The other <em><code>.pem</code></em> files in the gSOAP package are examples of self-signed certificates for testing purposes (<em><code>cacert.pem</code></em>, <em><code>client.pem</code></em>, <em><code>server.pem</code></em>). The <em><code>client.pem</code></em> and <em><code>server.pem</code></em> contain the private key and certificate of the client or server, respectively. The keyfiles (<em><code>client.pem</code></em> and <em><code>server.pem</code></em>) are created by concatenating the private key PEM with the certificate PEM. The keyfile should not be shared with any party. With OpenSSL, you can encrypt the keyfiles with a password to offer some protection and the password is used in the client/server code to read the keyfile. GNUTLS does not support this feature and cannot encrypt or decrypt a keyfile.</p>
<p>You can also create your own self-signed certificates. There is more than one way to generate the necessary files for clients and servers. See <a href="http://www.openssl.org">http://www.openssl.org</a> for information on OpenSSL and <a href="http://sial.org/howto/openssl/ca/">http://sial.org/howto/openssl/ca/</a> on how to setup and manage a local CA and <a href="http://sial.org/howto/openssl/self-signed">http://sial.org/howto/openssl/self-signed</a> on how to setup self-signed test certificates.</p>
<p>It is possible to convert IIS-generated certificates to PEM format with the openssl library and openssl command-line tool: </p><pre class="fragment">openssl x509 -in mycert.cer -inform DER -out mycert.pem -outform PEM
</pre><p>This converts the CRT-formatted mycert.cer to PEM-formatted mycert.pem.</p>
<p>Here is the simplest way to setup self-signed certificates. First you need to create a private Certificate Authority (CA). The CA is used in SSL to verify the authenticity of a given certificate. The CA acts as a trusted third party who has authenticated the user of the signed certificate as being who they say. The certificate is signed by the CA, and if the client trusts the CA, it will trust your certificate. For use within your organization, a private CA will probably serve your needs. However, if you intend use your certificates for a public service, you should probably obtain a certificate from a known CA. In addition to identification, your certificate is also used for encryption.</p>
<p>Creating certificates should be done through a CA to obtain signed certificates. But you can create your own certificates for testing purposes as follows.</p>
<ul>
<li>Go to the OpenSSL bin directory (<code>/usr/local/ssl</code> by default and <code>/System/Library/OpenSSL</code> on Mac OS X)</li>
<li>There should be a file called openssl.cnf</li>
<li>Create a new directory in your home account, e.g. $HOME/CA, and copy the openssl.cnf file to this directory</li>
<li>Modify openssl.cnf by changing the 'dir' value to HOME/CA</li>
<li>Copy the README.txt, root.sh, and cert.sh scripts from the gSOAP source code package located in the <em><code>gsoap/samples/ssl</code></em> directory to HOME/CA</li>
<li>Follow the README.txt instructions</li>
</ul>
<p>You now have a self-signed CA root certificate cacert.pem and a server.pem (or client.pem) certificate in PEM format. The cacert.pem certificate is used in the <code>cafile</code> parameter of the <code><a class="el" href="group__group__ssl.html#ga269c7732b1cda9dc79db08fcbf1d5438" title="Initialize the client-side SSL/TLS context. ">soap_ssl_client_context</a></code> (or <code><a class="el" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7" title="Initialize the server-side SSL/TLS context. ">soap_ssl_server_context</a></code>) at the client (or server) side to verify the authenticity of the peer. You can also provide a capath parameter to these trusted certificates. The server.pem (or client.pem) must be provided with the <code><a class="el" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7" title="Initialize the server-side SSL/TLS context. ">soap_ssl_server_context</a></code> at the server side (or <code><a class="el" href="group__group__ssl.html#ga269c7732b1cda9dc79db08fcbf1d5438" title="Initialize the client-side SSL/TLS context. ">soap_ssl_client_context</a></code> at the client side) together with the password you entered when generating the certificate using cert.sh to access the file. These certificates must be present to grant authentication requests by peers. In addition, the server.pem (and client.pem) include the host name of the machine on which the application runs (e.g. localhost), so you need to generate new certificates when migrating a server (or client).</p>
<p>Finally, you need to generate Diffie-Helmann (DH) parameters for the server if you wish to use DH instead of RSA. There are two options:</p>
<ul>
<li>Set the <code>dhfile</code> parameter to the numeric DH prime length in bits required (for example "1024") to let the engine generate DH parameters at initialization. This can be time consuming.</li>
<li>Provide a file name for the <code>dhfile</code> parameter of <code><a class="el" href="group__group__ssl.html#ga3492465cdd8aa71fe746199d3842cac7" title="Initialize the server-side SSL/TLS context. ">soap_ssl_server_context</a></code>. The file should be generated beforehand. To do so with the OpenSSL command line tool, use: <pre class="fragment"> openssl dhparam -outform PEM -out dh.pem 512
</pre></li>
</ul>
<p>File <em><code>dh512.pem</code></em> is the output file and 512 is the number of bits used.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="sslhw"></a>
SSL hardware acceleration</h2>
<p>You can specify a hardware engine to enable hardware support for cryptographic acceleration. This can be done once in a server or client with the following statements:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *engine = <span class="stringliteral">&quot;cswift&quot;</span>; <span class="comment">/* engine name */</span> </div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  ENGINE *e; </div><div class="line">  <span class="keywordflow">if</span> (!(e = ENGINE_by_id(engine))) </div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Error finding engine %s\n&quot;</span>, engine); </div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!ENGINE_set_default(e, ENGINE_METHOD_ALL)) </div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Error using engine %s\n&quot;</span>, engine); </div><div class="line">  ... <span class="comment">//</span></div><div class="line">}</div></div><!-- fragment --><p>The following table lists the names of the hardware and software engines:</p>
<table class="doxtable">
<tr>
<th>engine </th><th>result  </th></tr>
<tr>
<td><code>openssl</code> </td><td>The default software engine for cryptographic operations </td></tr>
<tr>
<td><code>openbsd_dev_crypto</code> </td><td>OpenBSD supports kernel level cryptography </td></tr>
<tr>
<td><code>cswift</code> </td><td>CryptoSwift acceleration hardware </td></tr>
<tr>
<td><code>chil</code> </td><td>nCipher CHIL acceleration hardware </td></tr>
<tr>
<td><code>atalla</code> </td><td>Compaq Atalla acceleration hardware </td></tr>
<tr>
<td><code>nuron</code> </td><td>Nuron acceleration hardware </td></tr>
<tr>
<td><code>ubsec</code> </td><td>Broadcom uBSec acceleration hardware </td></tr>
<tr>
<td><code>aep</code> </td><td>Aep acceleration hardware </td></tr>
<tr>
<td><code>sureware</code> </td><td>SureWare acceleration hardware </td></tr>
</table>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="sslwin"></a>
SSL on Windows</h2>
<p>Set the full path to <em><code>libssl.lib</code></em> and <em><code>libcrypto.lib</code></em> under the MSVC++ "Projects" menu, then choose "Link": "Object/Modules". Please make sure <em><code>libssl32.dll</code></em> and <em><code>libeay32.dll</code></em> can be loaded by your applications, thus they must be installed properly on the target machine.</p>
<p>If you're using compilation settings such as <code>/MTd</code> then link to the correct <em><code>libeay32MTd.lib</code></em> and <em><code>ssleay32MTd.lib</code></em> libraries.</p>
<p>Alternatively, you can use the WinInet interface for secure connections, available in the <em><code>gsoap/mod_gsoap</code></em> directory of the gSOAP package, see also Section <a class="el" href="index.html#wininetplugin">The WinInet plugin</a>. Or you can use the CURL plugin to use CURL for secure connections, see Section <a class="el" href="index.html#curlplugin">The CURL plugin</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="compression"></a>
Zlib compression</h2>
<p>To enable deflate and gzip compression with Zlib, install Zlib from <a href="http://www.zlib.org">http://www.zlib.org</a> if not already installed on your system. Compile <em><code>gsoap/stdsoap2.cpp</code></em> (or <em><code>gsoap/stdsoap2.c</code></em>) and all your sources that include <em><code>gsoap/stdsoap2.h</code></em> or <em><code>soapH.h</code></em> with compile-time flag <code><a class="el" href="group__group__with.html#gad30a07ea604aea8cb00f41f6310cf30f" title="When this macro is defined at compile time (undefined by default), enables linkage with the zlib libr...">WITH_GZIP</a></code> and link your code with the Zlib library, e.g. <b><code>-lz</code></b> on Unix/Linux platforms.</p>
<p>The gzip compression is orthogonal to all transport encodings such as HTTP, SSL, DIME, and can be used with other transport layers. You can even save and load compressed XML data to/from files.</p>
<p>Two compression formats are supported by the engine: deflate and gzip. The gzip format is used by default. The gzip format has several benefits over deflate. Firstly, the engine automatically detects gzip compressed inbound messages, even without HTTP headers, by checking for the presence of a gzip header in the message content. Secondly, gzip includes a CRC32 checksum to ensure messages have been correctly received. Thirdly, gzip compressed content can be decompressed with other compression software, so you can decompress XML data saved by a gSOAP application in gzip format.</p>
<p>Gzip compression is enabled by compiling the sources with compile-time flag <code><a class="el" href="group__group__with.html#gad30a07ea604aea8cb00f41f6310cf30f" title="When this macro is defined at compile time (undefined by default), enables linkage with the zlib libr...">WITH_GZIP</a></code>. To transmit gzip compressed SOAP/XML data, set the output mode flags to <code><a class="el" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8" title="soap_mode ENC output flag value to compress messages sent, requires zlib enabled with compile-time fl...">SOAP_ENC_ZLIB</a></code>. For example:</p>
<div class="fragment"><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line"><a class="code" href="group__group__context.html#gaf6fa6e197f360834eae124fa37e68cf7">soap_set_omode</a>(&amp;soap, <a class="code" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8">SOAP_ENC_ZLIB</a>); <span class="comment">// enable Zlib&#39;s gzip </span></div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__myMethod(&amp;soap, ...)) </div><div class="line">  ... <span class="comment">// error</span></div><div class="line"><span class="keywordflow">else</span></div><div class="line">  ... <span class="comment">// success</span></div><div class="line"><a class="code" href="group__group__context.html#ga8c28d2943bee7aa5c3ffaf32803b31bd">soap_clr_omode</a>(&amp;soap, <a class="code" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8">SOAP_ENC_ZLIB</a>); <span class="comment">// disable Zlib&#39;s gzip </span></div></div><!-- fragment --><p>This will send a compressed SOAP/XML request to a service, provided that Zlib is installed and linked with the application and the compile-time flag <code><a class="el" href="group__group__with.html#gad30a07ea604aea8cb00f41f6310cf30f" title="When this macro is defined at compile time (undefined by default), enables linkage with the zlib libr...">WITH_GZIP</a></code> option was used to compile the sources. Receiving compressed SOAP/XML over HTTP either in gzip or deflate formats is automatic. The <code><a class="el" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8" title="soap_mode ENC output flag value to compress messages sent, requires zlib enabled with compile-time fl...">SOAP_ENC_ZLIB</a></code> flag does not have to be set at the server side to accept compressed messages. Reading and receiving gzip compressed SOAP/XML without HTTP headers (e.g. with other transport protocols) is also automatic.</p>
<p>To control the level of compression for outbound messages, you can set the <code><a class="el" href="structsoap.html#a9fae46446ebcb1a51417f2c0c1db31f8" title="User-definable compression level for gzip compression (0=none, 1=fast to 9=best) default level is 6...">soap::z_level</a></code> to a value between 1 and 9, where 1 is the best speed and 9 is the best compression (default is 6). For example</p>
<div class="fragment"><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line"><a class="code" href="group__group__context.html#gaf6fa6e197f360834eae124fa37e68cf7">soap_set_omode</a>(&amp;soap, <a class="code" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8">SOAP_ENC_ZLIB</a>); </div><div class="line">soap.<a class="code" href="structsoap.html#a9fae46446ebcb1a51417f2c0c1db31f8">z_level</a> = 9; <span class="comment">// best compression </span></div></div><!-- fragment --><p>To verify and monitor compression rates, you can use the values <code><a class="el" href="structsoap.html#a6cc15a11a897cde81f4303866df747ac" title="The compression ratio = compressed.size/uncompressed.size of the compressed message received...">soap::z_ratio_in</a></code> and <code><a class="el" href="structsoap.html#ab9d0aab0f89e2109ba02ca460c219541" title="The compression ratio = compressed.size/uncompressed.size of the compressed message sent...">soap::z_ratio_out</a></code>. These two float values lie between 0.0 and 1.0 and express the ratio of the compressed message length over uncompressed message length.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (soap_call_ns__myMethod(&amp;soap, ...))</div><div class="line">{</div><div class="line">  ... <span class="comment">// error</span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span></div><div class="line">{</div><div class="line">  printf(<span class="stringliteral">&quot;Compression ratio: %f%% (in) %f%% (out)\n&quot;</span>, 100*soap.<a class="code" href="structsoap.html#ab9d0aab0f89e2109ba02ca460c219541">z_ratio_out</a>, 100*soap.<a class="code" href="structsoap.html#a6cc15a11a897cde81f4303866df747ac">z_ratio_in</a>); </div><div class="line">  ... <span class="comment">// success</span></div><div class="line">}</div></div><!-- fragment --><p>Note: lower ratios mean higher compression rates.</p>
<p>Compressed transfers require buffering the entire output message to determine HTTP message length. This means that the <code><a class="el" href="group__group__flags.html#gaf7cbb692f85f8633c4efc66dfae41e9e" title="soap_mode IO output flag value to store messages temporarily before transmission, e...">SOAP_IO_STORE</a></code> flag is automatically set when the <code><a class="el" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8" title="soap_mode ENC output flag value to compress messages sent, requires zlib enabled with compile-time fl...">SOAP_ENC_ZLIB</a></code> flag is set to send compressed messages. The use of HTTP chunking significantly reduces memory usage and may speed up the transmission of compressed SOAP/XML messages. This is accomplished by setting the <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code> flag with <code><a class="el" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8" title="soap_mode ENC output flag value to compress messages sent, requires zlib enabled with compile-time fl...">SOAP_ENC_ZLIB</a></code> for the output mode. However, some Web servers do not accept HTTP chunked request messages (even when they return HTTP chunked messages!). Stand-alone gSOAP services always accept chunked request messages.</p>
<p>To restrict the compression to the deflate format only, compile the sources with the compile-time flag <code><a class="el" href="group__group__with.html#gad2cdc1f87f3fc46b92e957d9e251797c" title="When this macro is defined at compile time (undefined by default), enables linking the zlib library f...">WITH_ZLIB</a></code>. This limits compression and decompression to the deflate format. Only plain and deflated messages can be exchanged, gzip is not supported with this option. Receiving gzip compressed content is automatic, even in the absence of HTTP headers. Receiving deflate compressed content is not automatic in the absence of HTTP headers and requires the flag <code><a class="el" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8" title="soap_mode ENC output flag value to compress messages sent, requires zlib enabled with compile-time fl...">SOAP_ENC_ZLIB</a></code> to be set for the input mode to decompress deflated data.</p>
<dl class="section warning"><dt>Warning</dt><dd>It is important that the <code><a class="el" href="group__group__with.html#gad30a07ea604aea8cb00f41f6310cf30f" title="When this macro is defined at compile time (undefined by default), enables linkage with the zlib libr...">WITH_GZIP</a></code> and <code><a class="el" href="group__group__with.html#gad2cdc1f87f3fc46b92e957d9e251797c" title="When this macro is defined at compile time (undefined by default), enables linking the zlib library f...">WITH_ZLIB</a></code> macros must be consistently defined to compile the sources, such as <em><code>gsoap/stdsoap2.cpp</code></em>, <em><code>soapC.cpp</code></em>, <em><code>soapClient.cpp</code></em>, <em><code>soapServer.cpp</code></em>, and all application sources that include <em><code>gsoap/stdsoap2.h</code></em> or <em><code>soapH.h</code></em>. If the macros are not consistently used, the application will crash due to a mismatches in the declaration and access of the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="clientcookie"></a>
Client-side cookie support</h2>
<p>Client-side cookie support is optional. To enable cookie support, compile all sources with the compile-time flag <code><a class="el" href="group__group__with.html#ga77f061a12d88eb8b7dae8b07cf90e29d" title="When this macro is defined at compile time (undefined by default), HTTP cookie support is enabled in ...">WITH_COOKIES</a></code>, for example: </p><pre class="fragment"> c++ -DWITH_COOKIES -o myclient stdsoap2.cpp soapC.cpp soapClient.cpp
</pre><p>or add the following line to <em><code>stdsoap.h</code></em>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define WITH_COOKIES</span></div></div><!-- fragment --><p>Client-side cookie support is fully automatic. So just compile <em><code>gsoap/stdsoap2.cpp</code></em> with the compile-time flag <code><a class="el" href="group__group__with.html#ga77f061a12d88eb8b7dae8b07cf90e29d" title="When this macro is defined at compile time (undefined by default), HTTP cookie support is enabled in ...">WITH_COOKIES</a></code> to enable cookie-based session control in your client.</p>
<p>A cookie store with cookies is kept and returned to the appropriate servers when the client connects to these servers. Cookies are not automatically saved to a file by a client. An example cookie file manager is included as an extras in the gSOAP package. You can remove all cookies from a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context by calling <code>soap_free_cookies(soap)</code>, which also happens when you call <code>soap_done(soap)</code>.</p>
<p>To avoid "cookie storms" caused by malicious servers that return an unreasonable amount of cookies, gSOAP clients/servers are limited to a cookie store size of <code><a class="el" href="structsoap.html#a44bd7fc8ba08b1dec2f08299d7f723dd" title="User-definable maximum number of active cookies allowed to be set with soap_set_cookie before cookie ...">soap::cookie_max</a></code> that the user can change, for example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a44bd7fc8ba08b1dec2f08299d7f723dd">cookie_max</a> = 10;</div></div><!-- fragment --><p>The cookie store is a linked list of <code><a class="el" href="structsoap__cookie.html" title="Cookie structure. ">soap_cookie</a></code> structures pointed to by <code><a class="el" href="structsoap.html#acefda44460d269105320e1ebe186608f" title="The cookie store is a linked list of cookies. ">soap::cookies</a></code>.</p>
<p>Since the cookie store is linked to the current <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context, and each thread must use its own context, each thread also has its own cookie store.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="servercookie"></a>
Server-side cookie support</h2>
<p>This feature is not recommended to implement state in stand-alone servers. Cookies may require a fair amount of processing overhead and are not in fact needed to implement stateful services, which is typically performed with session IDs in XML/JSON messages or by passing the session IDs via the URL.</p>
<p>Server-side cookie support is optional. To enable cookie support, compile all sources with compile-time flag <code><a class="el" href="group__group__with.html#ga77f061a12d88eb8b7dae8b07cf90e29d" title="When this macro is defined at compile time (undefined by default), HTTP cookie support is enabled in ...">WITH_COOKIES</a></code>: </p><pre class="fragment"> c++ -DWITH_COOKIES -o myserver ...
</pre><p>See API documentation Module <a class="el" href="group__group__cookies.html">HTTP cookie functions</a> for the cookie API functions. See the <a href="../../sessions/html/index.html">HTTP sessions plugin</a> for HTTP session management with cookies that is required for server-side session control. The <code><a class="el" href="group__group__with.html#ga77f061a12d88eb8b7dae8b07cf90e29d" title="When this macro is defined at compile time (undefined by default), HTTP cookie support is enabled in ...">WITH_COOKIES</a></code> flag is useless without server-side session management and control.</p>
<p>Here is an overview of the cookie API functions:</p>
<ul>
<li><code>struct <a class="el" href="structsoap__cookie.html" title="Cookie structure. ">soap_cookie</a> *soap_set_cookie(struct soap *soap, const char *name, const char *value, const char *domain, const char *path);</code> This function adds a cookie to the cookie store at the server side, if not already there, with the specified <code>name</code> and <code>value</code>. The <code>domain</code> and <code>path</code> parameters can be specified or can be NULL to use the current domain and path given by <code><a class="el" href="structsoap.html#af2ecfbae740da7839a0c5c96eb65db2a" title="User-definable string that specifies the HTTP cookie domain of the running server. ">soap::cookie_domain</a></code> and <code><a class="el" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb" title="User-definable string that specifies the HTTP cookie path of the running server. ">soap::cookie_path</a></code>. Returns pointer to the cookie structure in the database or NULL when an error occurred.</li>
<li><code>int <a class="el" href="group__group__cookies.html#gae22594f7ccdd5476bcdd93626b3006ef" title="Set cookie expiration. ">soap_set_cookie_expire(struct soap *soap, const char *name, long expire, const char *domain, const char *path)</a>;</code> This function sets the expiration of the specified cookie <code>name</code> in seconds and updates the cookie store at the server side. The <code>domain</code> and <code>path</code> parameters can be specified or can be NULL to use the current domain and path given by <code><a class="el" href="structsoap.html#af2ecfbae740da7839a0c5c96eb65db2a" title="User-definable string that specifies the HTTP cookie domain of the running server. ">soap::cookie_domain</a></code> and <code><a class="el" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb" title="User-definable string that specifies the HTTP cookie path of the running server. ">soap::cookie_path</a></code>. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code.</li>
<li><code>int <a class="el" href="group__group__cookies.html#gac7ecc82a09c396a50c56ce801662de71" title="Set cookie secure. ">soap_set_cookie_secure(struct soap *soap, const char *name, const char *domain, const char *path)</a>;</code> This function sets the "secure" property of the specified cookie <code>name</code> and updates the cookie store at the server side. The "secure" property means that this cookie should be sent by the client to the server only when a secure HTTPS connection can be established. When HTTPS is enabled all cookies are sent by the server to the client with the "secure" property set, which means that this function is generally not needed unless the server is not HTTPS-enabled but cookies must be secure. The <code>domain</code> and <code>path</code> parameters can be specified or can be NULL to use the current domain and path given by <code><a class="el" href="structsoap.html#af2ecfbae740da7839a0c5c96eb65db2a" title="User-definable string that specifies the HTTP cookie domain of the running server. ">soap::cookie_domain</a></code> and <code><a class="el" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb" title="User-definable string that specifies the HTTP cookie path of the running server. ">soap::cookie_path</a></code>. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code.</li>
<li><code>int <a class="el" href="group__group__cookies.html#ga5f7d712b3d1c7c2a09741aa45621dfb5" title="Set session cookie. ">soap_set_cookie_session(struct soap *soap, const char *name, const char *domain, const char *path)</a>;</code> This function makes the specified cookie <code>name</code> a "session cookie" and updates the cookie store at the server side by marking the cookie as a session cookie. This means that the cookie will be sent to clients that connect to the server. This function is not needed when a cookie is modified with <code><a class="el" href="group__group__cookies.html#gae22594f7ccdd5476bcdd93626b3006ef" title="Set cookie expiration. ">soap_set_cookie_expire</a></code>, for example, because modified cookies are always sent back to the client. The <code>domain</code> and <code>path</code> parameters can be specified or can be NULL to use the current domain and path given by <code><a class="el" href="structsoap.html#af2ecfbae740da7839a0c5c96eb65db2a" title="User-definable string that specifies the HTTP cookie domain of the running server. ">soap::cookie_domain</a></code> and <code><a class="el" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb" title="User-definable string that specifies the HTTP cookie path of the running server. ">soap::cookie_path</a></code>. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code.</li>
<li><code>void <a class="el" href="group__group__cookies.html#gac6b00dc725a0e74cf0342070151da94f" title="Clear cookie. ">soap_clr_cookie(struct soap *soap, const char *name, const char *domain, const char *path)</a>;</code> This function deletes the specified cookie <code>name</code> from the cookie store at the server side. The <code>domain</code> and <code>path</code> parameters can be specified or can be NULL to use the current domain and path given by <code><a class="el" href="structsoap.html#af2ecfbae740da7839a0c5c96eb65db2a" title="User-definable string that specifies the HTTP cookie domain of the running server. ">soap::cookie_domain</a></code> and <code><a class="el" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb" title="User-definable string that specifies the HTTP cookie path of the running server. ">soap::cookie_path</a></code>.</li>
<li><code>int <a class="el" href="group__group__cookies.html#ga760df00c0998efaeaddc39e401f3e168" title="Clear session cookie. ">soap_clr_cookie_session(struct soap *soap, const char *name, const char *domain, const char *path)</a>;</code> This function clears the session property of the specified cookie <code>name</code> and updates the cookie store at the server side. The <code>domain</code> and <code>path</code> parameters can be specified or can be NULL to use the current domain and path given by <code><a class="el" href="structsoap.html#af2ecfbae740da7839a0c5c96eb65db2a" title="User-definable string that specifies the HTTP cookie domain of the running server. ">soap::cookie_domain</a></code> and <code><a class="el" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb" title="User-definable string that specifies the HTTP cookie path of the running server. ">soap::cookie_path</a></code>. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code.</li>
<li><code>struct <a class="el" href="structsoap__cookie.html" title="Cookie structure. ">soap_cookie</a> *soap_cookie(struct soap *soap, const char *name, const char *domain, const char *path);</code> This function returns the cookie structure of the specified cookie <code>name</code> or NULL when not found by searching the cookie store at the server side. The <code>domain</code> and <code>path</code> parameters can be specified or can be NULL to use the current domain and path given by <code><a class="el" href="structsoap.html#af2ecfbae740da7839a0c5c96eb65db2a" title="User-definable string that specifies the HTTP cookie domain of the running server. ">soap::cookie_domain</a></code> and <code><a class="el" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb" title="User-definable string that specifies the HTTP cookie path of the running server. ">soap::cookie_path</a></code>.</li>
<li><code>const char *soap_cookie_value(struct soap *soap, const char *name, const char *domain, const char *path);</code> This function returns the cookie value of the specified cookie <code>name</code> or NULL when not found by searching the cookie store at the server side. The <code>domain</code> and <code>path</code> parameters can be specified or can be NULL to use the current domain and path given by <code><a class="el" href="structsoap.html#af2ecfbae740da7839a0c5c96eb65db2a" title="User-definable string that specifies the HTTP cookie domain of the running server. ">soap::cookie_domain</a></code> and <code><a class="el" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb" title="User-definable string that specifies the HTTP cookie path of the running server. ">soap::cookie_path</a></code>.</li>
<li><code>time_t <a class="el" href="group__group__cookies.html#gaac3464da4691fe86b2421bafecee0b6d" title="Get cookie expiration. ">soap_cookie_expire(struct soap *soap, const char *name, const char *domain, const char *path)</a>;</code> This function returns the cookie expiration time <code>time_t</code> of the specified cookie <code>name</code> or -1 when not found by searching the cookie store at the server side. The <code>domain</code> and <code>path</code> parameters can be specified or can be NULL to use the current domain and path given by <code><a class="el" href="structsoap.html#af2ecfbae740da7839a0c5c96eb65db2a" title="User-definable string that specifies the HTTP cookie domain of the running server. ">soap::cookie_domain</a></code> and <code><a class="el" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb" title="User-definable string that specifies the HTTP cookie path of the running server. ">soap::cookie_path</a></code>.</li>
<li><code>int <a class="el" href="group__group__cookies.html#ga7e55b641c3a3d6f9710b523e41917fe8" title="Get cookies from the HTTP_COOKIE environment variable. ">soap_getenv_cookies(struct soap *soap)</a>;</code> This function initializes the cookie store at the server side by reading the <code>HTTP_COOKIE</code> environment variable. This provides a means for a CGI application to read cookies sent by a client. Returns <code><a class="el" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0" title="The soap_status code for no error (zero) ">SOAP_OK</a></code> or a <code><a class="el" href="group__group__errors.html#gac0eadf8f72bacb5b41b750beaeca0444" title="Status and error codes are int values, a zero value or SOAP_OK (0) means no error, nonzero means error. ">soap_status</a></code> error code when the <code>HTTP_COOKIE</code> variable was not found.</li>
<li><code>void <a class="el" href="group__group__cookies.html#gacf59ec191a3c7012dd6171f7db3d2c6b" title="Free cookies. ">soap_free_cookies(struct soap *soap)</a>;</code> This function frees the cookie store and deletes all cookies.</li>
</ul>
<p>The following variables of the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context are used to define the current domain and path:</p>
<ul>
<li><code>const char * <a class="el" href="structsoap.html#af2ecfbae740da7839a0c5c96eb65db2a" title="User-definable string that specifies the HTTP cookie domain of the running server. ">soap::cookie_domain</a></code> should be set to the domain (host) of the service</li>
<li><code>const char * <a class="el" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb" title="User-definable string that specifies the HTTP cookie path of the running server. ">soap::cookie_path</a></code> may be set to the default path to the service</li>
<li><code>int <a class="el" href="structsoap.html#a44bd7fc8ba08b1dec2f08299d7f723dd" title="User-definable maximum number of active cookies allowed to be set with soap_set_cookie before cookie ...">soap::cookie_max</a></code> maximum cookie database size (default=32)</li>
</ul>
<p>The <code><a class="el" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb" title="User-definable string that specifies the HTTP cookie path of the running server. ">soap::cookie_path</a></code> value is used to filter cookies intended for this service according to the path prefix rules outlined in RFC2109.</p>
<p>The following example server adopts cookies for session control:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap soap; </div><div class="line">  <span class="keywordtype">int</span> m, s; </div><div class="line">  <a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">  soap.<a class="code" href="structsoap.html#af2ecfbae740da7839a0c5c96eb65db2a">cookie_domain</a> = <span class="stringliteral">&quot;...&quot;</span>; </div><div class="line">  soap.<a class="code" href="structsoap.html#afdd91ce1189fedd32ebfa51dd6ed33eb">cookie_path</a> = <span class="stringliteral">&quot;/&quot;</span>; <span class="comment">// the path which is used to filter/set cookies with this destination </span></div><div class="line">  <span class="keywordflow">if</span> (argc &lt; 2) </div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__cookies.html#ga7e55b641c3a3d6f9710b523e41917fe8">soap_getenv_cookies</a>(&amp;soap); <span class="comment">// CGI app: grab cookies from &#39;HTTP_COOKIE&#39; env var </span></div><div class="line">    <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(&amp;soap); </div><div class="line">  } </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">  {</div><div class="line">    m = <a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(&amp;soap, NULL, atoi(argv[1]), 10); <span class="comment">// small BACKLOG for iterative servers</span></div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(m)) </div><div class="line">      exit(EXIT_FAILURE); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; ; i++) </div><div class="line">    {</div><div class="line">      s = <a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(&amp;soap); </div><div class="line">      <span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(s)) </div><div class="line">        exit(EXIT_FAILURE); </div><div class="line">      <a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(&amp;soap); </div><div class="line">      <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap);</div><div class="line">      <a class="code" href="group__group__cookies.html#gacf59ec191a3c7012dd6171f7db3d2c6b">soap_free_cookies</a>(&amp;soap); <span class="comment">// remove all old cookies from database so no interference occurs with the arrival of new cookies </span></div><div class="line">    } </div><div class="line">  } </div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keyword">struct</span> soap *soap, ...) </div><div class="line">{</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *cookie_value = <a class="code" href="group__group__cookies.html#ga0dd82c4fd7b499208d2402b195a182fe">soap_cookie_value</a>(soap, <span class="stringliteral">&quot;cookie_name&quot;</span>, NULL, NULL);</div><div class="line">  <span class="keywordflow">if</span> (!cookie_value)                <span class="comment">// cookie returned by client? </span></div><div class="line">    cookie_value = <span class="stringliteral">&quot;initial_value&quot;</span>; <span class="comment">// no: set initial cookie value </span></div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">    ...                             <span class="comment">// yes: modify the cookie value to reflect the new state</span></div><div class="line">  <a class="code" href="group__group__cookies.html#ga7d5b0588ea763e511772f0cc2498e322">soap_set_cookie</a>(soap, <span class="stringliteral">&quot;cookie_name&quot;</span>, cookie_value, NULL, NULL); </div><div class="line">  <a class="code" href="group__group__cookies.html#gae22594f7ccdd5476bcdd93626b3006ef">soap_set_cookie_expire</a>(soap, <span class="stringliteral">&quot;cookie_name&quot;</span>, 60, NULL, NULL); <span class="comment">// cookie expires in 60 seconds </span></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="proxyservers"></a>
Connecting clients through proxy servers</h2>
<p>When a client needs to connect to a Web Service through a proxy server, set the <code><a class="el" href="structsoap.html#ac172bd9019afeebb3635b3a9f72a9101" title="User-definable proxy host name string which should be set to connect through an HTTP proxy...">soap::proxy_host</a></code> string and <code><a class="el" href="structsoap.html#a037554fd2cf54fb9a6d5326b11c8ffa0" title="User-definable proxy port which should be set to connect through an HTTP proxy (the value is 8080 by ...">soap::proxy_port</a></code> integer attributes of the current <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context to the proxy's host name and port, respectively. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap soap; </div><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line">soap.<a class="code" href="structsoap.html#ac172bd9019afeebb3635b3a9f72a9101">proxy_host</a> = <span class="stringliteral">&quot;proxyhostname&quot;</span>; </div><div class="line">soap.<a class="code" href="structsoap.html#a037554fd2cf54fb9a6d5326b11c8ffa0">proxy_port</a> = 8080; </div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__webmethod(&amp;soap, <span class="stringliteral">&quot;http://host:port/path&quot;</span>, <span class="stringliteral">&quot;action&quot;</span>, ...)) </div><div class="line">  <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(&amp;soap, stderr); </div><div class="line"><span class="keywordflow">else</span> </div><div class="line">  ... <span class="comment">// success</span></div></div><!-- fragment --><p>The context attributes <code><a class="el" href="structsoap.html#ac172bd9019afeebb3635b3a9f72a9101" title="User-definable proxy host name string which should be set to connect through an HTTP proxy...">soap::proxy_host</a></code> and <code><a class="el" href="structsoap.html#a037554fd2cf54fb9a6d5326b11c8ffa0" title="User-definable proxy port which should be set to connect through an HTTP proxy (the value is 8080 by ...">soap::proxy_port</a></code> keep their values through a sequence of service operation calls, so they only need to be set once.</p>
<p>When X-Forwarded-For headers are returned by the proxy, the header can be accessed in the <code><a class="el" href="structsoap.html#a59b7a3c700fd54ba1708f97c7b60876b" title="The X-Forwarding-For HTTP header string value received. ">soap::proxy_from</a></code> string.</p>
<p>See also Sections <a class="el" href="index.html#proxyauthentication">HTTP proxy basic authentication</a> and <a class="el" href="index.html#NTLMproxyauthentication">HTTP proxy NTLM authentication</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="bindbeforeconnect"></a>
Bind before connect and setting the client interface address</h2>
<p>To bind the client to a port before connect, set the <code><a class="el" href="structsoap.html#a9b424c2622c9f8e4284eba0e6c74e67c" title="User-definable client port to bind to before connecting to a server, when non-negative. ">soap::client_port</a></code> to a non-negative port number:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#a9b424c2622c9f8e4284eba0e6c74e67c">client_port</a> = ...; <span class="comment">// non-negative port number </span></div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, <span class="stringliteral">&quot;http://host:port/path&quot;</span>, <span class="stringliteral">&quot;action&quot;</span>, ...)) </div><div class="line">  ... <span class="comment">// error</span></div><div class="line"><span class="keywordflow">else</span> </div><div class="line">  ... <span class="comment">// success</span></div></div><!-- fragment --><p>This port number is used only once and reset to -1 (disabled). Set it again for the next call.</p>
<p>To set a client interface address for the connection that is an IP address of the client:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">soap-&gt;<a class="code" href="structsoap.html#aa66026bcd099d88d44c985b49928a05d">client_interface</a> = <span class="stringliteral">&quot;...&quot;</span>; <span class="comment">// IP address </span></div><div class="line"><span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, <span class="stringliteral">&quot;http://host:port/path&quot;</span>, <span class="stringliteral">&quot;action&quot;</span>, ...)) </div><div class="line">  ... <span class="comment">// error</span></div><div class="line"><span class="keywordflow">else</span> </div><div class="line">  ... <span class="comment">// success</span></div></div><!-- fragment --><p>This client interface address string is used only once and reset to NULL (disabled). Set it again for the next call. This feature is not available when compiling the code on windows.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="fastcgi"></a>
FastCGI</h2>
<p>To enable FastCGI support, install FastCGI and compile all soapcpp2-generated source code files and your application sources with the compile-time flag <code><a class="el" href="group__group__with.html#gac697013bbde81d22d15d83d122f85f18" title="When this macro is defined at compile time (undefined by default), enables and configures the engine ...">WITH_FASTCGI</a></code> or add:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define WITH_FASTCGI</span></div></div><!-- fragment --><p>to <em><code>gsoap/stdsoap2.h</code></em> and recompile the project code.</p>
<dl class="section warning"><dt>Warning</dt><dd>Do not link against the <em><code>gsoap/libgsoap*</code></em> libraries as these are not suitable for FastCGI. Compile <em><code>gsoap/stdsoap2.c</code></em> (or <em><code>gsoap/stdsoap2.cpp</code></em>) instead.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="lean"></a>
How to minimize application memory footprint</h2>
<p>To compile gSOAP applications intended for small memory devices, you may want to remove all non-essential features that consume precious code and data space. To do this, compile the source code files with the compile-time flag <code><a class="el" href="group__group__with.html#gaae03aa5dd66b0251c11ba8fc2fe29ecf" title="When this macro is defined at compile time (undefined by default), memory footprint is significantly ...">WITH_LEAN</a></code> (i.e. <code>#define WITH_LEAN</code>) to remove many non-essential features. The features that will be disabled are:</p>
<ul>
<li>No UDP support</li>
<li>No HTTP keep alive support</li>
<li>No HTTP bearer, basic, and digest authentication</li>
<li>No HTTP chunked output with <code><a class="el" href="group__group__flags.html#gaea7443dc67c979b06cf347ed16db1b51" title="soap_mode IO output flag value to send HTTP chunked messages, buffers the message in packets of size ...">SOAP_IO_CHUNK</a></code>, but chunked HTTP input is accepted</li>
<li>No HTTP compressed output with <code><a class="el" href="group__group__flags.html#gafa62be7ba46b50d58608a066f442c2a8" title="soap_mode ENC output flag value to compress messages sent, requires zlib enabled with compile-time fl...">SOAP_ENC_ZLIB</a></code>, but compressed input is accepted</li>
<li>No canonical XML output with <code><a class="el" href="group__group__flags.html#ga757fa32433be64f8c228b1ecce727815" title="soap_mode XML output flag value to send XML messages in exclusive canonical format as per W3C XML C14...">SOAP_XML_CANONICAL</a></code></li>
<li>No <code><a class="el" href="structsoap.html#af32b5f3975eac2bd1202571515859163" title="User-definable timeout when waiting to connect to a server at the client-side, positive timeout value...">soap::connect_timeout</a></code>, <code><a class="el" href="structsoap.html#a711bb3a53de7cc62429e4d3a2e0b5474" title="User-definable timeout to send a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::send_timeout</a></code>, <code><a class="el" href="structsoap.html#ac5d5fb92fffda724ccb3b038d2bb2388" title="User-definable timeout to receive a packet of data, positive timeout values are seconds, negative timeout values are microseconds, zero means no timeout (the value is 0 by default) ">soap::recv_timeout</a></code> and <code><a class="el" href="structsoap.html#afcf1d236d052579122f785d7639c43c7" title="User-definable timeout to send or receive an entire message, positive timeout values are seconds...">soap::transfer_timeout</a></code> timeouts</li>
<li>No support for socket flags, no <code><a class="el" href="structsoap.html#aae3eee771d8c4031d30d4ca7633edf9f" title="User-definable socket send and recv flags, for example assign MSG_NOSIGNAL to disable sigpipe (the va...">soap::socket_flags</a></code>, <code><a class="el" href="structsoap.html#a52a22fafc369b3a54fb0d16f53158794" title="User-definable setsockopt level SOL_SOCKET flags when connecting soap::socket to a server (the value ...">soap::connect_flags</a></code>, <code><a class="el" href="structsoap.html#a6b18b017ce2c77ac2b6331469094de59" title="User-definable setsockopt level SOL_SOCKET flags when binding soap::master socket (the value is 0 by ...">soap::bind_flags</a></code>, <code><a class="el" href="structsoap.html#ad98f12f602efdde049dbd367a43e7cb0" title="User-definable setsockopt level SOL_SOCKET flags (0 by default), when nonzero sets the soap::socket f...">soap::accept_flags</a></code></li>
<li>No support for <code>time_t</code> serialization with the <code>xsd__dateTime</code> type, use a string to store the date and time instead.</li>
</ul>
<p>Use the compile-time flag <code><a class="el" href="group__group__with.html#ga6c72f5017edb6930c54a8f70d9fb40b9" title="When this macro is defined at compile time (undefined by default), memory footprint is further reduce...">WITH_LEANER</a></code> to make the executable even smaller by removing DIME and MIME attachment handling, <code><a class="el" href="group__group__soap.html#ga78b36c5636eb5283d651b69d8684c6ae" title="User-definable macro that represents a portable signed 64 bit integer type. ">LONG64</a></code> (64 bit) serialization, <code>wchar_t*</code> serialization, and support for XML DOM operations. Note that DIME/MIME attachments are not essential to achieve SOAP/XML interoperability. DIME attachments are a convenient way to exchange non-text-based (i.e. binary) content, but are not required for basic SOAP/XML interoperability. Attachment requirements are predictable. That is, applications won't suddenly decide to use DIME or MIME instead of XML to exchange content.</p>
<p>It is safe to try to compile your application with the compile-time flag <code><a class="el" href="group__group__with.html#gaae03aa5dd66b0251c11ba8fc2fe29ecf" title="When this macro is defined at compile time (undefined by default), memory footprint is significantly ...">WITH_LEAN</a></code>, provided that your application does not rely on I/O timeouts. When no linkage error occurs in the compilation process, it is safe to assume that your application will run just fine.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="noio"></a>
How to remove the BSD socket library requirement</h2>
<p>The <em><code>gsoap/stdsoap2.c</code></em> and <em><code>gsoap/stdsoap2.cpp</code></em> libraries should be linked with a BSD socket library in the project build. To remove the need to link a socket library, you can compile <em><code>gsoap/stdsoap2.c</code></em> (for C) and <em><code>gsoap/stdsoap2.cpp</code></em> (for C++) with the the compile-time flag <code><a class="el" href="group__group__with.html#ga93604d4f98eeeedcc7af19ff83192308" title="When this macro is defined at compile time (undefined by default), removes all IO and socket library ...">WITH_NOIO</a></code> macro set (i.e. <code>#define WITH_NOIO</code>). This removes the dependency on the BSD socket API, IO streams, <code>FILE</code> type, and <code>errno</code>.</p>
<p>You should define callbacks to replace the missing socket stack. To do so, add to your code the following definitions:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap soap; </div><div class="line"><a class="code" href="group__group__context.html#ga8e034e1a7d6093eaddc11b647179657c">soap_init</a>(&amp;soap); </div><div class="line"><span class="comment">/* fsend is used to transmit data in blocks */</span> </div><div class="line">soap.<a class="code" href="group__group__callbacks.html#gafd52b80655e4f1021edd6c55b8dfedff">fsend</a> = my_send; </div><div class="line"><span class="comment">/* frecv is used to receive data in blocks */</span> </div><div class="line">soap.<a class="code" href="group__group__callbacks.html#ga0c218cd5552045745cc640998e25ed72">frecv</a> = my_recv; </div><div class="line"><span class="comment">/* fopen is used to connect */</span> </div><div class="line">soap.<a class="code" href="group__group__callbacks.html#ga9b4985eb5a588f4c16ad88ef7ca329dc">fopen</a> = my_tcp_connect; </div><div class="line"><span class="comment">/* fclose is used to disconnect */</span> </div><div class="line">soap.<a class="code" href="group__group__callbacks.html#gab9591dd80dbb0e571784bad5421b2202">fclose</a> = my_tcp_disconnect; </div><div class="line"><span class="comment">/* fclosesocket is used only to close the master socket in a server upon soap_done() */</span> </div><div class="line">soap.<a class="code" href="group__group__callbacks.html#ga21edadcbd081c7f37822d04bb05a9d29">fclosesocket</a> = my_tcp_closesocket; </div><div class="line"><span class="comment">/* fshutdownsocket is used after completing a send operation to send TCP FIN */</span> </div><div class="line">soap.<a class="code" href="group__group__callbacks.html#ga51e09ddf769a2ddcd874fb6e6fb5289d">fshutdownsocket</a> = my_tcp_shutdownsocket; </div><div class="line"><span class="comment">/* setting fpoll is optional, leave it NULL to omit polling the server */</span> </div><div class="line">soap.<a class="code" href="group__group__callbacks.html#ga20210aa171019b27ef182d853e2d6e2f">fpoll</a> = my_poll; </div><div class="line"><span class="comment">/* faccept is used only by a server application */</span> </div><div class="line">soap.<a class="code" href="group__group__callbacks.html#ga8249b4c23f662dbe680ad0deef274ae8">faccept</a> = my_accept;</div></div><!-- fragment --><p>These functions should provide a minimal input/output stack (<code><a class="el" href="group__group__callbacks.html#ga0c218cd5552045745cc640998e25ed72" title="Callback that receives bytes of data into the given buffer. ">soap::frecv</a></code> and <code><a class="el" href="group__group__callbacks.html#gafd52b80655e4f1021edd6c55b8dfedff" title="Callback that sends the given bytes of data. ">soap::fsend</a></code>) to read/write XML and socket-like stack (the other functions) when developing client and server applications.</p>
<p>See Section <a class="el" href="index.html#callback">Function callbacks for customized I/O and HTTP handling</a> for more details on the use of these callbacks. All callback function pointers should be non-NULL, except <code><a class="el" href="group__group__callbacks.html#ga20210aa171019b27ef182d853e2d6e2f" title="Callback that blocks until activity is detected on the soap::socket or soap::master socket...">soap::fpoll</a></code>.</p>
<p>You cannot use <code><a class="el" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af" title="Print error message on the specified output. ">soap_print_fault</a></code> and <code><a class="el" href="group__group__fault.html#gaa70822938e0f116d1d0020aff66cc795" title="Print the location in the message where and when the error occurred. ">soap_print_fault_location</a></code> to print error diagnostics. Instead, the value of <code><a class="el" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2" title="The soap context soap_status (int) error code of the last operation or SOAP_OK (zero) ...">soap::error</a></code>, which contains the gSOAP error code, can be used to determine the cause of a fault.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="combine"></a>
How to combine multiple client and server implementations into one executable</h2>
<p>The wsdl2h tool can be used to import multiple WSDLs and schemas at once. The service definitions are combined in one header file to be parsed by soapcpp2. It is important to assign namespace prefixes to namespace URIs using the <em><code>typemap.dat</code></em> file. Otherwise, wsdl2h will assign namespace prefixes <code>ns1</code>, <code>ns2</code>, and so on to the service operations and schema types. Thus, any change to a WSDL or schema may result in a new prefix assignment. For more details, please see Section <a class="el" href="index.html#typemap">Customizing XML data bindings with the typemap.dat file</a> .</p>
<p>Another approach to combine multiple client and service applications into one executable is by using C++ namespaces to structurally separate the definitions. This is automated with <a href="#wsdl2h-q"><b><code>wsdl2h -q name</code></b> option <b><code>-q name</code></b></a>. Or by creating libraries in C for the client/server objects as explained in subsequent sections</p>
<p>Both approaches are demonstrated by examples in the gSOAP source code package, the <em><code>gsoap/samples/link</code></em> (C only) and <em><code>gsoap/samples/link++</code></em> (C++ with C++ namespaces) examples.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="codenamespace"></a>
How to build a client or server in a C++ code namespace</h2>
<p>You can use a C++ code namespace of your choice in your interface header file to build a client or server in that C++ namespace. In this way, you can create multiple clients and servers that can be combined and linked together without conflicts, which is explained in more detail in the next section (which also shows an example combining two client libraries defined in two C++ code namespaces).</p>
<p>Use <a href="#wsdl2h-q"><b><code>wsdl2h -q name</code></b> option <b><code>-q name</code></b></a> to generate definitions in the C++ <code>name</code> namespace. This option can also be used in combination with C++ proxy and server object generation, using <b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b> or option <b><code>-i</code></b>).</p>
<p>At most one namespace can be defined for the entire interface header file for soapcpp2. The C++ namespace must completely encapsulate the entire contents of the header file:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>NamespaceName {</div><div class="line">  ... <span class="keyword">interface </span>header file contents ... </div><div class="line">}</div></div><!-- fragment --><p>When compiling this interface header file with the soapcpp2 tool, all type definitions, the serializers for these types, and the stub and skeleton functions will be placed in this namespace. The XML namespace mapping table (saved in a <em><code>.nsmap</code></em> file) will not be placed in the code namespace to allow it to be linked as a global object. You can use <b><code>soapcpp2 -n</code></b> option <b><code>-n</code></b> to create local XML namespace tables, see Section <a class="el" href="index.html#soapcpp2options">soapcpp2 options</a> (but remember that you explicitly need to initialize the namespaces to point to a table at run time using <code><a class="el" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5" title="Activates an XML namespace table to generate and resolve xmlns namespace prefixes in XML messages...">soap_set_namespaces</a></code>). The generated files are prefixed with the code namespace name instead of the usual <em><code>soap</code></em> file name prefix to enable multiple client/server codes to be build in the same project directory.</p>
<p>Because the SOAP Header and Fault serializers will also be placed in the namespace, they cannot be called from the <em><code>gsoap/stdsoap2.cpp</code></em> run time library code and are therefore rendered unusable. Therefore, these serializers are not compiled at all (enforced with <code>#define WITH_NOGLOBAL</code>). To add SOAP Header and Fault serializers, you must compile them separately as follows. First, create a new header file <em><code>env.h</code></em> with the SOAP Header <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> and SOAP Fault <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html" title="SOAP Fault structure. ">SOAP_ENV__Fault</a></code> structures, including <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code> if this structure contains members that are serialized as fault details. You can leave this header file empty if you want to use the default SOAP Header and Fault. However, if SOAP Headers are required then you cannot leave the <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> structure empty. For example, the WS-Addressing and WS-Security plugins require SOAP Headers which can be imported by adding <code>#import "wsa5.h"</code> and <code>#import "wsse.h"</code>, respectively to <em><code>env.h</code></em>. Then compile this header file with: </p><pre class="fragment"> soapcpp2 -penv env.h
</pre><p>The generated <em><code>envC.cpp</code></em> file holds the SOAP Header and Fault serializers and you can link this file with your client and server applications.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="dylibs"></a>
How to create client/server libraries</h2>
<p>The soapcpp2 tool produces <em><code>soapClientLib.cpp</code></em> and <em><code>soapServerLib.cpp</code></em> source code files that are specifically intended for building static or dynamic client and server libraries in C or C++. These files export the stub and skeleton functions, but keep all serialization code static, thus hidden to avoid link symbol conflicts when combining multiple clients and services into one executable. Note that it is far simpler to use the wsdl2h tool on multiple WSDL files to generate a header file that combines all service definitions. However, the approach presented in this section is useful when creating (dynamic) libraries for client and server objects, such as DLLs as described in Section <a class="el" href="index.html#dll">How to create DLLs</a> .</p>
<dl class="section note"><dt>Note</dt><dd>One major disadvantage of the approach presented here is that the serializer functions are no longer accessible in the user's source code, because serializers will be converted to static functions (to be used by the generated stub and skeleton functions only). For example, functions such as <code>soap_new_T</code>, <code>soap_default_T</code>, <code>soap_write_T</code>, <code>soap_read_T</code>, <code>soap_put_T</code>, and <code>soap_get_T</code> cannot be used any longer.</dd></dl>
<p>Using C++ namespaces is a better alternative when building applications in C++ that combine multiple clients and services. To build multiple libraries, you can define a C++ namespace in your header file with <b><code>soapcpp2 -qname</code></b> option <b><code>-qname</code></b>, see Section <a class="el" href="index.html#codenamespace">How to build a client or server in a C++ code namespace</a> for details.</p>
<p>For C, you can use <b><code>soapcpp2 -c -p name</code></b> option <b><code>-p name</code></b> to rename the generated <em><code>soapClientLib.c</code></em> and <em><code>soapServerLib.c</code></em> (and associated) files. The <b><code>-p name</code></b> option specifies the file <em><code>name</code></em> prefix to replace the <em><code>soap</code></em> file name prefix.</p>
<p>The engine does not define SOAP Header and Fault serializers that the engine needs. We therefore add SOAP Header and Fault serializers, which are compiled separately as follows. First, create a new header file <em><code>env.h</code></em> with the SOAP Header <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> and SOAP Fault <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html" title="SOAP Fault structure. ">SOAP_ENV__Fault</a></code> structures, including <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code> if this structure contains members that are serialized as fault details. You can leave this header file empty if you want to use the default SOAP Header and Fault. However, if SOAP Headers are required then you cannot leave the <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> structure empty. For example, the WS-Addressing and WS-Security plugins require SOAP Headers which can be imported by adding <code>#import "wsa5.h"</code> and <code>#import "wsse.h"</code>, respectively to <em><code>env.h</code></em>. Then compile this header file with: </p><pre class="fragment"> soapcpp2 -penv env.h
</pre><p>The generated <em><code>envC.cpp</code></em> file holds the SOAP Header and Fault serializers and you can create a (dynamic) library for it to link it with your client and server applications.</p>
<p>You should then compile the <em><code>gsoap/stdsoap2.cpp</code></em> library with the compile-time <code><a class="el" href="group__group__with.html#gac22000b4058bb41a88750d10785baaf1" title="When this macro is defined at compile time (undefined by default), removes dependence on the global n...">WITH_NONAMESPACES</a></code> flag: </p><pre class="fragment"> c++ -DWITH_NONAMESPACES -c stdsoap2.cpp
</pre><p>This omits the reference to the global namespaces table, which is nowhere to be defined since we will use XML namespaces for each client/service separately. Therefore, you must explicitly set the namespaces value of the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context in your code every time after initialization of the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context with the <code><a class="el" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5" title="Activates an XML namespace table to generate and resolve xmlns namespace prefixes in XML messages...">soap_set_namespaces(struct soap*, const struct Namespace*)</a></code> function.</p>
<p>For example, suppose we have two clients defined in header files <em><code>client1.h</code></em> and <em><code>client2.h</code></em>. We first generate the <em><code>envH.h</code></em> file for the SOAP Header and Fault definitions: </p><pre class="fragment"> soapcpp2 -c -penv env.h
</pre><p>Then we generate the code for client1 and client2: </p><pre class="fragment"> soapcpp2 -c -n -pmyClient1 client1.h
 soapcpp2 -c -n -pmyClient2 client2.h
</pre><p>This generates <em><code>myClient1ClientLib.c</code></em> and <em><code>myClient2ClientLib.c</code></em> (among several other files). These two files should be compiled and linked with your application. The source code of your application should include the generated <em><code>envH.h</code></em>, <em><code>myClient1H.h</code></em>, <em><code>myClient2.h</code></em> files and <em><code>myClient1.nsmap</code></em>, <em><code>myClient2.nsmap</code></em> files:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;myClient1H.h&quot;</span> <span class="comment">// include client 1 stubs </span></div><div class="line"><span class="preprocessor">#include &quot;myClient2H.h&quot;</span> <span class="comment">// include client 2 stubs </span></div><div class="line"><span class="preprocessor">#include &quot;envH.h&quot;</span> </div><div class="line">... <span class="comment">//</span></div><div class="line"><span class="preprocessor">#include &quot;myClient1H.nsmap&quot;</span> <span class="comment">// include client 1 nsmap </span></div><div class="line"><span class="preprocessor">#include &quot;myClient2H.nsmap&quot;</span> <span class="comment">// include client 2 nsmap </span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line"><a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, myClient1_namespaces); </div><div class="line">... <span class="comment">// make Client 1 invocations</span></div><div class="line">... <span class="comment">//</span></div><div class="line"><a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, myClient2_namespaces); </div><div class="line">... <span class="comment">// make Client 2 invocations</span></div></div><!-- fragment --><p>It is important to use <b><code>soapcpp2 -n</code></b> option <b><code>-n</code></b>, see Section <a class="el" href="index.html#soapcpp2options">soapcpp2 options</a>, to rename the namespace tables so we can include them all without running into redefinitions.</p>
<dl class="section note"><dt>Note</dt><dd>Link conflicts may still occur in the unlikely situation that identical service operation names are defined in two or more stub or skeleton functions when these methods share the same XML namespace prefix.</dd></dl>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example13"></a>
C++ examples</h3>
<p>As an example we will build a Delayed Stock Quote client library and a Currency Exchange Rate client library.</p>
<p>First, we create an empty header file <em><code>env.h</code></em>, which may be empty or should contain SOAP Header and Fault definitions as explained in Section <a class="el" href="index.html#dylibs">How to create client/server libraries</a>, and compile it as follows: </p><pre class="fragment"> soapcpp2 -penv env.h
 c++ -c envC.cpp
</pre><p>We also compile <em><code>gsoap/stdsoap2.cpp</code></em> without namespaces: </p><pre class="fragment"> c++ -c -DWITH_NONAMESPACES stdsoap2.cpp
</pre><p>If you do not use <code><a class="el" href="group__group__with.html#gac22000b4058bb41a88750d10785baaf1" title="When this macro is defined at compile time (undefined by default), removes dependence on the global n...">WITH_NONAMESPACES</a></code> then you will get an unresolved link error for the global <code>namespaces</code> table. You can define a dummy table to avoid having to recompile <em><code>gsoap/stdsoap2.cpp</code></em>.</p>
<p>Second, we create the Delayed Stock Quote header file specification, which may be obtained using the WSDL importer. If you want to use C++ namespaces then you need to manually add the <code>namespace</code> declaration to the generated header file:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>quote {</div><div class="line"></div><div class="line"><span class="comment">//gsoap ns service name: Service </span></div><div class="line"><span class="comment">//gsoap ns service style: rpc </span></div><div class="line"><span class="comment">//gsoap ns service encoding: encoded </span></div><div class="line"><span class="comment">//gsoap ns service location: http://services.xmethods.net/soap </span></div><div class="line"><span class="comment">//gsoap ns schema namespace: urn:xmethods-delayed-quotes </span></div><div class="line"><span class="comment">//gsoap ns service method-action: getQuote &quot;&quot; </span></div><div class="line"><span class="keywordtype">int</span> ns__getQuote(<span class="keywordtype">char</span> *symbol, <span class="keywordtype">float</span> &amp;Result); </div><div class="line"></div><div class="line">} <span class="comment">// namespace quote</span></div></div><!-- fragment --><p>We then compile it as a library and we use option <b><code>-n</code></b> to prefix the generated files and to rename the namespace table to avoid link conflicts later: </p><pre class="fragment"> soapcpp2 -n quote.h
 c++ -c quoteClientLib.cpp
</pre><p>If you don't want to use a C++ code namespace, you should compile <em><code>quote.h</code></em> "as is" with option <b><code>-pquote</code></b>: </p><pre class="fragment"> soapcpp2 -n -pquote quote.h
 c++ -c quoteClientLib.cpp
</pre><p>Third, we create the Currency Exchange Rate header file specification:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>rate {</div><div class="line"></div><div class="line"><span class="comment">//gsoap ns service name: Service </span></div><div class="line"><span class="comment">//gsoap ns service style: rpc </span></div><div class="line"><span class="comment">//gsoap ns service encoding: encoded </span></div><div class="line"><span class="comment">//gsoap ns service location: http://services.xmethods.net/soap </span></div><div class="line"><span class="comment">//gsoap ns schema namespace: urn:xmethods-CurrencyExchange </span></div><div class="line"><span class="comment">//gsoap ns service method-action: getRate &quot;&quot; </span></div><div class="line"><span class="keywordtype">int</span> ns__getRate(<span class="keywordtype">char</span> *country1, <span class="keywordtype">char</span> *country2, <span class="keywordtype">float</span> &amp;Result); </div><div class="line"></div><div class="line">} <span class="comment">// namespace rate</span></div></div><!-- fragment --><p>Similar to the Quote example above, we generate source code using option <b><code>-n</code></b> to prefix the generated files and to rename the namespace table to avoid link conflicts: </p><pre class="fragment"> soapcpp2 -n rate.h
</pre><p>Fourth, we use the generated source code libraries with the main program.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;quoteH.h.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;rateH.h.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;quote.nsmap&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;rate.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (argc &lt;= 1) </div><div class="line">  {</div><div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Usage: main ticker [currency]&quot;</span> &lt;&lt; std::endl </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">  <span class="keywordtype">float</span> q; </div><div class="line">  <a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, quote_namespaces); </div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns__getQuote(soap, NULL, NULL, argv[1], q)) <span class="comment">// get quote </span></div><div class="line">  {</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (argc &gt; 2) </div><div class="line">    {</div><div class="line">      <span class="keywordtype">float</span> r; </div><div class="line">      <a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, rate_namespaces); </div><div class="line">      <span class="keywordflow">if</span> (soap_call_ns__getRate(soap, NULL, NULL, <span class="stringliteral">&quot;us&quot;</span>, argv[2], r)) <span class="comment">// get rate in US dollars </span></div><div class="line">        <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">      <span class="keywordflow">else</span> </div><div class="line">        q *= r; <span class="comment">// convert the quote </span></div><div class="line">    } </div><div class="line">    std::cout &lt;&lt; argv[1] &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; q &lt;&lt; std::endl; </div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">}</div></div><!-- fragment --><p>Compile and link this application with <em><code>stdsoap2.o</code></em>, <em><code>envC.o</code></em>, <em><code>quoteServerProxy.o</code></em>, and <em><code>rateServerProxy.o</code></em>.</p>
<p>Instead of the generated <code>soap_call_webmethod</code> stub functions you can also use <b><code>soapcpp2 -j</code></b> option <b><code>-j</code></b> or option <b><code>-i</code></b> to generate C++ proxy classes.</p>
<p>To compile server is very similar. For example, assume that we need to implement a calculator service and we want to create a library for it.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>calc {</div><div class="line"></div><div class="line"><span class="comment">//gsoap ns service name: Calc </span></div><div class="line"><span class="comment">//gsoap ns service style: rpc </span></div><div class="line"><span class="comment">//gsoap ns service encoding: encoded </span></div><div class="line"><span class="comment">//gsoap ns service location: http://www.cs.fsu.edu/~engelen/calc.cgi </span></div><div class="line"><span class="comment">//gsoap ns schema namespace: urn:calc </span></div><div class="line"><span class="keywordtype">int</span> ns__add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> &amp;result); </div><div class="line"><span class="keywordtype">int</span> ns__sub(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> &amp;result); </div><div class="line"><span class="keywordtype">int</span> ns__mul(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> &amp;result); </div><div class="line"><span class="keywordtype">int</span> ns__div(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> &amp;result); </div><div class="line"></div><div class="line">} <span class="comment">// namespace calc</span></div></div><!-- fragment --><p>We generate code: </p><pre class="fragment"> soapcpp2 -j -n calc.h
</pre><p>Here we used option <b><code>-j</code></b> to generate a C++ service class <em><code>calcCalcService.h</code></em> and <em><code>calcCalcService.cpp</code></em>. The effect of the <b><code>-n</code></b> option is that it creates local namespace tables and uses <em><code>calc</code></em> to prefix the generated files.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;calcCalcService.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;calc.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  calc::Calc calc; </div><div class="line">  ... <span class="comment">//</span></div><div class="line">  calc.serve(); <span class="comment">// calls request dispatcher to invoke one of the functions below </span></div><div class="line">  ... <span class="comment">//</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> calc::Calc::add(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> &amp;result)</div><div class="line">{</div><div class="line">  result = a + b;</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>;</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> calc::Calc::sub(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> &amp;result)</div><div class="line">{</div><div class="line">  result = a - b;</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>;</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> calc::Calc::mul(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> &amp;result)</div><div class="line">{</div><div class="line">  result = a * b;</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>;</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> calc::Calc::div(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b, <span class="keywordtype">double</span> &amp;result)</div><div class="line">{</div><div class="line">  result = a / b;</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>;</div><div class="line">} </div></div><!-- fragment --><p>The example above serves requests over stdin/out. Use the bind and accept calls to create a stand-alone server to service inbound requests over sockets, see Section <a class="el" href="index.html#stand-alone">How to create a stand-alone server</a> .</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example14"></a>
C examples</h3>
<p>This is the same example as above, but the clients are build in C.</p>
<p>We create a <em><code>env.h</code></em> that contains the joint SOAP Header and SOAP Fault definitions. You may have to copy-paste these from the other header files. Then, compile it as follows: </p><pre class="fragment"> soapcpp2 -c -penv env.h
 cc -c envC.c
</pre><p>We also compile <em><code>gsoap/stdsoap2.c</code></em> without namespaces: </p><pre class="fragment"> cc -c -DWITH_NONAMESPACES stdsoap2.c
</pre><p>Second, we create the Delayed Stock Quote header file specification, which may be obtained using the WSDL importer.</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service name: Service </span></div><div class="line"><span class="comment">//gsoap ns service style: rpc </span></div><div class="line"><span class="comment">//gsoap ns service encoding: encoded </span></div><div class="line"><span class="comment">//gsoap ns service location: http://services.xmethods.net/soap </span></div><div class="line"><span class="comment">//gsoap ns schema namespace: urn:xmethods-delayed-quotes </span></div><div class="line"><span class="comment">//gsoap ns service method-action: getQuote &quot;&quot; </span></div><div class="line"><span class="keywordtype">int</span> ns__getQuote(<span class="keywordtype">char</span> *symbol, <span class="keywordtype">float</span> *Result);</div></div><!-- fragment --><p>We compile it as a library and we use options <b><code>-n</code></b> and <b><code>-pquote</code></b> to prefix the generated files and to rename the namespace table to avoid link conflicts: </p><pre class="fragment"> soapcpp2 -c -n -pquote quote.h
 cc -c quoteClientLib.c
</pre><p>Third, we create the Currency Exchange Rate header file specification:</p>
<div class="fragment"><div class="line"><span class="comment">//gsoap ns service name: Service </span></div><div class="line"><span class="comment">//gsoap ns service style: rpc </span></div><div class="line"><span class="comment">//gsoap ns service encoding: encoded </span></div><div class="line"><span class="comment">//gsoap ns service location: http://services.xmethods.net/soap </span></div><div class="line"><span class="comment">//gsoap ns schema namespace: urn:xmethods-CurrencyExchange </span></div><div class="line"><span class="comment">//gsoap ns service method-action: getRate &quot;&quot; </span></div><div class="line"><span class="keywordtype">int</span> ns__getRate(<span class="keywordtype">char</span> *country1, <span class="keywordtype">char</span> *country2, <span class="keywordtype">float</span> *Result);</div></div><!-- fragment --><p>We compile it as a library and we use options <b><code>-n</code></b> and <b><code>-prate</code></b> to prefix the generated files and to rename the namespace table to avoid link conflicts: </p><pre class="fragment"> soapcpp2 -c -n -prate rate.h
 cc -c rateClientLib.c
</pre><p>The main program is:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;quoteH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;rateH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;quote.nsmap&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;rate.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (argc &lt;= 1) </div><div class="line">  {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Usage: main ticker [currency]\n&quot;</span>); </div><div class="line">    exit(EXIT_FAILURE); </div><div class="line">  } </div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line">  <span class="keywordtype">float</span> q; </div><div class="line">  <a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, quote_namespaces); </div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns__getQuote(soap, NULL, NULL, argv[1], &amp;q)) <span class="comment">// get quote </span></div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (argc &gt; 2) </div><div class="line">    {</div><div class="line">      <a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, rate_namespaces); </div><div class="line">      <span class="keywordtype">float</span> r; </div><div class="line">      <span class="keywordflow">if</span> (soap_call_ns__getRate(soap, NULL, NULL, <span class="stringliteral">&quot;us&quot;</span>, argv[2], &amp;r)) <span class="comment">// get rate in US dollars </span></div><div class="line">        <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">      <span class="keywordflow">else</span> </div><div class="line">        q *= r; <span class="comment">// convert the quote </span></div><div class="line">    } </div><div class="line">    printf(<span class="stringliteral">&quot;%s: %f \n&quot;</span>, argv[1], q); </div><div class="line">  } </div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">}</div></div><!-- fragment --><p>Compile and link this application with <em><code>stdsoap2.o</code></em>, <em><code>envC.o</code></em>, <em><code>quoteClientLib.o</code></em>, and <em><code>rateClientLib.o</code></em>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="example15"></a>
How to chain C services to accept messages on the same port</h3>
<p>When combining multiple services into one application, you can run wsdl2h on multiple WSDLs to generate the single all-inclusive service definitions interface header file for soapcpp2. This header file is then processed with soapcpp2 to generate skeleton functions in C.</p>
<p>What if we generate multiple services, each from a WSDL separately, and want to deploy them on the same port? This requires listening to the same port and then chaining the service dispatches so that each service can serve a request.</p>
<p>First we create a <em><code>env.h</code></em> that contains the joint SOAP Header and SOAP Fault definitions, for example by copy-pasting these from the other header files generated by wsdl2h. Or this file is empty if no specialized SOAP Headers and Faults are used. We compile it as follows: </p><pre class="fragment"> soapcpp2 -c -penv env.h
 cc -c envC.c
</pre><p>We also compile <em><code>gsoap/stdsoap2.c</code></em> without namespaces: </p><pre class="fragment"> cc -c -DWITH_NONAMESPACES stdsoap2.c
</pre><p>Say for example that we have a service definition in <em><code>quote.h</code></em>. We compile it as a library and we use options <b><code>-n</code></b> and <b><code>-pquote</code></b> to prefix the generated files and to rename the namespace table to avoid link conflicts: </p><pre class="fragment"> soapcpp2 -c -n -pquote quote.h
 cc -c quoteClientLib.c
</pre><p>We do the same for a service definition in <em><code>rate.h</code></em>: </p><pre class="fragment"> soapcpp2 -c -n -prate rate.h
 cc -c rateClientLib.c
</pre><p>To serve both the quote and rate services on the same port, we chain the service dispatchers as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;quoteH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;rateH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;quote.nsmap&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;rate.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(<a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(soap, NULL, 8080, 10))) <span class="comment">// small BACKLOG for iterative servers</span></div><div class="line">{</div><div class="line">  <span class="keywordflow">while</span> (1)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(<a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(soap)))</div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga5652f1b77271d434d0a4b66d5a607adb">soap_begin_serve</a>(soap)) </div><div class="line">      {</div><div class="line">        <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">      }</div><div class="line">      <a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, quote_namespaces);</div><div class="line">      <span class="keywordflow">if</span> (quote_serve_request(soap) == <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>) </div><div class="line">      {</div><div class="line">        <a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, rate_namespaces);</div><div class="line">        <span class="keywordflow">if</span> (rate_serve_request(soap))</div><div class="line">          <a class="code" href="group__group__io.html#gab03e7a2c2605004c7f74be27738cc629">soap_send_fault</a>(soap); <span class="comment">// send fault to client </span></div><div class="line">      } </div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>) </div><div class="line">      {</div><div class="line">        <a class="code" href="group__group__io.html#gab03e7a2c2605004c7f74be27738cc629">soap_send_fault</a>(soap); <span class="comment">// send fault to client </span></div><div class="line">      }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a>) <span class="comment">// accept failed, try again after 1 second</span></div><div class="line">    {</div><div class="line">      <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">      sleep(1);</div><div class="line">    } </div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">      fprintf(stderr, <span class="stringliteral">&quot;server timed out\n&quot;</span>); </div><div class="line">      <span class="keywordflow">break</span>; </div><div class="line">    }</div><div class="line">    <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line">    <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line">  }</div><div class="line">}</div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div></div><!-- fragment --><p>This chaining can be arbitrarily deep. When the previous request fails with a <code><a class="el" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad" title="A soap_status error code: the service request dispatcher did not find a matching service operation fo...">SOAP_NO_METHOD</a></code> then next request dispatcher can be tried.</p>
<p>The server should also define the service operations:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ns__getQuote(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *symbol, <span class="keywordtype">float</span> *Result); </div><div class="line">{</div><div class="line">  *Result = ... ; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__getRate(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *country1, <span class="keywordtype">char</span> *country2, <span class="keywordtype">float</span> *Result); </div><div class="line">{</div><div class="line">  *Result = ... ; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">}</div></div><!-- fragment --><p>However, the while loop iterates for each new connection that is established with <code><a class="el" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6" title="Accept a connection with a client. ">soap_accept</a></code> and does not allow for HTTP keep-alive connections to persist. For our final improvement we want to support HTTP keep-alive connections that require looping over the service dispatches until the connection closes on either end, after which we resume the outer loop. The resulting code is very close to the soapcpp2-generated <code><a class="el" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d" title="Serve a pending request. ">soap_serve</a></code> code and the <code>serve</code> service class methods, with the addition of the chain of service dispatches in the loop body:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;quoteH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;rateH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;quote.nsmap&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;rate.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(<a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(soap, NULL, 8080, 10))) <span class="comment">// small BACKLOG for iterative servers</span></div><div class="line">{</div><div class="line">  <span class="keywordflow">while</span> (1)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(<a class="code" href="group__group__io.html#gaec0e1aecc2d5479d8099762feb4713c6">soap_accept</a>(soap)))</div><div class="line">    {</div><div class="line">      soap-&gt;<a class="code" href="structsoap.html#a3d93ba968bb58373f5884177a7ec0d83">keep_alive</a> = soap-&gt;<a class="code" href="structsoap.html#a1d7aca6ac1d62302102c17508a8b0ec0">max_keep_alive</a> + 1; <span class="comment">// max keep-alive iterations</span></div><div class="line">      <span class="keywordflow">do</span></div><div class="line">      {</div><div class="line">        <span class="keywordflow">if</span> ((soap-&gt;<a class="code" href="structsoap.html#a3d93ba968bb58373f5884177a7ec0d83">keep_alive</a> &gt; 0) &amp;&amp; (soap-&gt;<a class="code" href="structsoap.html#a1d7aca6ac1d62302102c17508a8b0ec0">max_keep_alive</a> &gt; 0))</div><div class="line">          soap-&gt;<a class="code" href="structsoap.html#a3d93ba968bb58373f5884177a7ec0d83">keep_alive</a>--;</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga5652f1b77271d434d0a4b66d5a607adb">soap_begin_serve</a>(soap))</div><div class="line">        {</div><div class="line">          <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> &gt;= <a class="code" href="group__group__errors.html#gaa03308d50b94828cbc49724d049d9d2d">SOAP_STOP</a>) <span class="comment">// if a plugin has served the request</span></div><div class="line">            <span class="keywordflow">continue</span>;                   <span class="comment">// then continue with the next request</span></div><div class="line">          <span class="keywordflow">break</span>;                        <span class="comment">// an error occurred</span></div><div class="line">        }</div><div class="line">        <a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, quote_namespaces);</div><div class="line">        <span class="keywordflow">if</span> (quote_serve_request(soap) == <a class="code" href="group__group__errors.html#gab0c5959ec4b7509ce48d9a29c8601fad">SOAP_NO_METHOD</a>) </div><div class="line">        {</div><div class="line">          <a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, rate_namespaces);</div><div class="line">          <span class="keywordflow">if</span> (rate_serve_request(soap))</div><div class="line">            <a class="code" href="group__group__io.html#gab03e7a2c2605004c7f74be27738cc629">soap_send_fault</a>(soap); <span class="comment">// send fault to client </span></div><div class="line">        } </div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>) </div><div class="line">        {</div><div class="line">          <a class="code" href="group__group__io.html#gab03e7a2c2605004c7f74be27738cc629">soap_send_fault</a>(soap); <span class="comment">// send fault to client </span></div><div class="line">        }</div><div class="line">        <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line">        <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line">      } <span class="keywordflow">while</span> (soap-&gt;<a class="code" href="structsoap.html#a3d93ba968bb58373f5884177a7ec0d83">keep_alive</a>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a10b66d6d489690b7d0f591ae2633dd13">errnum</a>) <span class="comment">// accept failed, try again after 1 second</span></div><div class="line">    {</div><div class="line">      <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); </div><div class="line">      sleep(1);</div><div class="line">    } </div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">      fprintf(stderr, <span class="stringliteral">&quot;server timed out\n&quot;</span>); </div><div class="line">      <span class="keywordflow">break</span>; </div><div class="line">    }</div><div class="line">    <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line">    <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line">  }</div><div class="line">}</div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div></div><!-- fragment --><p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="dll"></a>
How to create DLLs</h2>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="basedll"></a>
Creating the base stdsoap2.dll</h3>
<p>The engine does not define SOAP Header and Fault serializers that the engine needs when installed as a library. We therefore add SOAP Header and Fault serializers, which are compiled separately as follows. First, create a new header file <em><code>env.h</code></em> with the SOAP Header <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> and SOAP Fault <code><a class="el" href="struct_s_o_a_p___e_n_v_____fault.html" title="SOAP Fault structure. ">SOAP_ENV__Fault</a></code> structures, including <code><a class="el" href="struct_s_o_a_p___e_n_v_____detail.html" title="SOAP Fault Detail structure. ">SOAP_ENV__Detail</a></code> if this structure contains members that are serialized as fault details. You can leave this header file empty if you want to use the default SOAP Header and Fault. However, if SOAP Headers are required then you cannot leave the <code><a class="el" href="struct_s_o_a_p___e_n_v_____header.html" title="SOAP Header structure. ">SOAP_ENV__Header</a></code> structure empty. For example, the WS-Addressing and WS-Security plugins require SOAP Headers which can be imported by adding <code>#import "wsa5.h"</code> and <code>#import "wsse.h"</code>, respectively to <em><code>env.h</code></em>. Then compile this header file with: </p><pre class="fragment"> soapcpp2 -penv env.h
</pre><p>The generated <em><code>envC.cpp</code></em> file holds the SOAP Header and Fault serializers. We can either create a separate <em><code>envC.dll</code></em> DLL for this that all clients and service applications will use, or combine <em><code>envC.cpp</code></em> with the <em><code>stdsoap2.dll</code></em> we create, which we will explain further.</p>
<p>The next step is to create <em><code>stdsoap2.dll</code></em> which consists of the file <em><code>gsoap/stdsoap2.cpp</code></em> and <em><code>envC.cpp</code></em> and optionally the plugins you want to use such as <em><code>wsseapi.cpp</code></em> (we need to rename all <em><code>.c</code></em> files to <em><code>.cpp</code></em> files to avoid issues with MSVC++). This DLL contains all common functions needed for all other clients and servers based on gSOAP. Compile <em><code>envC.cpp</code></em> and <em><code>gsoap/stdsoap2.cpp</code></em> into <em><code>stdsoap2.dll</code></em> using the compiler option <code>/D</code> <code><a class="el" href="group__group__with.html#gac22000b4058bb41a88750d10785baaf1" title="When this macro is defined at compile time (undefined by default), removes dependence on the global n...">WITH_NONAMESPACES</a></code> and the MSVC Pre-Processor definitions <code>SOAP_FMAC1=__declspec(dllexport)</code>, <code>SOAP_FMAC3=__declspec(dllexport)</code>, and the <code><a class="el" href="group__group__soap.html#ga3176b06a7c108fc79cb2319a9e2f6fd2" title="User-definable macro to enable Windows DLL builds. ">SOAP_STD_EXPORTS</a></code> macro set as shown below from the MSVC command prompt: </p><pre class="fragment">C:&gt; cl /c /I. /EHsc /DWITH_NONAMESPACES /DSOAP_FMAC1=__declspec(dllexport) /DSOAP_FMAC3=__declspec(dllexport) /DSOAP_STD_EXPORTS envC.cpp stdsoap2.cpp
C:&gt; link /LIBPATH ws2_32.lib /OUT:mygsoap.dll /DLL envC.obj stdsoap2.obj
</pre><p>Note: as of gSOAP 2.8.30 and later, the DLL export macros shown here are all set with one pre-processor definition <code><a class="el" href="group__group__soap.html#ga3176b06a7c108fc79cb2319a9e2f6fd2" title="User-definable macro to enable Windows DLL builds. ">SOAP_STD_EXPORTS</a></code>.</p>
<p>Alternatively, you can compile with <code>/D</code> <code><a class="el" href="group__group__with.html#ga24620333a812a36ed84902ff3d897ff6" title="When this macro is defined at compile time (undefined by default), a user-supplied file named soapdef...">WITH_SOAPDEFS_H</a></code> and put the macro definitions in <em><code>soapdefs.h</code></em>. This exports all functions which are preceded by the macro <code><a class="el" href="group__group__soap.html#gaf9c67beaa852bbda509579313b9ca11b" title="User-definable macro to annotate global functions. ">SOAP_FMAC1</a></code> in the <em><code>soapcpp2.cpp</code></em> source file and macro <code><a class="el" href="group__group__soap.html#gac97573871ae52cf2eeeeba051b61305d" title="User-definable macro to annotate global serialization functions generated by soapcpp2. ">SOAP_FMAC3</a></code> in the <em><code>envC.cpp</code></em> source file.</p>
<p>Finally, note that the gSOAP source code package contains a lot of <em><code>.c</code></em> source code files. Mixing C with C++ files is not recommended with Visual Studio and will lead to run-time errors when building DLLs. Therefore, always rename <em><code>.c</code></em> source code files to <em><code>.cpp</code></em> source code files when creating DLLs.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="clientserverdll"></a>
Creating client and server DLLs</h3>
<p>Compile the <em><code>soapClientLib.cpp</code></em> and <em><code>soapServerLib.cpp</code></em> sources as DLLs by using the MSVC Pre-Processor definitions <code>SOAP_FMAC5=__declspec(dllexport)</code> and <code>SOAP_CMAC=__declspec(dllexport)</code>, and by using the C++ compiler option <code>/D</code> <code><a class="el" href="group__group__with.html#gac22000b4058bb41a88750d10785baaf1" title="When this macro is defined at compile time (undefined by default), removes dependence on the global n...">WITH_NONAMESPACES</a></code>. All of these macros are set as a shorthand with one pre-processor definition <code><a class="el" href="group__group__soap.html#ga3176b06a7c108fc79cb2319a9e2f6fd2" title="User-definable macro to enable Windows DLL builds. ">SOAP_STD_EXPORTS</a></code> (requires gSOAP 2.8.30 or later).</p>
<p>This DLL links to <em><code>stdsoap2.dll</code></em> we created in Section <a class="el" href="index.html#basedll">Creating the base stdsoap2.dll</a>.</p>
<p>To create multiple DLLs in the same project directory, you should use <b><code>soapcpp2 -p name</code></b> option <b><code>-p name</code></b> to rename the generated <em><code>soapClientLib.cpp</code></em> and <em><code>soapServerLib.cpp</code></em> (and associated) files. The <b><code>-p name</code></b> option specifies a <em><code>name</code></em> prefix to replace the <em><code>soap</code></em> file name prefix. Another way is to use C++ namespaces with <b><code>soapcpp2 -q name</code></b> option <b><code>-q name</code></b>, if the interface header file input to soapcpp2 does not already declare a C++ namespace. A clean separation of libraries can also be achieved with C++ namespaces, see Section <a class="el" href="index.html#codenamespace">How to build a client or server in a C++ code namespace</a> .</p>
<p>Unless you use the client proxy and server object classes (<em><code>soapXYZProxy.h</code></em> and <em><code>soapXYZService.h</code></em>), all client and server applications must explicitly set the namespaces value of the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context with:</p>
<div class="fragment"><div class="line"><a class="code" href="group__group__namespace.html#ga5ec913accc705cca3296ab75bae955a5">soap_set_namespaces</a>(soap, namespaces);</div></div><!-- fragment --><p>where the <code>namespaces[]</code> table should be defined in the client/server source. These tables are generated in the <em><code>.nsmap</code></em> files. The tables are renamed for convenience using <b><code>soapcpp2 -n</code></b> option <b><code>-n</code></b>, see Section <a class="el" href="index.html#soapcpp2options">soapcpp2 options</a> .</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="module"></a>
How to build modules and libraries with the #module directive</h2>
<p>The <code>#module</code> directive is used to build modules with soapcpp2. A library can be built from a module and linked with multiple Web services applications. The directive should appear at the top of the interface header file for soapcpp2 and has the following formats:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#module &quot;name&quot; </span></div></div><!-- fragment --><p>and</p>
<div class="fragment"><div class="line"><span class="preprocessor">#module &quot;name&quot; &quot;fullname&quot;</span></div></div><!-- fragment --><p>where the <code>name</code> must be a unique short name for the module. The name is case insensitive and must not exceed 4 characters in length. The <code>fullname</code>, when present, represents the full name of the module and is used to prefix the function names of the generated serializers replacing the usual <code>soap</code> prefix. If absent, the short name is used to prefix the function names of the serializers.</p>
<p>The rest of the content of the interface header file includes type declarations and optionally the declarations of service operations and SOAP Headers and Faults that are universally used by SOAP services, when applicable. When the soapcpp2 tool processes the header file module, it will generate the source codes for a library. The Web services application that uses the library should use a header file that imports the module with the <code>#import</code> directive, for example:</p>
<div class="fragment"><div class="line"><span class="comment">/* Contents of file &quot;module.h&quot; */</span> </div><div class="line"><span class="preprocessor">#module &quot;test&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// types and typedefs become module-specific</span></div><div class="line"><span class="keyword">typedef</span> <a class="code" href="group__group__soap.html#ga78b36c5636eb5283d651b69d8684c6ae">LONG64</a> xsd__long;</div><div class="line"><span class="keywordtype">char</span>*;</div><div class="line"></div><div class="line"><span class="comment">// a module-specific struct</span></div><div class="line"><span class="keyword">struct </span>ns__S </div><div class="line">{</div><div class="line">    ... <span class="comment">// members</span></div><div class="line">};</div></div><!-- fragment --><p>The <em><code>module.h</code></em> data binding interface header file for soapcpp2 declares module-specific serializable types <code>LONG64</code>, <code>xsd__long</code>, <code>char*</code>, and a <code>struct ns__S</code>. The module name is "test", so the soapcpp2 tool produces a <em><code>testC.cpp</code></em> file with the XML serializers for these types. The <em><code>testC.cpp</code></em> data binding implementation source code can be separately compiled and linked with an application. If service operations are declared in the interface header file as function prototypes, we also get <em><code>testClient.cpp</code></em> client stub functions and <em><code>testServer.cpp</code></em> server skeleton functions.</p>
<p>There are some limitations for module imports:</p>
<ul>
<li>A module must be imported into another interface header to use the module's type definitions.</li>
<li>When multiple modules are imported, the types that they declare must be declared in one module only to avoid name clashes and link errors. You cannot create two modules that declare or use the same type and import these modules separately into another header file. When using modules, consider creating a module hierarchy such that types are declared only once and by only one module when these modules must be linked.</li>
</ul>
<p>With modules, the source code serializers for the types defined in the modules are generated with soapcpp2 separately. For example, assume that we have a module <em><code>module.h</code></em>:</p>
<div class="fragment"><div class="line"><span class="comment">/* Contents of file &quot;module.h&quot; */</span></div><div class="line"><span class="preprocessor">#module &quot;test&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>ns__S</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *name;</div><div class="line">    <span class="keywordtype">int</span> amount;</div><div class="line">};</div></div><!-- fragment --><p>and a header file <em><code>example.h</code></em> that uses it:</p>
<div class="fragment"><div class="line"><span class="comment">/* Contents of file &quot;example.h&quot; */</span></div><div class="line"><span class="preprocessor">#import &quot;module.h&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keyword">const</span> <span class="keywordtype">char</span> *code, <span class="keyword">struct</span> ns__S *record, <span class="keywordtype">int</span> *result);    </div></div><!-- fragment --><p>The module is compiled as follows: </p><pre class="fragment">soapcpp2 module1.h
</pre><p>This generates the files <em><code>testStub.h</code></em>, <em><code>testH.h</code></em>, and <em><code>testC.cpp</code></em> with serializers for <code>struct ns__S</code> but also for <code>char*</code> and <code>int</code>.</p>
<p>Running soapcpp2 on <em><code>example.h</code></em> imports the module definitions, but does not generate serializers for <code>struct ns__S</code>, <code>char*</code> and <code>int</code> since these are defined by <em><code>module.h</code></em>: </p><pre class="fragment">soapcpp2 -CL example.h
</pre><p>An example client application that calls the client stub function:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;soapH.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;ns.nsmap&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">  <span class="keyword">struct </span>ns__S s;</div><div class="line">  soap_default_ns__S(soap, &amp;s);</div><div class="line">  s.name = <a class="code" href="group__group__context.html#ga41747ef145667bdff9c66cdd2bc86653">soap_strdup</a>(soap, <span class="stringliteral">&quot;name&quot;</span>);</div><div class="line">  s.amount = 124;</div><div class="line">  <span class="keywordtype">int</span> n;</div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, endpoint, NULL, <span class="stringliteral">&quot;code&quot;</span>, &amp;s, &amp;n))</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">    printf(<span class="stringliteral">&quot;OK n = %d\n&quot;</span>, n);</div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div><div class="line">}</div></div><!-- fragment --><p>We compile this example as follows: </p><pre class="fragment">c++ -o example example.cpp testC.cpp soapC.cpp soapClient.cpp stdsoap2.cpp
</pre><p>Modules may help to define a modular hierarchy of libraries with reusable serializable types.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h2><a class="anchor" id="plugins"></a>
Plugins, modules, and extensions</h2>
<p>Plugins offer a convenient extension mechanism for the gSOAP toolkit by extending the capabilities of its engine. When the plugin registers with the gSOAP engine, it has full access to the run-time settings and the engine's function callbacks. Upon registry, the plugin's local data is associated with the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context. By overriding the callbacks with the plugin's callbacks, the plugin extends or modifies the engine's capabilities. The local plugin data can be accessed through a lookup function, usually invoked within a callback function to access the plugin data. The registry and lookup functions are:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__group__plugin.html#ga800a005ce0f0236461d1a5dbf4be2a80">soap_register_plugin_arg</a>(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">int</span> (*fcreate)(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> soap_plugin *p, <span class="keywordtype">void</span> *arg), <span class="keywordtype">void</span> *arg)</div></div><!-- fragment --> <div class="fragment"><div class="line"><span class="keywordtype">void</span>* soap_lookup_plugin(<span class="keyword">struct</span> soap*, <span class="keyword">const</span> <span class="keywordtype">char</span>*);</div></div><!-- fragment --><p>The <code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy</a></code> function returns a new dynamically allocated <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context that is a copy of another, such that no data is shared between the copy and the original context. The <code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy</a></code> function invokes the copy functions of the registered plugins to copy the plugins' local data. The <code><a class="el" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a" title="Finalize the given soap context, i.e. when the soap context is stack allocated, automatically invoked...">soap_done</a></code> and <code><a class="el" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a" title="Finalize and free the given soap context from unmanaged heap memory. ">soap_free</a></code> functions de-registers all plugin.</p>
<p>The follow example overrides the send and receive callbacks to copy all messages that are sent and received to the terminal (stderr).</p>
<p>First, we write a header file <em><code>plugin.h</code></em> to define the local plugin data structure(s) and we define a global name to identify the plugin:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="stdsoap2_8h.html">stdsoap2.h</a>&quot;</span> </div><div class="line"><span class="preprocessor">#define PLUGIN_ID &quot;PLUGIN-1.0&quot; // some name to identify plugin </span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>plugin_data <span class="comment">// local plugin data </span></div><div class="line">{</div><div class="line">  int (*fsend)(<span class="keyword">struct </span>soap*, <span class="keyword">const</span> <span class="keywordtype">char</span>*, size_t); <span class="comment">// to save and use send callback </span></div><div class="line">  size_t (*<a class="code" href="group__group__callbacks.html#ga0c218cd5552045745cc640998e25ed72">frecv</a>)(<span class="keyword">struct </span>soap*, <span class="keywordtype">char</span>*, size_t); <span class="comment">// to save and use recv callback </span></div><div class="line">}; </div><div class="line"><span class="keywordtype">int</span> plugin(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> soap_plugin *plugin, <span class="keywordtype">void</span> *arg);</div></div><!-- fragment --><p>Then, we write the plugin registry function and the callbacks:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;plugin.h&quot;</span> </div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> plugin_id[] = PLUGIN_ID; <span class="comment">// the plugin id </span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> plugin_init(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> plugin_data *data); </div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> plugin_copy(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> soap_plugin *dst, <span class="keyword">struct</span> soap_plugin *src); </div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> plugin_delete(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> soap_plugin *p); </div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> plugin_send(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len); </div><div class="line"><span class="keyword">static</span> <span class="keywordtype">size_t</span> plugin_recv(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len); </div><div class="line"></div><div class="line"><span class="comment">// the registry function: </span></div><div class="line"><span class="keywordtype">int</span> plugin(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> soap_plugin *p, <span class="keywordtype">void</span> *arg) </div><div class="line">{</div><div class="line">  p-&gt;id = plugin_id; </div><div class="line">  p-&gt;data = (<span class="keywordtype">void</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> plugin_data)); </div><div class="line">  p-&gt;fcopy = plugin_copy; <span class="comment">/* optional: when set the plugin must copy its local data */</span></div><div class="line">  p-&gt;fdelete = plugin_delete; </div><div class="line">  <span class="keywordflow">if</span> (p-&gt;data) </div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (plugin_init(soap, (<span class="keyword">struct</span> plugin_data*)p-&gt;data)) </div><div class="line">    {</div><div class="line">      free(p-&gt;data); <span class="comment">// error: could not init </span></div><div class="line">      <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga9fd637076afcd330401f2cd0a71fe729">SOAP_EOM</a>; <span class="comment">// return error </span></div><div class="line">    } </div><div class="line">  }</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> plugin_init(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> plugin_data *data) </div><div class="line">{</div><div class="line">  data-&gt;fsend = soap-&gt;<a class="code" href="group__group__callbacks.html#gafd52b80655e4f1021edd6c55b8dfedff">fsend</a>; <span class="comment">// save old recv callback </span></div><div class="line">  data-&gt;frecv = soap-&gt;<a class="code" href="group__group__callbacks.html#ga0c218cd5552045745cc640998e25ed72">frecv</a>; <span class="comment">// save old send callback </span></div><div class="line">  soap-&gt;<a class="code" href="group__group__callbacks.html#gafd52b80655e4f1021edd6c55b8dfedff">fsend</a> = plugin_send; <span class="comment">// replace send callback with new </span></div><div class="line">  soap-&gt;<a class="code" href="group__group__callbacks.html#ga0c218cd5552045745cc640998e25ed72">frecv</a> = plugin_recv; <span class="comment">// replace recv callback with new </span></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">// copy plugin data, called by soap_copy()</span></div><div class="line"><span class="comment">// This is important: we need a deep copy to avoid data sharing by two contexts </span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> plugin_copy(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> soap_plugin *dst, <span class="keyword">struct</span> soap_plugin *src) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (!(dst-&gt;data = (<span class="keyword">struct</span> plugin_data*)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> plugin_data)))) </div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga9fd637076afcd330401f2cd0a71fe729">SOAP_EOM</a>; </div><div class="line">  *dst-&gt;data = *src-&gt;data; </div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">// plugin deletion, called by soap_done() </span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> plugin_delete(<span class="keyword">struct</span> soap *soap, <span class="keyword">struct</span> soap_plugin *p) </div><div class="line">{</div><div class="line">  free(p-&gt;data); <span class="comment">// free allocated plugin data </span></div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">// the new send callback </span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> plugin_send(<span class="keyword">struct</span> soap *soap, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>plugin_data *data = (<span class="keyword">struct </span>plugin_data*)soap_lookup_plugin(soap, plugin_id); <span class="comment">// fetch plugin&#39;s local data </span></div><div class="line">  fwrite(buf, len, 1, stderr); <span class="comment">// write message to stderr </span></div><div class="line">  <span class="keywordflow">return</span> data-&gt;fsend(soap, buf, len); <span class="comment">// pass data on to old send callback </span></div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">// the new receive callback </span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">size_t</span> plugin_recv(<span class="keyword">struct</span> soap *soap, <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len) </div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>plugin_data *data = (<span class="keyword">struct </span>plugin_data*)soap_lookup_plugin(soap, plugin_id); <span class="comment">// fetch plugin&#39;s local data </span></div><div class="line">  <span class="keywordtype">size_t</span> res = data-&gt;frecv(soap, buf, len); <span class="comment">// get data from old recv callback </span></div><div class="line">  fwrite(buf, res, 1, stderr); </div><div class="line">  <span class="keywordflow">return</span> res; </div><div class="line">}</div></div><!-- fragment --><p>It is the responsibility of the plugin to handle registry (init), copy, and deletion of the plugin data and reset callbacks.</p>
<p>The <code>fdelete</code> callback of <code>struct soap_plugin</code> must be set to de-register the plugin and let it delete its resources.</p>
<p>A plugin is copied along with its corresponding <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context with the <code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy</a></code> call. This function copies a <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context and the chain of plugins. It is up to the plugin implementation to share the plugin data or not as follows:</p>
<ul>
<li>if the <code>fcopy()</code> callback is set by the plugin initialization, this callback will be called to allow the plugin to copy its local data upon a <code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy</a></code> call. When <code><a class="el" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a" title="Finalize the given soap context, i.e. when the soap context is stack allocated, automatically invoked...">soap_done</a></code> or <code><a class="el" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a" title="Finalize and free the given soap context from unmanaged heap memory. ">soap_free</a></code> is called on this <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context copy, the <code>fdelete()</code> callback is called for deallocation and cleanup of the local data.</li>
<li>if the <code>fcopy()</code> callback is not set, then the plugin data will be shared (i.e. the data pointer points to the same address). The <code>fdelete()</code> callback will not be called upon a <code><a class="el" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a" title="Finalize the given soap context, i.e. when the soap context is stack allocated, automatically invoked...">soap_done</a></code> on a copy of the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context . The <code>fdelete()</code> callback will be called for the original <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context with which the plugin was registered.</li>
</ul>
<p>The example plugin should be used as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line"><a class="code" href="group__group__plugin.html#gad645e5a58ed442fe4753dcc2338c8bdb">soap_register_plugin</a>(soap, plugin); </div></div><!-- fragment --><p>To pass a <code>void*</code> argument to the plugin's registry function use:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>(); </div><div class="line"><a class="code" href="group__group__plugin.html#ga800a005ce0f0236461d1a5dbf4be2a80">soap_register_plugin_arg</a>(soap, plugin, arg); </div></div><!-- fragment --><p>Additional documentation for the growing number of gSOAP plugins can be found at <a href="https://www.genivia.com/doc">https://www.genivia.com/doc</a>. A number of example plugins are included in the gSOAP source code package's <em><code>gsoap/plugin</code></em> directory. Some of these plugins are discussed in the next sections.</p>
<p>See also API documentation Module <a class="el" href="group__group__plugin.html">Plugins and plugin registry functions</a> .</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="dom"></a>
DOM API overview</h3>
<p>The DOM API is not a plugin, but an extension that provides a DOM API as a separate source code file to compile and link with gSOAP applications to enabled the gSOAP DOM. XML DOM processing is optional, and enabled with <a href="#wsdl2h-d"><b><code>wsdl2h -d</code></b> option <b><code>-d</code></b></a> to generate DOM structures for <em><code>xsd:anyType</code></em>, <em><code>xsd:any</code></em>, and <em><code>xsd:anyAttribute</code></em> schema components, which are enabled with <code>#import "dom.h"</code> in an interface header file for soapcpp2. This imports <em><code>gsoap/import/dom.h</code></em>. Then compile <em><code>gsoap/dom.c</code></em> for C or <em><code>gsoap/dom.cpp</code></em> for C++ with your application.</p>
<p>To use the DOM API with Web services, add <code>#import "dom.h"</code> to the interface header file or use <a href="#wsdl2h-d"><b><code>wsdl2h -d</code></b> option <b><code>-d</code></b></a>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;dom.h&quot;</span></div></div><!-- fragment --><p>This declares <code>xsd__anyType</code> and <code>xsd__anyAttribute</code> types.</p>
<p>A DOM element node is serialized with the <code>xsd__anyType</code> serializable type. The underlying implementation type of <code>xsd__anyType</code> is <code>soap_dom_element</code>. One or more DOM attribute nodes are serialized with the <code>xsd__anyAttribute</code> serializable type. The underlying implementation type of <code>xsd__anyAttribute</code> is <code>soap_dom_attribute</code>, which is a linked list.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;dom.h&quot;</span> <span class="comment">// imports xsd__anyType as a DOM node</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>ns__data : <span class="keyword">public</span> xsd__anyType</div><div class="line">{ <span class="keyword">public</span>:</div><div class="line">    xsd__anyType* foo;                <span class="comment">// Store &lt;foo&gt; element in DOM soap_dom_element</span></div><div class="line">    xsd__anyType __any;               <span class="comment">// Store any element content in DOM soap_dom_element</span></div><div class="line">  @ xsd__anyAttribute __anyAttribute; <span class="comment">// Store anyAttribute content in DOM soap_dom_attribute linked node structure</span></div><div class="line">};</div></div><!-- fragment --><p>To manipulate the DOM elements and attributes we use the DOM API functions documented in the gSOAP <a href="../../dom/html/index.html">XML DOM API documentation</a>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="loggingplugin"></a>
The message logging plugin</h3>
<p>The message <code><a class="el" href="group__group__debug.html#gac637945d0869d91a4b00dc1ddaced537" title="The logging plugin registration function. ">logging</a></code> plugin can be used to selectively log inbound and outbound messages to a file or stream. It also keeps access statistics to log the total number of bytes sent and received.</p>
<p>To use the plugin, compile and link your application with <em><code>logging.c</code></em> located in the <em><code>gsoap/plugin</code></em> directory of the gSOAP package. To enable the plugin in your code, register the plugin and set the streams as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;logging.h&quot;</span> </div><div class="line"></div><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line"><span class="keywordtype">size_t</span> bytes_in; </div><div class="line"><span class="keywordtype">size_t</span> bytes_out; </div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__group__plugin.html#gad645e5a58ed442fe4753dcc2338c8bdb">soap_register_plugin</a>(soap, <a class="code" href="group__group__debug.html#gac637945d0869d91a4b00dc1ddaced537">logging</a>)) </div><div class="line">  ... <span class="comment">// failed to register </span></div><div class="line">... <span class="comment">//</span></div><div class="line"><a class="code" href="group__group__debug.html#gaa04b3b63c8ba47da5673fbafe385e9ad">soap_set_logging_inbound</a>(soap, stdout); </div><div class="line"><a class="code" href="group__group__debug.html#ga08a67e8989dc849602b61e438a7f86e2">soap_set_logging_outbound</a>(soap, stdout); </div><div class="line">... <span class="comment">// process messages</span></div><div class="line"><a class="code" href="group__group__debug.html#gaa04b3b63c8ba47da5673fbafe385e9ad">soap_set_logging_inbound</a>(soap, NULL); <span class="comment">// disable logging </span></div><div class="line"><a class="code" href="group__group__debug.html#ga08a67e8989dc849602b61e438a7f86e2">soap_set_logging_outbound</a>(soap, NULL); <span class="comment">// disable logging </span></div><div class="line"><a class="code" href="group__group__debug.html#ga628bfc4b7a6ba4bef23bea4787ef5f5d">soap_logging_stats</a>(soap, &amp;bytes_out, &amp;bytes_in);</div><div class="line">... <span class="comment">//</span></div><div class="line"><a class="code" href="group__group__debug.html#ga4965a2d58aec4ae3983ae73fc711df60">soap_reset_logging_stats</a>(soap);</div></div><!-- fragment --><p>If you use <code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy</a></code> to copy the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context with the plugin, the plugin's state will be shared by the copy. The plugin is thread-safe, but does not use a lock to protect the internal statistics counters to ensure the speed of messaging is not compromised, meaning that you should not fully rely on the statistics to be 100% accurate for multi-threaded services.</p>
<p>See also <code><a class="el" href="group__group__debug.html#gac637945d0869d91a4b00dc1ddaced537" title="The logging plugin registration function. ">logging</a></code>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="RESTfulserverGET"></a>
RESTful server-side API with the HTTP GET plugin</h3>
<p>Server-side use of RESTful HTTP GET operations is supported with the <code><a class="el" href="group__group__io.html#ga0ecdc43a53e494edc4f84e8c135659ba" title="The HTTP GET plugin registration function. ">http_get</a></code> HTTP GET plugin <em><code>gsoap/plugin/httpget.c</code></em>.</p>
<p>The HTTP GET plugin allows your server to handle RESTful HTTP GET requests and at the same time still serve SOAP-based POST requests. The plugin provides support to client applications to issue HTTP GET operations to a server.</p>
<p>Note that HTTP GET requests can also be handled at the server side with the <code><a class="el" href="group__group__callbacks.html#gae022204ff7004df2d5ac9e083cbb5b16" title="Callback to implement logic at the server-side to serve responses to HTTP GET requests from clients...">soap::fget</a></code> callback, see Section <a class="el" href="index.html#callback">Function callbacks for customized I/O and HTTP handling</a> . However, the HTTP GET plugin also keeps statistics on the number of successful POST and GET exchanges and failed operations (HTTP faults, SOAP Faults, etc.). It also keeps hit histograms accumulated for up to a year of running time.</p>
<p>To use the <code><a class="el" href="group__group__io.html#ga0ecdc43a53e494edc4f84e8c135659ba" title="The HTTP GET plugin registration function. ">http_get</a></code> plugin, compile and link your application with <em><code>httpget.c</code></em> located in the <em><code>gsoap/plugin</code></em> directory of the gSOAP package. To enable the plugin in your code, register the plugin with your HTTP GET handler function as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;httpget.h&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__plugin.html#ga800a005ce0f0236461d1a5dbf4be2a80">soap_register_plugin_arg</a>(soap, <a class="code" href="group__group__io.html#ga0ecdc43a53e494edc4f84e8c135659ba">http_get</a>, (<span class="keywordtype">void</span>*)my_http_get_handler)) </div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr); <span class="comment">// failed to register </span></div><div class="line">  ... <span class="comment">//</span></div><div class="line">  <span class="keyword">struct </span>http_get_data *httpgetdata; </div><div class="line">  httpgetdata = (<span class="keyword">struct </span>http_get_data*)soap_lookup_plugin(soap, http_get_id); </div><div class="line">  <span class="keywordflow">if</span> (!httpgetdata) </div><div class="line">    ... <span class="comment">// if the plugin registered OK, there is certainly data but can&#39;t hurt to check </span></div><div class="line">  ... <span class="comment">// process messages</span></div><div class="line">  <span class="keywordtype">size_t</span> get_ok = httpgetdata-&gt;stat_get; </div><div class="line">  <span class="keywordtype">size_t</span> post_ok = httpgetdata-&gt;stat_post; </div><div class="line">  <span class="keywordtype">size_t</span> errors = httpgetdata-&gt;stat_fail; </div><div class="line">  time_t now = time(NULL); </div><div class="line">  <span class="keyword">struct </span>tm *T; </div><div class="line">  T = localtime(&amp;now); </div><div class="line">  <span class="keywordtype">size_t</span> hitsthisminute = httpgetdata-&gt;hist_min[T-&gt;tm_min]; </div><div class="line">  <span class="keywordtype">size_t</span> hitsthishour = httpgetdata-&gt;hist_hour[T-&gt;tm_hour]; </div><div class="line">  <span class="keywordtype">size_t</span> hitstoday = httpgetdata-&gt;hist_day[T-&gt;tm_yday];</div><div class="line">}</div></div><!-- fragment --><p>An HTTP GET handler can simply produce some HTML content, or any other type of content by sending data using <code><a class="el" href="group__group__io.html#ga0390e58bd2a3ebe6fe3a46de0534a614" title="Initialize the context for server-side sending and send a HTTP response header. ">soap_response</a></code>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> my_http_get_handler(<span class="keyword">struct</span> soap *soap) </div><div class="line">{</div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#ae5e98733a4349b5e1466a9e0ccc22c11">http_content</a> = <span class="stringliteral">&quot;text/html&quot;</span>; </div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga0390e58bd2a3ebe6fe3a46de0534a614">soap_response</a>(soap, <a class="code" href="group__group__io.html#ga05be99343f556fe70940145e874cdb99">SOAP_FILE</a>)</div><div class="line">   || <a class="code" href="group__group__io.html#ga7712f5bc36127050a11ad995d0593bdc">soap_send</a>(soap, <span class="stringliteral">&quot;&lt;html&gt;Hello&lt;/html&gt;&quot;</span>)</div><div class="line">   || <a class="code" href="group__group__io.html#ga290ddb46afdbf5ec6669b6ac8daca5c9">soap_end_send</a>(soap)</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga06d59094afa3df6b1b9f6b2bb484207c">soap_closesock</a>(soap);</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; <span class="comment">// return SOAP_OK or HTTP error code, e.g. 404 </span></div><div class="line">}</div></div><!-- fragment --><p>If you use <code><a class="el" href="group__group__context.html#gab4c3f8ce80baf0f1fec8c86f0bb5788a" title="Allocate and initialize a new soap context as a copy of the given soap context. ">soap_copy</a></code> to copy the <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context with the plugin, the plugin's data will be shared by the copy. Therefore, the statistics are not 100% guaranteed to be accurate for multi-threaded services since race conditions on the counters may occur. Mutex is not used to update the counters to avoid introducing expensive synchronization points. If 100% server-side accuracy is required, add mutex at the points indicated in the <em><code>httpget.c</code></em> code.</p>
<p>The client-side use of HTTP GET is provided by the <code><a class="el" href="group__group__io.html#ga953bdee7ebf242b056834e5592079ae9" title="HTTP GET content from server. ">soap_GET</a></code> operation. To receive a SOAP/XML (response) message <em><code>ns:methodResponse</code></em>, use:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga953bdee7ebf242b056834e5592079ae9">soap_GET</a>(soap, endpoint, NULL)) </div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (soap_recv_ns__webmethodResponse(soap, ...)) </div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  <span class="keywordflow">else</span> </div><div class="line">    ... <span class="comment">// success</span></div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap); </div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); </div><div class="line"><a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(soap);</div></div><!-- fragment --><p>To receive any HTTP Body data into a buffer, use:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">  <span class="keywordtype">char</span> *response = NULL; </div><div class="line">  <span class="keywordtype">size_t</span> response_len;</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga953bdee7ebf242b056834e5592079ae9">soap_GET</a>(soap, endpoint, NULL)</div><div class="line">   || (response = <a class="code" href="group__group__io.html#gae2cd37f875d3314eec314b8723e2ffd8">soap_http_get_body</a>(soap, &amp;response_len)) == NULL</div><div class="line">   || <a class="code" href="group__group__io.html#ga86b0c04e8baa911fc57e7f1220f9eb8f">soap_end_recv</a>(&amp;soap))</div><div class="line">    ... <span class="comment">// error</span></div><div class="line">  <span class="keywordflow">else</span></div><div class="line">    ... <span class="comment">// use the response string (NULL indicates no body or error)</span></div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(&amp;soap); </div><div class="line">  <a class="code" href="group__group__context.html#ga28ee8fdcf500443e0e51750324aa6a1a">soap_done</a>(&amp;soap);</div><div class="line">}</div></div><!-- fragment --><p>See also <code><a class="el" href="group__group__io.html#ga0ecdc43a53e494edc4f84e8c135659ba" title="The HTTP GET plugin registration function. ">http_get</a></code>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="RESTfulservicePOST"></a>
RESTful server-side API with the HTTP POST plugin</h3>
<p>Server-side use of RESTful HTTP POST, PUT, PATCH, and DELETE operations are supported with the <code><a class="el" href="group__group__io.html#ga4c08d5ef28bc0dc37eee4633acdd1140" title="The HTTP POST plugin registration function. ">http_post</a></code> HTTP POST plugin <em><code>gsoap/plugin/httppost.c</code></em>.</p>
<p>The <code><a class="el" href="group__group__io.html#ga4c08d5ef28bc0dc37eee4633acdd1140" title="The HTTP POST plugin registration function. ">http_post</a></code> HTTP POST plugin allows your server to handle RESTful HTTP POST requests and at the same time still serve SOAP-based POST requests. The plugin also provides support for client applications to issue HTTP POST operations to a server.</p>
<p>To simplify the server-side handling of POST requests, handlers can be associated with media types:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>http_post_handlers my_handlers[] = </div><div class="line">{</div><div class="line">  { <span class="stringliteral">&quot;image/jpg&quot;</span>, jpeg_handler }, </div><div class="line">  { <span class="stringliteral">&quot;image/*&quot;</span>,   image_handler }, </div><div class="line">  { <span class="stringliteral">&quot;text/html&quot;</span>, html_handler }, </div><div class="line">  { <span class="stringliteral">&quot;text/*&quot;</span>,    text_handler }, </div><div class="line">  { <span class="stringliteral">&quot;POST&quot;</span>,      generic_POST_handler }, </div><div class="line">  { <span class="stringliteral">&quot;PUT&quot;</span>,       generic_PUT_handler }, </div><div class="line">  { <span class="stringliteral">&quot;PATCH&quot;</span>,     generic_PATCH_handler }, </div><div class="line">  { <span class="stringliteral">&quot;DELETE&quot;</span>,    generic_DELETE_handler }, </div><div class="line">  { NULL } </div><div class="line">};</div></div><!-- fragment --><p>Note that <code>*</code> and <code>-</code> can be used as wildcards to match any text and any character, respectively. Media types may have optional parameters after <code>;</code> such as <code>charset</code> and <code>boundary</code>. These parameters can be matched by the media type patterns in the table. Patterns that are more specific must precede patterns that are less specific in the table. For example, <code>"text/xml;*charset=utf-8*"</code> must precede <code>"text/xml"</code> which must precede <code>"text/*"</code>. Note that <code>"text/xml"</code> also matches any parameters of the media type of the message reveived, such as <code>"text/xml; charset=utf-8"</code> (only since gSOAP version 2.8.75).</p>
<p>The handlers are functions that will be invoked when a POSTed request message matching media type is sent to the server.</p>
<p>An example image handler that checks the specific image type:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> image_handler(<span class="keyword">struct</span> soap *soap) </div><div class="line">{</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *buf; </div><div class="line">  <span class="keywordtype">size_t</span> len; </div><div class="line">  <span class="comment">// if necessary, check type in soap-&gt;http_content </span></div><div class="line">  <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#ae5e98733a4349b5e1466a9e0ccc22c11">http_content</a> &amp;&amp; !<a class="code" href="group__group__misc.html#gae2bfad49979faa3a625aca44acaa017c">soap_tag_cmp</a>(soap-&gt;<a class="code" href="structsoap.html#ae5e98733a4349b5e1466a9e0ccc22c11">http_content</a>, <span class="stringliteral">&quot;image/gif&quot;</span>) </div><div class="line">    <span class="keywordflow">return</span> 404; <span class="comment">// HTTP error 404 </span></div><div class="line">  if ((buf = <a class="code" href="group__group__io.html#gae2cd37f875d3314eec314b8723e2ffd8">soap_http_get_body</a>(soap, &amp;len)) == NULL)</div><div class="line">    <span class="keywordflow">return</span> soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a>; </div><div class="line">  <span class="comment">// ... now process image in buf </span></div><div class="line">  <span class="comment">// reply with empty HTTP 200 OK response: </span></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__group__io.html#ga6ac5e550072a59c8b6d432b63cc3543a">soap_send_empty_response</a>(soap, 200); </div><div class="line">}</div></div><!-- fragment --><p>The above example returns HTTP OK. If content is supposed to be returned, then use:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">... <span class="comment">//</span></div><div class="line">soap-&gt;<a class="code" href="structsoap.html#ae5e98733a4349b5e1466a9e0ccc22c11">http_content</a> = <span class="stringliteral">&quot;image/jpeg&quot;</span>; <span class="comment">// a jpeg image to return back </span></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga0390e58bd2a3ebe6fe3a46de0534a614">soap_response</a>(soap, <a class="code" href="group__group__io.html#ga05be99343f556fe70940145e874cdb99">SOAP_FILE</a>)) <span class="comment">// SOAP_FILE sets custom http content </span></div><div class="line"> || <a class="code" href="group__group__io.html#gab3b1ba631a0c47d67fe31474982bde86">soap_send_raw</a>(soap, buf, len) <span class="comment">// send image </span></div><div class="line"> || <a class="code" href="group__group__io.html#ga290ddb46afdbf5ec6669b6ac8daca5c9">soap_end_send</a>(soap)</div><div class="line">  return <a class="code" href="group__group__io.html#ga06d59094afa3df6b1b9f6b2bb484207c">soap_closesock</a>(soap);</div><div class="line">return <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>;</div></div><!-- fragment --><p>For client applications to use HTTP POST, use the <code><a class="el" href="group__group__io.html#gaf502246613cb6d4ea120965065d8c0b2" title="HTTP POST content to server. ">soap_POST</a></code> operation:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">... <span class="comment">//</span></div><div class="line"><span class="keywordtype">char</span> *<a class="code" href="structsoap.html#acda1736fbaac07261226befe165a5681">buf</a>; <span class="comment">// holds the HTTP request/response body data </span></div><div class="line"><span class="keywordtype">size_t</span> len; <span class="comment">// length of data </span></div><div class="line">... <span class="comment">// populate buf and len with message to send</span></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#gaf502246613cb6d4ea120965065d8c0b2">soap_POST</a>(soap, <span class="stringliteral">&quot;URL&quot;</span>, <span class="stringliteral">&quot;SOAP action or NULL&quot;</span>, <span class="stringliteral">&quot;media type&quot;</span>) </div><div class="line"> || <a class="code" href="group__group__io.html#gab3b1ba631a0c47d67fe31474982bde86">soap_send_raw</a>(soap, buf, len); </div><div class="line"> || <a class="code" href="group__group__io.html#ga290ddb46afdbf5ec6669b6ac8daca5c9">soap_end_send</a>(soap)) </div><div class="line"> ... <span class="comment">// error</span></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#gaf4ce538944f65ac97d82bfeaa9345c42">soap_begin_recv</a>(&amp;soap) </div><div class="line"> || (buf = <a class="code" href="group__group__io.html#gae2cd37f875d3314eec314b8723e2ffd8">soap_http_get_body</a>(soap, &amp;len)) == NULL</div><div class="line"> || <a class="code" href="group__group__io.html#ga86b0c04e8baa911fc57e7f1220f9eb8f">soap_end_recv</a>(&amp;soap)) </div><div class="line">  ... <span class="comment">// error</span></div><div class="line"><span class="comment">// ... use buf[0..len-1] </span></div><div class="line"><a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line"><a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div><div class="line"><a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div></div><!-- fragment --><p>Similarly, <code><a class="el" href="group__group__io.html#gae93e23c11379e71baeb6fafe68e14709" title="HTTP PUT content to server. ">soap_PUT</a></code>, <code><a class="el" href="group__group__io.html#ga71eebf1ab266c7480831a2fb10b6ca1a" title="HTTP PATCH content to server. ">soap_PATCH</a></code>, and <code><a class="el" href="group__group__io.html#ga98e63f6969d2d83a31f178728a01c7cc" title="HTTP DELETE content from server. ">soap_DELETE</a></code> commands are provided for PUT, PATCH, and DELETE handling.</p>
<p>To support HTTP pipelining we use the <code><a class="el" href="group__group__io.html#gabebc40cb4df7641874965df27cfd7abc" title="The HTTP pipelining plugin registration function. ">http_pipe</a></code> plugin, which can be used at the server side to enable HTTP pipelining automatically, when registered. The plugin can also be used at the client side, though this is only necessary in scenarios that require the client to receive multiple messages without intermittend sends, i.e. multiple sends followed by multiple receives by the same thread using the same <code><a class="el" href="structsoap.html" title="Context with the engine state. ">soap</a></code> context. However, clients should use multiple threads when HTTP pipelining is used to prevent blocking. See the <em><code>gsoap/samples/async</code></em> folder in the gSOAP package for explanation and examples.</p>
<p>See also <code><a class="el" href="group__group__io.html#ga4c08d5ef28bc0dc37eee4633acdd1140" title="The HTTP POST plugin registration function. ">http_post</a></code> and <code><a class="el" href="group__group__io.html#gabebc40cb4df7641874965df27cfd7abc" title="The HTTP pipelining plugin registration function. ">http_pipe</a></code>.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="httpdaplugin"></a>
The HTTP digest authentication plugin</h3>
<p>The HTTP digest authentication plugin enables a more secure authentication scheme compared to basic authentication. HTTP basic authentication sends unencrypted userids and passwords over the net, while digest authentication does not exchange passwords but exchanges checksums of passwords (and other data such as nonces to avoid replay attacks). For more details, please see RFC 2617.</p>
<p>The HTTP digest authentication can be used next to the built-in basic authentication, or basic authentication can be rejected to tighten security. The server must have a database with userid's and passwords (in plain text form). The client, when challenged by the server, checks the authentication realm provided by the server and sets the userid and passwords for digest authentication. The client application can temporarily store the userid and password for a sequence of message exchanges with the server, which is faster than repeated authorization challenges and authentication responses.</p>
<p>At the client side, the plugin is registered and service invocations are checked for authorization challenges (HTTP error code 401). When the server challenges the client, the client should set the userid and password and retry the invocation. The client can determine the userid and password based on the authentication realm part of the server's challenge. The authentication information can be temporarily saved for multiple invocations.</p>
<p>Client-side example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;httpda.h&quot;</span> </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">  <span class="keywordflow">if</span> <a class="code" href="group__group__plugin.html#gad645e5a58ed442fe4753dcc2338c8bdb">soap_register_plugin</a>(soap, http_da)) </div><div class="line">    exit(EXIT_FAILURE); <span class="comment">// failed to register </span></div><div class="line">  <span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, ...)) </div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#ab85f5d42702963d13ea540bd9876e6d2">error</a> == 401) <span class="comment">// challenge: HTTP authentication required </span></div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (!strcmp(soap-&gt;<a class="code" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd">authrealm</a>, <a class="code" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd">authrealm</a>)) <span class="comment">// optionally determine authentication realm</span></div><div class="line">      {</div><div class="line">        <span class="keyword">struct </span>http_da_info info; <span class="comment">// to store userid and passwd </span></div><div class="line">        http_da_save(soap, &amp;info, authrealm, userid, passwd); <span class="comment">// set userid and passwd for this realm</span></div><div class="line">        <span class="keywordflow">if</span> (soap_call_ns__webmethod(soap, ...)) <span class="comment">// retry </span></div><div class="line">        {</div><div class="line">          ... <span class="comment">//</span></div><div class="line">          <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap); <span class="comment">// userid and passwd were deallocated </span></div><div class="line">          http_da_restore(soap, &amp;info); <span class="comment">// restore userid and passwd </span></div><div class="line">          <span class="keywordflow">if</span> (!soap_call_ns__webmethod(soap, ...)) <span class="comment">// another call </span></div><div class="line">            ... <span class="comment">//</span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    }</div><div class="line">  }</div><div class="line">  http_da_release(soap, &amp;info); <span class="comment">// to remove all userid and passwd</span></div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div><div class="line">}</div></div><!-- fragment --><p>This code supports both basic and digest authentication.</p>
<p>The server can challenge a client using HTTP code 401. With the plugin, HTTP digest authentication challenges are send. Without the plugin, basic authentication challenges are send.</p>
<p>Each server method can implement authentication as desired and may enforce digest authentication or may also accept basic authentication responses. To verify digest authentication responses, the server should compute and compare the checksums using the plugin's <code>http_da_verify_post</code> function for HTTP POST requests (and <code>http_da_verify_get</code> for HTTP GET requests with the HTTP GET plugin) as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;httpda.h&quot;</span> </div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>soap *soap = <a class="code" href="group__group__context.html#ga87c20488b2dc680aaa7689b1d024989c">soap_new</a>();</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__plugin.html#gad645e5a58ed442fe4753dcc2338c8bdb">soap_register_plugin</a>(soap, http_da)) </div><div class="line">    exit(EXIT_FAILURE); <span class="comment">// failed to register </span></div><div class="line">  ... <span class="comment">// use soap_bind and soap_accept in a (multi-threaded) service loop</span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__group__io.html#ga51dba7706a505240bd8935c0b28e419d">soap_serve</a>(soap))</div><div class="line">    <a class="code" href="group__group__fault.html#ga931a4ab6df2553b48a0c270f8a0a88af">soap_print_fault</a>(soap, stderr);</div><div class="line">  ... <span class="comment">//</span></div><div class="line">  <a class="code" href="group__group__context.html#gaf7d0176161e9def36981e24faa1913d9">soap_destroy</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga81a009ae1ea825a05e5241e2b7a8ece9">soap_end</a>(soap);</div><div class="line">  <a class="code" href="group__group__context.html#ga57108ca4681186e58b5b189c3528f10a">soap_free</a>(soap);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ns__webmethod(<span class="keyword">struct</span> soap *soap, ...) </div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a2ede02095d98942f4c220fd17b495703">userid</a> &amp;&amp; soap-&gt;<a class="code" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3">passwd</a>) <span class="comment">// client used basic authentication </span></div><div class="line">  {</div><div class="line">    <span class="comment">// may decide not to handle, but if ok then go ahead and compare info: </span></div><div class="line">    <span class="keywordflow">if</span> (!strcmp(soap-&gt;<a class="code" href="structsoap.html#a2ede02095d98942f4c220fd17b495703">userid</a>, <a class="code" href="structsoap.html#a2ede02095d98942f4c220fd17b495703">userid</a>) &amp;&amp; !strcmp(soap-&gt;<a class="code" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3">passwd</a>, <a class="code" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3">passwd</a>)) </div><div class="line">    {</div><div class="line">      ... <span class="comment">// handle request</span></div><div class="line">      <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">    } </div><div class="line">  } </div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (soap-&gt;<a class="code" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd">authrealm</a> &amp;&amp; soap-&gt;<a class="code" href="structsoap.html#a2ede02095d98942f4c220fd17b495703">userid</a>) <span class="comment">// Digest authentication </span></div><div class="line">  {</div><div class="line">    <a class="code" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3">passwd</a> = ...; <span class="comment">// database lookup on userid and authrealm to find passwd </span></div><div class="line">    <span class="keywordflow">if</span> (!strcmp(soap-&gt;<a class="code" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd">authrealm</a>, <a class="code" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd">authrealm</a>) &amp;&amp; !strcmp(soap-&gt;<a class="code" href="structsoap.html#a2ede02095d98942f4c220fd17b495703">userid</a>, <a class="code" href="structsoap.html#a2ede02095d98942f4c220fd17b495703">userid</a>)) </div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (!http_da_verify_post(soap, <a class="code" href="structsoap.html#a22d219c98f0fcf456641277cc64174a3">passwd</a>)) </div><div class="line">      {</div><div class="line">        ... <span class="comment">// handle request</span></div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__group__errors.html#ga3b10a68f354f39cbb0fe0d043ad4c7c0">SOAP_OK</a>; </div><div class="line">      } </div><div class="line">    } </div><div class="line">  } </div><div class="line">  soap-&gt;<a class="code" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd">authrealm</a> = <a class="code" href="structsoap.html#a8dbe57d59f683d99305a44b4d7939bfd">authrealm</a>; <span class="comment">// set realm for challenge </span></div><div class="line">  <span class="keywordflow">return</span> 401; <span class="comment">// Not authorized, challenge digest authentication </span></div><div class="line">}</div></div><!-- fragment --><p>For more details, including how to configure HTTP Digest authentication for proxies, see the <a href="../../httpda/html/httpda.html">HTTP digest authentication plugin</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="sessionsplugin"></a>
The HTTP sessions plugin</h3>
<p>The plugin code is located in the <em><code>gsoap/plugin</code></em> directory containing <em><code>sessions.h</code></em> and <em><code>sessions.c</code></em>.</p>
<p>For more details, see the <a href="../../sessions/html/index.html">HTTP sessions plugin</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="apacheplugin"></a>
The Apache module plugin</h3>
<p>The plugin code is located in the <em><code>gsoap/mod_gsoap/mod_gsoap-0.9/apache_20</code></em> directory.</p>
<p>For more details, see the <a href="../../apache/html/index.html">Apache module</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="isapiplugin"></a>
The ISAPI extension plugin</h3>
<p>The plugin code is located in the <em><code>gsoap/mod_gsoap/gsoap_win/isapi</code></em> directory.</p>
<p>For more details, see the <a href="../../isapi/html/index.html">ISAPI extension</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="curlplugin"></a>
The CURL plugin</h3>
<p>The plugin code is located in the <em><code>gsoap/plugin</code></em> directory containing <em><code>curlapi.h</code></em> and <em><code>curlapi.c</code></em>.</p>
<p>For more details, see the <a href="../../curl/html/index.html">CURL plugin</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wininetplugin"></a>
The WinInet plugin</h3>
<p>The plugin code is located in the <em><code>gsoap/mod_gsoap/gsoap_win/wininet</code></em> directory.</p>
<p>For more details, see the <a href="../../wininet/html/index.html">WinInet plugin</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsaplugin"></a>
The WS-Addressing plugin</h3>
<p>The plugin code is located in the <em><code>gsoap/plugin</code></em> directory containing <em><code>wsaapi.h</code></em> and <em><code>wsaapi.c</code></em> (to be used in C and C++).</p>
<p>To enable WS-Addressing 2005 (and support for 8/2004), the service definitions header file for soapcpp2 should include the following imports:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;import/wsa5.h&quot;</span></div></div><!-- fragment --><p>This imports the SOAP header elements required by WS-Addressing.</p>
<p>For more details, see the <a href="../../wsa/html/wsa_0.html">WS-Addressing plugin</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsrmplugin"></a>
The WS-ReliableMessaging plugin</h3>
<p>The plugin code is located in the <em><code>gsoap/plugin</code></em> directory containing <em><code>wsrmapi.h</code></em> and <em><code>wsrmapi.c</code></em> (to be used in C and C++).</p>
<p>Also needed are <em><code>threads.h</code></em> and <em><code>threads.c</code></em> for multi-threading and locking support.</p>
<p>To enable WS-ReliableMessaging, the service definitions header file for soapcpp2 should include the following imports:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;import/wsrm.h&quot;</span> </div><div class="line"><span class="preprocessor">#import &quot;import/wsa5.h&quot;</span></div></div><!-- fragment --><p>This imports the SOAP header elements required by WS-ReliableMessaging.</p>
<p>For more details, see the <a href="../../wsrm/html/wsrm_0.html">WS-ReliableMessaging plugin</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsseplugin"></a>
The WS-Security plugin</h3>
<p>The plugin code is located in the <em><code>gsoap/plugin</code></em> directory containing <em><code>wsseapi.h</code></em> and <em><code>wsseapi.c</code></em> (to be used in C and C++).</p>
<p>Also needed are: <em><code>smdevp.h</code></em> and <em><code>smdevp.c</code></em> for streaming XML signature and message digest engine, <em><code>mecevp.h</code></em> and <em><code>mecevp.c</code></em> for the streaming XML encryption engine, <em><code>threads.h</code></em> and <em><code>threads.c</code></em> for multi-threading and locking support.</p>
<p>To enable WS-Security, the service definitions header file for soapcpp2 should include the following imports:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#import &quot;import/wsse.h&quot;</span></div></div><!-- fragment --><p>This imports the SOAP header elements required by WS-Security.</p>
<p>For more details, see the <a href="../../wsse/html/wsse.html">WS-Security plugin</a> documentation.</p>
<p>🔝 <a href="#">Back to table of contents</a></p>
<h3><a class="anchor" id="wsddplugin"></a>
The WS-Discovery plugin</h3>
<p>Basically, to add WS-Discovery support the following event handlers must be defined and linked:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> wsdd_event_Hello(<span class="keyword">struct</span> soap *soap, </div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> InstanceId, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *SequenceId, </div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MessageNumber, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *MessageID, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *RelatesTo, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *EndpointReference, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *Types, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *Scopes, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *MatchBy, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *XAddrs, </div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MetadataVersion)</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">void</span> wsdd_event_Bye(<span class="keyword">struct</span> soap *soap, </div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> InstanceId, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *SequenceId, </div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MessageNumber, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *MessageID, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *RelatesTo, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *EndpointReference, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *Types, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *Scopes, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *MatchBy, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *XAddrs, </div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MetadataVersion)</div></div><!-- fragment --><div class="fragment"><div class="line">soap_wsdd_mode wsdd_event_Probe(<span class="keyword">struct</span> soap *soap, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *MessageID, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *ReplyTo, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *Types, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *Scopes, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *MatchBy, </div><div class="line"><span class="keyword">struct</span> wsdd__ProbeMatchesType *ProbeMatches)</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">void</span> wsdd_event_ProbeMatches(<span class="keyword">struct</span> soap *soap, </div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> InstanceId, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *SequenceId, </div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MessageNumber, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *MessageID, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *RelatesTo, </div><div class="line"><span class="keyword">struct</span> wsdd__ProbeMatchesType *ProbeMatches)</div></div><!-- fragment --><div class="fragment"><div class="line">soap_wsdd_mode wsdd_event_Resolve(<span class="keyword">struct</span> soap *soap, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *MessageID, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *ReplyTo, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *EndpointReference, </div><div class="line"><span class="keyword">struct</span> wsdd__ResolveMatchesType *ResolveMatches)</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">void</span> wsdd_event_ResolveMatches(<span class="keyword">struct</span> soap *soap, </div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> InstanceId, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *SequenceId, </div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MessageNumber, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *MessageID, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *RelatesTo, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *EndpointReference, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *Types, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *Scopes, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *MatchBy, </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *XAddrs, </div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MetadataVersion)</div></div><!-- fragment --><p>These event handlers will be invoked when inbound WS-Discovery messages arrive using:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!<a class="code" href="group__group__soap.html#gaaae8747f4cdacee575875c3a2488d99c">soap_valid_socket</a>(<a class="code" href="group__group__io.html#ga0a9725a3edbc27b97456190fee47cc18">soap_bind</a>(soap, NULL, port, BACKLOG))) </div><div class="line">  ... <span class="comment">// error </span></div><div class="line"><span class="keywordflow">if</span> (soap_wsdd_listen(soap, timeout)) </div><div class="line">  ... <span class="comment">// error</span></div></div><!-- fragment --><p>which will listen for <code>timeout</code> seconds to inbound WS-Discovery messages on a port and dispatches them to the event handlers. A negative <code>timeout</code> value specifies the timeout in microseconds.</p>
<p>For more details, see the <a href="../../wsdd/html/wsdd_0.html">WS-Discovery plugin</a> documentation.</p>
<h1><a class="anchor" id="copyright"></a>
Copyright                                                           </h1>
<p><em>Copyright (c) 2000-2020, Robert A. van Engelen, Genivia Inc.<br />
All rights reserved.</em> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<hr class="footer">
<address class="footer">
Copyright (C) 2020, Robert van Engelen, Genivia Inc., All Rights Reserved.
</address>
<address class="footer"><small>
Converted on Wed Apr 8 2020 15:47:05 by <a target="_blank" href="http://www.doxygen.org/index.html">Doxygen</a> 1.8.11</small></address>
<br>
<div style="height: 246px; background: #DBDBDB;">
</body>
</html>
